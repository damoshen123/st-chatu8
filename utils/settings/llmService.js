(function(_0x531354,_0xa1e9b3){const _0x5b6e04=_0x531354();function _0x401593(_0x385562,_0x162534,_0x28bc72,_0x30c359){return _0x4e4a(_0x162534- -0x335,_0x385562);}function _0x3f6ddb(_0x7b630d,_0x39c19,_0xa895dd,_0xe1e5da){return _0x4e4a(_0x39c19- -0x172,_0xe1e5da);}while(!![]){try{const _0x562d87=parseInt(_0x401593(-0x1dc,-0x172,-0x165,-0x203))/(0x6d*-0x1a+-0x106b+0x1b7e)+-parseInt(_0x3f6ddb(0xf,0x4f,0xe1,0x81))/(-0xef3+-0x1*0x1561+0x2456)+parseInt(_0x3f6ddb(0xf4,0x10e,0xf8,0xd7))/(0x1*0x1164+-0x2539+0x13d8)*(parseInt(_0x401593(-0x77,-0x81,0x24,0x22))/(0x56e+-0x1*0x4a5+-0xc5))+-parseInt(_0x3f6ddb(0x33,0x59,0x82,-0x38))/(0x1*-0x5c9+0x135d+-0xd8f)*(parseInt(_0x401593(-0x207,-0x16c,-0xd8,-0x196))/(-0xce*0x17+-0x9*0x1a3+0x2143))+-parseInt(_0x401593(-0x57,-0xb9,-0xa8,-0xfa))/(-0x1ea3+-0x26cf+0x4579)+-parseInt(_0x3f6ddb(0x60,0xd4,0xa9,0x11c))/(-0x710*0x5+0x8*-0x3c1+0x4160)+parseInt(_0x3f6ddb(0x87,0x9b,0x143,0x83))/(0x2b*-0x8b+0x1aa6+-0x16*0x26);if(_0x562d87===_0xa1e9b3)break;else _0x5b6e04['push'](_0x5b6e04['shift']());}catch(_0x8b3975){_0x5b6e04['push'](_0x5b6e04['shift']());}}}(_0x3135,0x1766f*0x4+-0xa3b35+0xa4464));const _0x2f8d9e=(function(){function _0x3731d3(_0x26453b,_0x441fa6,_0x473d65,_0x340b86){return _0x4e4a(_0x340b86- -0x15,_0x26453b);}const _0x42a009={};_0x42a009[_0x2b6095(-0x7f,-0x118,-0x5c,0x1f)]=function(_0x54c59b,_0x2d43a5){return _0x54c59b!==_0x2d43a5;},_0x42a009['qgDst']=_0x2b6095(-0xc4,-0x69,-0xc1,-0xbd);function _0x2b6095(_0x3b7721,_0x3b1ea2,_0xb2de42,_0x2a604a){return _0x4e4a(_0x3b7721- -0x323,_0x3b1ea2);}_0x42a009[_0x2b6095(-0xe8,-0x95,-0xd3,-0x62)]=_0x3731d3(0xe3,0x133,0x19a,0x170);const _0x22723e=_0x42a009;let _0x1464ab=!![];return function(_0x267889,_0x33bbd6){const _0xf1592e=_0x1464ab?function(){const _0x715769={};_0x715769[_0x1c19e6(0xb4,0x111,0x13d,0x124)]=_0x1c19e6(0xc6,0x10a,0x10f,0x14a)+_0x1a1a43(0x5a,0x5d,0x16,0xc2);const _0x57b182=_0x715769;function _0x1c19e6(_0x2dfe32,_0x4b2d41,_0x8ab705,_0x37d5e2){return _0x4e4a(_0x4b2d41- -0x6e,_0x2dfe32);}function _0x1a1a43(_0x352042,_0x24905c,_0x268a51,_0x4b1e99){return _0x4e4a(_0x352042- -0x156,_0x4b1e99);}if(_0x33bbd6){if(_0x22723e[_0x1a1a43(0x14e,0x15a,0x109,0xcf)](_0x22723e[_0x1a1a43(0x93,0xa1,0xe7,0x9c)],_0x22723e[_0x1c19e6(0x186,0x1cd,0x268,0x218)])){const _0x5d5040=_0x33bbd6['apply'](_0x267889,arguments);return _0x33bbd6=null,_0x5d5040;}else _0x515f41[_0x1c19e6(0xbf,0x107,0x10a,0x84)](),_0x1321d7['info'](_0x57b182[_0x1c19e6(0x13e,0x111,0xe0,0x147)]);}}:function(){};return _0x1464ab=![],_0xf1592e;};}()),_0x45c91d=_0x2f8d9e(this,function(){const _0x28ccc5={};function _0x1c3a8e(_0x5c9d45,_0x547ff1,_0x5c5be0,_0x254382){return _0x4e4a(_0x547ff1-0x14c,_0x5c5be0);}_0x28ccc5[_0x1c3a8e(0x2d2,0x33d,0x3d6,0x3a5)]=_0x2b8754(0x490,0x495,0x463,0x538)+'+$';const _0x2489ca=_0x28ccc5;function _0x2b8754(_0x528703,_0x5a4eb5,_0x3a2695,_0x117e42){return _0x4e4a(_0x528703-0x2f0,_0x117e42);}return _0x45c91d['toString']()[_0x2b8754(0x535,0x51b,0x598,0x517)](_0x2489ca[_0x1c3a8e(0x39e,0x33d,0x3d8,0x2a5)])['toString']()['constructo'+'r'](_0x45c91d)[_0x1c3a8e(0x35c,0x391,0x386,0x355)](_0x2489ca['AswOf']);});_0x45c91d();import{extension_settings}from'../../../../../extensions.js';import{eventSource}from'../../../../../../script.js';import{extensionName,eventNames,LLMRequestTypes}from'../config.js';import{getRequestHeaders,clearLog,addLog}from'../utils.js';import{startFabLoading,stopFabLoading}from'./fab.js';import{checkTriggerWords,mergeAdjacentMessages}from'../promptProcessor.js';import{processRollPlaceholders}from'./rollProcessor.js';import{taskQueue,TaskType,TaskStatus}from'../taskQueue.js';function _0x43fdb1(_0x1defac,_0x5bd86f,_0x4559f7,_0x5dd590){return _0x4e4a(_0x1defac- -0x2e0,_0x4559f7);}function _0x3135(){const _0x17c7e1=['B2fgBu4','5O+q56s66k+n6i635y+w6k+35RgcicHj','zgf0ytOG','DxnLCG','mta3nJm0nLjNtvbrtq','l2fWAs9IywnRzq','mZKWotzgBNPUvgC','D2jszeC','AuzuDxe','ANnVBG','ksa9pt09pq','rgXMzuq','mZu0ruzoDhLc','zw5HyMXLza','nJuZmZvNrgzRBMS','z290t0C','zgf0ytOGw0rptG','v25mwva','teXnoIa','wMnyDNi','Dg9Rzw4','EKz5wuu','s0HNtei','Aw5MBW','y2ryBfG','zwfmtxK','ueKGs2v5lcdMIjyG','ALvTCMu','BMn0q1m','lcdNUQyG','yKHrCwq','5Q2J5zYO5Ase55cgia','rv9srvnqt05trq','uenXqwu','zNnksw4','BwvZC2fNzq','B2zPBgu','DgLTzu91Da','ywrKvgfZAW','AxnbCNjHEq','oIbbueKGvvjmla','5lUJ56cboIa','y2fUy2vSx2XSBq','Aw9HCuO','CwDeC3q','44cq5Rwl6k+v5QIH5BYp44cr','rNDzzxa','BgvUz3rO','C3rFy29UDgv4Da','5Q2J5zYO5Ase55cg5Asw6yoO6k+35Rgc77Ym6k+3','t3buChK','CMvWBgfJzq','qxn3t2y','5PYQ5Ps25yIW5PYj5Pwi5zUE5Asn44cc','Dgv2qKC','Awf1tgG','zgjUufu','DKnevwO','y3vYCMvUDf9SBa','8j+tTYbB55sO5OI35lIk5lYG55Qe5zU+54Mh','tw9KzwWG5PYQ6ywn572U44cc','sKDLCw8','zxiG','x3bYB2zPBgu','sxHQzeq','sNjJy1u','vKf0ChK','Bvnbwfy','C3bSAxq','uxferLi','uNn5teG','C2v0','zgDHDfu','6kEs6iMYl+ACJEIJHEIUVUIUOq','tKjjtfm','wvvgvfi','zgvSDge','DvHrELm','B2jQzwn0','s2L6rLa','mtG5mZqXmJHsv1P5qNe','CM1PyKC','y29UDgvUDa','BgXTvgvZDe1Vza','teXn','y3vZDg9T','s0TXBK4','C3rHDhvZ','wNflBKm','Bwf4x3rVA2vUCW','tKHoANK','zxjYB3i','5Pwi5zUE5Asn44cc','qwjVCNrfCNjVCG','uKnPv3i','zgzkA28','rhPKu0u','u2DXBfm','yKXtA0C','wuTTq3u','zhLqy1a','yM9KEq','DgvZDf9JB250zq','AK1cAui','CLrOzeG','y3vYCMvUDf90zq','DxbKyxrLu3rHDa','B21WBgv0Aw9UCW','uwHfBw0','CM91BMq','C3rHDhvZvgv4Da','zgvJB2rL','ve96ugq','r1rLrfe','pt09pt0GteXnia','ALvIzui','DhLWzq','t1zgy3i','Aw1Hz2vFDxjS','Bv9WCM9MAwXL','D2fYBMLUzW','z2v0','AM9PBG','zg1Vqu0','vej4AwC','zxrPB25FC291CG','tNnxqu0','yxbPx3bYB2zPBa','Df90ExbLx2nVBG','B095yMq','CMvHza','sLDSEeO','oIbmte0G5PYQ5Ps25yIW5PYj','BgXTx3jLCxvLCW','EwDAwxi','5y+r6ycb55QeifbYB21WDa','C2vHCMnO','mti4mJCYmgreEwz6uq','wK9ys3e','s0jD','BfPYELu','z0zMDge','6kEs6iMYl+ACJEIJHEwXLEEKUG','DKrpzfq','qxbhr0O','tgrUyMS','s01zzgC','uKPJweW','teXnioIVT+AXGUw3SUs4REATOUoaGG','CgX0u1K','AeLgC1C','se9wDhy','iowBNUwKJsaTls0Tlq','AgLZDg9YEq','CMvZDwX0','tNjKv24','wvnYqNy','yxbPx2TLEq','56In5yczlI4U','zgf0ytO','yxbWBhK','5Rwb5BYp6kEJ5P6q6k2M5zgkoG','CxzIvxC','C1jIwhO','s1vUvMO','renYvKW','A2v5CW','uwreveq','z1vduvi','EhrFChjVzMLSzq','q0foq0vmteve','DKnVD2u','Cxb6rxO','y2HHCL9KAxnWBa','6k+35RgcieLeoIa','ChjVBxb0','qvbjifvstcWGqq','rgPlvMK','C3rFy2HHDhu4xW','CMvWzwf0','rhnPqLO','teXnx0vyrunvva','Dg9Wx3a','EwDewvy','ChvZAa','AgLJvgW','5Rwl6k+v5QIH5BYp5O+q56s6','r2P4vNG','6BUy6k6K6k+35Rgc5BYa5AElid09pq','Aw9UoIaIqMvHCG','zw1PDa','mZyWodG0m3PnzxrPCq','zhf1qKu','ELPOEK8','CMjbvgK','mteZotq5weHAwhfu','yxbPx3vYBa','Dg9VBa','CgfYC2u','r2P0uuO','t0j5wMK','uMvXDwvZDcbHyG','zhniu0u','zMLNCW','uLvotKLorW','DvHABKS','cI0Tls0TieXmtq','uefqzhm','BhvKzv9OzwfKzq','D2PKteO','DgvTCgvYyxr1CG','6k+35Rgc6zsz6k+VoIa','iefqssblzxKSia','y2HVAwnLCW','Dgv4Da','Cg9W','sejss3C','s3j5C24','l2DLBMvYyxrL','C3rYAw5NAwz5','tujoEgu','Aw1Hz2vFz2vU','se5Kzeu','tuHNr3y','y2HHDf9JB21WBa','teXnigv4zwn1Da','DfnUqxG','B3j0zwq','uvHjrgq','ioIVT+AXGUw3SUwUJoAiKo+8JowqJUE7REAtJq','CvfqqKO','BwvqwKu','zw50CMLLCW','C3LZDgvT','vwHbuKC','DhLWvfu','CMnmuNy','A0PlCuy','C3rHCNrZv2L0Aa','57g75z6loG','C2LNBMfS','Bw9KzwW','u0XgqKW','zLP2tMS','uvD4vuC','5Q2J5PAh5zU+54Mh55sF5OIq','zu5ovw0','mJrqA0Duwfe','r0PJr2G','m3WXFdj8mhW0','5Rwb5BYp6kEJ5P6q6k2M5zgkicJMNidLKi4','y29Kzq','BwvZC2fNzxm','r1PtB2y','Duz2B1i','C3rYzwfT','zwn4ruO','ALnACeG','zKPcv20','zsbYzxf1zxn0ia','t2DcsLG','CgHeDem','6k+35Rgc5A6m5OIqid09pt09','sez0ELu','shDvrwm','CNL0Bvi','ioAuTUwiSa','z0PWDM8','r3DJAMG','BejTt00','57o757UF5O+q56s66k+n','wujIv0K','t21dB2e','C2XPy2u','CMP3ufO','CM9Szq','5yE95PwW6lcd55sO','wKL1BeG','5l2C5BEY6lEZ6l+h44cc','Bg9N','ievYCM9YoG','ywjVCNq','qu5MBhu','DhjHBNnSyxrPBW','teXn6k+35Rgc5BEY5lIT5PAT77Ym5BYa','z2v0uMvHzgvY','rvHlrxa','CuXPBey','C3vJy2vZCW','tKj4AKO','6k+35Rgc5BYa5AElicG','EffuBxe','EhPdtu0','zM9YrwfJAa','DLnKwhm','EhbOuem','s3DiEwW','z3L6v1e','tMXRAe8','qKfhyLG','AuXLB2S','vwnbq1O','vLbtEeG','D2fYBG','zgHszhe','teXnioACQUAuTUwiSoACIEAvIowBNG','BMfTzq','tuXttLy','qLDxwKi','yxnZAxn0yw50','zgvSzxrL','mNWWFdf8nhWZFa','qwDXzLK','D3nnrgi','C3qTy2HHDhu4oG','Aw5JBhvKzxm','t1r4sei','y29UDgv4Da','Exb4rKG','ioIVT+AXGU+8JoIVT+EOJEwaMs4UlG','qxv0Ag9YAxPHDa','BgXkwgO','vKr0DgW','yK5Lsgm','kcGOlISPkYKRkq','zLn2DwK','57g75z6loIa','suLjDw8','BgXTx3bYB2zPBa','y1nLDLy','ue9tva','sMTjwwm','ENDQs3a','sLnwANa','uwz2Aem','y2HHCL9KzxnPzW','t2XrD3O','DgfNx21VzgLMEq','DhjPBq','Dg9Uvfi','5AEl5PAW6k+35Rgc44cc','ExDJrge','y29UDgv4Df9WCG','BMrZl2nOyxqTyW','6k+35Rgc5AsX6lsLoIa','z2HIu0K','t2nTtfi','8j+tTYbB5zU+54Mh6zo+5O6LoIa','DhjPz2DLCK1Vza','Dwffzhe','zKnRyvy','DwXRDxa','rdOG'];_0x3135=function(){return _0x17c7e1;};return _0x3135();}let currentLLMRequestController=null;const llmTaskControllers=new Map();eventSource['on'](_0x43fdb1(-0x71,-0x14,-0x33,-0x11c)+_0x2b23e9(0x4a0,0x4e5,0x55c,0x4b7)+'_task',({taskId:_0x25fa15})=>{function _0x4c3950(_0x103f70,_0x4e98b0,_0x508682,_0x5777b6){return _0x43fdb1(_0x4e98b0-0x2c8,_0x4e98b0-0x1d6,_0x5777b6,_0x5777b6-0xe9);}const _0x4ea352=llmTaskControllers[_0x4c3950(0x284,0x21e,0x2c6,0x25c)](_0x25fa15);function _0x597b44(_0x2e6559,_0x7855ec,_0x40d6a5,_0x21e9e5){return _0x2b23e9(_0x2e6559-0x172,_0x7855ec- -0x63f,_0x2e6559,_0x21e9e5-0x96);}_0x4ea352&&(_0x4ea352[_0x597b44(-0x196,-0x1cc,-0x17b,-0x263)](),llmTaskControllers[_0x597b44(-0x18f,-0x1af,-0x15b,-0x18b)](_0x25fa15),console[_0x597b44(-0x22c,-0x1ce,-0x15c,-0x222)]('[LLM]\x20任务已取'+'消:\x20'+_0x25fa15));});export function getLLMRequestController(){return currentLLMRequestController;}export function setLLMRequestController(_0x4ea8e0){currentLLMRequestController=_0x4ea8e0;}export function isLLMRequestActive(){return!!currentLLMRequestController;}export function abortLLMRequest(){const _0x1aa7ba={};_0x1aa7ba['xzCMM']=function(_0x1d9b0a,_0x580e23){return _0x1d9b0a!==_0x580e23;},_0x1aa7ba[_0x14d9c1(0x388,0x362,0x3d8,0x32c)]=_0x14d9c1(0x33e,0x3d0,0x36b,0x415);function _0x14d9c1(_0xe7014b,_0x4fa62,_0x5a981a,_0x6befa3){return _0x43fdb1(_0x5a981a-0x3fa,_0x4fa62-0x2b,_0x6befa3,_0x6befa3-0x10a);}function _0x7333de(_0xfe4773,_0x3efbda,_0x387ff1,_0x22bd27){return _0x2b23e9(_0xfe4773-0x14a,_0x387ff1- -0x2f,_0x22bd27,_0x22bd27-0x171);}const _0x5ab259=_0x1aa7ba;if(currentLLMRequestController){if(_0x5ab259[_0x7333de(0x469,0x42c,0x44f,0x4f1)](_0x14d9c1(0x2f2,0x327,0x2e6,0x2f2),_0x7333de(0x416,0x432,0x4a4,0x485)))currentLLMRequestController[_0x14d9c1(0x254,0x22d,0x28f,0x306)](),toastr[_0x14d9c1(0x2d4,0x2a8,0x2ee,0x2be)](_0x5ab259['jSZpH']);else{const _0x1fa06a=_0x14d9c1(0x2e1,0x3b8,0x387,0x320)+_0x14d9c1(0x2f2,0x270,0x2f1,0x308)+_0x14d9c1(0x3b4,0x2ec,0x313,0x3b0);_0x1c4fb2[_0x7333de(0x567,0x469,0x4e7,0x552)](_0x1fa06a);const _0x4238c7={};_0x4238c7[_0x14d9c1(0x31d,0x2e0,0x296,0x1f8)]=![],_0x4238c7[_0x7333de(0x576,0x5c6,0x526,0x584)]=_0x1fa06a,_0x4238c7['id']=_0x26b61a,_0x4c8014[_0x7333de(0x5d7,0x4e2,0x54a,0x5c2)](_0x39704e[_0x14d9c1(0x339,0x403,0x38c,0x3e9)+_0x14d9c1(0x289,0x3a6,0x2f7,0x2fb)],_0x4238c7);return;}}}export function isLLMTestMode(){return!!extension_settings[extensionName]['llmTestMod'+'e'];}export function formatPromptForDisplay(_0x13cfe9){const _0x5222c6={'QqDFR':'unknown','GjtQJ':function(_0x534842,_0x59a565){return _0x534842/_0x59a565;},'QfvhC':function(_0x56025e,_0x59abf5){return _0x56025e!==_0x59abf5;},'LhfcA':_0x13cd3e(0x49a,0x4d4,0x474,0x4f2),'bLSkG':function(_0xb10b1e,_0x474e5a){return _0xb10b1e*_0x474e5a;},'ulkup':_0x13cd3e(0x31b,0x3b7,0x359,0x391)+'始新请求。','OpTpy':_0x5dbc5f(0x23a,0x292,0x230,0x252),'rcLRv':function(_0x2827f0,_0x1dfabf){return _0x2827f0(_0x1dfabf);},'Figkc':function(_0x9b9d5,_0x4ae9c1){return _0x9b9d5===_0x4ae9c1;},'ygDYV':'string','MLSNV':_0x13cd3e(0x320,0x3ef,0x397,0x3c4),'dmoAM':function(_0x59ead4,_0x40929a){return _0x59ead4===_0x40929a;},'wjdLJ':'brXcL','ZIulH':function(_0x8d2fa4,_0x538335){return _0x8d2fa4===_0x538335;}};function _0x5dbc5f(_0xd83736,_0x35ac0c,_0x51e26f,_0x46ed40){return _0x2b23e9(_0xd83736-0xd9,_0x46ed40- -0x30c,_0x51e26f,_0x46ed40-0x91);}if(_0x5222c6[_0x5dbc5f(0xf8,0x111,0xcb,0x163)](typeof _0x13cfe9,'string'))return _0x13cfe9;if(Array[_0x5dbc5f(0x168,0x27d,0x1ba,0x1d6)](_0x13cfe9)){const _0x48460d=[];return _0x13cfe9[_0x13cd3e(0x2e4,0x3c3,0x362,0x3f2)]((_0x28cd2b,_0x2860d0)=>{const _0x14d966={'Krysn':_0x5222c6['QqDFR'],'cSevV':function(_0x557e4b,_0x196dea){function _0x2ea200(_0x304237,_0x454fd9,_0x5bd67a,_0xb10ea5){return _0x4e4a(_0x454fd9- -0x348,_0x5bd67a);}return _0x5222c6[_0x2ea200(-0x151,-0xc4,-0x13f,-0x26)](_0x557e4b,_0x196dea);},'izigq':function(_0x47f878,_0x16a013){function _0x878ce0(_0x573046,_0x14adfa,_0x985e7e,_0xda9609){return _0x4e4a(_0x573046-0x1a5,_0xda9609);}return _0x5222c6[_0x878ce0(0x34f,0x2d8,0x3a9,0x3e0)](_0x47f878,_0x16a013);},'UcACZ':_0x182bf7(-0x106,-0x109,-0x9f,-0x1ae),'fCkaV':'AGoqh','kJKqF':function(_0x5ea235,_0x2d7cba){return _0x5ea235===_0x2d7cba;},'WvQZv':_0x5222c6['LhfcA'],'KHgLB':_0x10d81f(0x26c,0x28c,0x257,0x29d),'PWRUy':_0x182bf7(-0x3a,-0x9b,-0x3,0x62),'lWsBA':function(_0x150f6a,_0x1e138a){function _0x1e2c93(_0x312930,_0x571114,_0x205bb9,_0x28d8f3){return _0x182bf7(_0x28d8f3-0x3ed,_0x571114-0xf6,_0x205bb9-0xbb,_0x205bb9);}return _0x5222c6[_0x1e2c93(0x3c3,0x382,0x363,0x3db)](_0x150f6a,_0x1e138a);},'AgqfY':function(_0x28add7,_0x290a49){function _0x3feef5(_0x47f9e1,_0x1b03dc,_0x2bc16c,_0xc3deaf){return _0x10d81f(_0x47f9e1-0x90,_0xc3deaf,_0x2bc16c-0x72,_0x2bc16c- -0xf5);}return _0x5222c6[_0x3feef5(0xf4,0x165,0x194,0x15a)](_0x28add7,_0x290a49);},'BetdG':_0x5222c6[_0x10d81f(0x228,0x17e,0x258,0x225)]};function _0x182bf7(_0x46ac9f,_0x2e5f4c,_0x44cdfc,_0x3a9874){return _0x5dbc5f(_0x46ac9f-0x1ac,_0x2e5f4c-0x1ca,_0x3a9874,_0x46ac9f- -0x288);}function _0x10d81f(_0x279b32,_0x228876,_0x3bd5d5,_0x593ad0){return _0x5dbc5f(_0x279b32-0x4e,_0x228876-0x8a,_0x228876,_0x593ad0-0x78);}if(_0x5222c6[_0x10d81f(0x2eb,0x1f0,0x2cc,0x259)]===_0x5222c6['OpTpy']){const _0x2efaf0=_0x28cd2b[_0x182bf7(-0x127,-0x8c,-0x81,-0xe9)]||_0x5222c6[_0x182bf7(-0x94,-0xcc,-0x35,-0x2e)],_0x4fb010=_0x5222c6[_0x182bf7(0x13,0x95,-0xe,0xbe)](getRoleLabel,_0x2efaf0);_0x48460d[_0x10d81f(0x2d3,0x2a9,0x240,0x2df)](''+'═'[_0x182bf7(-0x26,0x2d,-0x2e,-0x5b)](-0x1*-0xd7+-0x1a74+-0x19cf*-0x1)),_0x48460d[_0x10d81f(0x241,0x30f,0x262,0x2df)]('【'+_0x4fb010+'】'),_0x48460d[_0x10d81f(0x2d7,0x26d,0x2b5,0x2df)](''+'─'['repeat'](-0x21a5+0x153c+0x1cd*0x7));const _0x3f1035=_0x28cd2b[_0x182bf7(-0x87,-0x52,-0x9,-0x25)];if(_0x5222c6['Figkc'](typeof _0x3f1035,_0x5222c6[_0x10d81f(0x2fa,0x38e,0x378,0x2de)])){if(_0x182bf7(0x25,-0x21,0x2,-0x21)!==_0x5222c6[_0x10d81f(0x206,0x209,0x149,0x1f9)])_0x48460d['push'](_0x3f1035);else return;}else{if(Array[_0x182bf7(-0xb2,-0x8a,-0x101,-0x14b)](_0x3f1035)){if(_0x5222c6[_0x10d81f(0x1f7,0x222,0x21f,0x2a2)](_0x5222c6[_0x10d81f(0x27e,0x295,0x295,0x2f8)],'EgdEZ')){const _0x5367b9=_0x3088fa['image_url']?.['url']||'';if(_0x5367b9['startsWith'](_0x182bf7(-0x3a,-0x6c,0x26,-0xb7))){const _0x582bd2=_0x5367b9['match'](/^data:([^;]+);/),_0x9b5d9d=_0x582bd2?_0x582bd2[-0xdee*0x2+0x77c*0x4+-0x213]:_0x14d966[_0x182bf7(0x0,-0x3e,-0x1d,0x35)],_0x52cb7c=_0x5367b9[_0x10d81f(0x27b,0x2fa,0x2e5,0x26b)](',')[-0xa57+0x3*-0xa81+0x85f*0x5]||'',_0x4f85e9=_0x31973f['round'](_0x14d966[_0x182bf7(-0xf1,-0x41,-0x45,-0x12f)](_0x14d966[_0x10d81f(0x2ac,0x29d,0x2a4,0x20f)](_0x52cb7c[_0x10d81f(0x1b8,0x24f,0x1a6,0x256)]*(-0x1da6+-0xf*-0x95+-0x2*-0xa77),0x36*0x73+0x26da+-0x3f18),0x7*-0x446+-0x530+0x271a));_0x2dfd9f[_0x182bf7(-0x21,0x4e,-0x21,-0x58)](_0x10d81f(0x23d,0x2de,0x302,0x262)+':\x20'+_0x9b5d9d+_0x10d81f(0x2e4,0x1ea,0x2ab,0x244)+_0x4f85e9+_0x182bf7(-0x4e,-0x42,-0x14,0x29));}else _0x6f0a6b['push'](_0x10d81f(0x260,0x2b6,0x1fd,0x221)+_0x5367b9+']');}else _0x3f1035[_0x182bf7(-0x115,-0xa8,-0x139,-0x192)](_0x144ea2=>{function _0x3fcbc4(_0x53e6ec,_0x19a875,_0x4c5a7a,_0x40f0ae){return _0x182bf7(_0x19a875-0x541,_0x19a875-0x29,_0x4c5a7a-0x11b,_0x40f0ae);}function _0x5382ec(_0xda0786,_0x21270e,_0x375f37,_0x4fd722){return _0x10d81f(_0xda0786-0x1ce,_0x375f37,_0x375f37-0x17b,_0xda0786-0x29c);}if(_0x14d966['izigq'](_0x14d966[_0x5382ec(0x48f,0x4f6,0x46e,0x4c3)],_0x14d966[_0x5382ec(0x4c0,0x48f,0x475,0x41d)])){if(_0x14d966[_0x3fcbc4(0x5c0,0x555,0x5c6,0x523)](_0x144ea2[_0x5382ec(0x537,0x4c3,0x48a,0x4a8)],_0x14d966['WvQZv']))_0x48460d[_0x3fcbc4(0x572,0x520,0x512,0x56a)](_0x144ea2[_0x5382ec(0x599,0x5d0,0x609,0x509)]||'');else{if(_0x144ea2[_0x3fcbc4(0x43f,0x4dc,0x487,0x54b)]===_0x14d966[_0x3fcbc4(0x3e0,0x47e,0x4bb,0x47c)]){const _0x1ae1a0=_0x144ea2['image_url']?.['url']||'';if(_0x1ae1a0[_0x5382ec(0x5b1,0x634,0x628,0x5cb)](_0x14d966['PWRUy'])){const _0x1acb6c=_0x1ae1a0['match'](/^data:([^;]+);/),_0x36b9a1=_0x1acb6c?_0x1acb6c[0x9b9*-0x4+-0x1b8+0x1*0x289d]:_0x14d966['Krysn'],_0x5c4ed9=_0x1ae1a0[_0x3fcbc4(0x4f3,0x4ac,0x492,0x45a)](',')[-0x1ed9+0x1e3a+0x5*0x20]||'',_0x478773=Math[_0x3fcbc4(0x578,0x4d5,0x4ad,0x558)](_0x14d966['lWsBA'](_0x14d966[_0x3fcbc4(0x448,0x43f,0x493,0x3e0)](_0x5c4ed9['length'],-0x2084+0x1544+-0xb43*-0x1),0x43*-0x3e+-0x15f6*-0x1+0x18*-0x3d)/(0x4*0x75a+0x16*0x24+-0x1c80));_0x48460d[_0x3fcbc4(0x557,0x520,0x4a5,0x4f8)](_0x5382ec(0x4fe,0x551,0x4f8,0x4e9)+':\x20'+_0x36b9a1+_0x5382ec(0x4e0,0x457,0x45b,0x45a)+_0x478773+_0x3fcbc4(0x596,0x4f3,0x57c,0x454));}else _0x48460d['push'](_0x3fcbc4(0x44a,0x462,0x3df,0x3fc)+_0x1ae1a0+']');}}}else _0xf1bb1d=''+_0x5c3508[_0x3fcbc4(0x5d0,0x543,0x594,0x5b7)](_0x54715c[_0x3fcbc4(0x503,0x4c3,0x546,0x4c6)]);});}}_0x48460d['push']('');}else _0x27f6a7[_0x182bf7(-0x121,-0xc9,-0x8c,-0x8b)](),_0x52c3b8['info'](_0x14d966['BetdG']);}),_0x48460d[_0x5dbc5f(0x24c,0x2ba,0x17f,0x229)]('\x0a');}if(typeof _0x13cfe9===_0x13cd3e(0x45c,0x378,0x3ec,0x44b)&&_0x13cfe9!==null)return JSON[_0x5dbc5f(0x30a,0x2a8,0x294,0x28a)](_0x13cfe9,null,0x4f*0x7d+-0x2*-0x22d+-0x2aeb);function _0x13cd3e(_0x1b31f3,_0x519845,_0x5ac74d,_0x32f517){return _0x2b23e9(_0x1b31f3-0x117,_0x5ac74d- -0x11d,_0x32f517,_0x32f517-0xe4);}return String(_0x13cfe9);}export function getRoleLabel(_0x1a0705){const _0x24b288={};_0x24b288[_0x3cd4c0(0x29f,0x1ce,0x263,0x241)]=_0x4d0a3b(-0x7b,-0x93,-0xed,-0x117),_0x24b288[_0x4d0a3b(-0x168,-0x13e,-0x16b,-0x133)]='AI助手',_0x24b288['OTxHB']=_0x3cd4c0(0x2a4,0x211,0x1fb,0x211);const _0xb3f186=_0x24b288;function _0x4d0a3b(_0x2eb956,_0xe71bc7,_0x547d55,_0x44a0bc){return _0x43fdb1(_0x547d55- -0xd8,_0xe71bc7-0x14d,_0xe71bc7,_0x44a0bc-0xdd);}const _0xf0229d={};_0xf0229d[_0x3cd4c0(0x28d,0x313,0x331,0x3ce)]=_0xb3f186['jUmre'];function _0x3cd4c0(_0xcfcbc8,_0x468298,_0xc90ede,_0x39f8a0){return _0x2b23e9(_0xcfcbc8-0x1,_0xc90ede- -0x273,_0xcfcbc8,_0x39f8a0-0x192);}_0xf0229d[_0x3cd4c0(0x256,0x2ac,0x24b,0x2e3)]='用户',_0xf0229d[_0x4d0a3b(-0x222,-0x2c5,-0x227,-0x1b9)]=_0xb3f186[_0x4d0a3b(-0x1b5,-0x124,-0x16b,-0x1c0)],_0xf0229d['function']=_0xb3f186[_0x3cd4c0(0x27f,0x1af,0x223,0x175)],_0xf0229d[_0x3cd4c0(0x319,0x29d,0x30d,0x2a9)]='工具';const _0x5cde94=_0xf0229d;return _0x5cde94[_0x1a0705]||_0x1a0705;}export function getCurrentLLMProfile(){function _0x4e3b3f(_0x4d28a5,_0xd9c604,_0x58cac0,_0x1d6f9a){return _0x43fdb1(_0x58cac0-0x32a,_0xd9c604-0x158,_0x4d28a5,_0x1d6f9a-0x103);}const _0xf1267f=extension_settings[extensionName][_0x4caa5e(-0x14d,-0xac,-0x87,-0x115)+'es']||{},_0x5e3098=extension_settings[extensionName][_0x4caa5e(-0x44,-0x51,-0xeb,-0xc2)+_0x4e3b3f(0x22d,0x285,0x27e,0x2bc)];function _0x4caa5e(_0x2c9842,_0x157778,_0x3b78fb,_0x4a95f3){return _0x43fdb1(_0x4a95f3-0x27,_0x157778-0x8f,_0x157778,_0x4a95f3-0xcb);}return _0xf1267f[_0x5e3098]||_0xf1267f[Object[_0x4e3b3f(0x314,0x331,0x2ad,0x28a)](_0xf1267f)[0x1*0x1a76+-0x18ad*0x1+-0x1c9]]||{};}export function getCurrentTestContext(){function _0x2f8d59(_0x338cfe,_0x794046,_0x9fd17b,_0x49eed2){return _0x43fdb1(_0x9fd17b-0x5c6,_0x794046-0x1b,_0x49eed2,_0x49eed2-0x14);}function _0x423006(_0x4ae4a2,_0xc3f0d2,_0x56940b,_0x41a1d8){return _0x43fdb1(_0xc3f0d2- -0xae,_0xc3f0d2-0x10c,_0x41a1d8,_0x41a1d8-0x1e5);}const _0x180a98=extension_settings[extensionName]['test_conte'+_0x423006(-0x171,-0x128,-0x92,-0x1d2)+'s']||{},_0x3a6b9a=extension_settings[extensionName][_0x2f8d59(0x524,0x491,0x50c,0x492)+_0x2f8d59(0x575,0x544,0x4d3,0x4c0)+_0x423006(-0x239,-0x192,-0x1d0,-0x232)];return _0x180a98[_0x3a6b9a]||_0x180a98[Object['keys'](_0x180a98)[-0x454+-0x472*-0x1+0x1*-0x1e]]||{};}export function getEffectiveConfigForRequestType(_0x3cc6ea){const _0x1b2a36=extension_settings[extensionName][_0x24c700(-0x9f,-0x8,0x8,-0x28)+_0x24c700(0x8,0x72,0x3,0x8)+_0x24c700(0xfc,0x69,0x4e,0xd8)]||{};function _0x24c700(_0x2d0a7e,_0x4f8d10,_0x9577f8,_0x50a05d){return _0x2b23e9(_0x2d0a7e-0xe7,_0x9577f8- -0x538,_0x50a05d,_0x50a05d-0x1e9);}const _0x13c292={};_0x13c292['api_profil'+'e']='默认',_0x13c292[_0x413d1b(-0x207,-0x19b,-0x1e4,-0x218)+_0x24c700(-0x94,-0x46,-0x59,-0xb5)]='默认';const _0x273413=_0x1b2a36[_0x3cc6ea]||_0x13c292,_0x1905b6=extension_settings[extensionName]['llm_profil'+'es']||{},_0x415eef=extension_settings[extensionName][_0x413d1b(-0x196,-0x11b,-0xf2,-0x1cc)+'xt_profile'+'s']||{},_0x4bb6f8=_0x273413[_0x24c700(0x89,-0x5b,0x2,-0x48)+'e']||'默认',_0x2210cf=_0x1905b6[_0x4bb6f8]||_0x1905b6[Object[_0x24c700(0xd9,-0x84,0x29,0x71)](_0x1905b6)[0x1923+-0x9fc+-0x3*0x50d]]||{},_0x4e2060=_0x273413[_0x24c700(-0xa7,-0x1f,-0x88,-0x1a)+_0x413d1b(-0x1d8,-0x201,-0x235,-0x23c)]||'默认',_0x1a794e=_0x415eef[_0x4e2060]||_0x415eef[Object[_0x24c700(0xca,0x7a,0x29,0xb9)](_0x415eef)[-0x153f*0x1+0x23ca+-0xe8b]]||{},_0x39a3da={};_0x39a3da[_0x413d1b(-0x138,-0x146,-0x101,-0x1b0)]=_0x2210cf[_0x24c700(0xd4,-0x50,0x47,0x5b)]||'',_0x39a3da[_0x24c700(-0x51,0x2a,0x20,-0x18)]=_0x2210cf[_0x413d1b(-0x15f,-0x1dc,-0xea,-0x142)]||'',_0x39a3da['model']=_0x2210cf[_0x24c700(0x112,0x91,0x74,0x3d)]||'',_0x39a3da[_0x24c700(0xc1,-0x24,0x55,0x87)+'e']=_0x2210cf[_0x413d1b(-0x12a,-0xec,-0xbb,-0x151)+'e']??-0x1*0x2033+0xf3c+0x10f7+0.7,_0x39a3da['top_p']=_0x2210cf[_0x24c700(0x6c,0x28,0x39,0x3)]??-0x35*-0x75+-0x185*0x11+0x7*0x3b,_0x39a3da[_0x24c700(0x59,0x1f,-0x24,-0xb3)]=_0x2210cf[_0x413d1b(-0x1a3,-0x1b4,-0x20c,-0x11f)]??0x8d*0x12+0x511*0x1+-0xcfb;function _0x413d1b(_0x1cc800,_0xa2c78,_0x1af0f4,_0xb26e6d){return _0x43fdb1(_0x1cc800- -0xd9,_0xa2c78-0x1d8,_0x1af0f4,_0xb26e6d-0x171);}return _0x39a3da[_0x24c700(0x79,-0x6,0x82,0x10d)]=_0x2210cf[_0x24c700(0xe3,0x1e,0x82,0x91)]??![],_0x39a3da[_0x413d1b(-0x220,-0x1ea,-0x2cf,-0x206)]=_0x1a794e,_0x39a3da;}export function buildPromptForRequestType(_0x444896,_0x1802e9=''){const _0x227d30={'bHQqd':function(_0x427999,_0x3619a1){return _0x427999!==_0x3619a1;},'fZvNk':_0x32711e(0x476,0x406,0x54c,0x4ae),'dfJko':'qOqSC','RsyLH':function(_0x28473f,_0x157832){return _0x28473f===_0x157832;},'QYZtP':'trigger','typTU':_0x32711e(0x4ff,0x59c,0x5b8,0x509),'rmibG':function(_0x418751,_0x1b4d84,_0x5240d3){return _0x418751(_0x1b4d84,_0x5240d3);},'ZcXvr':'QWxUG','NBILS':'user','JskXM':_0x32711e(0x3ee,0x389,0x392,0x401),'qLilF':'zwjKp','HBRKw':function(_0x807461,_0x39797e){return _0x807461(_0x39797e);}},_0x3b9d3e=extension_settings[extensionName][_0x32711e(0x438,0x472,0x540,0x4b2)+_0x32711e(0x43f,0x494,0x523,0x4ad)+_0x1daed7(0x19e,0x19a,0x1c1,0x200)]||{},_0x4fe0e7={};_0x4fe0e7[_0x1daed7(0xc8,0xa8,0x4c,0x30)+'ofile']='默认';function _0x32711e(_0x405ce6,_0x548ca2,_0x3ebda1,_0x206e81){return _0x2b23e9(_0x405ce6-0xa2,_0x206e81- -0x8e,_0x405ce6,_0x206e81-0x1cd);}function _0x1daed7(_0x284fcf,_0x203ea7,_0x13bbb7,_0x51a058){return _0x2b23e9(_0x284fcf-0x132,_0x284fcf- -0x3e8,_0x51a058,_0x51a058-0x14f);}const _0x43411d=_0x3b9d3e[_0x444896]||_0x4fe0e7,_0x4dce99=_0x43411d[_0x32711e(0x49d,0x4a4,0x4ae,0x422)+_0x1daed7(0xf7,0xc6,0x115,0xed)]||'默认',_0x574bde=extension_settings[extensionName][_0x32711e(0x4ec,0x4d1,0x4c7,0x493)+_0x32711e(0x4b2,0x53d,0x4df,0x4d6)+'s']||{},_0x384617=_0x574bde[_0x4dce99]||_0x574bde[Object[_0x32711e(0x437,0x4cb,0x451,0x4d3)](_0x574bde)[0xb32*-0x3+0x1*-0x1a6e+0x3c04]]||{},_0x24fa6c=[];if(_0x384617['entries']&&Array['isArray'](_0x384617['entries'])){if(_0x1daed7(0xbe,0x54,0x16d,0xa1)===_0x227d30[_0x1daed7(0x91,0xcf,0xce,0x30)])_0x384617[_0x32711e(0x578,0x4f6,0x584,0x515)]['forEach'](_0x45950f=>{function _0x14356b(_0x5e9bbb,_0x5342ed,_0x1d6ed6,_0x5744b5){return _0x1daed7(_0x1d6ed6-0x6d,_0x5342ed-0x62,_0x1d6ed6-0x11b,_0x5342ed);}function _0x230480(_0xacec9f,_0x3c6066,_0x1f6853,_0x250382){return _0x32711e(_0xacec9f,_0x3c6066-0x13b,_0x1f6853-0x18e,_0x1f6853- -0x49f);}if(_0x227d30['bHQqd'](_0x227d30[_0x230480(0x94,0xa2,0x81,0x42)],_0x227d30[_0x14356b(0x19c,0x156,0x19f,0x17d)])){if(!_0x45950f[_0x14356b(0x1f2,0xd2,0x14d,0x13d)])return;if(!_0x45950f[_0x230480(-0x76,0x4b,-0x20,-0x20)]||_0x227d30[_0x14356b(0x1c8,0x1ed,0x186,0x20f)](_0x45950f[_0x14356b(0x16a,0x167,0x192,0x12b)][_0x230480(-0x8c,-0x9,-0x81,-0x15)](),''))return;if(_0x227d30[_0x230480(0x53,-0xa0,-0x2c,0x73)](_0x45950f[_0x14356b(0xa8,0xaa,0x13b,0xc9)+'e'],_0x227d30['QYZtP'])){if(_0x230480(0x8d,0x10d,0x80,0x4f)===_0x227d30[_0x230480(0x119,0x23,0x79,0x115)]){const _0x2d0d15=_0x34550c[_0xff5998][_0x230480(0x55,-0xa7,-0xc,0x12)+'xt_profile'+'s']||{},_0x3cdbb6=_0x3dd478[_0x5153d8][_0x14356b(0x238,0x121,0x1a9,0x126)+_0x230480(0x17,-0x91,-0x42,0x2b)+_0x14356b(0x111,0xf2,0x17f,0x119)];return _0x2d0d15[_0x3cdbb6]||_0x2d0d15[_0x5dff73[_0x230480(0xce,-0x48,0x34,0x73)](_0x2d0d15)[-0xe8b*-0x2+-0xf1*0x25+-0x5bf*-0x1]]||{};}else{if(!_0x1802e9||!_0x227d30[_0x14356b(0x10d,0x212,0x191,0x242)](checkTriggerWords,_0x45950f['triggerWor'+'ds'],_0x1802e9)){if(_0x227d30[_0x14356b(0x1f9,0x19f,0x153,0x1ad)]!==_0x14356b(0x266,0x1f7,0x234,0x208)){const _0x4ca4c4=_0x2a3c19[_0xd2c1da][_0x230480(-0x2c,0x0,-0x8b,-0xee)+'es']||{},_0x594fac=_0x16a387[_0x20c595][_0x230480(-0x91,-0x82,-0x38,0x56)+_0x14356b(0x212,0x1ad,0x1b7,0x148)];return _0x4ca4c4[_0x594fac]||_0x4ca4c4[_0x3bc40b['keys'](_0x4ca4c4)[-0x2cd*-0x4+-0x902*-0x2+-0x1d38]]||{};}else return;}}}const _0x4ff46c={};_0x4ff46c[_0x14356b(0x63,0xad,0xf2,0x90)]=_0x45950f[_0x230480(-0xa8,-0x130,-0xc0,-0x26)]||_0x227d30[_0x230480(0x55,-0xb,-0x28,-0x9)],_0x4ff46c[_0x14356b(0x1d8,0x1ab,0x192,0x14d)]=_0x45950f['content'],_0x24fa6c[_0x230480(0xa4,-0x6a,0x46,0x8)](_0x4ff46c);}else _0x51aa48['warn'](_0x14356b(0x1f3,0x21b,0x1e1,0x1d8),_0x25757b[_0x230480(-0xee,-0xa5,-0x4f,-0x1)]);});else{const _0xe0303f={};_0xe0303f[_0x32711e(0x3d8,0x3c1,0x394,0x3df)]=_0x1daed7(0xa7,0x113,0x88,0x74),_0xe0303f[_0x1daed7(0x125,0xa0,0x11e,0x9e)]=_0x3592b1[_0x32711e(0x459,0x3f6,0x3ae,0x401)],_0xd02a38[_0x32711e(0x51f,0x511,0x50a,0x4e5)](_0xe0303f);}}else _0x384617[_0x32711e(0x41d,0x458,0x462,0x4c6)]&&Array[_0x32711e(0x3ab,0x4b2,0x455,0x454)](_0x384617[_0x1daed7(0x16c,0x105,0x200,0x1fa)])&&_0x384617[_0x1daed7(0x16c,0xc3,0x20a,0xed)][_0x1daed7(0x97,0x54,0xba,0xb6)](_0x2b9a0f=>{if(_0x2b9a0f[_0x26a940(-0x150,-0x121,-0x119,-0x14b)]&&_0x2b9a0f[_0x26a940(-0x115,-0xa5,-0xb8,-0x14b)][_0x26a940(-0x20b,-0x134,-0x15a,-0x15d)]()!==''){const _0x17ea4b={};_0x17ea4b[_0x54bd01(0x4ff,0x587,0x4fe,0x574)]=_0x227d30[_0x54bd01(0x597,0x53d,0x570,0x516)],_0x17ea4b['content']=_0x2b9a0f[_0x26a940(-0x1e6,-0x1a6,-0xf2,-0x14b)],_0x24fa6c[_0x54bd01(0x605,0x578,0x5e4,0x68e)](_0x17ea4b);}function _0x26a940(_0x29191e,_0x4005ea,_0x19d65e,_0x5779e6){return _0x1daed7(_0x5779e6- -0x221,_0x4005ea-0x1b2,_0x19d65e-0xe5,_0x29191e);}function _0x54bd01(_0x2b542a,_0x34f3d7,_0x40aa37,_0x35a483){return _0x32711e(_0x40aa37,_0x34f3d7-0x2e,_0x40aa37-0x89,_0x2b542a-0x120);}if(_0x2b9a0f['assistant']&&_0x227d30[_0x54bd01(0x56b,0x5a0,0x5db,0x558)](_0x2b9a0f['assistant']['trim'](),'')){const _0x428e10={};_0x428e10[_0x26a940(-0x210,-0xec,-0x1b9,-0x19c)]=_0x227d30['JskXM'],_0x428e10['content']=_0x2b9a0f[_0x54bd01(0x521,0x475,0x5cf,0x4d6)],_0x24fa6c[_0x26a940(-0xb,-0xb0,-0x11f,-0x96)](_0x428e10);}});const _0x17defe=_0x227d30[_0x1daed7(0x1ab,0x19a,0x144,0x165)](mergeAdjacentMessages,_0x24fa6c),_0x3046ea=_0x227d30[_0x32711e(0x51a,0x492,0x490,0x505)](processRollPlaceholders,_0x17defe);return _0x3046ea;}const _0xfd4896={};_0xfd4896[_0x2b23e9(0x581,0x598,0x501,0x57c)]=_0x43fdb1(-0x2e,-0xc2,-0x1f,-0x5f),_0xfd4896[_0x2b23e9(0x422,0x4a9,0x52b,0x53b)+'n']=_0x43fdb1(-0xda,-0x16d,-0x13a,-0x50),_0xfd4896[_0x2b23e9(0x4b8,0x568,0x55c,0x4d0)+'ay']=_0x2b23e9(0x536,0x549,0x5a3,0x56e),_0xfd4896['char_modif'+'y']='角色/服装修改',_0xfd4896[_0x43fdb1(-0x169,-0xc6,-0x138,-0xc4)+'n']='翻译',_0xfd4896[_0x43fdb1(-0x133,-0x1bf,-0xea,-0xbb)]='Tag修改';const REQUEST_TYPE_NAMES=_0xfd4896;function _0x2b23e9(_0x268fc0,_0x40ceb2,_0x329894,_0x583739){return _0x4e4a(_0x40ceb2-0x2fe,_0x329894);}export async function executeTypedLLMRequest(_0x269478,_0x122a69,_0x5d2bc0,_0x2ee9ab=null){const _0x3759f5={'vCDUj':function(_0x35665f,_0xa725dd){return _0x35665f!==_0xa725dd;},'txObT':_0x4503d2(0x8e,0xf4,0x85,0x6a),'IxjdD':function(_0xf43254,_0x3ecf24){return _0xf43254!==_0x3ecf24;},'iauLh':_0x4503d2(0x22,0xd8,0x56,0xb7),'OVFcr':function(_0x4453e0,_0x84eae4){return _0x4453e0(_0x84eae4);},'RCiWr':_0x4503d2(-0x1a,-0x2c,0x52,0x63)+'复。','ZqKnC':function(_0x5d8a50,_0x5c50df){return _0x5d8a50(_0x5c50df);},'LqasM':function(_0x3cf0f2){return _0x3cf0f2();},'pltSY':function(_0x3b416f,_0x10dfa1){return _0x3b416f===_0x10dfa1;},'ecxEJ':_0x4c755d(0x443,0x43a,0x3aa,0x3a3),'HwUEc':function(_0x555f15,_0x27d1a5){return _0x555f15>_0x27d1a5;},'BrrOU':function(_0x1c856e,_0xf2b94d){return _0x1c856e||_0xf2b94d;},'vSdXs':function(_0x28830e,_0xcc0922){return _0x28830e===_0xcc0922;},'SgqlS':'gJpvo','iFTuq':'LLM请求已中断，开'+_0x4503d2(0x85,-0x7,0x75,0x8e),'hicTl':function(_0x2a9524,_0x21b8fa){return _0x2a9524(_0x21b8fa);},'HOVtv':function(_0x103555,_0x33b8f2){return _0x103555(_0x33b8f2);},'QdDTD':function(_0x790be,_0x3e160d){return _0x790be||_0x3e160d;},'DCrVL':_0x4c755d(0x38c,0x3f6,0x34b,0x35a)+_0x4c755d(0x396,0x2f2,0x381,0x34b)+_0x4503d2(0x73,0xd2,0xed,0x100)+'/generate','phDtC':_0x4c755d(0x42e,0x304,0x390,0x3aa),'wolyZ':_0x4503d2(0xcd,0xb3,0x6b,0x7a),'oaFmN':_0x4503d2(0x68,0x87,0x68,0x93),'dgatU':function(_0x996dbd,_0x810a8b){return _0x996dbd===_0x810a8b;},'rytmR':_0x4c755d(0x38a,0x385,0x354,0x339),'diTMz':function(_0x3f0d5d,_0x2c2e07){return _0x3f0d5d>_0x2c2e07;},'DsiBZ':_0x4503d2(0x17d,0x83,0x10f,0x61),'GTeDQ':_0x4c755d(0x45f,0x4c9,0x39b,0x422),'jMBiB':_0x4c755d(0x479,0x3f3,0x4e7,0x457),'FwYep':_0x4c755d(0x404,0x4c8,0x49b,0x444),'iLeok':'utf-8','RJcXL':'xZGRG','EXKEp':_0x4c755d(0x423,0x480,0x382,0x3db),'UhARG':function(_0x355465,_0x9ced00){return _0x355465===_0x9ced00;},'ANflu':_0x4503d2(0x10a,0x63,0x92,0x62)+'E]','xphPC':_0x4c755d(0x2ea,0x2ec,0x394,0x357),'gUCQR':_0x4c755d(0x392,0x2fb,0x296,0x31f),'KUnVj':'GbhGP','uXQzS':'流式解析警告:','YKmCu':_0x4503d2(0x175,0xcf,0xdc,0x18c),'OgGJW':_0x4c755d(0x29a,0x2bd,0x3e2,0x33f),'rHJFW':function(_0x535162,_0x504ae8){return _0x535162===_0x504ae8;},'hyaqj':'PCqAe','PAPds':_0x4503d2(0x161,0x12a,0x17c,0x102)+'buffer):','KKqnN':_0x4c755d(0x3a3,0x296,0x3af,0x324),'NlkhO':'iTpTe','zZhzO':function(_0x24c653,_0x4d010f){return _0x24c653===_0x4d010f;},'OlQwz':_0x4503d2(0x10a,0x184,0x142,0x11b),'ghbSI':_0x4c755d(0x2aa,0x2fa,0x363,0x335),'jUbeB':_0x4503d2(0x157,0x49,0xf2,0x15b),'KizFP':function(_0x5df5d9,_0x30953e){return _0x5df5d9===_0x30953e;},'QhEmm':function(_0x41d8f3,_0x49184f){return _0x41d8f3>_0x49184f;},'Mdive':function(_0x13f56a,_0x11c7eb){return _0x13f56a!==_0x11c7eb;},'tSnAx':_0x4503d2(0x109,0x137,0x10e,0x17a),'zFyYE':_0x4c755d(0x3a9,0x3c2,0x2df,0x38a),'TBxig':_0x4503d2(0x70,0x16f,0xbf,0x73),'qpzEz':function(_0x48c2f0,_0xe8c0f0){return _0x48c2f0(_0xe8c0f0);},'fsJIn':function(_0x1792cd,_0x14483d){return _0x1792cd(_0x14483d);},'WnLYP':function(_0x19f4ac,_0x5d1b8a){return _0x19f4ac===_0x5d1b8a;},'VfsFK':'edsEt','mSAXV':_0x4c755d(0x424,0x33d,0x3ea,0x380),'YSrBv':'测试模式提示','KwHyl':function(_0x1a81c2,_0x57e03f){return _0x1a81c2===_0x57e03f;},'IVwoX':'AbortError','fxDrh':_0x4c755d(0x398,0x3e6,0x384,0x41e)+_0x4c755d(0x47b,0x40f,0x3c4,0x438),'ypxFH':'XCONN','Bqncv':function(_0x5f0231,_0x5edb39){return _0x5f0231===_0x5edb39;},'ywcDa':_0x4503d2(0x39,0xb0,0x33,0x8c),'dyPcP':_0x4c755d(0x2e7,0x365,0x402,0x397),'tonTR':function(_0x3885db){return _0x3885db();}},{prompt:_0x1a60c9,id:_0x381f97}=_0x269478;if(_0x3759f5['BrrOU'](!_0x381f97,!_0x1a60c9))return;if(currentLLMRequestController){if(_0x3759f5['vSdXs'](_0x4c755d(0x4ea,0x3d8,0x4a8,0x460),_0x3759f5[_0x4503d2(0xb8,0x143,0xe3,0x9e)]))currentLLMRequestController[_0x4503d2(-0x4e,0x4d,0x3a,-0x11)](),toastr[_0x4c755d(0x2bd,0x3c2,0x41b,0x36c)](_0x3759f5[_0x4503d2(0x62,0x112,0x8a,0xe9)]);else{const _0x47e809={};_0x47e809[_0x4503d2(0x99,0xcf,0x34,0xa)]='user',_0x47e809[_0x4503d2(0x14e,0x172,0xd4,0xdf)]=_0x1c2287[_0x4c755d(0x2df,0x3cc,0x402,0x358)],_0x32bb11['push'](_0x47e809);}}function _0x4503d2(_0x49a129,_0x59dbd8,_0x140266,_0xca69dc){return _0x2b23e9(_0x49a129-0x1b3,_0x140266- -0x439,_0xca69dc,_0xca69dc-0x1df);}currentLLMRequestController=new AbortController();const _0x120f07=currentLLMRequestController['signal'],_0x300463=currentLLMRequestController,_0x16ed99=REQUEST_TYPE_NAMES[_0x122a69]||_0x122a69,_0x3700bf={};_0x3700bf[_0x4c755d(0x3b0,0x357,0x2ec,0x326)]=_0x4c755d(0x2be,0x3f9,0x361,0x367)+_0x16ed99,_0x3700bf['type']=TaskType['LLM'],_0x3700bf[_0x4c755d(0x4ad,0x3c0,0x49a,0x404)]=_0x381f97;const _0x1b8dd0=taskQueue[_0x4503d2(0xf1,0xa1,0xa8,0xed)](_0x3700bf);llmTaskControllers[_0x4503d2(0xab,0x8d,0xc9,0xe2)](_0x1b8dd0,currentLLMRequestController);function _0x4c755d(_0x4ae41e,_0x269b0a,_0x271491,_0x2c6cd1){return _0x43fdb1(_0x2c6cd1-0x478,_0x269b0a-0x127,_0x4ae41e,_0x2c6cd1-0x1b);}taskQueue[_0x4503d2(0xc9,0x78,0xec,0x196)+'us'](_0x1b8dd0,TaskStatus[_0x4c755d(0x3b6,0x403,0x38f,0x421)]),startFabLoading();let _0x451c44=![];clearLog(),addLog('=====\x20LLM\x20'+_0x4503d2(0x93,0x21,0x43,0x89)+_0x16ed99+_0x4c755d(0x336,0x2c4,0x3b7,0x35f)),_0x3759f5['ZqKnC'](addLog,_0x4503d2(0x134,0x155,0x130,0xed)+_0x381f97),_0x3759f5[_0x4c755d(0x40b,0x3ad,0x446,0x40e)](addLog,_0x4503d2(0x1a4,0xbe,0x109,0x132)+':'),_0x3759f5[_0x4c755d(0x3cd,0x43b,0x3a9,0x40e)](addLog,_0x3759f5['OVFcr'](formatPromptForDisplay,_0x1a60c9));const _0x3148f0=_0x3759f5[_0x4c755d(0x46e,0x3bb,0x452,0x3ec)](getEffectiveConfigForRequestType,_0x122a69),{api_url:_0xc44cdf,api_key:_0x2c46e6,model:_0x3ca177,temperature:_0x34dff6,top_p:_0x23eccf,max_tokens:_0x1f77e1,stream:_0x5c79ac}=_0x3148f0;if(_0x3759f5[_0x4503d2(0xff,0x188,0x129,0x92)](!_0xc44cdf,!_0x2c46e6)||!_0x3ca177){const _0x2a5833=_0x16ed99+(_0x4c755d(0x315,0x3fb,0x2d7,0x37d)+_0x4503d2(0x117,0x19d,0x156,0x1f1)+'或\x20Model\x20未配'+'置。');toastr['error'](_0x2a5833);const _0x391ecd={};_0x391ecd[_0x4503d2(0xa4,0x69,0x41,0xe9)]=![],_0x391ecd[_0x4c755d(0x42d,0x461,0x397,0x3ef)]=_0x2a5833,_0x391ecd['id']=_0x381f97,eventSource[_0x4503d2(0x14d,0x1bb,0x140,0x1cd)](_0x5d2bc0,_0x391ecd);return;}const _0x463dc3=_0x3759f5[_0x4c755d(0x385,0x492,0x38c,0x3fa)],_0x413d4d=_0xc44cdf[_0x4c755d(0x3f3,0x3f4,0x344,0x388)](/\/$/,'');_0x2ee9ab&&_0x2ee9ab(_0x4503d2(0x11a,0x136,0xa1,0x9)+_0x16ed99+_0x4c755d(0x30d,0x297,0x2ea,0x333));try{const _0x437ad1={};_0x437ad1[_0x4503d2(0xe7,0x19e,0x162,0x14f)+_0x4503d2(0x9a,0x1af,0xff,0x128)+'ce']=_0x3759f5[_0x4c755d(0x3b9,0x4df,0x400,0x45a)],_0x437ad1['custom_url']=_0x413d4d,_0x437ad1['custom_inc'+_0x4503d2(0xb2,0x1d7,0x152,0x19b)+'rs']=_0x4c755d(0x2a4,0x3a3,0x2c1,0x334)+_0x4503d2(0xdb,0x1e4,0x13f,0x179)+_0x4503d2(0x88,0x59,0xc0,0x115)+_0x2c46e6+'\x22',_0x437ad1[_0x4503d2(0x20d,0x1a6,0x173,0xe8)]=_0x3ca177,_0x437ad1[_0x4c755d(0x437,0x3bc,0x402,0x451)]=_0x1a60c9,_0x437ad1[_0x4503d2(0x121,0x1e0,0x154,0x17b)+'e']=_0x34dff6,_0x437ad1['top_p']=_0x23eccf,_0x437ad1[_0x4c755d(0x3c4,0x3ec,0x3aa,0x3ae)]=_0x1f77e1,_0x437ad1[_0x4c755d(0x498,0x46c,0x452,0x454)]=_0x5c79ac;const _0x517014=_0x437ad1,_0x42523b=await fetch(_0x463dc3,{'method':_0x3759f5['wolyZ'],'headers':_0x3759f5[_0x4503d2(0x119,0xe1,0x13b,0xce)](getRequestHeaders,window[_0x4c755d(0x40b,0x3bd,0x3a2,0x369)]),'body':JSON[_0x4503d2(0xd7,0x1b7,0x15d,0x145)](_0x517014),'signal':_0x120f07});if(!_0x42523b['ok']){if(_0x3759f5[_0x4c755d(0x336,0x374,0x33f,0x355)]===_0x4503d2(0x1c6,0xcf,0x14a,0xb9)){if(_0x33402e[_0x4c755d(0x399,0x405,0x3ce,0x358)]&&_0x3759f5[_0x4503d2(0x26,0x10a,0xbb,0x118)](_0x26d5ca[_0x4c755d(0x36d,0x38d,0x35d,0x358)][_0x4c755d(0x38a,0x29f,0x300,0x346)](),'')){const _0x298704={};_0x298704[_0x4503d2(-0x68,0xbf,0x34,0x40)]=_0x3759f5['txObT'],_0x298704[_0x4503d2(0x29,0x17d,0xd4,0x73)]=_0x260a22['user'],_0x4f1f6c[_0x4c755d(0x455,0x3e2,0x394,0x40d)](_0x298704);}if(_0xf1a200['assistant']&&_0x3759f5[_0x4503d2(0x54,0xcf,0xc2,0x115)](_0x4799f0[_0x4c755d(0x2c2,0x322,0x2e2,0x329)]['trim'](),'')){const _0x1b75a0={};_0x1b75a0[_0x4503d2(-0x7c,0xae,0x34,-0x2b)]=_0x3759f5[_0x4c755d(0x380,0x2e9,0x324,0x38c)],_0x1b75a0[_0x4503d2(0x6f,0x6d,0xd4,0x55)]=_0xf0820f[_0x4c755d(0x2c9,0x350,0x33c,0x329)],_0x42d4d4['push'](_0x1b75a0);}}else{try{const _0x50d869=await _0x42523b[_0x4503d2(0x30,0x6f,0x8b,0x64)]();if(_0x50d869[_0x4503d2(0xc7,0x13f,0xdd,0xb2)]){let _0x3c6113;if(_0x3759f5[_0x4503d2(0x17a,0xd0,0xca,0x13a)](typeof _0x50d869[_0x4503d2(0x6f,0x3d,0xdd,0x63)],_0x3759f5['ecxEJ'])&&_0x50d869[_0x4503d2(0xa2,0xdc,0xdd,0x33)][_0x4503d2(0x43,0x112,0xa5,0x104)]){if(_0x3759f5[_0x4503d2(0x15c,0x113,0x18b,0x17a)]==='YkQnG')_0x1eb691='未收到有效回复。',_0x5b5bad[_0x4503d2(0xe8,0x153,0xfa,0x80)](_0x1eac6b+(_0x4503d2(0x13f,0x168,0x106,0xe8)+'效回复。'));else{_0x3c6113=''+_0x50d869[_0x4c755d(0x379,0x3fb,0x32a,0x3b0)][_0x4503d2(0x49,0xea,0xa5,0x14d)];const _0x498810=[];if(_0x50d869[_0x4503d2(0xcb,0x17b,0xdd,0xca)][_0x4503d2(0x15e,0x115,0xf6,0x92)])_0x498810[_0x4c755d(0x420,0x483,0x411,0x40d)](_0x4503d2(-0x42,0x81,0x67,0x8)+_0x50d869[_0x4503d2(0x55,0x41,0xdd,0x6d)]['type']);if(_0x50d869['error'][_0x4c755d(0x3cf,0x409,0x4cf,0x450)])_0x498810['push'](_0x4c755d(0x3fb,0x358,0x395,0x37e)+_0x50d869[_0x4c755d(0x3cc,0x38a,0x318,0x3b0)][_0x4c755d(0x41b,0x39f,0x4c1,0x450)]);if(_0x3759f5['diTMz'](_0x498810['length'],-0x1*-0x2513+0x36*0x8a+-0x422f)){if(_0x3759f5[_0x4c755d(0x36b,0x3bc,0x396,0x395)](_0x3759f5[_0x4503d2(0x109,0x143,0x136,0x14b)],_0x4503d2(0x70,0xaa,0x10f,0x117))){if(_0x109bd7){const _0x81a47f=_0x1478b8[_0x4503d2(0x85,0x16d,0x122,0x12b)](_0x145b8a,arguments);return _0x4034b5=null,_0x81a47f;}}else _0x3c6113+='\x20('+_0x498810[_0x4c755d(0x476,0x3a6,0x3b7,0x3cf)](',\x20')+')';}}}else _0x3c6113=''+JSON[_0x4503d2(0x160,0xbb,0x15d,0xfc)](_0x50d869['error']);throw new Error(_0x3c6113);}}catch(_0x2ee040){if(_0x3759f5['pltSY'](_0x3759f5[_0x4503d2(0x5a,0x14e,0xf3,0x142)],_0x3759f5[_0x4503d2(0x161,0xbc,0xe9,0xc6)]))_0x3944ef+='\x20('+_0x2176ed[_0x4c755d(0x33e,0x42c,0x402,0x3cf)](',\x20')+')';else{if(_0x2ee040[_0x4503d2(0xb1,0x95,0xa5,0x12)][_0x4c755d(0x37f,0x3ac,0x363,0x32f)](_0x3759f5[_0x4c755d(0x3f9,0x3ec,0x318,0x383)])||_0x2ee040['message'][_0x4c755d(0x310,0x357,0x334,0x32f)]('代码:'))throw _0x2ee040;}}throw new Error(_0x4503d2(0xf7,0xe4,0x79,0xb7)+_0x42523b[_0x4c755d(0x3e2,0x344,0x442,0x3ac)]+'\x20'+_0x42523b[_0x4c755d(0x342,0x37f,0x330,0x3c3)]);}}let _0x2502c2='';if(_0x5c79ac){const _0x58e072=_0x42523b[_0x4c755d(0x340,0x39e,0x35d,0x3ba)][_0x4503d2(-0x4f,0x7e,0x3e,-0x1)](),_0x5418ef=new TextDecoder(_0x3759f5[_0x4c755d(0x380,0x29a,0x38c,0x320)]);let _0x1d7464='';while(!![]){const {done:_0x537f05,value:_0x2eef6d}=await _0x58e072[_0x4c755d(0x46b,0x3b7,0x41a,0x3d7)]();if(_0x537f05)break;const _0x2d09a2={};_0x2d09a2[_0x4c755d(0x43f,0x502,0x4f5,0x454)]=!![],_0x1d7464+=_0x5418ef[_0x4c755d(0x3b8,0x3a4,0x43e,0x3c4)](_0x2eef6d,_0x2d09a2);const _0x3da43b=_0x1d7464[_0x4c755d(0x372,0x3da,0x382,0x399)]('\x0a');_0x1d7464=_0x3da43b[_0x4503d2(0xfa,0x121,0x159,0xcb)]()||'';for(const _0x39eeb4 of _0x3da43b){if(_0x3759f5[_0x4c755d(0x416,0x3bf,0x397,0x39d)](_0x3759f5[_0x4503d2(0x136,0x1b5,0x115,0x7d)],_0x3759f5[_0x4c755d(0x271,0x26c,0x2be,0x312)]))_0x4df1b6(_0x4c755d(0x362,0x3d9,0x398,0x374)+_0x3a1900+_0x4503d2(0x79,0x2a,0x60,0x9));else{const _0x46e09b=_0x39eeb4[_0x4503d2(0x122,0x4c,0x73,0x21)]();if(!_0x46e09b||_0x3759f5[_0x4c755d(0x4a6,0x43a,0x3cf,0x43f)](_0x46e09b,_0x3759f5[_0x4503d2(0x43,-0x1c,0x3b,0x9e)]))continue;if(_0x46e09b[_0x4503d2(0x137,0x189,0x170,0x1fb)](_0x3759f5[_0x4503d2(0x10,0x43,0x48,0x88)])){if(_0x3759f5[_0x4c755d(0x378,0x2f7,0x41a,0x39d)](_0x4c755d(0x3d2,0x44e,0x4cb,0x41f),_0x3759f5[_0x4c755d(0x3a4,0x36f,0x3dd,0x3fd)]))return _0x55cc5f;else try{const _0x194aaf=_0x46e09b[_0x4c755d(0x2db,0x31e,0x355,0x305)](-0xa3*0xf+0x643+0x1*0x350),_0x2a2158=JSON[_0x4503d2(0x1ac,0x175,0x148,0xe4)](_0x194aaf),_0x47a557=_0x2a2158[_0x4c755d(0x4b2,0x4ab,0x3cc,0x42a)]?.[0x1c73+0x922*0x3+-0x37d9]?.[_0x4c755d(0x43f,0x312,0x345,0x3a1)]?.['content'];_0x47a557&&(_0x2502c2+=_0x47a557,_0x2ee9ab&&(_0x3759f5[_0x4503d2(0x1fd,0x150,0x16c,0x109)](_0x4503d2(0x122,0x119,0x17a,0x14d),_0x3759f5[_0x4c755d(0x3b8,0x3ac,0x478,0x3f9)])?_0x4636a1=null:_0x2ee9ab(_0x2502c2)));}catch(_0x19b4f6){console[_0x4503d2(0xf7,0x30,0x50,0x27)](_0x3759f5[_0x4503d2(0x94,0xd9,0xcf,0x111)],_0x19b4f6[_0x4c755d(0x3dd,0x2d6,0x350,0x378)]);}}}}}if(_0x1d7464[_0x4503d2(0x10b,0xa3,0x73,0xb1)]()&&_0x3759f5[_0x4c755d(0x387,0x3c5,0x422,0x395)](_0x1d7464[_0x4503d2(0x3c,0x50,0x73,-0x1e)](),_0x3759f5[_0x4503d2(-0x51,0x9b,0x3b,-0x2e)])&&_0x1d7464[_0x4503d2(0x29,0xa8,0x73,0x10a)]()[_0x4503d2(0x1f3,0x20d,0x170,0x1cf)](_0x3759f5[_0x4503d2(0xf,0xe5,0x48,-0x8)])){if(_0x3759f5[_0x4c755d(0x3ae,0x3fa,0x407,0x3b8)]===_0x3759f5['OgGJW'])_0x3759f5[_0x4503d2(0x10d,0x198,0xf7,0x172)](_0x45a97d,_0x5616e6);else try{const _0x3441b0=_0x1d7464[_0x4503d2(0xf7,-0x25,0x73,0x7a)]()[_0x4503d2(-0x59,-0x1e,0x32,-0x70)](0x2171*-0x1+-0x60f*0x1+0x2786),_0x404ebe=JSON[_0x4503d2(0xd5,0x12b,0x148,0x168)](_0x3441b0),_0x140060=_0x404ebe[_0x4503d2(0xc0,0x1ab,0x157,0x141)]?.[-0x1109+0x13b2+-0xe3*0x3]?.[_0x4503d2(0xf2,0x14e,0xce,0x40)]?.[_0x4c755d(0x455,0x3bd,0x3cc,0x3a7)];_0x140060&&(_0x2502c2+=_0x140060,_0x2ee9ab&&_0x3759f5[_0x4c755d(0x49c,0x3d6,0x420,0x3ec)](_0x2ee9ab,_0x2502c2));}catch(_0x51a9ce){_0x3759f5['rHJFW'](_0x4503d2(0xb5,0x78,0xa3,0x105),_0x3759f5['hyaqj'])?console[_0x4c755d(0x36f,0x2e1,0x357,0x323)](_0x3759f5[_0x4c755d(0x3e9,0x407,0x4ae,0x424)],_0x51a9ce[_0x4503d2(0xb4,0x11f,0xa5,0x9f)]):_0x2aaa05[_0x4503d2(0x153,0x114,0xfa,0x17a)](_0x3759f5[_0x4c755d(0x458,0x3eb,0x463,0x3b3)]);}}!_0x2502c2&&(_0x3759f5[_0x4503d2(0xad,0x184,0xd8,0x153)]===_0x3759f5[_0x4503d2(0xfc,-0x12,0x4b,-0x27)]?_0x1ed688[_0x4503d2(0x1a1,0x149,0x13a,0x198)](_0x51e271[_0x4c755d(0x37f,0x3b3,0x4c4,0x42b)]||''):(_0x2502c2='未收到有效回复。',toastr[_0x4503d2(0x13d,0xcb,0xfa,0x108)](_0x16ed99+(_0x4c755d(0x329,0x377,0x484,0x3d9)+'效回复。'))));}else{if(_0x3759f5[_0x4c755d(0x4ae,0x38b,0x3ae,0x416)](_0x3759f5[_0x4503d2(0xb0,-0xc,0x71,0x20)],_0x3759f5[_0x4503d2(-0x1b,0x8e,0x7a,0x82)]))_0x2948fe=''+_0x1898ec[_0x4503d2(0xd4,0x1d5,0x15d,0x1e8)](_0x335f7e['error']);else{const _0x409cdc=await _0x42523b[_0x4c755d(0x2b6,0x40e,0x3d1,0x35e)]();if(_0x409cdc[_0x4503d2(0x105,0x100,0xdd,0x81)]){if(_0x3759f5[_0x4c755d(0x3fa,0x3df,0x421,0x395)](_0x3759f5[_0x4503d2(0x179,0x110,0xf5,0x44)],_0x3759f5[_0x4c755d(0x364,0x3de,0x402,0x3c8)]))_0x3944d9+='\x20('+_0x456571[_0x4503d2(0x118,0xe4,0xfc,0x15a)](',\x20')+')';else{let _0x866cbb;if(_0x3759f5['KizFP'](typeof _0x409cdc[_0x4c755d(0x3f8,0x424,0x41e,0x3b0)],_0x3759f5[_0x4c755d(0x4db,0x4e8,0x4b3,0x455)])&&_0x409cdc[_0x4c755d(0x409,0x366,0x45b,0x3b0)][_0x4c755d(0x36e,0x3f1,0x3ed,0x378)]){_0x866cbb=''+_0x409cdc['error'][_0x4c755d(0x347,0x3d6,0x316,0x378)];const _0x35667a=[];if(_0x409cdc[_0x4c755d(0x3a3,0x414,0x32f,0x3b0)]['type'])_0x35667a[_0x4c755d(0x3bc,0x46b,0x417,0x40d)]('类型:\x20'+_0x409cdc[_0x4503d2(0x14f,0x43,0xdd,0xde)]['type']);if(_0x409cdc[_0x4503d2(0xee,0x7e,0xdd,0x11c)]['code'])_0x35667a[_0x4503d2(0xfe,0x174,0x13a,0xe3)](_0x4503d2(0xee,0xfc,0xab,0xac)+_0x409cdc[_0x4c755d(0x3c1,0x317,0x30c,0x3b0)][_0x4503d2(0x168,0x1fd,0x17d,0xe8)]);_0x3759f5[_0x4503d2(0x12e,0x164,0xee,0xd1)](_0x35667a[_0x4503d2(0x5b,0xbb,0xb1,0x119)],0x2372*-0x1+-0x1289+-0x1*-0x35fb)&&(_0x866cbb+='\x20('+_0x35667a['join'](',\x20')+')');}else _0x866cbb=''+JSON[_0x4c755d(0x402,0x4a6,0x4b8,0x430)](_0x409cdc[_0x4c755d(0x3f8,0x408,0x40b,0x3b0)]);throw new Error(_0x866cbb);}}_0x2502c2=_0x409cdc[_0x4503d2(0x1cb,0x198,0x157,0x1e1)]?.[0xbd4+0x17ad+0x2381*-0x1]?.[_0x4503d2(0xea,0xdc,0xa5,0xaf)]?.[_0x4503d2(0x2e,0x143,0xd4,0x182)]||'',!_0x2502c2&&(_0x3759f5['Mdive'](_0x3759f5[_0x4c755d(0x45e,0x41f,0x4ad,0x437)],_0x3759f5[_0x4c755d(0x41b,0x3cd,0x46a,0x437)])?_0x3759f5[_0x4c755d(0x3d5,0x372,0x390,0x3ca)](_0x2ef64d,_0x78a372):(_0x2502c2=_0x3759f5[_0x4c755d(0x2ce,0x37f,0x32b,0x36a)],toastr[_0x4503d2(0x127,0x182,0xfa,0xf4)](_0x16ed99+(_0x4503d2(0x196,0x8e,0x106,0xaa)+_0x4503d2(0xcd,0x126,0xde,0x49))))),_0x2ee9ab&&(_0x3759f5[_0x4c755d(0x36b,0x421,0x420,0x3a4)](_0x3759f5[_0x4503d2(0x14f,0x15a,0xfe,0x1a7)],_0x3759f5['TBxig'])?_0x3759f5[_0x4503d2(0x13c,0x88,0x12e,0xe3)](_0x2ee9ab,_0x2502c2):(_0x51b582+=_0x383c6a,_0x1faf77&&_0x3759f5[_0x4503d2(0x156,0x139,0xda,0x17f)](_0x4bf5fe,_0x5a2560)));}}_0x3759f5[_0x4503d2(0x128,0x68,0xa4,-0x1)](addLog,_0x4c755d(0x43d,0x4c9,0x474,0x423)+_0x4503d2(0x189,0xd6,0x11a,0x10a)),addLog(_0x2502c2),_0x3759f5[_0x4503d2(0x151,0xf8,0xa4,0x2e)](addLog,_0x4c755d(0x43b,0x428,0x33d,0x3c7)+_0x4503d2(0x20f,0x13c,0x188,0xfd)),taskQueue['completeTa'+'sk'](_0x1b8dd0,!![]),llmTaskControllers[_0x4503d2(-0x57,-0x47,0x57,0x9f)](_0x1b8dd0);const _0x4fc5c8=extension_settings[extensionName][_0x4c755d(0x327,0x40d,0x377,0x3a8)+'e'];if(_0x4fc5c8){if(_0x3759f5[_0x4503d2(0x5f,0xd6,0x93,0xb6)](_0x3759f5['VfsFK'],_0x3759f5[_0x4c755d(0x3dc,0x326,0x30c,0x398)]))_0x3759f5['LqasM'](_0x35bc2d);else{const _0x1cc7cb={};_0x1cc7cb[_0x4503d2(0x20,0x99,0xa7,0xd4)]=0x1388,toastr[_0x4c755d(0x322,0x342,0x3b0,0x36c)](_0x4503d2(0xc2,0x45,0xaf,0x77)+_0x16ed99+('\x20请求已完成，后续操'+_0x4503d2(0x4c,0x4d,0x37,-0x2)),_0x3759f5[_0x4503d2(0x174,0x162,0x11e,0x1a5)],_0x1cc7cb);}}const _0x9c5cae={};_0x9c5cae[_0x4503d2(-0x1f,0xc5,0x41,0x91)]=!![],_0x9c5cae[_0x4c755d(0x474,0x449,0x498,0x3ef)]=_0x2502c2,_0x9c5cae['id']=_0x381f97,_0x9c5cae['testMode']=_0x4fc5c8,eventSource[_0x4503d2(0x98,0x15a,0x140,0x173)](_0x5d2bc0,_0x9c5cae);}catch(_0x55e7d4){if(_0x3759f5[_0x4c755d(0x2bf,0x38c,0x329,0x31c)](_0x55e7d4[_0x4c755d(0x286,0x300,0x344,0x326)],_0x3759f5['IVwoX'])){const _0x1813ea=_0x4c755d(0x4e1,0x45d,0x42c,0x44e)[_0x4c755d(0x35a,0x354,0x31d,0x399)]('|');let _0x8995ae=-0x1b3b+-0x1d0e+-0x641*-0x9;while(!![]){switch(_0x1813ea[_0x8995ae++]){case'0':const _0x4d8886={};_0x4d8886[_0x4503d2(0x8e,0x3,0x53,0x6f)]=_0x3759f5['IVwoX'],_0x4d8886[_0x4503d2(0x1e,0x10c,0xa5,0x6a)]=_0x3759f5['fxDrh'];const _0x440c65={};_0x440c65[_0x4503d2(-0x21,-0x3f,0x41,0x7d)]=![],_0x440c65[_0x4503d2(0x14c,0x120,0x11c,0x93)]=null,_0x440c65['id']=_0x381f97,_0x440c65[_0x4c755d(0x367,0x32f,0x390,0x3b0)]=_0x4d8886,eventSource[_0x4c755d(0x438,0x3a4,0x45b,0x413)](_0x5d2bc0,_0x440c65);continue;case'1':taskQueue[_0x4c755d(0x31d,0x3c0,0x420,0x3bf)+'us'](_0x1b8dd0,TaskStatus[_0x4c755d(0x450,0x3bb,0x368,0x3ff)]);continue;case'2':llmTaskControllers['delete'](_0x1b8dd0);continue;case'3':_0x451c44=!![];continue;case'4':return;}break;}}console[_0x4c755d(0x41f,0x380,0x358,0x3b0)](_0x16ed99+_0x4503d2(-0x9,0x2a,0x39,0xe3),_0x55e7d4);const _0x37db85=_0x4c755d(0x4c7,0x389,0x409,0x428)+_0x55e7d4[_0x4c755d(0x3ad,0x413,0x416,0x378)];if(_0x2ee9ab){if(_0x3759f5[_0x4503d2(0x13e,0x156,0xc2,0x3d)](_0x3759f5[_0x4c755d(0x30d,0x291,0x388,0x332)],_0x4503d2(0x11b,0xa1,0x12d,0x1d6)))_0x3759f5['OVFcr'](_0x2ee9ab,_0x37db85);else{let _0x4f1551;if(_0x3759f5[_0x4c755d(0x3d6,0x41f,0x410,0x3ea)](typeof _0x139e47['error'],_0x3759f5[_0x4c755d(0x4ef,0x472,0x3db,0x455)])&&_0x3bd105[_0x4503d2(0x85,0xdc,0xdd,0xbd)][_0x4c755d(0x3a8,0x3e7,0x2eb,0x378)]){_0x4f1551=''+_0x3b8801[_0x4503d2(0xb9,0xcf,0xdd,0x6c)][_0x4503d2(0x6b,0xa3,0xa5,0x35)];const _0x38cb59=[];if(_0x526871[_0x4503d2(0xa3,0xf8,0xdd,0x4b)][_0x4503d2(0x132,0x162,0xf6,0x164)])_0x38cb59[_0x4503d2(0x106,0x9b,0x13a,0x12a)](_0x4c755d(0x340,0x3ca,0x393,0x33a)+_0x2ecb76[_0x4503d2(0x174,0xb0,0xdd,0x106)]['type']);if(_0x41456d['error']['code'])_0x38cb59[_0x4503d2(0x1c9,0xeb,0x13a,0x136)](_0x4503d2(0x11f,0x13e,0xab,-0x5)+_0x4aa642['error'][_0x4c755d(0x3bb,0x3c7,0x41b,0x450)]);_0x3759f5[_0x4503d2(0x136,0x14f,0x18a,0x19b)](_0x38cb59[_0x4c755d(0x35e,0x3c8,0x318,0x384)],-0x212c+0x107*0x2+-0x2*-0xf8f)&&(_0x4f1551+='\x20('+_0x38cb59[_0x4503d2(0x10b,0x17f,0xfc,0x82)](',\x20')+')');}else _0x4f1551=''+_0x190148[_0x4503d2(0x172,0xbc,0x15d,0xb3)](_0x24ae6f[_0x4c755d(0x41c,0x327,0x316,0x3b0)]);throw new _0x26e5a5(_0x4f1551);}}toastr[_0x4503d2(0x30,0x36,0xdd,0xd0)](_0x55e7d4[_0x4c755d(0x323,0x2da,0x3af,0x378)]),taskQueue['completeTa'+'sk'](_0x1b8dd0,![]),llmTaskControllers[_0x4c755d(0x2e4,0x389,0x396,0x32a)](_0x1b8dd0);const _0x165dbc={};_0x165dbc[_0x4503d2(-0x1f,-0x42,0x41,0xa)]=![],_0x165dbc[_0x4c755d(0x368,0x452,0x3c2,0x3ef)]=_0x37db85,_0x165dbc['id']=_0x381f97,eventSource['emit'](_0x5d2bc0,_0x165dbc);}finally{if(_0x3759f5['Bqncv'](currentLLMRequestController,_0x300463)){if(_0x3759f5[_0x4503d2(0xe0,0x96,0x76,0x49)]===_0x3759f5[_0x4503d2(0x91,0x92,0xe6,0x15c)]){const {id:_0x33be6e}=_0x1a7448;if(!_0x33be6e)return;const _0x342e83=_0x3571b9[_0xc84eba]||_0x2e9c35;_0x1d8c95[_0x4c755d(0x39d,0x296,0x2c0,0x30b)](_0x4503d2(0x26,-0x15,0x5b,-0x3a)+'\x20收到'+_0x342e83+(_0x4c755d(0x329,0x3e0,0x384,0x356)+_0x4c755d(0x3ef,0x3fa,0x386,0x354))+_0x33be6e+')');const _0x3d1cff=_0x3759f5[_0x4503d2(0x95,0x8b,0xf7,0x66)](_0x36e303,_0x2ddfbb),_0x30df6e={};_0x30df6e['prompt']=_0x3d1cff,_0x30df6e['id']=_0x33be6e,_0x3fab45['emit'](_0x54f7cb,_0x30df6e);}else currentLLMRequestController=null;}(!_0x451c44||_0x3759f5[_0x4503d2(0xf2,0x6c,0x47,0xee)](currentLLMRequestController,null))&&_0x3759f5[_0x4c755d(0x333,0x2fd,0x3a6,0x347)](stopFabLoading);}}function _0x4e4a(_0x2794bd,_0xf3c763){_0x2794bd=_0x2794bd-(0x250a+-0x1*-0x1a4f+0xbf*-0x53);const _0x5b49f5=_0x3135();let _0x59c092=_0x5b49f5[_0x2794bd];if(_0x4e4a['VWnQJQ']===undefined){var _0x521d05=function(_0x20c595){const _0x3bc40b='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x3cd4f1='',_0x37bcb8='',_0x37aeea=_0x3cd4f1+_0x521d05;for(let _0x778770=0x1c*-0xd+-0xa0b*0x1+0xb77,_0x27be68,_0x11c00a,_0x3be63d=-0x1d*-0xc9+-0x19c8+-0x303*-0x1;_0x11c00a=_0x20c595['charAt'](_0x3be63d++);~_0x11c00a&&(_0x27be68=_0x778770%(0x1d33+0x2056*0x1+-0x3d85)?_0x27be68*(-0x1b32*-0x1+-0xcb9*-0x1+0x2a5*-0xf)+_0x11c00a:_0x11c00a,_0x778770++%(-0x9c7*-0x2+0x9*0x244+-0x10d*0x26))?_0x3cd4f1+=_0x37aeea['charCodeAt'](_0x3be63d+(-0x1665+0xd88+0x8e7))-(0x1bd*0x7+0x1*-0x6d5+-0x54c)!==-0x1*-0x1122+0x2528+-0x364a*0x1?String['fromCharCode'](0x2*-0xa7b+-0xdb+0x16d0&_0x27be68>>(-(-0x17*-0xd9+0x236a+-0x36e7)*_0x778770&0x8e*0x41+0xd61+-0x5b*0x8b)):_0x778770:0xe92*0x1+0xe*-0x26c+-0xa5*-0x1e){_0x11c00a=_0x3bc40b['indexOf'](_0x11c00a);}for(let _0x34550c=-0x1d11+0xb28+0x11e9,_0xff5998=_0x3cd4f1['length'];_0x34550c<_0xff5998;_0x34550c++){_0x37bcb8+='%'+('00'+_0x3cd4f1['charCodeAt'](_0x34550c)['toString'](0x1ecb+-0x9*0x1cb+0x2*-0x74c))['slice'](-(-0x2413+-0x11dc+0x35f1));}return decodeURIComponent(_0x37bcb8);};_0x4e4a['exvFdq']=_0x521d05,_0x4e4a['hiqbEy']={},_0x4e4a['VWnQJQ']=!![];}const _0x2a3c19=_0x5b49f5[-0x4*0xb1+-0x1923+-0x1*-0x1be7],_0xd2c1da=_0x2794bd+_0x2a3c19,_0x16a387=_0x4e4a['hiqbEy'][_0xd2c1da];if(!_0x16a387){const _0x3dd478=function(_0x5153d8){this['itMXDn']=_0x5153d8,this['VYFGFt']=[-0x24*-0xe6+0x75c*-0x4+-0x2e7*0x1,-0x133*-0x5+0xb2+-0x1*0x6b1,-0x2163+0x650+0x1b13],this['ZVgaKs']=function(){return'newState';},this['aoDzpl']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['iUjTXf']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x3dd478['prototype']['DOVjHX']=function(){const _0x5dff73=new RegExp(this['aoDzpl']+this['iUjTXf']),_0x469c3d=_0x5dff73['test'](this['ZVgaKs']['toString']())?--this['VYFGFt'][-0xed9+0x1761+-0x3b*0x25]:--this['VYFGFt'][0x6d*-0x17+0x232f+-0x1964];return this['DyifIH'](_0x469c3d);},_0x3dd478['prototype']['DyifIH']=function(_0x37d313){if(!Boolean(~_0x37d313))return _0x37d313;return this['aLTYPn'](this['itMXDn']);},_0x3dd478['prototype']['aLTYPn']=function(_0x1d59d2){for(let _0x17ee2f=-0x1*-0x165f+-0x7b8+-0x79*0x1f,_0x5c921e=this['VYFGFt']['length'];_0x17ee2f<_0x5c921e;_0x17ee2f++){this['VYFGFt']['push'](Math['round'](Math['random']())),_0x5c921e=this['VYFGFt']['length'];}return _0x1d59d2(this['VYFGFt'][0x4*0x37d+0x1*-0x72d+-0x6c7]);},new _0x3dd478(_0x4e4a)['DOVjHX'](),_0x59c092=_0x4e4a['exvFdq'](_0x59c092),_0x4e4a['hiqbEy'][_0xd2c1da]=_0x59c092;}else _0x59c092=_0x16a387;return _0x59c092;}export async function executeDefaultLLMRequest(_0x22ad44,_0xd25693,_0x4af50f=null){const _0x1e5fe6={'JHizW':_0x30cad7(0x24d,0x2b9,0x28b,0x29f),'KMYdg':function(_0x1c87e7,_0x351244){return _0x1c87e7===_0x351244;},'OmCoa':_0x30cad7(0x1e1,0x1a9,0x215,0x19e),'eNNUm':function(_0x34e2c2,_0x131ff6){return _0x34e2c2>_0x131ff6;},'rNwrD':_0x5b75cc(0x409,0x3c5,0x465,0x41f),'hIFsW':function(_0xb747f9,_0x16badc){return _0xb747f9||_0x16badc;},'NrdWn':'LLM请求已中断，开'+'始新请求。','VDttl':'LLM:\x20外部请求','Gwcjh':function(_0x27e54d){return _0x27e54d();},'NBxjJ':function(_0x4b9f27,_0x2a6824){return _0x4b9f27(_0x2a6824);},'nctCS':function(_0x87c5ad,_0x4b76ac){return _0x87c5ad(_0x4b76ac);},'OlbMc':function(_0x49e24f,_0x1177b8){return _0x49e24f(_0x1177b8);},'vDOdT':_0x30cad7(0x243,0x24d,0x22f,0x1c4)+'PI\x20Key,\x20或\x20'+_0x30cad7(0x1cf,0x1a7,0x179,0x225),'NnGPn':function(_0x4d34f8,_0x3a3f4d){return _0x4d34f8===_0x3a3f4d;},'mFMuN':_0x5b75cc(0x490,0x5b5,0x516,0x561),'rThdH':_0x30cad7(0x1c4,0x1ca,0x211,0x1a4)+_0x30cad7(0x231,0x207,0x1ac,0x261),'HNddE':_0x5b75cc(0x428,0x485,0x485,0x410),'wsMDb':function(_0x4ccddc,_0x24ff98){return _0x4ccddc(_0x24ff98);},'ydzKw':_0x5b75cc(0x42a,0x39f,0x42c,0x3bd),'DjKVi':function(_0x34ca2a,_0x5eb45e){return _0x34ca2a>_0x5eb45e;},'dbnPU':function(_0x2aaf04,_0xdaf685){return _0x2aaf04!==_0xdaf685;},'wbRdG':_0x5b75cc(0x3df,0x381,0x41c,0x410),'GjxVx':_0x5b75cc(0x411,0x4f9,0x449,0x3a3),'YUFTR':_0x5b75cc(0x391,0x3c5,0x400,0x458)+'复。','ZOXKq':function(_0xfe6e72,_0x334907){return _0xfe6e72(_0x334907);},'duwpH':'GmPqB','YBbWI':_0x30cad7(0x169,0x211,0x11e,0x1c2)+'5','SCTcn':_0x5b75cc(0x4a2,0x4ea,0x511,0x57f)+_0x5b75cc(0x535,0x4ab,0x533,0x4c4)+'aborted.','Ykqhb':_0x30cad7(0x1f0,0x169,0x26e,0x263),'HDbyX':'LLM\x20Execut'+'e\x20Error:','rbATi':_0x5b75cc(0x427,0x3bb,0x466,0x3e8),'bNeHc':_0x5b75cc(0x549,0x493,0x514,0x478),'Ldnbk':'oOChi','lBmOM':_0x5b75cc(0x429,0x46b,0x4b3,0x50a),'FbizB':function(_0x383f65,_0x1af8ee){return _0x383f65===_0x1af8ee;}},{prompt:_0x591305,id:_0x411eab}=_0x22ad44;if(_0x1e5fe6[_0x5b75cc(0x560,0x502,0x4c6,0x52c)](!_0x411eab,!_0x591305))return;currentLLMRequestController&&(currentLLMRequestController[_0x30cad7(0x14b,0x197,0xad,0x139)](),toastr[_0x5b75cc(0x3fd,0x472,0x447,0x4cf)](_0x1e5fe6[_0x5b75cc(0x4f2,0x514,0x4cb,0x53a)]));currentLLMRequestController=new AbortController();const _0x57a57b=currentLLMRequestController[_0x5b75cc(0x4da,0x489,0x520,0x4ee)];function _0x30cad7(_0x15ce85,_0xf6398b,_0x19d8fb,_0x58cf23){return _0x43fdb1(_0x15ce85-0x2b6,_0xf6398b-0x120,_0x58cf23,_0x58cf23-0x7e);}const _0x5d45fa=currentLLMRequestController,_0x3f9d9a={};_0x3f9d9a[_0x30cad7(0x164,0x10b,0x14b,0x1b5)]=_0x1e5fe6[_0x30cad7(0x174,0x19a,0x1d7,0xe1)],_0x3f9d9a[_0x5b75cc(0x523,0x444,0x4a4,0x519)]=TaskType[_0x5b75cc(0x520,0x45f,0x484,0x4c3)],_0x3f9d9a[_0x5b75cc(0x506,0x433,0x4df,0x535)]=_0x411eab;const _0x23166c=taskQueue[_0x30cad7(0x1b9,0x18b,0x1ae,0x1e7)](_0x3f9d9a);llmTaskControllers[_0x30cad7(0x1da,0x1e0,0x22d,0x16b)](_0x23166c,currentLLMRequestController),taskQueue[_0x5b75cc(0x501,0x52b,0x49a,0x549)+'us'](_0x23166c,TaskStatus['RUNNING']),_0x1e5fe6['Gwcjh'](startFabLoading);let _0x931199=![];clearLog(),_0x1e5fe6[_0x5b75cc(0x48d,0x431,0x3f0,0x38b)](addLog,'=====\x20LLM\x20'+_0x5b75cc(0x586,0x4aa,0x4ec,0x4cb)+'=='),_0x1e5fe6[_0x5b75cc(0x3a7,0x4b4,0x44c,0x3cf)](addLog,_0x5b75cc(0x4f6,0x53a,0x4de,0x43f)+_0x411eab),addLog(_0x5b75cc(0x446,0x499,0x4b7,0x567)+':'),_0x1e5fe6['OlbMc'](addLog,_0x1e5fe6[_0x30cad7(0x153,0x130,0x106,0x11d)](formatPromptForDisplay,_0x591305));function _0x5b75cc(_0x418ca9,_0x2acf1d,_0x1fe052,_0x4edb75){return _0x2b23e9(_0x418ca9-0xbd,_0x1fe052- -0x8b,_0x2acf1d,_0x4edb75-0x16b);}const {api_url:_0x5ab81a,api_key:_0x9fd8f5,model:_0x567a80,temperature:_0x15d567,top_p:_0x4ef5ad,max_tokens:_0x8253d7}=_0xd25693;if(_0x1e5fe6[_0x5b75cc(0x4bc,0x4fe,0x4c6,0x460)](!_0x5ab81a,!_0x9fd8f5)||!_0x567a80){const _0x514ce6=_0x1e5fe6[_0x30cad7(0x222,0x254,0x260,0x26a)];toastr[_0x30cad7(0x1ee,0x26b,0x29b,0x268)](_0x514ce6);const _0x22aece={};_0x22aece['success']=![],_0x22aece['result']=_0x514ce6,_0x22aece['id']=_0x411eab,eventSource[_0x5b75cc(0x4e1,0x4bc,0x4ee,0x4d3)](eventNames[_0x5b75cc(0x44a,0x4da,0x4e5,0x4f5)+_0x30cad7(0x1b3,0x1fd,0x21a,0x236)],_0x22aece);return;}const _0x171cd0=_0x30cad7(0x198,0x142,0x1a5,0x16d)+_0x5b75cc(0x4a6,0x423,0x426,0x45e)+_0x5b75cc(0x4cf,0x40d,0x49b,0x465)+_0x5b75cc(0x5a7,0x547,0x50a,0x52b),_0x603785=_0x5ab81a[_0x5b75cc(0x3d8,0x41e,0x463,0x3d1)](/\/$/,'');_0x4af50f&&(_0x1e5fe6['NnGPn'](_0x30cad7(0x279,0x2a0,0x1d7,0x2eb),_0x1e5fe6['mFMuN'])?_0x4af50f(_0x1e5fe6[_0x30cad7(0x1fb,0x218,0x225,0x25c)]):_0x254695['push'](_0x572a0e));try{const _0x21b289={};_0x21b289[_0x30cad7(0x273,0x274,0x1cc,0x275)+_0x5b75cc(0x545,0x55b,0x4ad,0x4b7)+'ce']=_0x1e5fe6[_0x5b75cc(0x4cf,0x4c7,0x50e,0x59b)],_0x21b289['custom_url']=_0x603785,_0x21b289['custom_inc'+_0x5b75cc(0x494,0x541,0x500,0x531)+'rs']='Authorizat'+'ion:\x20\x22Bear'+_0x5b75cc(0x4ec,0x4c3,0x46e,0x420)+_0x9fd8f5+'\x22',_0x21b289[_0x30cad7(0x284,0x2b0,0x1db,0x2c4)]=_0x567a80,_0x21b289['messages']=_0x591305,_0x21b289[_0x30cad7(0x265,0x278,0x2ed,0x2c3)+'e']=_0x15d567,_0x21b289[_0x5b75cc(0x541,0x50b,0x4e6,0x4d6)]=_0x4ef5ad,_0x21b289['max_tokens']=_0x8253d7,_0x21b289[_0x30cad7(0x292,0x26a,0x309,0x2c3)]=![];const _0x54eae8=_0x21b289,_0x1b4acf=await fetch(_0x171cd0,{'method':_0x30cad7(0x17c,0x1d8,0xce,0x1e6),'headers':_0x1e5fe6[_0x30cad7(0x16b,0x12a,0xf5,0xf9)](getRequestHeaders,window[_0x5b75cc(0x3c4,0x4df,0x444,0x3f8)]),'body':JSON[_0x30cad7(0x26e,0x264,0x1c2,0x2a5)](_0x54eae8),'signal':_0x57a57b}),_0x59bbda=await _0x1b4acf[_0x30cad7(0x19c,0x1bf,0x183,0x1e7)]();if(_0x59bbda[_0x5b75cc(0x4ae,0x427,0x48b,0x434)]){if(_0x1e5fe6['ydzKw']!=='uaEdq'){const _0x336fc7=_0x148b94+(':\x20API\x20URL,'+_0x5b75cc(0x490,0x5b2,0x504,0x4ea)+'或\x20Model\x20未配'+'置。');_0x171eed[_0x30cad7(0x1ee,0x28b,0x15c,0x1b6)](_0x336fc7);const _0x49c9af={};_0x49c9af[_0x30cad7(0x152,0xdc,0x1dc,0x165)]=![],_0x49c9af[_0x30cad7(0x22d,0x254,0x287,0x1d9)]=_0x336fc7,_0x49c9af['id']=_0x48ae8b,_0x36095b[_0x30cad7(0x251,0x237,0x2e4,0x2d4)](_0x23238a,_0x49c9af);return;}else{let _0x35c1fe;if(typeof _0x59bbda[_0x30cad7(0x1ee,0x295,0x206,0x1e0)]===_0x1e5fe6['OmCoa']&&_0x59bbda[_0x30cad7(0x1ee,0x25d,0x285,0x220)][_0x30cad7(0x1b6,0x1d3,0x1cc,0x1ee)]){_0x35c1fe=''+_0x59bbda[_0x5b75cc(0x535,0x4ef,0x48b,0x530)][_0x30cad7(0x1b6,0x21e,0x1dd,0x193)];const _0x5bd816=[];if(_0x59bbda['error'][_0x30cad7(0x207,0x241,0x242,0x1ab)])_0x5bd816[_0x30cad7(0x24b,0x1b7,0x1b7,0x1c3)](_0x30cad7(0x178,0x11a,0xff,0x135)+_0x59bbda[_0x5b75cc(0x434,0x4fd,0x48b,0x414)][_0x30cad7(0x207,0x224,0x25e,0x16c)]);if(_0x59bbda[_0x30cad7(0x1ee,0x23f,0x1a7,0x24e)][_0x30cad7(0x28e,0x2fc,0x2e4,0x1ef)])_0x5bd816[_0x30cad7(0x24b,0x22c,0x234,0x201)](_0x5b75cc(0x43f,0x469,0x459,0x4be)+_0x59bbda[_0x5b75cc(0x4c6,0x3e9,0x48b,0x4c4)][_0x5b75cc(0x57b,0x4c9,0x52b,0x558)]);if(_0x1e5fe6[_0x5b75cc(0x47b,0x4f2,0x4e1,0x56a)](_0x5bd816[_0x30cad7(0x1c2,0x244,0x220,0x187)],-0xcf7*0x2+-0x443*0x6+0x3380)){if(_0x1e5fe6[_0x30cad7(0x1cb,0x1fc,0x26a,0x11e)](_0x1e5fe6[_0x30cad7(0x19a,0x227,0xf0,0x248)],_0x1e5fe6[_0x5b75cc(0x525,0x4fa,0x4eb,0x521)]))_0x35c1fe+='\x20('+_0x5bd816['join'](',\x20')+')';else{const _0x308d49={};_0x308d49[_0x30cad7(0x1b8,0x16e,0x1a9,0x200)]=0x1388,_0x5841ff[_0x30cad7(0x1aa,0x11b,0x1b0,0x18c)]('【测试模式】'+_0x1e4c36+(_0x5b75cc(0x5be,0x469,0x515,0x4cc)+_0x5b75cc(0x346,0x477,0x3e5,0x47e)),_0x1e5fe6['JHizW'],_0x308d49);}}}else _0x35c1fe=''+JSON[_0x5b75cc(0x5a3,0x54f,0x50b,0x5ab)](_0x59bbda[_0x5b75cc(0x534,0x427,0x48b,0x4ee)]);throw new Error(_0x35c1fe);}}if(!_0x1b4acf['ok'])throw new Error(_0x5b75cc(0x47a,0x4c5,0x427,0x49d)+_0x1b4acf[_0x5b75cc(0x3ee,0x41b,0x487,0x450)]+'\x20'+_0x1b4acf[_0x30cad7(0x201,0x267,0x153,0x242)]);const _0x131b49=_0x59bbda[_0x30cad7(0x268,0x2ce,0x2de,0x1d5)]?.[-0x1*0x16b1+0xc52+0xa5f]?.[_0x30cad7(0x1b6,0x19f,0x248,0x211)]?.[_0x30cad7(0x1e5,0x19c,0x14b,0x1a1)]||'';!_0x131b49&&toastr['warning'](_0x1e5fe6[_0x30cad7(0x1de,0x1b6,0x189,0x1bf)]);_0x4af50f&&_0x4af50f(_0x131b49);_0x1e5fe6[_0x30cad7(0x1af,0x1b4,0x24b,0x16e)](addLog,'\x0a-----\x20LLM'+_0x30cad7(0x22b,0x26d,0x2a2,0x2bf)),_0x1e5fe6['OlbMc'](addLog,_0x131b49),_0x1e5fe6[_0x30cad7(0x21d,0x1bc,0x2a2,0x1a5)](addLog,_0x30cad7(0x205,0x2a1,0x1b4,0x2a8)+_0x30cad7(0x299,0x341,0x240,0x2a2)),taskQueue['completeTa'+'sk'](_0x23166c,!![]),llmTaskControllers[_0x30cad7(0x168,0xe3,0x1ab,0x1e9)](_0x23166c);const _0x3e3186={};_0x3e3186[_0x30cad7(0x152,0x1e7,0x12a,0x15b)]=!![],_0x3e3186[_0x5b75cc(0x4d8,0x527,0x4ca,0x528)]=_0x131b49,_0x3e3186['id']=_0x411eab,eventSource[_0x30cad7(0x251,0x22e,0x2ad,0x286)](eventNames[_0x5b75cc(0x583,0x441,0x4e5,0x4ff)+'E_RESPONSE'],_0x3e3186);}catch(_0x1d09f7){if(_0x1e5fe6['KMYdg'](_0x1d09f7[_0x5b75cc(0x3bc,0x3fc,0x401,0x412)],_0x30cad7(0x1f0,0x142,0x1f0,0x210))){if('GmPqB'===_0x1e5fe6['duwpH']){const _0x2d4b02=_0x1e5fe6[_0x5b75cc(0x4ee,0x54c,0x53f,0x4ee)][_0x30cad7(0x1d7,0x27b,0x248,0x133)]('|');let _0x1adee7=-0x2653+0x99f*0x1+-0x72d*-0x4;while(!![]){switch(_0x2d4b02[_0x1adee7++]){case'0':console['log'](_0x1e5fe6['SCTcn']);continue;case'1':taskQueue[_0x30cad7(0x1fd,0x291,0x2a9,0x21d)+'us'](_0x23166c,TaskStatus[_0x5b75cc(0x53c,0x46c,0x4da,0x53c)]);continue;case'2':_0x931199=!![];continue;case'3':const _0x44c712={};_0x44c712[_0x5b75cc(0x396,0x445,0x401,0x463)]=_0x1e5fe6['Ykqhb'],_0x44c712[_0x5b75cc(0x414,0x4b4,0x453,0x41e)]=_0x30cad7(0x25c,0x21a,0x28b,0x286)+'orted';const _0x37ee93={};_0x37ee93[_0x5b75cc(0x348,0x3e6,0x3ef,0x3dc)]=![],_0x37ee93[_0x5b75cc(0x54f,0x50e,0x4ca,0x4d7)]=null,_0x37ee93['id']=_0x411eab,_0x37ee93[_0x5b75cc(0x404,0x4e5,0x48b,0x4dc)]=_0x44c712,eventSource[_0x30cad7(0x251,0x2f0,0x1f0,0x1c1)](eventNames[_0x5b75cc(0x555,0x4b4,0x4e5,0x48f)+_0x30cad7(0x1b3,0x172,0x165,0x1f5)],_0x37ee93);continue;case'4':llmTaskControllers[_0x5b75cc(0x489,0x4b2,0x405,0x386)](_0x23166c);continue;case'5':return;}break;}}else{let _0x97d83a;if(_0x1e5fe6[_0x30cad7(0x225,0x2d5,0x23b,0x1c0)](typeof _0x4fe17f[_0x30cad7(0x1ee,0x20b,0x28d,0x1f2)],_0x1e5fe6[_0x5b75cc(0x358,0x38d,0x3df,0x408)])&&_0x142df9[_0x30cad7(0x1ee,0x1f6,0x1b9,0x1b5)][_0x5b75cc(0x3a2,0x476,0x453,0x4fb)]){_0x97d83a=''+_0x102bb3[_0x30cad7(0x1ee,0x164,0x295,0x1b8)][_0x5b75cc(0x4a4,0x3d3,0x453,0x4bc)];const _0x188693=[];if(_0xa66f6a[_0x30cad7(0x1ee,0x18b,0x283,0x203)][_0x5b75cc(0x4be,0x54a,0x4a4,0x549)])_0x188693[_0x30cad7(0x24b,0x225,0x1ef,0x1d1)](_0x30cad7(0x178,0x229,0x14f,0x14f)+_0x155e9c[_0x5b75cc(0x3df,0x4d4,0x48b,0x411)][_0x30cad7(0x207,0x157,0x20b,0x270)]);if(_0x4a59f0[_0x30cad7(0x1ee,0x1f2,0x218,0x1cd)][_0x30cad7(0x28e,0x2f3,0x26b,0x328)])_0x188693[_0x5b75cc(0x4f0,0x4d4,0x4e8,0x52a)]('代码:\x20'+_0x43e303[_0x30cad7(0x1ee,0x153,0x1bd,0x156)]['code']);_0x1e5fe6[_0x5b75cc(0x520,0x4db,0x526,0x52f)](_0x188693[_0x5b75cc(0x44b,0x468,0x45f,0x50f)],0x16ed+-0x60d+-0x10e0)&&(_0x97d83a+='\x20('+_0x188693[_0x5b75cc(0x4ce,0x402,0x4aa,0x44f)](',\x20')+')');}else _0x97d83a=''+_0x1379a7[_0x5b75cc(0x45e,0x565,0x50b,0x548)](_0x3304d2[_0x30cad7(0x1ee,0x24b,0x200,0x25a)]);throw new _0x51f3db(_0x97d83a);}}console[_0x5b75cc(0x41d,0x517,0x48b,0x40d)](_0x1e5fe6['HDbyX'],_0x1d09f7);const _0x423f21='请求错误:\x20'+_0x1d09f7[_0x5b75cc(0x413,0x401,0x453,0x4d0)];_0x4af50f&&_0x1e5fe6[_0x5b75cc(0x439,0x547,0x4ba,0x457)](_0x4af50f,_0x423f21);toastr[_0x30cad7(0x1ee,0x1b5,0x298,0x1d4)](_0x1d09f7[_0x30cad7(0x1b6,0x127,0x1f9,0x132)]),taskQueue['completeTa'+'sk'](_0x23166c,![]),llmTaskControllers['delete'](_0x23166c);const _0x4887ae={};_0x4887ae['success']=![],_0x4887ae[_0x5b75cc(0x4a8,0x495,0x4ca,0x505)]=_0x423f21,_0x4887ae['id']=_0x411eab,eventSource[_0x30cad7(0x251,0x285,0x2e8,0x1bd)](eventNames[_0x5b75cc(0x520,0x438,0x4e5,0x558)+_0x5b75cc(0x3f0,0x4d8,0x450,0x4af)],_0x4887ae);}finally{if(_0x1e5fe6[_0x30cad7(0x255,0x1d7,0x217,0x216)]!==_0x1e5fe6[_0x5b75cc(0x473,0x438,0x412,0x37a)]){if(currentLLMRequestController===_0x5d45fa){if(_0x1e5fe6[_0x30cad7(0x224,0x18c,0x1ec,0x22f)]===_0x1e5fe6[_0x30cad7(0x2a0,0x301,0x301,0x24a)]){_0xc1d9d8=''+_0x3509dc[_0x30cad7(0x1ee,0x161,0x241,0x24f)]['message'];const _0x19ae36=[];if(_0xb1ae32[_0x30cad7(0x1ee,0x223,0x22d,0x214)][_0x30cad7(0x207,0x1fa,0x241,0x1de)])_0x19ae36[_0x30cad7(0x24b,0x2d7,0x1e2,0x21f)](_0x30cad7(0x178,0xf8,0x126,0xf8)+_0x42e70a[_0x30cad7(0x1ee,0x229,0x25b,0x183)][_0x5b75cc(0x425,0x4d7,0x4a4,0x400)]);if(_0xad0263[_0x30cad7(0x1ee,0x286,0x269,0x238)][_0x5b75cc(0x4be,0x51e,0x52b,0x4d7)])_0x19ae36['push'](_0x30cad7(0x1bc,0x182,0x217,0x159)+_0x40239e['error']['code']);_0x1e5fe6[_0x5b75cc(0x5ac,0x5a7,0x526,0x505)](_0x19ae36['length'],-0x1118*0x2+-0x14c1*-0x1+0x1*0xd6f)&&(_0x47ba7c+='\x20('+_0x19ae36['join'](',\x20')+')');}else currentLLMRequestController=null;}(!_0x931199||_0x1e5fe6['FbizB'](currentLLMRequestController,null))&&_0x1e5fe6[_0x5b75cc(0x4ab,0x4e3,0x53c,0x597)](stopFabLoading);}else _0x25581d=_0x1e5fe6['rNwrD'],_0x35408c[_0x30cad7(0x20b,0x15f,0x26e,0x1a7)](_0x3d90db+(':\x20LLM\x20未收到有'+'效回复。'));}}export function createGetPromptHandler(_0x35cfc0,_0x51354d){const _0x3b98d1={'DzdSE':function(_0x5b1215,_0x458e3a){return _0x5b1215(_0x458e3a);}};return function(_0x1066cf){const {id:_0x2d6425}=_0x1066cf;if(!_0x2d6425)return;const _0x31c275=REQUEST_TYPE_NAMES[_0x35cfc0]||_0x35cfc0;console['log'](_0x4871e4(0x40a,0x384,0x327,0x376)+_0x33d49f(0x26e,0x298,0x2da,0x2e9)+_0x31c275+('提示词获取请求\x20(I'+_0x4871e4(0x3fa,0x3aa,0x3c3,0x380))+_0x2d6425+')');function _0x33d49f(_0x5cd80d,_0x2104dd,_0x5b2398,_0xb24fd1){return _0x4e4a(_0x5cd80d- -0x59,_0x2104dd);}function _0x4871e4(_0x312250,_0x2e6d31,_0x433e25,_0x48d22a){return _0x4e4a(_0x2e6d31-0x1ee,_0x433e25);}const _0x1a2c59=_0x3b98d1[_0x4871e4(0x4b2,0x40b,0x475,0x497)](buildPromptForRequestType,_0x35cfc0),_0xcd2013={};_0xcd2013[_0x33d49f(0x213,0x255,0x2b6,0x1e4)]=_0x1a2c59,_0xcd2013['id']=_0x2d6425,eventSource[_0x33d49f(0x222,0x2b8,0x217,0x229)](_0x51354d,_0xcd2013);};}export function createExecuteHandler(_0x317a5a,_0x5e933c,_0xbe69cc=null){const _0xaa9566={'JrccU':function(_0x58e90e,_0xb8dbfe){return _0x58e90e(_0xb8dbfe);},'HFtzU':function(_0x50ddbf,_0x4ae7c7){return _0x50ddbf===_0x4ae7c7;},'szKfg':_0x609a0a(-0x1c0,-0x111,-0x137,-0x11b),'MHgGv':_0x609a0a(-0x8b,-0x18,-0xbd,0x94),'GZSof':function(_0x40f1e7){return _0x40f1e7();},'VPSxH':function(_0x52fa68,_0x34d159,_0x3847db,_0x49c95b,_0x5ab237){return _0x52fa68(_0x34d159,_0x3847db,_0x49c95b,_0x5ab237);}};function _0x5c88b8(_0x108daf,_0x50113b,_0x35d142,_0x545009){return _0x2b23e9(_0x108daf-0x107,_0x35d142-0x8e,_0x545009,_0x545009-0x94);}function _0x609a0a(_0x4923d5,_0x3a293d,_0x334761,_0x5cf31c){return _0x2b23e9(_0x4923d5-0x1c7,_0x3a293d- -0x5d7,_0x334761,_0x5cf31c-0x157);}return async function(_0x532b27){function _0x19e586(_0x34c1b4,_0x2ea93b,_0x162861,_0x424c4e){return _0x609a0a(_0x34c1b4-0x159,_0x2ea93b-0x5a5,_0x34c1b4,_0x424c4e-0x16e);}function _0x338d63(_0x2029bd,_0x4d9c49,_0x4b7efb,_0x2bc0fb){return _0x5c88b8(_0x2029bd-0x6b,_0x4d9c49-0x103,_0x2029bd- -0x239,_0x2bc0fb);}if(_0xaa9566[_0x338d63(0x417,0x493,0x422,0x480)](_0xaa9566['szKfg'],_0xaa9566[_0x19e586(0x4c8,0x568,0x614,0x4fd)])){const _0x1623f8=_0x49be9d[_0x338d63(0x2c0,0x210,0x2b8,0x235)](-0x752+0x1*-0x709+-0x199*-0x9),_0x105879=_0x115b07['parse'](_0x1623f8),_0x165e6a=_0x105879[_0x19e586(0x5b7,0x55e,0x4e0,0x50e)]?.[0x1*0x26e9+0x1b27+-0x4210]?.[_0x19e586(0x4cc,0x4d5,0x4bf,0x56f)]?.[_0x338d63(0x362,0x2fe,0x3e0,0x404)];_0x165e6a&&(_0x373bfb+=_0x165e6a,_0x3fdfe0&&_0xaa9566[_0x19e586(0x567,0x4ca,0x47d,0x478)](_0x693762,_0x25eba0));}else{const _0x40716c=_0xbe69cc?_0xaa9566[_0x338d63(0x40d,0x416,0x394,0x4b3)](_0xbe69cc):null;await _0xaa9566[_0x19e586(0x46d,0x456,0x418,0x4de)](executeTypedLLMRequest,_0x532b27,_0x317a5a,_0x5e933c,_0x40716c);}};}