function _0x502deb(_0x4a814f,_0x1ff1c2,_0x168cbd,_0x27253a){return _0x18af(_0x4a814f- -0x137,_0x1ff1c2);}(function(_0xe92ad7,_0x5f2c67){function _0x924f00(_0x2ab32d,_0xc98310,_0x59f6c4,_0x517378){return _0x18af(_0xc98310- -0x310,_0x517378);}function _0xcaf3a9(_0x379d89,_0x3053ce,_0x168f11,_0x30dd49){return _0x18af(_0x168f11- -0x3d8,_0x30dd49);}const _0x3ae59d=_0xe92ad7();while(!![]){try{const _0x2bf4f7=-parseInt(_0xcaf3a9(-0x141,-0x164,-0x1b0,-0x1e4))/(0x2*0x5c6+0xc1e+-0x17a9)*(-parseInt(_0xcaf3a9(-0x1e8,-0x26f,-0x21e,-0x1ac))/(-0x1*-0x17b3+0x2*0x1256+-0x3c5d))+parseInt(_0xcaf3a9(-0x1f2,-0x272,-0x20f,-0x1e2))/(0x13ca+-0xa52*0x3+0xb2f)+-parseInt(_0xcaf3a9(-0x285,-0x2a1,-0x249,-0x1ee))/(0xb*0x25f+0x3ad+-0x2*0xedf)+parseInt(_0xcaf3a9(-0x1f5,-0x1d1,-0x1e7,-0x178))/(0x3*-0x3fa+0x1*0x1bbf+-0xfcc)*(-parseInt(_0x924f00(-0xe8,-0xf5,-0xe5,-0xf0))/(0xd3*0xa+-0x478+-0x3c0))+parseInt(_0x924f00(-0x137,-0x157,-0x17f,-0x18d))/(0x8ef*-0x2+0x4cd*-0x7+0x3380)*(-parseInt(_0x924f00(-0x186,-0x17b,-0x163,-0x193))/(-0x1710*0x1+-0x102b+-0x17*-0x1b5))+-parseInt(_0x924f00(-0x1ae,-0x15f,-0x180,-0x195))/(-0xb72+0x1d70+-0x11f5)*(parseInt(_0xcaf3a9(-0x220,-0x1e9,-0x21c,-0x245))/(0xfc9+-0x38+-0x9f*0x19))+parseInt(_0x924f00(-0x57,-0xc9,-0x65,-0x138))/(0x268b+-0xd8e*-0x1+-0x340e);if(_0x2bf4f7===_0x5f2c67)break;else _0x3ae59d['push'](_0x3ae59d['shift']());}catch(_0x2c6af8){_0x3ae59d['push'](_0x3ae59d['shift']());}}}(_0x1890,-0x3d*0x113e+0x4ac63+0x2ac0b));const _0x40b5fc=(function(){let _0x297bce=!![];return function(_0x4ae388,_0x5a9022){const _0x4e44e5=_0x297bce?function(){function _0x395d26(_0x793fd6,_0x3cc0ef,_0x110860,_0x54d4ed){return _0x18af(_0x3cc0ef-0x261,_0x793fd6);}if(_0x5a9022){const _0x358935=_0x5a9022[_0x395d26(0x45c,0x44b,0x480,0x45b)](_0x4ae388,arguments);return _0x5a9022=null,_0x358935;}}:function(){};return _0x297bce=![],_0x4e44e5;};}()),_0x238268=_0x40b5fc(this,function(){function _0x41910a(_0x580eed,_0x1fc262,_0x343c0b,_0x52cbf5){return _0x18af(_0x580eed-0x93,_0x52cbf5);}const _0x27e21b={};function _0x54f575(_0x4afdf8,_0x40705d,_0x26dd5f,_0x23f165){return _0x18af(_0x4afdf8- -0x17d,_0x26dd5f);}_0x27e21b[_0x41910a(0x290,0x2cf,0x2e7,0x23a)]=_0x41910a(0x2f9,0x30a,0x35e,0x2fb)+'+$';const _0x1168fd=_0x27e21b;return _0x238268[_0x41910a(0x219,0x246,0x23d,0x231)]()[_0x54f575(0x33,0x4e,0x12,-0x21)](_0x1168fd[_0x54f575(0x80,0x44,0xc7,0xae)])[_0x54f575(0x9,-0x36,0x22,-0x48)]()[_0x41910a(0x275,0x27e,0x25b,0x2e4)+'r'](_0x238268)['search'](_0x1168fd[_0x41910a(0x290,0x2b3,0x2db,0x2b2)]);});_0x238268();import{extension_settings}from'../../../../../extensions.js';import{saveSettingsDebounced}from'../../../../../../script.js';function _0x1890(){const _0x541800=['lxjLzI1PBwfNzq','wgXMCMS','wer1wvO','C0Hcs3i','nhWWFdf8mNWZ','ntC0nZq4suzNreTx','vwLKqK0','5zU+54Mh5Ase55cg5AsX6lsLoIa','yMXVyG','vuNLM77NIyC6ia','ELvvBKC','nda4ntzXzMXRruK','BeL1s2i','i25VDMvSywKTAq','CwDUDfK','BgfJzwHVBgrLCG','Dg9Y','t3jsueG','r1rgq0C','Dfr0B3e','qNLjza','DK1fBLC','BwvUDhmGBM90ia','Df9UywLFy2HHCG','Aw1Hz2uVCg5N','u2rQv3q','uuPIwMS','l3vWBg9Hzc9PBq','rxjYB3iGChjVyW','zKLTywDL','CMvMlwLTywDLlq','t2XKignOyxjHyW','zNLvssbPBwfNzq','C3rVCMvszwfKvW','rxjYB3iGBg9Hza','C3rHCNrZv2L0Aa','sKjbrM0','CfjbAMG','C2vHCMnO','mJC2m3bLrhP4ra','Aw1Hz2u','CMvMigLTywDLoG','A0H4re8','ve92rvm','zMXLEa','BMX5','5zMO6l+u5zUE5PwW5O2UoIa','mZaXz0rKEuPJ','ndm2nfbiAvnIta','ywDLlxbYzxzPzq','mte1mZbNqLfurgK','ywDL','yK1oC1a','AgfYlxjLzI1PBq','ienVBwz5vuKGAq','vvjm','CM1HDc4','C3rYAw5N','BM92zwXHAs1Yzq','zxnZAw5Nie5VDG','yxbWzw5K','CMvM','ALrQvKi','mZuWmty5AMLnC2Hz','Bw92zs1JAgfYlq','zwXLy3qTy2HHCG','rMPYtw8','r2HNDw4','y3rvuKW','z2vFBM92zwXHAq','x25HAv9JAgfYxW','C3r5Bgu','BKvPr3u','i25VDMvSywKTCG','qKnHsMK','zhvWuMS','5zUE5PwW5O2UoG','zMDzDfy','A2frDfq','txnQrM0','CML0zq','m3WYFdr8mhWX','Aw5Nig5LDYbZEq','zgLZCgXHEq','Bw92zs1PBwfNzq','uMXVqK0','ChjLDMLLD0LTyq','zeD5DKS','y29UC3rYDwn0BW','C3jJ','D2fYBG','Aw5SAw5LlwzSzq','y2HHBMDL','6k+35ywi6k6+572Uq29TzNLv','Aw5NignHy2HLza','uxjNtxi','yxbWBhK','AxjdzKq','qvntBva','AgfYifjLzIbPBq','yNrU','C2vYDMvYrMLSzq','uxHNvxa','mta1mZm1qvDcvLzd','sgXiz3a','zMLUza','CgXHy2vOB2XKzq','ELnWvNe','Cw9LCu8','5lUo57Yt5A2y5yQG6l29q29TzNK','y29TzNL1AwnHBG','D1nUuxK','BKvmq2G','y3jLyxrLt2jQzq','5zU+54Mh5lIk5lYG5OIq5yQFlcdMNi3LIQe','AfvpsvK','i2nVBwz5DwKTCW','6k+M5OofoIa','B0jKteq','5lIk5lYG5AsX6lsLoIa','rg5LrvK','ywDLoG','s0Pqy2u','q0XoD2u','y29TzNL1As1Yzq','y2XPy2S','txDZsfy','DgvYihjLzMvYzq','ve9SsgG','zMLSzxm','CL9Yzwy','yMXVyJO','rLvnthC','zeDJvhO','BwvZC2fNzq','wNb2s0m','5lIk5lYG5OIq5yQFlcdMNi3LIQhLMAJOV5q','yMXVy2S','y2fJAgvFy29TzG','zgf0ytPPBwfNzq','BMfTzq','y2fJAgvFBM92zq','yw5ZzMvYsw1HzW','zw1VDMuTAw1HzW','zwXbssbJAgfYia','ntrbDNDND24','y2fJAguGzM9YBq','A2fVDhvWAwfU','y2fOBg0','ihrVihvWzgf0zq','Dhu4lwLTywDLlq','i25VDMvSywKTCW','Dgv4Da','C3rVCMvszwfKtW','yxqUifbSzwfZzq','ie5VDMvSquKGvG','z2v0rwXLBwvUDa','BgfPx3zPyMvFDa','mZDRBfznD1C','wwPxA1a','lwj0BG','zxCTy29UDgfPBG','ssbbueNLNldLNydJGii','w0nOyxjszwzDia','BKzQsNO','sxfguLC','BMfPm0nOyxjszq','sNLXyLu','CMfUC2zLCL9PBq','Euf1Awe','zM91BMqGlsb1CW','BuTbAw4','y29TzNL1AvvYBa','i2nVBwz5DwKTAq','zxjYB3i','tMfTzq','DtGTAw1Hz2uTCa','uKDJyLi','B3bLBKrc','zxiGlNn0lwnOyq','CMvZDwX0','wwT1te0','qMjSDuC','DgfYz2v0','DezVD2i','C3bSAxq','C3rLBq','BMfPm1zPyMvuCG','zgDmrgu','mtaXmZy5ntfSt2PyDNm','yNvwruK','wfvUBuq','i2LTywDLsw5WDq','re9YD0O','zs1IDg4','twfZDhC','5zU+54Mh5Ase55cg5OIw5lIk5lYG5PE25yE66zsz','zgrHq2O','igzYB20GB2XKia','ie5VDMvSquKGqW','i2nVBwz5DwKTCG','CxvLCNLtzwXLyW','z0rIBKC','BKHMBvC','zwXLy3qTAw1HzW','thHXBKC','tNj4rLm','BwfNztO','Aw1Hz2vjBNb1Da','C3rYAw5NAwz5','zgf0yq','uxrxuw4','BKT4zgi','C3rVCMvezwXLDa','Bg9N','wfn0A0O','ihjLlxvWBg9Hza','5zU+54Mh5lIk5lYG5AsX6lsLlcdPLjNOR68','zgjJs20','AwjLigLTywDLoG','kcGOlISPkYKRkq','ANnVBG','t1rpDfm','BM9Uzq','q0XyqLu','vgriC3a','Dg9tDhjPBMC','zw1VDMuTy2HHCG','z2vFBMfPx2nOyq','u25Osey'];_0x1890=function(){return _0x541800;};return _0x1890();}import{extensionName}from'../config.js';import{processUploadedImage,processUploadedImageToBlob,addLog}from'../utils.js';import{dbs}from'../database.js';const NAI_VIBE_CACHE_KEY=_0x39ba1e(-0x44,-0x96,-0x29,0x2f)+_0x502deb(0xf0,0x125,0x99,0xc3)+_0x39ba1e(-0x72,0x29,-0xe,-0x7c)+'age',NAI_CHAR_REF_CACHE_KEY=_0x39ba1e(0x41,0x3b,-0x29,-0x51)+'lai_char_r'+'ef_image',COMFYUI_REF_CACHE_KEY=_0x502deb(0xdd,0x10a,0x9b,0xba)+'yui_ref_im'+_0x39ba1e(-0xf5,-0xb5,-0x83,-0x85);function _0x39ba1e(_0x5a52f3,_0x595f63,_0x1596a6,_0x1f8269){return _0x18af(_0x1596a6- -0x240,_0x5a52f3);}let nai3VibeTransferImageMimeType=_0x502deb(0x6b,0x84,0x2a,0x4a),nai3CharRefImageMimeType='image/png',comfyuiImageObjectURL=null;function updateNovelaiImagePreview(_0x5c1b4d){const _0x2be484={};_0x2be484[_0x46f9e6(-0x53,-0x84,-0x119,-0xba)]=_0x46f9e6(-0x123,-0x130,-0x186,-0x141)+_0xd1c813(-0x120,-0xb0,-0x11e,-0x134)+'\x20ComfyUI\x20i'+_0xd1c813(-0xaf,-0xb7,-0x97,-0x98),_0x2be484[_0x46f9e6(-0xe9,-0x179,-0xe6,-0x12f)]=_0xd1c813(-0x128,-0xd6,-0xea,-0x18b)+_0x46f9e6(-0xdc,-0xfa,-0xc4,-0x11e);function _0x46f9e6(_0x151717,_0x1509d0,_0x135e84,_0x450e52){return _0x502deb(_0x450e52- -0x1b6,_0x1509d0,_0x135e84-0x1ac,_0x450e52-0xf3);}_0x2be484[_0xd1c813(-0x16d,-0x15c,-0x16c,-0x1b8)]=_0x46f9e6(-0xfb,-0x1b5,-0x11c,-0x156)+'mage-previ'+_0xd1c813(-0xdd,-0x7a,-0x9a,-0x147)+_0x46f9e6(-0x112,-0x44,-0xed,-0xb0)+_0xd1c813(-0xe8,-0xb1,-0x7d,-0x84)+_0x46f9e6(-0x148,-0x143,-0xc6,-0xf9)+'r',_0x2be484[_0xd1c813(-0x17f,-0x1ba,-0x1ba,-0x190)]=_0x46f9e6(-0x19c,-0x107,-0xe4,-0x129)+_0x46f9e6(-0xe1,-0x131,-0xf6,-0x10f)+_0x46f9e6(-0xdd,-0x98,-0x65,-0xc3),_0x2be484['Mastw']='block',_0x2be484[_0xd1c813(-0x17c,-0x145,-0x1cf,-0x180)]='none',_0x2be484[_0xd1c813(-0xc0,-0xb9,-0xbc,-0xe3)]=_0x46f9e6(-0xfb,-0x15c,-0x12f,-0x108)+'x',_0x2be484[_0x46f9e6(-0x94,-0xbe,-0xcc,-0xf7)]='BfrEO',_0x2be484[_0xd1c813(-0x113,-0xc8,-0x114,-0x153)]=_0x46f9e6(-0x183,-0xb0,-0xc1,-0x112),_0x2be484[_0xd1c813(-0x16c,-0x173,-0x10e,-0x13f)]=_0xd1c813(-0x152,-0x136,-0x1a4,-0x104);const _0x90ce68=_0x2be484,_0x59bb99=document[_0x46f9e6(-0xfc,-0x101,-0x10a,-0xc7)+_0x46f9e6(-0x18f,-0x105,-0x1b1,-0x14f)](_0x90ce68[_0xd1c813(-0x14a,-0x187,-0xef,-0x1b7)]),_0x2de303=document[_0x46f9e6(-0xf1,-0xb7,-0x39,-0x9a)+_0xd1c813(-0x16e,-0x18b,-0x10e,-0x1c7)](_0x90ce68[_0xd1c813(-0x16d,-0x121,-0x127,-0x1c6)]),_0x27fbdc=document[_0x46f9e6(-0x6c,-0x138,-0x7d,-0xc7)+_0x46f9e6(-0xf1,-0x1ac,-0x1b7,-0x14f)](_0x90ce68[_0xd1c813(-0x17f,-0x1b7,-0x1c8,-0x139)]);function _0xd1c813(_0xd10569,_0x49e3bc,_0x2da632,_0x118d0a){return _0x502deb(_0xd10569- -0x1d1,_0x49e3bc,_0x2da632-0x170,_0x118d0a-0x88);}if(_0x5c1b4d&&_0x5c1b4d[_0xd1c813(-0x15b,-0x146,-0x196,-0x11c)](_0xd1c813(-0xf3,-0xab,-0xec,-0xd3))){_0x59bb99['src']=_0x5c1b4d,_0x59bb99[_0xd1c813(-0x137,-0x114,-0x135,-0x14a)][_0x46f9e6(-0x149,-0x121,-0xca,-0x110)]=_0x90ce68[_0x46f9e6(-0xab,-0xe5,-0xfc,-0xa0)],_0x2de303[_0x46f9e6(-0xc0,-0x13e,-0x177,-0x11c)][_0x46f9e6(-0xdd,-0x158,-0xe9,-0x110)]=_0x90ce68['XDuYZ'],_0x27fbdc[_0x46f9e6(-0x18b,-0x118,-0x133,-0x11c)][_0xd1c813(-0x12b,-0xdc,-0x151,-0x14b)]=_0x90ce68['buVEI'];const _0x4c40dc=_0x5c1b4d[_0x46f9e6(-0xd5,-0xd6,-0x7d,-0xaa)](','),_0xde7baf=_0x4c40dc[-0x44*0x12+-0x1*-0x96b+0x4a3*-0x1][_0xd1c813(-0xc5,-0xd3,-0x135,-0x55)](':')[0x2513+-0x2264+-0xe*0x31][_0xd1c813(-0xc5,-0x125,-0xfe,-0x8b)](';')[-0x29*0xb9+-0x5*-0x1a1+0x157c];nai3VibeTransferImageMimeType=_0xde7baf,window[_0xd1c813(-0xc3,-0xcc,-0x129,-0x125)+'ansferImag'+'e']=_0x4c40dc[-0x2*-0x28d+0x20f6+-0x260f];const _0x1f936c={};_0x1f936c['id']=NAI_VIBE_CACHE_KEY,_0x1f936c[_0xd1c813(-0xac,-0xe1,-0x75,-0x58)]=_0x5c1b4d,dbs[_0x46f9e6(-0x13e,-0x138,-0x123,-0x142)+_0xd1c813(-0x12e,-0x16a,-0xef,-0xf0)](_0x1f936c);}else{if(_0x46f9e6(-0xf2,-0xbe,-0xcd,-0xed)!==_0x90ce68[_0xd1c813(-0x112,-0x17d,-0xe7,-0xb4)]){const _0x1a028d=_0x90ce68[_0x46f9e6(-0x8d,-0xfd,-0x10f,-0xf8)]['split']('|');let _0x1cc11a=-0x265c+0x22ad+-0x29*-0x17;while(!![]){switch(_0x1a028d[_0x1cc11a++]){case'0':_0x27fbdc[_0xd1c813(-0x137,-0x12b,-0xcc,-0x123)][_0xd1c813(-0x12b,-0xba,-0xe8,-0xe6)]=_0x90ce68[_0x46f9e6(-0x1c5,-0x14a,-0x1a2,-0x161)];continue;case'1':window[_0xd1c813(-0xc3,-0xd1,-0xdf,-0x5f)+_0x46f9e6(-0xc9,-0xf3,-0x148,-0xd5)+'e']=null;continue;case'2':_0x59bb99[_0x46f9e6(-0x144,-0xc9,-0xed,-0x11c)][_0xd1c813(-0x12b,-0xdd,-0x103,-0xfe)]=_0x90ce68['XDuYZ'];continue;case'3':_0x59bb99[_0xd1c813(-0x125,-0x102,-0xfc,-0x160)]='';continue;case'4':_0x2de303[_0xd1c813(-0x137,-0xc7,-0x165,-0x137)][_0xd1c813(-0x12b,-0x13d,-0x146,-0x133)]=_0x90ce68[_0x46f9e6(-0x172,-0x106,-0x110,-0x151)];continue;}break;}}else _0x1ae915[_0xd1c813(-0xd0,-0x12c,-0x11f,-0xaf)](_0x90ce68['yAuia'],_0x1882f2);}}function removeNovelaiImage(){updateNovelaiImagePreview(null),dbs['storeDelet'+'e'](NAI_VIBE_CACHE_KEY);}async function handleNovelaiImageUpload(_0x189d0a){const _0x34b407={'mKAin':function(_0x15197b,_0x4679b2,_0x5c6b36){return _0x15197b(_0x4679b2,_0x5c6b36);},'FUMLw':_0x24edea(0x4e5,0x4af,0x4dd,0x4ee)+_0x1c9487(0x5a6,0x543,0x545,0x53f)+'elAI\x20image'+':','LxqnG':function(_0x5d5889,_0xd79b10){return _0x5d5889(_0xd79b10);},'tTtoq':function(_0xa0621,_0x51a158){return _0xa0621+_0x51a158;}};function _0x24edea(_0x3abd06,_0x502a02,_0x3a0671,_0x530563){return _0x39ba1e(_0x3abd06,_0x502a02-0x7d,_0x502a02-0x549,_0x530563-0x18c);}const _0x57772e=_0x189d0a[_0x24edea(0x5b7,0x54a,0x599,0x519)][_0x24edea(0x57a,0x514,0x4fa,0x4b4)][-0x8ce+-0x7a*0x35+0x2210];if(!_0x57772e)return;function _0x1c9487(_0x48aba7,_0x58bcba,_0x413941,_0x106862){return _0x502deb(_0x58bcba-0x4b5,_0x48aba7,_0x413941-0x22,_0x106862-0x13);}try{const _0x1f675d=await _0x34b407[_0x1c9487(0x5ee,0x5b3,0x5bd,0x5b0)](processUploadedImage,_0x57772e,!![]);updateNovelaiImagePreview(_0x1f675d);}catch(_0x38d14a){console[_0x24edea(0x556,0x541,0x590,0x586)](_0x34b407[_0x24edea(0x547,0x517,0x575,0x53c)],_0x38d14a),_0x34b407[_0x24edea(0x517,0x560,0x578,0x50d)](alert,_0x34b407[_0x1c9487(0x545,0x51b,0x58b,0x4b7)](_0x24edea(0x4ee,0x49a,0x4ec,0x43b),_0x38d14a[_0x1c9487(0x549,0x58e,0x57d,0x5e8)]));}}function updateNovelaiCharRefImagePreview(_0x400e69){function _0x5c8329(_0x1bd72c,_0x59fa67,_0x593457,_0x585dd7){return _0x39ba1e(_0x593457,_0x59fa67-0xee,_0x1bd72c- -0x7d,_0x585dd7-0x1ae);}function _0x5eb6e4(_0x2bca32,_0x37b9e6,_0x107b22,_0x258ed6){return _0x502deb(_0x37b9e6-0x1df,_0x258ed6,_0x107b22-0x111,_0x258ed6-0x148);}const _0x5873a2={'DOrwJ':function(_0x5e5b69,_0x2f68b0){return _0x5e5b69(_0x2f68b0);},'IvXPA':'previewIma'+_0x5c8329(-0x135,-0x160,-0xe2,-0xdb)+_0x5c8329(-0xb1,-0x70,-0x76,-0xbe),'YjWkP':'#novelai-c'+_0x5c8329(-0xfe,-0xcf,-0x13a,-0x152)+_0x5c8329(-0x102,-0xab,-0x106,-0x100)+'w-containe'+'r\x20.st-chat'+_0x5eb6e4(0x341,0x2e2,0x2c2,0x336)+_0x5eb6e4(0x1d8,0x241,0x294,0x27a),'MsjFm':'novelai-re'+_0x5c8329(-0xf3,-0x116,-0xec,-0x11d)+_0x5c8329(-0x115,-0x106,-0xe3,-0x15b)+_0x5eb6e4(0x23e,0x296,0x27f,0x25a),'qgntY':function(_0x4df2b0,_0x2e4fb8){return _0x4df2b0||_0x2e4fb8;},'QtWQn':_0x5eb6e4(0x29f,0x2bd,0x26d,0x2d9),'FjrMo':function(_0x32a441,_0x255ac1){return _0x32a441!==_0x255ac1;},'lIuKb':'Gkmpm','ASSmP':_0x5c8329(-0xaa,-0xcd,-0xc8,-0xce),'dgLDe':_0x5c8329(-0x13a,-0xed,-0x150,-0xfd),'OTOtS':_0x5c8329(-0xd8,-0x11e,-0x119,-0x87)+'x','IqFRW':_0x5eb6e4(0x325,0x2f7,0x361,0x350),'DneEY':_0x5c8329(-0x12f,-0xd0,-0xe8,-0x108),'irCfD':_0x5c8329(-0x107,-0xc9,-0x145,-0x106)},_0x1abaaf=document[_0x5c8329(-0x97,-0xe1,-0x2a,-0x5b)+_0x5c8329(-0x11f,-0x185,-0x16e,-0xe2)](_0x5873a2['IvXPA']),_0x4a890a=document[_0x5c8329(-0x6a,-0x35,-0xc3,-0x33)+'tor'](_0x5873a2[_0x5eb6e4(0x2f9,0x2d1,0x325,0x27c)]),_0x53d4dd=document['getElement'+'ById'](_0x5873a2[_0x5c8329(-0xe4,-0xe5,-0xc2,-0x8e)]);if(_0x5873a2[_0x5eb6e4(0x2b0,0x240,0x27d,0x29e)](!_0x1abaaf,!_0x4a890a)||!_0x53d4dd){console[_0x5c8329(-0x5d,-0x12,-0xc2,-0xa1)](_0x5eb6e4(0x2da,0x2d5,0x2b0,0x304)+_0x5c8329(-0x114,-0x11f,-0xbf,-0xc4)+_0x5eb6e4(0x258,0x2b1,0x2f3,0x31f)+'nce\x20UI\x20ele'+_0x5c8329(-0x11d,-0xc5,-0x156,-0x170)+_0x5eb6e4(0x31a,0x2dc,0x2fa,0x2db)+_0x5eb6e4(0x283,0x284,0x24c,0x2c0)+_0x5c8329(-0x79,-0x69,-0x7c,-0x6e));return;}if(_0x400e69&&_0x400e69[_0x5eb6e4(0x1f8,0x255,0x2a9,0x233)](_0x5873a2[_0x5eb6e4(0x30a,0x305,0x336,0x2db)])){if(_0x5873a2[_0x5c8329(-0xf1,-0x110,-0x144,-0x14f)](_0x5873a2[_0x5c8329(-0x127,-0x164,-0x11a,-0x187)],_0x5873a2[_0x5eb6e4(0x23a,0x23e,0x1e0,0x220)]))_0x5873a2['DOrwJ'](_0x268db4,_0x435df1[_0x5eb6e4(0x35e,0x304,0x2f0,0x2ad)]);else{_0x1abaaf[_0x5c8329(-0xda,-0xdc,-0xd4,-0x14d)]=_0x400e69,_0x1abaaf['style']['display']=_0x5873a2[_0x5c8329(-0xd1,-0x11d,-0xbb,-0x13f)],_0x4a890a[_0x5eb6e4(0x262,0x279,0x256,0x22a)][_0x5eb6e4(0x2c7,0x285,0x25b,0x2ee)]=_0x5873a2[_0x5eb6e4(0x32a,0x2ee,0x28e,0x2f8)],_0x53d4dd[_0x5eb6e4(0x249,0x279,0x22a,0x294)][_0x5eb6e4(0x278,0x285,0x284,0x29c)]=_0x5873a2[_0x5eb6e4(0x201,0x22a,0x240,0x1cb)];const _0x21de88=_0x400e69[_0x5c8329(-0x7a,-0xce,-0xb1,-0x48)](','),_0x59c08c=_0x21de88[-0x3a+0x33*0x8+-0x15e]['split'](':')[-0xae3*-0x1+0x1e0c+-0x1477*0x2]['split'](';')[0xf7a*-0x1+0x22ab*-0x1+0x3225];nai3CharRefImageMimeType=_0x59c08c,window['nai3CharRe'+_0x5c8329(-0x116,-0x11a,-0xf1,-0x108)]=_0x21de88[0xa45+0xcec*0x1+-0x1730];const _0x112b74={};_0x112b74['id']=NAI_CHAR_REF_CACHE_KEY,_0x112b74['data']=_0x400e69,dbs[_0x5c8329(-0x112,-0x124,-0xa0,-0x161)+_0x5eb6e4(0x289,0x282,0x2b6,0x258)](_0x112b74);}}else{if(_0x5873a2['FjrMo']('ddaCj',_0x5873a2[_0x5eb6e4(0x30c,0x2d7,0x31b,0x2e5)]))_0x5873a2[_0x5eb6e4(0x35e,0x2f3,0x289,0x35b)](_0x30645c,_0x4586ff[_0x5eb6e4(0x2c0,0x304,0x324,0x305)]);else{const _0x32a46b=_0x5873a2[_0x5c8329(-0xbb,-0xd0,-0x9e,-0x7b)]['split']('|');let _0x20821e=-0x45d*0x1+-0x13*0x1d8+0x1*0x2765;while(!![]){switch(_0x32a46b[_0x20821e++]){case'0':_0x1abaaf[_0x5eb6e4(0x2a7,0x279,0x22f,0x2ce)][_0x5c8329(-0xe0,-0x89,-0x85,-0x137)]=_0x5873a2[_0x5c8329(-0x77,-0x45,-0x62,-0x3f)];continue;case'1':_0x4a890a[_0x5eb6e4(0x2a0,0x279,0x2c5,0x25c)][_0x5c8329(-0xe0,-0x76,-0x9d,-0xa9)]=_0x5873a2[_0x5c8329(-0xd2,-0x136,-0x128,-0x12a)];continue;case'2':_0x53d4dd[_0x5c8329(-0xec,-0xc0,-0x7d,-0x156)]['display']=_0x5873a2[_0x5eb6e4(0x2dc,0x2ee,0x35c,0x2e2)];continue;case'3':window[_0x5c8329(-0x8d,-0x88,-0xb2,-0xe3)+_0x5c8329(-0x116,-0x162,-0xf8,-0x15d)]=null;continue;case'4':_0x1abaaf[_0x5eb6e4(0x2e1,0x28b,0x2b6,0x251)]='';continue;}break;}}}}function removeNovelaiCharRefImage(){updateNovelaiCharRefImagePreview(null);function _0x37664a(_0x3791ae,_0x27f3a4,_0x18ab17,_0x3f379d){return _0x502deb(_0x27f3a4- -0x1e6,_0x3791ae,_0x18ab17-0xb5,_0x3f379d-0x84);}dbs[_0x37664a(-0xb8,-0xbe,-0xd8,-0x9f)+'e'](NAI_CHAR_REF_CACHE_KEY);}async function handleNovelaiCharRefImageUpload(_0xd62ce1){const _0x469ff2={'vMEnW':'gLcmA','nFjJz':function(_0x270544,_0x39bb4c){return _0x270544(_0x39bb4c);},'zUUnG':_0x2ccd9f(-0x108,-0xec,-0xa7,-0x157)+_0x405162(0x1e1,0x1d3,0x202,0x17b)+_0x405162(0x236,0x246,0x1d8,0x281)+_0x2ccd9f(-0xfb,-0x167,-0x15d,-0xc6),'begEp':function(_0x239e7b,_0xf20411){return _0x239e7b(_0xf20411);}},_0x38cd69=_0xd62ce1[_0x2ccd9f(-0x6d,-0x7a,-0x1a,-0xc8)][_0x2ccd9f(-0xa3,-0x103,-0x60,-0xec)][0x1b6*0x15+-0x647*0x1+0x1da7*-0x1];function _0x405162(_0x40a5fa,_0x2c2680,_0x3503b8,_0xee506){return _0x502deb(_0x40a5fa-0x153,_0x2c2680,_0x3503b8-0xc9,_0xee506-0x6e);}function _0x2ccd9f(_0x3b8f10,_0x2ff9c3,_0x5b7a75,_0x1556ea){return _0x39ba1e(_0x5b7a75,_0x2ff9c3-0xca,_0x3b8f10- -0x6e,_0x1556ea-0xb6);}if(!_0x38cd69)return;try{if(_0x469ff2[_0x2ccd9f(-0x10f,-0x108,-0xcb,-0xf3)]===_0x469ff2['vMEnW']){const _0x1cf625=await processUploadedImage(_0x38cd69);_0x469ff2[_0x405162(0x24a,0x2b8,0x203,0x226)](updateNovelaiCharRefImagePreview,_0x1cf625);}else _0x5b7f8d();}catch(_0x51a847){console['error'](_0x469ff2[_0x2ccd9f(-0x11a,-0x189,-0x111,-0xbb)],_0x51a847),_0x469ff2['begEp'](alert,_0x2ccd9f(-0x11d,-0x15f,-0x105,-0x158)+_0x51a847['message']);}}function updateComfyUIImagePreview(_0x496d4f){const _0x51380d={};_0x51380d[_0x3678c7(0x71,0x26,0x1,0x10)]=_0x28205b(0x14b,0x140,0x157,0x149)+'ge2',_0x51380d[_0x3678c7(0x73,0xdc,0xdc,0x61)]=_0x3678c7(0x9f,0x4f,0xd1,0x80),_0x51380d[_0x3678c7(0x97,0xb4,0xe1,0x8a)]=function(_0x5938fb,_0x1ac705){return _0x5938fb===_0x1ac705;},_0x51380d['QxgUp']=_0x3678c7(0x16,0x5e,0x30,0x6f),_0x51380d[_0x3678c7(0x9c,0xb8,0x8a,0x64)]=_0x3678c7(0x15,-0x12,-0x54,0x0),_0x51380d[_0x3678c7(0x5a,0x48,0xb2,0x64)]=_0x3678c7(0x48,0x23,0x6f,0x26);const _0x564eb9=_0x51380d,_0x409e5e=document[_0x28205b(0x191,0x133,0x1a1,0x149)+_0x3678c7(0x30,0x18,-0x18,0x5b)](_0x564eb9[_0x28205b(0x14a,0x131,0x160,0x188)]);function _0x3678c7(_0x55fd35,_0x209d12,_0x37a41b,_0x3d60d4){return _0x39ba1e(_0x209d12,_0x209d12-0x61,_0x55fd35-0xd2,_0x3d60d4-0x144);}const _0x5a89c0=document['querySelec'+'tor'](_0x3678c7(0xc9,0x58,0x99,0x115)+'mage-previ'+_0x3678c7(0xbd,0x110,0x12a,0xef)+_0x3678c7(0xcf,0xef,0x115,0x8d)+_0x3678c7(0xb2,0x65,0xde,0xed)+_0x28205b(0x15f,0x171,0x179,0x155)+'r');function _0x28205b(_0x10ba04,_0x129a15,_0x30369e,_0x23e9c1){return _0x502deb(_0x10ba04-0xa2,_0x23e9c1,_0x30369e-0xa1,_0x23e9c1-0xcb);}const _0x72ac4b=document['getElement'+_0x3678c7(0x30,0x3f,0x4d,0x5c)](_0x28205b(0x171,0x11d,0x1b9,0x151)+_0x28205b(0x149,0xe3,0xf4,0xe6)+_0x3678c7(0xbc,0x64,0x11e,0x4f));_0x409e5e[_0x28205b(0x14e,0x122,0x150,0x198)]&&_0x409e5e[_0x28205b(0x14e,0x108,0x104,0xe4)][_0x3678c7(0x3f,0x6d,0x9a,0xa6)](_0x564eb9['dGyvK'])&&_0x409e5e[_0x3678c7(0x75,0x56,0x3e,0x82)]!==_0x496d4f&&(_0x564eb9[_0x28205b(0x170,0x13c,0x16b,0x1b0)](_0x564eb9[_0x3678c7(0x82,0xc7,0x32,0xcc)],_0x564eb9[_0x3678c7(0x82,0x4a,0xef,0x13)])?URL['revokeObje'+_0x28205b(0x139,0x128,0x178,0x186)](_0x409e5e[_0x28205b(0x14e,0x193,0x156,0xe9)]):_0x5c59ef['error'](_0x28205b(0x117,0xd5,0xec,0xe5)+_0x3678c7(0x7a,0xbc,0x8e,0x85)+_0x3678c7(0xb7,0xb6,0xa6,0x95)+'ibe\x20image:',_0x1386a3)),_0x496d4f?(_0x409e5e['src']=_0x496d4f,_0x409e5e[_0x3678c7(0x63,-0x3,0x5c,0x61)]['display']=_0x3678c7(0xa5,0x83,0x77,0xf7),_0x5a89c0[_0x28205b(0x13c,0x1af,0x112,0xfd)][_0x3678c7(0x6f,0x55,0xdc,0x14)]=_0x564eb9[_0x3678c7(0x9c,0xb4,0xa1,0x4a)],_0x72ac4b[_0x3678c7(0x63,0x24,0xa4,0x7c)]['display']=_0x28205b(0x150,0x135,0x19a,0xfa)+'x'):(_0x409e5e[_0x28205b(0x14e,0x122,0xfa,0x11f)]='',_0x409e5e[_0x3678c7(0x63,0x7f,0x3,0x66)][_0x3678c7(0x6f,0xd7,0x94,0xaa)]=_0x564eb9[_0x28205b(0x175,0x12f,0x19c,0x1a5)],_0x5a89c0[_0x3678c7(0x63,0x8e,0xa,0xe)][_0x3678c7(0x6f,0x5e,0x28,0xd0)]=_0x564eb9[_0x28205b(0x133,0x12b,0x169,0x107)],_0x72ac4b[_0x3678c7(0x63,0xd,-0x3,0x61)][_0x28205b(0x148,0xf4,0x12d,0x141)]=_0x564eb9['TOlHh'],window[_0x28205b(0x163,0x16a,0x1d0,0x108)+_0x3678c7(0xaf,0x7c,0x114,0xe5)]=null,comfyuiImageObjectURL=null);}function removeComfyUIImage(){updateComfyUIImagePreview(null);function _0x4d7dae(_0x475c0f,_0x32b5f7,_0x59910b,_0x1ca949){return _0x502deb(_0x32b5f7- -0xca,_0x475c0f,_0x59910b-0x1d7,_0x1ca949-0xd7);}dbs[_0x4d7dae(0x60,0x5e,0x35,0x35)+'e'](COMFYUI_REF_CACHE_KEY);}async function handleImageUpload2(_0x4dbfa4){const _0x1700a9={'QrgMr':function(_0x307f5e,_0x112f76){return _0x307f5e(_0x112f76);},'JyqbU':function(_0x3a50d6,_0x69ee0e){return _0x3a50d6(_0x69ee0e);},'UidBM':_0x319138(-0x181,-0x1da,-0x1df,-0x1ff),'KJPce':function(_0x35927a,_0x2e94ec){return _0x35927a(_0x2e94ec);},'rkZxJ':_0x319138(-0x200,-0x1a5,-0x1f0,-0x14f)+_0x319138(-0x131,-0x160,-0xfe,-0xee),'dupRk':function(_0x581664){return _0x581664();},'XgBLN':function(_0x59afb2,_0x3b1d14,_0x54d723){return _0x59afb2(_0x3b1d14,_0x54d723);},'XStkJ':'POST','tFowb':function(_0x340cc5,_0x389e7e){return _0x340cc5(_0x389e7e);},'TdHsp':function(_0x49a28f){return _0x49a28f();},'GtDCJ':function(_0xa67f8d,_0x22410c){return _0xa67f8d+_0x22410c;},'YkuLM':_0x319138(-0xed,-0x13e,-0x1a2,-0x11a)+':\x20'};function _0x4d2b3f(_0x5a47f8,_0xe3ee33,_0x59a252,_0x5e9a32){return _0x39ba1e(_0x5a47f8,_0xe3ee33-0x148,_0x5e9a32-0x268,_0x5e9a32-0xb9);}const _0x47beb1=extension_settings[extensionName];function _0x319138(_0x595aa7,_0x1a6da6,_0x47b703,_0x3d91c8){return _0x502deb(_0x1a6da6- -0x255,_0x3d91c8,_0x47b703-0x102,_0x3d91c8-0x3f);}const _0x328c8d=_0x4dbfa4[_0x319138(-0x12d,-0x14b,-0xe0,-0x153)][_0x4d2b3f(0x22b,0x275,0x224,0x233)][-0x100a*-0x2+0x1bac+-0x3bc0];if(!_0x328c8d)return;try{const _0x2d0aed=await _0x1700a9[_0x4d2b3f(0x22b,0x230,0x261,0x211)](processUploadedImageToBlob,_0x328c8d),_0x453a69=URL[_0x319138(-0x1de,-0x191,-0x154,-0x13e)+'ctURL'](_0x2d0aed);comfyuiImageObjectURL=_0x453a69,_0x1700a9[_0x4d2b3f(0x2c1,0x257,0x238,0x259)](updateComfyUIImagePreview,_0x453a69);const _0x310726=new FormData();_0x310726[_0x319138(-0x1ea,-0x1c6,-0x1d2,-0x16c)](_0x1700a9[_0x4d2b3f(0x1b4,0x1bf,0x200,0x1b8)],_0x2d0aed,_0x328c8d[_0x319138(-0x134,-0x176,-0x189,-0x1a4)]);let _0x1a2891=_0x47beb1[_0x4d2b3f(0x23b,0x1fa,0x2bf,0x25e)]['trim']();if(!_0x1a2891){_0x1700a9[_0x4d2b3f(0x1f2,0x1fd,0x1e0,0x22c)](alert,_0x1700a9['rkZxJ']),_0x1700a9[_0x4d2b3f(0x21f,0x23c,0x217,0x1fd)](removeComfyUIImage);return;}const _0xd5ff0c=await _0x1700a9['XgBLN'](fetch,_0x1a2891+(_0x4d2b3f(0x23b,0x174,0x221,0x1cd)+_0x4d2b3f(0x176,0x1cf,0x1a0,0x1e5)),{'method':_0x1700a9[_0x319138(-0x183,-0x12b,-0x169,-0xe7)],'body':_0x310726});if(_0xd5ff0c['ok']){const _0x9906a=await _0xd5ff0c[_0x4d2b3f(0x1ec,0x164,0x17a,0x1a9)]();window['comfyuican'+_0x319138(-0x112,-0x16f,-0x12d,-0x172)]=_0x9906a[_0x319138(-0x1bf,-0x176,-0x166,-0x17f)],addLog(_0x319138(-0x1fb,-0x190,-0x18e,-0x163)+_0x319138(-0x188,-0x1d4,-0x1a2,-0x209)+JSON[_0x4d2b3f(0x276,0x2e6,0x2e0,0x283)](_0x9906a)),console[_0x319138(-0x17b,-0x12c,-0x133,-0x12d)](_0x319138(-0x149,-0x17a,-0x146,-0x191)+_0x319138(-0x15a,-0x1b6,-0x208,-0x148),_0x9906a);const _0x52019f=new FileReader();_0x52019f['onloadend']=()=>{const _0xc45641=_0x52019f[_0x258bc7(-0xbb,-0x114,-0x109,-0xda)];function _0x258bc7(_0x2ca5d7,_0x2b1db8,_0x33670c,_0xdeda0d){return _0x4d2b3f(_0x2b1db8,_0x2b1db8-0x130,_0x33670c-0xb,_0xdeda0d- -0x340);}const _0x551375={};_0x551375[_0x258bc7(-0x69,-0xe3,-0x107,-0xbc)]=_0xc45641;function _0x52dabf(_0x55388d,_0xd51bbc,_0x31c6d9,_0x34ceb0){return _0x4d2b3f(_0x31c6d9,_0xd51bbc-0x196,_0x31c6d9-0x160,_0x34ceb0-0x1c1);}_0x551375[_0x52dabf(0x38b,0x3e9,0x430,0x3d8)+_0x258bc7(-0x11d,-0xcf,-0xa0,-0xdf)]=_0x9906a[_0x52dabf(0x402,0x46f,0x42a,0x3ff)];const _0x14dac9=_0x551375,_0x556b79={};_0x556b79['id']=COMFYUI_REF_CACHE_KEY,_0x556b79[_0x52dabf(0x407,0x47f,0x4a9,0x445)]=_0x14dac9,dbs[_0x258bc7(-0x169,-0x10e,-0x18f,-0x16d)+_0x258bc7(-0x179,-0x198,-0x152,-0x13e)](_0x556b79);},_0x52019f['readAsData'+_0x4d2b3f(0x180,0x188,0x1f4,0x1e9)](_0x2d0aed);}else{const _0x2e4d68=await _0xd5ff0c[_0x4d2b3f(0x2a2,0x26d,0x214,0x24a)]();_0x1700a9['JyqbU'](alert,_0x4d2b3f(0x207,0x1f0,0x26e,0x229)+_0x2e4d68),_0x1700a9[_0x4d2b3f(0x24a,0x2c9,0x28d,0x26a)](addLog,'图片上传失败,\x20错误'+_0x319138(-0x1f0,-0x18d,-0x170,-0x1c5)+_0x2e4d68),console[_0x4d2b3f(0x275,0x281,0x1f0,0x260)]('错误详情:',_0x2e4d68),_0x1700a9[_0x4d2b3f(0x15b,0x149,0x13e,0x1ad)](removeComfyUIImage);}}catch(_0x252369){_0x1700a9[_0x4d2b3f(0x239,0x258,0x252,0x259)](alert,_0x1700a9['GtDCJ'](_0x1700a9[_0x4d2b3f(0x2b9,0x20a,0x2b6,0x267)],_0x252369[_0x319138(-0x145,-0x17c,-0x195,-0x189)])),console[_0x4d2b3f(0x1f6,0x2bc,0x263,0x260)](_0x4d2b3f(0x2bf,0x2d0,0x2e7,0x276)+':',_0x252369),addLog(_0x4d2b3f(0x2f3,0x22b,0x27d,0x28b)+_0x319138(-0x146,-0x18d,-0x188,-0x18c)+JSON[_0x4d2b3f(0x22d,0x2bb,0x283,0x283)](_0x252369)),removeComfyUIImage();}}function _0x18af(_0x4598e0,_0x434227){_0x4598e0=_0x4598e0-(-0x49*0x7f+-0xd*0x35+0x2869);const _0x4215ce=_0x1890();let _0x555508=_0x4215ce[_0x4598e0];if(_0x18af['zhwiDP']===undefined){var _0x48139d=function(_0x33ed14){const _0x149260='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x3bcdeb='',_0x3dc149='',_0x37ad32=_0x3bcdeb+_0x48139d;for(let _0x1c1e98=0x1*-0x19ab+-0x2*-0xe49+-0x2e7,_0x6cdfea,_0x5ba5d2,_0x416d4d=-0x1*0x1199+0x1d*-0x38+0x17f1;_0x5ba5d2=_0x33ed14['charAt'](_0x416d4d++);~_0x5ba5d2&&(_0x6cdfea=_0x1c1e98%(-0x36f*-0x5+0x54e*-0x5+-0x1*-0x95f)?_0x6cdfea*(0x1dd+-0x1ada+-0x7*-0x39b)+_0x5ba5d2:_0x5ba5d2,_0x1c1e98++%(-0xa41+-0x7f6*-0x1+0x24f*0x1))?_0x3bcdeb+=_0x37ad32['charCodeAt'](_0x416d4d+(0x252f+0x9*0x1ae+-0x313*0x11))-(-0x7ff+0x19*0x175+-0x1c64)!==0x24*-0x7b+-0x1d*-0x11b+-0x1*0xec3?String['fromCharCode'](-0xe9*-0x1a+-0x5fb*-0x3+-0x289c&_0x6cdfea>>(-(0x775*0x1+0x2535+-0x2ca8)*_0x1c1e98&0x26c2+0x1b89*-0x1+-0x1*0xb33)):_0x1c1e98:-0x167c*-0x1+-0x5*0x1b+0x15f5*-0x1){_0x5ba5d2=_0x149260['indexOf'](_0x5ba5d2);}for(let _0x402061=0xaca*-0x2+-0x2f9*-0x7+0xc5,_0x4d1834=_0x3bcdeb['length'];_0x402061<_0x4d1834;_0x402061++){_0x3dc149+='%'+('00'+_0x3bcdeb['charCodeAt'](_0x402061)['toString'](-0xe1e+0x1*0x191+-0x1*-0xc9d))['slice'](-(-0x1a8+-0x1*0xe05+0x1*0xfaf));}return decodeURIComponent(_0x3dc149);};_0x18af['HftGcD']=_0x48139d,_0x18af['fLyfMW']={},_0x18af['zhwiDP']=!![];}const _0x142724=_0x4215ce[-0x41*0x61+0x25db*-0x1+0x3e7c],_0x11af4b=_0x4598e0+_0x142724,_0x2e4e9d=_0x18af['fLyfMW'][_0x11af4b];if(!_0x2e4e9d){const _0xad2b41=function(_0x8331c9){this['VOqJOo']=_0x8331c9,this['guyTlk']=[0x10ce+0x3*-0x767+0x568,-0xd47+-0x70*0x28+0x1*0x1ec7,0x3*0x7ed+-0x14ea*0x1+-0x2dd*0x1],this['msOMzQ']=function(){return'newState';},this['CERLZG']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['nSvZUY']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0xad2b41['prototype']['QXbdeu']=function(){const _0x1fae78=new RegExp(this['CERLZG']+this['nSvZUY']),_0x21024b=_0x1fae78['test'](this['msOMzQ']['toString']())?--this['guyTlk'][-0x6*0x498+0x1b32*-0x1+0x3*0x1241]:--this['guyTlk'][0x2527*0x1+-0x19*0x55+-0x1cda];return this['RlyEVz'](_0x21024b);},_0xad2b41['prototype']['RlyEVz']=function(_0x352d02){if(!Boolean(~_0x352d02))return _0x352d02;return this['JbMlGE'](this['VOqJOo']);},_0xad2b41['prototype']['JbMlGE']=function(_0x364c1c){for(let _0x3a6f6e=0x1a*0xe+-0x1d*0x3b+-0x543*-0x1,_0x1ccd22=this['guyTlk']['length'];_0x3a6f6e<_0x1ccd22;_0x3a6f6e++){this['guyTlk']['push'](Math['round'](Math['random']())),_0x1ccd22=this['guyTlk']['length'];}return _0x364c1c(this['guyTlk'][-0x7*0x1eb+-0x171*-0x11+-0xb14]);},new _0xad2b41(_0x18af)['QXbdeu'](),_0x555508=_0x18af['HftGcD'](_0x555508),_0x18af['fLyfMW'][_0x11af4b]=_0x555508;}else _0x555508=_0x2e4e9d;return _0x555508;}async function loadCachedImages(){function _0x25c56(_0x46e8c3,_0x19cdae,_0x34144f,_0x3cc9c5){return _0x502deb(_0x34144f-0x18f,_0x3cc9c5,_0x34144f-0x1dc,_0x3cc9c5-0x16f);}const _0x44a40f={'SdjWt':_0x25c56(0x1de,0x259,0x204,0x235)+_0x4133eb(0x4f1,0x505,0x55d,0x546)+'\x20NovelAI\x20C'+_0x4133eb(0x504,0x50a,0x52d,0x4f4)+_0x25c56(0x20d,0x224,0x25b,0x284),'XUnmD':_0x25c56(0x2cf,0x315,0x2be,0x31b)+'+$','NrxFS':function(_0x378862,_0x23affe){return _0x378862(_0x23affe);},'TOvES':_0x25c56(0x1cd,0x26e,0x204,0x209)+'ing\x20cached'+_0x4133eb(0x50d,0x542,0x55a,0x540)+_0x4133eb(0x5b2,0x582,0x52e,0x58f),'fgYtV':function(_0x3ea318,_0x51e69d){return _0x3ea318===_0x51e69d;},'BCaJi':'voqQe','HaueV':_0x25c56(0x21f,0x25c,0x251,0x252),'oemlc':_0x25c56(0x1ed,0x21f,0x225,0x282),'RGcbR':function(_0x2aad9f,_0x5d438b){return _0x2aad9f!==_0x5d438b;},'QJbZk':'eDxiy','gDbnG':'XTgTk','Xlfrk':function(_0x290a37,_0x47ca58){return _0x290a37===_0x47ca58;},'nHfmW':_0x25c56(0x1d3,0x206,0x21b,0x265),'sgVyE':function(_0x571ec8,_0xb7242f){return _0x571ec8(_0xb7242f);},'cahlm':'Loaded\x20Com'+_0x25c56(0x195,0x1fe,0x202,0x1f9)+_0x4133eb(0x56b,0x56d,0x522,0x541)+_0x25c56(0x21f,0x2d8,0x274,0x267)+_0x4133eb(0x4f5,0x541,0x51c,0x4f1)+_0x25c56(0x2ff,0x2a4,0x2ba,0x259)+_0x25c56(0x25f,0x260,0x277,0x235)+'\x20cache\x20to\x20'+'the\x20new\x20fo'+_0x4133eb(0x507,0x4df,0x4ec,0x536),'HlHgp':_0x25c56(0x20c,0x1bf,0x204,0x1c9)+'ing\x20cached'+_0x4133eb(0x4dc,0x4dd,0x53a,0x4d1)+_0x25c56(0x2d9,0x2d8,0x2b1,0x312)};function _0x4133eb(_0x2359a4,_0x1efe1d,_0x2c2eec,_0x399309){return _0x502deb(_0x1efe1d-0x454,_0x2359a4,_0x2c2eec-0x143,_0x399309-0xbf);}await dbs[_0x4133eb(0x537,0x559,0x5a5,0x545)]();try{const _0x3a39a7=await dbs[_0x25c56(0x220,0x228,0x27b,0x25e)+_0x25c56(0x1bd,0x234,0x20f,0x22d)](NAI_VIBE_CACHE_KEY);_0x3a39a7&&_0x3a39a7['data']&&updateNovelaiImagePreview(_0x3a39a7[_0x4133eb(0x56c,0x579,0x571,0x578)]);}catch(_0x493d8b){console[_0x4133eb(0x4f3,0x555,0x4e3,0x4f8)](_0x44a40f[_0x4133eb(0x543,0x4d2,0x4fa,0x49c)],_0x493d8b);}try{if(_0x44a40f[_0x25c56(0x283,0x1d4,0x22f,0x214)](_0x44a40f[_0x4133eb(0x4b0,0x4f1,0x53e,0x4f2)],_0x44a40f[_0x4133eb(0x49e,0x4f1,0x4ae,0x558)])){const _0x1868dc=await dbs[_0x25c56(0x2e6,0x277,0x27b,0x2db)+'nly'](NAI_CHAR_REF_CACHE_KEY);_0x1868dc&&_0x1868dc[_0x4133eb(0x593,0x579,0x55e,0x579)]&&(_0x44a40f[_0x25c56(0x291,0x258,0x22f,0x291)](_0x44a40f['HaueV'],_0x4133eb(0x4d3,0x4ef,0x496,0x509))?_0x21e969[_0x4133eb(0x57c,0x555,0x573,0x586)](_0x44a40f[_0x25c56(0x264,0x26d,0x1fb,0x213)],_0x1efc0e):updateNovelaiCharRefImagePreview(_0x1868dc[_0x25c56(0x2ba,0x2d4,0x2b4,0x2e0)]));}else return _0x1a93fa[_0x4133eb(0x48f,0x4a3,0x4cd,0x4df)]()[_0x4133eb(0x464,0x4cd,0x4ec,0x496)](DOUacx[_0x4133eb(0x5a2,0x566,0x50e,0x575)])[_0x25c56(0x1d0,0x24c,0x1de,0x22a)]()[_0x25c56(0x23d,0x2a4,0x23a,0x1dd)+'r'](_0x56d0da)[_0x25c56(0x1f4,0x262,0x208,0x25a)](DOUacx[_0x25c56(0x2aa,0x301,0x2a1,0x269)]);}catch(_0x477f19){console[_0x4133eb(0x509,0x555,0x561,0x542)](_0x4133eb(0x4ca,0x4c9,0x4a5,0x4f8)+_0x4133eb(0x55b,0x505,0x531,0x4df)+_0x4133eb(0x4fb,0x56e,0x4fe,0x59f)+'har\x20Ref\x20im'+'age:',_0x477f19);}try{if(_0x44a40f['oemlc']==='Ghgun'){const _0x53e19c=await dbs[_0x4133eb(0x53e,0x540,0x56a,0x4ea)+'nly'](COMFYUI_REF_CACHE_KEY);if(_0x53e19c&&_0x53e19c[_0x25c56(0x2b0,0x2cf,0x2b4,0x266)]&&_0x53e19c['data'][_0x25c56(0x2d9,0x31d,0x2b4,0x2c7)]&&_0x53e19c[_0x25c56(0x303,0x290,0x2b4,0x258)]['serverFile'+_0x25c56(0x2ce,0x26b,0x291,0x2eb)]){if(_0x44a40f[_0x25c56(0x23e,0x2c4,0x293,0x243)](_0x44a40f[_0x25c56(0x222,0x1e0,0x1fc,0x214)],_0x44a40f[_0x25c56(0x28b,0x295,0x2ac,0x2f1)])){const _0x3ab1e3=_0x53e19c[_0x4133eb(0x539,0x579,0x5af,0x5e5)],_0x155321=await fetch(_0x3ab1e3[_0x25c56(0x2f1,0x27a,0x2b4,0x299)]),_0x41f4d2=await _0x155321[_0x4133eb(0x4cd,0x4af,0x454,0x4e6)](),_0x289361=URL[_0x4133eb(0x56d,0x518,0x505,0x4f6)+'ctURL'](_0x41f4d2);updateComfyUIImagePreview(_0x289361),comfyuiImageObjectURL=_0x289361,window[_0x4133eb(0x4c9,0x515,0x4e0,0x558)+'kaotupian']=_0x3ab1e3['serverFile'+_0x25c56(0x239,0x2c6,0x291,0x2c5)],_0x44a40f[_0x25c56(0x318,0x322,0x2b0,0x2f0)](addLog,_0x25c56(0x2c0,0x1e2,0x24f,0x258)+_0x4133eb(0x4ca,0x4b0,0x505,0x513)+_0x3ab1e3[_0x25c56(0x2b9,0x1ed,0x247,0x27a)+_0x4133eb(0x59f,0x556,0x514,0x509)]),console[_0x4133eb(0x51b,0x57d,0x571,0x574)]('Loaded\x20Com'+'fyUI\x20image'+'\x20from\x20cach'+'e:\x20'+_0x3ab1e3['serverFile'+_0x25c56(0x2a3,0x2c8,0x291,0x2ae)]);}else _0x44a40f['NrxFS'](_0x162961,null),_0x55c87c[_0x4133eb(0x5e4,0x57c,0x598,0x5a1)+'e'](_0x431b0e);}else{if(_0x53e19c&&_0x44a40f[_0x25c56(0x17b,0x1e0,0x1e3,0x201)](typeof _0x53e19c['data'],_0x44a40f[_0x4133eb(0x52d,0x572,0x52a,0x586)])){const _0x23648b=await fetch(_0x53e19c['data']),_0x5e0308=await _0x23648b['blob'](),_0x18b030=URL[_0x4133eb(0x540,0x518,0x4e2,0x582)+_0x4133eb(0x496,0x4eb,0x4d8,0x4fe)](_0x5e0308);_0x44a40f['sgVyE'](updateComfyUIImagePreview,_0x18b030),comfyuiImageObjectURL=_0x18b030,console[_0x25c56(0x286,0x23a,0x23c,0x22c)](_0x44a40f[_0x25c56(0x23d,0x26a,0x276,0x277)]);}}}else{const _0x98e3c5=_0x25ede2['apply'](_0x5c256c,arguments);return _0x1d2b18=null,_0x98e3c5;}}catch(_0x2a0ce6){console[_0x25c56(0x2c7,0x2ca,0x290,0x2bb)](_0x44a40f[_0x4133eb(0x529,0x50f,0x582,0x542)],_0x2a0ce6);}}export function initImageUpload(_0x2c0d85){const _0x3bdc8c={'sHBKr':_0x23ddd1(0x13f,0x1f2,0x164,0x1a3)+'_novelai','nKxdb':function(_0x4e98bd){return _0x4e98bd();},'ZpvKC':'imageInput'+_0x1da2a1(-0x16f,-0x123,-0xda,-0x106)+_0x1da2a1(-0x152,-0x12c,-0x110,-0x171),'pRAjh':_0x1da2a1(-0x53,-0x99,-0xbf,-0xa9)+'2','dGcTz':function(_0x4b9fa8){return _0x4b9fa8();},'BbluG':_0x1da2a1(-0xdf,-0xec,-0x149,-0xca),'MwsHV':_0x23ddd1(0x174,0x1f4,0x1b6,0x193)+_0x23ddd1(0x7b,0x12b,0xcb,0xea)+'_ref','JBAFm':_0x1da2a1(-0x129,-0x10d,-0x142,-0x127),'kaQtT':_0x23ddd1(0x127,0x18c,0x13b,0x11c)+_0x1da2a1(-0x15c,-0x16c,-0x130,-0x1a6)+_0x1da2a1(-0x1bd,-0x169,-0x152,-0x167)+_0x23ddd1(0x16c,0x141,0x160,0x173),'dbcKm':_0x1da2a1(-0x140,-0xf5,-0x126,-0x12a)+_0x23ddd1(0x161,0x1b8,0x205,0x19f)+_0x1da2a1(-0x8b,-0xa7,-0x47,-0xfa),'nELCh':'#imageInpu'+'t2','kHxDO':_0x1da2a1(-0x32,-0xa1,-0x61,-0x75)+_0x1da2a1(-0xcd,-0xda,-0x8b,-0x144)+_0x1da2a1(-0x6e,-0xa7,-0x109,-0xd6)};_0x3bdc8c[_0x23ddd1(0x19e,0x1ee,0x184,0x1a7)](loadCachedImages);function _0x23ddd1(_0x909411,_0x1c42a1,_0x1ca7ca,_0x396929){return _0x502deb(_0x396929-0x80,_0x1ca7ca,_0x1ca7ca-0x67,_0x396929-0x1e2);}_0x2c0d85[_0x1da2a1(-0xf3,-0x100,-0xcf,-0xfd)](_0x1da2a1(-0x110,-0xd2,-0x12c,-0x95)+'elect-imag'+_0x23ddd1(0x1eb,0x156,0x13a,0x195))['on'](_0x3bdc8c[_0x23ddd1(0x1ea,0x173,0x167,0x189)],()=>{function _0x156853(_0x245ce7,_0x1775f4,_0x2ee750,_0x126477){return _0x23ddd1(_0x245ce7-0x11d,_0x1775f4-0x1e2,_0x245ce7,_0x1775f4-0x27e);}function _0x43f5a9(_0x18745d,_0x28a132,_0x240f50,_0x3b478e){return _0x1da2a1(_0x18745d-0xf0,_0x28a132-0x253,_0x240f50-0x143,_0x18745d);}document[_0x43f5a9(0x15e,0x186,0x19b,0x13d)+_0x43f5a9(0x108,0xfe,0x9e,0x13f)](_0x3bdc8c[_0x43f5a9(0x140,0xed,0xce,0xaf)])[_0x43f5a9(0x1bc,0x167,0x17a,0x1c8)]();}),_0x2c0d85[_0x1da2a1(-0x133,-0x100,-0x9c,-0x132)](_0x1da2a1(-0x113,-0xa9,-0xf7,-0xce)+'t_novelai')['on'](_0x23ddd1(0x144,0x19c,0x122,0x12f),handleNovelaiImageUpload),_0x2c0d85['find'](_0x1da2a1(-0x15a,-0x120,-0x16a,-0xcb)+_0x1da2a1(-0x125,-0xda,-0x7d,-0x12b)+_0x1da2a1(-0xf0,-0xa7,-0x96,-0x71))['on'](_0x3bdc8c[_0x1da2a1(-0x107,-0xb3,-0x9a,-0x42)],()=>{function _0xf93c31(_0x79bfe0,_0x2a3a71,_0x55d821,_0x119519){return _0x1da2a1(_0x79bfe0-0x6,_0x79bfe0-0x31,_0x55d821-0x44,_0x2a3a71);}_0x3bdc8c[_0xf93c31(-0x64,-0x65,-0x99,-0x6f)](removeNovelaiImage);}),_0x2c0d85[_0x1da2a1(-0x158,-0x100,-0xf5,-0x15c)](_0x23ddd1(0x17f,0x1b0,0x12e,0x16a)+_0x1da2a1(-0xbf,-0x128,-0x184,-0xeb)+_0x1da2a1(-0x13d,-0x169,-0x19a,-0x1cc)+_0x23ddd1(0x1b7,0x176,0x169,0x173))['on'](_0x3bdc8c[_0x1da2a1(-0xf0,-0xb3,-0x55,-0x124)],()=>{function _0x241d37(_0x17114d,_0x145e4d,_0x131831,_0x26c710){return _0x1da2a1(_0x17114d-0x149,_0x131831- -0x1a,_0x131831-0x118,_0x145e4d);}function _0x52dc0b(_0x17c755,_0x2ceb21,_0x174e88,_0x45bcc3){return _0x1da2a1(_0x17c755-0xd,_0x174e88-0x3e0,_0x174e88-0x9e,_0x17c755);}document[_0x241d37(-0x113,-0xa0,-0xe7,-0x15a)+'ById'](_0x3bdc8c[_0x52dc0b(0x2c6,0x35e,0x2fe,0x339)])[_0x241d37(-0x143,-0x16a,-0x106,-0xcb)]();}),_0x2c0d85[_0x1da2a1(-0xed,-0x100,-0x9e,-0x170)](_0x3bdc8c[_0x23ddd1(0x118,0x185,0x109,0x151)])['on'](_0x3bdc8c[_0x23ddd1(0x10f,0xcf,0x117,0xf7)],handleNovelaiCharRefImageUpload),_0x2c0d85[_0x23ddd1(0xec,0xea,0x13e,0x13c)](_0x3bdc8c[_0x1da2a1(-0xd6,-0x11b,-0x157,-0x142)])['on']('click',()=>{removeNovelaiCharRefImage();}),_0x2c0d85['find'](_0x3bdc8c[_0x1da2a1(-0xc1,-0x8f,-0x67,-0x6a)])['on'](_0x3bdc8c[_0x23ddd1(0x17c,0x15d,0x194,0x189)],()=>{function _0x53fb14(_0x1bfb73,_0x4b903f,_0x19279a,_0x1f9672){return _0x1da2a1(_0x1bfb73-0x121,_0x1f9672-0x523,_0x19279a-0x1a3,_0x19279a);}function _0x39b350(_0x4eeedb,_0x75473f,_0x51740e,_0x48302f){return _0x1da2a1(_0x4eeedb-0x5e,_0x75473f-0x149,_0x51740e-0x88,_0x48302f);}document[_0x53fb14(0x425,0x407,0x419,0x456)+_0x53fb14(0x3b2,0x40c,0x36d,0x3ce)](_0x3bdc8c[_0x53fb14(0x3f8,0x3c1,0x411,0x3df)])[_0x53fb14(0x4a5,0x3ec,0x469,0x437)]();}),_0x2c0d85[_0x1da2a1(-0x173,-0x100,-0x160,-0xff)](_0x3bdc8c[_0x23ddd1(0x109,0xfc,0x112,0x143)])['on'](_0x3bdc8c[_0x1da2a1(-0xff,-0x145,-0x1a2,-0x16f)],handleImageUpload2);function _0x1da2a1(_0x972fc4,_0x402c5a,_0xed35e3,_0xddc796){return _0x502deb(_0x402c5a- -0x1bc,_0xddc796,_0xed35e3-0xfe,_0xddc796-0xaf);}_0x2c0d85['find'](_0x3bdc8c[_0x1da2a1(-0x10a,-0x13f,-0x13a,-0x1ab)])['on'](_0x23ddd1(0x12a,0x135,0x1b3,0x150),()=>{function _0x34241a(_0x7c84e5,_0x1602b3,_0x36217a,_0x2e865b){return _0x1da2a1(_0x7c84e5-0x3f,_0x7c84e5-0x6d0,_0x36217a-0x1c,_0x36217a);}_0x3bdc8c[_0x34241a(0x5ec,0x596,0x65e,0x651)](removeComfyUIImage);});}export{updateNovelaiImagePreview,updateNovelaiCharRefImagePreview,updateComfyUIImagePreview,nai3VibeTransferImageMimeType,nai3CharRefImageMimeType,comfyuiImageObjectURL};