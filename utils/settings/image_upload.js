(function(_0x4403e5,_0x201aaf){function _0xc54538(_0x38d0a4,_0xb47c8c,_0x28a505,_0x1ede81){return _0x1c45(_0x1ede81-0x16a,_0x38d0a4);}const _0x2130a4=_0x4403e5();function _0x449664(_0x5b3646,_0x1b35ae,_0x9092dd,_0x16c966){return _0x1c45(_0x9092dd- -0x43,_0x5b3646);}while(!![]){try{const _0x54995a=-parseInt(_0xc54538(0x46a,0x430,0x3d7,0x414))/(0x377*-0x4+-0xc7a*-0x1+-0x47*-0x5)*(parseInt(_0x449664(0x1e4,0x26e,0x21d,0x1f1))/(-0x1*0x162a+0x1134+0x4f8))+parseInt(_0xc54538(0x3e6,0x379,0x3d7,0x3b6))/(-0x12a*0xa+-0x1ec3+-0x1*-0x2a6a)*(-parseInt(_0x449664(0x15a,0x17a,0x1c5,0x1ad))/(0xb02+0x461+-0xf5f))+-parseInt(_0xc54538(0x407,0x42a,0x375,0x3de))/(-0x592+0x4*0x4f4+-0xe39*0x1)+parseInt(_0xc54538(0x388,0x3ef,0x33a,0x382))/(-0x8*0x357+0x3*-0x1bb+0x1fef)*(parseInt(_0xc54538(0x3c4,0x3b1,0x45a,0x427))/(-0x3c1+-0x1970*0x1+-0x5*-0x5d8))+-parseInt(_0x449664(0x2dc,0x288,0x283,0x287))/(0x905*-0x2+-0x1bc8+-0x2dda*-0x1)+-parseInt(_0xc54538(0x363,0x3da,0x3b3,0x3bf))/(0x159b+-0xde7*0x1+-0x97*0xd)*(-parseInt(_0x449664(0x24f,0x20e,0x222,0x294))/(0x2*0x5fb+0x587+-0x1173))+parseInt(_0x449664(0x1cb,0x27e,0x21e,0x1f3))/(-0x9f3*0x1+-0x2671+0x306f);if(_0x54995a===_0x201aaf)break;else _0x2130a4['push'](_0x2130a4['shift']());}catch(_0x9ae7a9){_0x2130a4['push'](_0x2130a4['shift']());}}}(_0x3b86,0x1*0x3e2df+-0x3420+0x2ee70*0x3));const _0x36f6b6=(function(){let _0x3850e1=!![];return function(_0x541ea6,_0x4e66de){const _0x1749ff=_0x3850e1?function(){function _0x5f0c72(_0x573501,_0x5193cd,_0x3063f3,_0x45b279){return _0x1c45(_0x45b279- -0x33f,_0x3063f3);}if(_0x4e66de){const _0x58b300=_0x4e66de[_0x5f0c72(-0xf2,-0x124,-0xbf,-0x134)](_0x541ea6,arguments);return _0x4e66de=null,_0x58b300;}}:function(){};return _0x3850e1=![],_0x1749ff;};}()),_0x222baa=_0x36f6b6(this,function(){function _0x4f523f(_0x54e4db,_0x188051,_0x26195a,_0x650b28){return _0x1c45(_0x650b28- -0x3dd,_0x54e4db);}const _0x426836={};_0x426836[_0x4f523f(-0x1a7,-0x201,-0x15b,-0x1b6)]=_0x4f523f(-0x1e4,-0x1b3,-0x11a,-0x17f)+'+$';const _0x2bc01b=_0x426836;function _0xc490b8(_0x57b824,_0xd6d98b,_0x33723e,_0x10b5dd){return _0x1c45(_0x10b5dd- -0x14f,_0xd6d98b);}return _0x222baa[_0x4f523f(-0x1e8,-0x23b,-0x21f,-0x1fa)]()[_0xc490b8(0xfe,0xe7,0x62,0x9e)](_0x2bc01b[_0x4f523f(-0x1e6,-0x162,-0x156,-0x1b6)])['toString']()[_0xc490b8(0xb1,0x12c,0x80,0xf5)+'r'](_0x222baa)['search'](_0x2bc01b[_0x4f523f(-0x1ba,-0x190,-0x192,-0x1b6)]);});_0x222baa();function _0x3b86(){const _0x4502de=['ie5VDMvSquKGqW','rhfzDeK','kcGOlISPkYKRkq','DNvnqK4','mMzoB1fwBG','mZm5mZmWmJbjvLvlwNe','B25SB2fKzw5K','q2Pcthe','D2L5teG','mtaZmJa2mZbPyxrNCKm','CML0zq','5zU+54Mh5Ase55cg5OIw5lIk5lYG5PE25yE66zsz','zMjby0O','uM9esgO','DhjPBq','BMfTzq','CxvLCNLtzwXLyW','AgXwEw8','Den3uNm','C3rYAw5N','sufKrMe','C3bSAxq','vxrAA0u','i25VDMvSywKTyW','nJiYmJq1mezbr2LtsG','rxrvAMq','BgfPx3zPyMvFDa','tgzZwgO','quDdvum','u2nrrvm','uurZDfi','zhv1u2W','5lUo57Yt5A2y5yQG6l29q29TzNK','y3rvuKW','t1zYBfu','ignHy2HLihrVia','wNDlzhq','Aw1Hz2vjBNb1Da','yM9KEq','Bwv0Ag9K','q2TJsMy','AejVsxu','zw1VDMuTAw1HzW','uNjQCwy','zMXLEa','6k+M5OofoIa','t1L6sw8','z1D6Efa','EwzAt08','AgfYifjLzIbPBq','zuzOv1i','zxCTy29UDgfPBG','Bg9N','z2v0rwXLBwvUDa','Aw5SAw5LlwzSzq','BwfNzs1WCMv2Aq','D3PjDKO','mxWYFdn8mhW0','zNLvssbPBwfNzq','sw95A2C','zw16t1K','zwXLy3qTAw1HzW','vgjiqui','CenXwNi','z2uY','z2vFBM92zwXHAq','Bw92zs1PBwfNzq','zfLqwNG','zwXbssbPBwfNzq','qLDruve','DwDKExC','tLLHwva','qKLmDKC','rNfiqLu','CMvMigLTywDLoG','yMzJufu','C2vYDMvYrMLSzq','BhHPBxa','mJG5mti5rfzgC3HU','u3PcrwC','Aw1Hz2u','CMviEgm','i2nVBwz5DwKTCG','5zUE5PwW5O2UoG','5zMO6l+u5zUE5PwW5O2UoIa','CMzqDhq','igzYB20GB2XKia','ywDL','v1ziEwu','AwjLigLTywDLoG','y29TzNL1AwnHBG','i2nVBwz5DwKTCW','Dhu4lwLTywDLlq','swjNvNq','i25VDMvSywKTCG','mxWWFdr8m3WY','vuNLM77NIyC6ia','odyXzeXRzKPm','rvrOvw8','i25VDMvSywKTAq','5zU+54Mh5lIk5lYG5AsX6lsLlcdPLjNOR68','yxbWzw5K','yMXVy2S','mxWZFdb8mNW0','zgrtyKS','DhnUtwS','odKZmJG0merfwgnoDa','5zU+54Mh5Ase55cg5AsX6lsLoIa','rLzLCu8','r1HgtuO','Df9UywLFy2HHCG','zgLZCgXHEq','ztOG','ihjLlxvWBg9Hza','qNLjza','Dg9tDhjPBMC','DufZuKm','B3H0BuS','ywDLlxbYzxzPzq','C3r5Bgu','D3j5rMC','CL9Yzwy','C3rVCMvszwfKvW','Ewvxswy','tg9HzgvKienVBq','C2vHCMnO','ywDLoG','zMLSzxm','ue9tva','EMXUAhi','vvjm','y29TzNL1As1Yzq','Du1Osu4','ywrnt20','y2XPy2S','y29TzNL1AvvYBa','q0rQD3G','DgHLig5LDYbMBW','vezSBK4','nxWWFdr8mxWYFa','CxbtufC','AgfXAhq','l3vWBg9Hzc9PBq','DhrlC2m','DtGTAw1Hz2uTCa','6zsz6k+V6k+M5OofoG','zgf0yq','y2fJAguGzM9YBq','Dg9Y','yMXJu0S','y2fJAgvFBM92zq','A2fVDhvWAwfU','mJm5nLrZB2rTvW','B0vvr2K','rLDXsu8','yxbWBhK','CMvHzefZrgf0yq','C3jJ','zxjYB3i','zKLTywDL','Bw92zs1JAgfYlq','zxiGlNn0lwnOyq','zMLUza','zs1IDg4','zNrIwhC','yxfwAfC','BM92zwXHAs1Yzq','q1vkrLq','mtuWmdzpEePzrwi','AgfYlxjLzI1PBq','BgfPx2nOyxjFCG','r1Lzs24','rxjYB3iGChjVyW','q1L2vgS','y3jLyxrLt2jQzq','C3rVCMvezwXLDa','BMfPm1zPyMvuCG','Aw1Hz2uVCg5N','ie5VDMvSquKGvG','Dgv4Da','C3rVCMvszwfKtW','5lIk5lYG5OIq5yQFlcdMNi3LIQhLMAJOV5q','BM9Uzq','sgTkrLy','CM1HDc4','Df9UB3zLBgfP','rxjYB3iGBg9Hza','yw5ZzMvYsw1HzW','DgfYz2v0','u1DJuMO','tMfTzq','vM9Or24','CMfUC2zLCL9PBq','CwLhsvO','BMfPm0nOyxjszq','yNbqzKe','D3j3uMy','vuXks3y','C3rHCNrZv2L0Aa','zxnZAw5Nie5VDG','rKnTzvu','C3rYAw5NAwz5','5zU+54Mh5lIk5lYG5OIq5yQFlcdMNi3LIQe','uLjLA04','y2HHBMDL','tKjsDha','Aw5NignHy2HLza','CMv2B2TLt2jQzq','y2fJAgvFy29TzG','yxqUifbSzwfZzq','i2LTywDLsw5WDq','uKPtD0q','y29UC3rYDwn0BW','lxjLzI1PBwfNzq','zwXbssbJAgfYia','z29XAxi','zgf0ytPPBwfNzq','r0jkC0K','i25VDMvSywKTCW','CMvZDwX0','ndC5mw9tterWrW','yMXVyG','BwfNztO','BMX5','6k+35ywi6k6+572Uq29TzNLv','zuXevxe','wg1YsgS','ugPMAe8','yMT2Dwi','ounyzKfksq','DMjszMy','BwvZC2fNzq','lwj0BG','BgfJzwHVBgrLCG','zMjIv04','yNbSwhm'];_0x3b86=function(){return _0x4502de;};return _0x3b86();}import{extension_settings}from'../../../../../extensions.js';import{saveSettingsDebounced}from'../../../../../../script.js';import{extensionName}from'../config.js';import{processUploadedImage,processUploadedImageToBlob,addLog}from'../utils.js';import{dbs}from'../database.js';const NAI_VIBE_CACHE_KEY='cache_nove'+_0x271a33(0x19c,0x129,0x161,0x159)+_0x271a33(0x156,0x143,0xee,0x187)+_0x271a33(0x1d9,0x199,0x180,0x1f3),NAI_CHAR_REF_CACHE_KEY=_0x271a33(0x12c,0xb8,0xf8,0xe8)+_0x13510d(0x535,0x4d1,0x52f,0x49a)+'ef_image',COMFYUI_REF_CACHE_KEY=_0x271a33(0x166,0x1bd,0x18d,0x10c)+'yui_ref_im'+_0x271a33(0x1d9,0x1ac,0x179,0x1af);let nai3VibeTransferImageMimeType=_0x13510d(0x530,0x4d8,0x512,0x4a4),nai3CharRefImageMimeType=_0x271a33(0x147,0xd7,0x10c,0x17e),comfyuiImageObjectURL=null;function updateNovelaiImagePreview(_0x1f20c5){function _0x2786a8(_0x38f455,_0x38cd34,_0x492670,_0x5b8f16){return _0x271a33(_0x492670-0x1d4,_0x38cd34-0xdb,_0x5b8f16,_0x5b8f16-0x17d);}const _0x89c1e5={};function _0xe13c9c(_0x318c87,_0x1bea27,_0x4c8d4a,_0x2cbf4d){return _0x13510d(_0x1bea27,_0x4c8d4a- -0x117,_0x4c8d4a-0x13e,_0x2cbf4d-0x7f);}_0x89c1e5[_0xe13c9c(0x489,0x471,0x420,0x426)]='previewIma'+_0xe13c9c(0x489,0x411,0x43d,0x47d),_0x89c1e5[_0xe13c9c(0x3f4,0x33d,0x3a9,0x3f5)]=_0x2786a8(0x38d,0x3f3,0x3b9,0x3fc)+_0xe13c9c(0x483,0x437,0x433,0x48d)+'ew-contain'+_0xe13c9c(0x35c,0x3d5,0x3b1,0x3fd)+_0x2786a8(0x424,0x389,0x3b2,0x38d)+'placeholde'+'r',_0x89c1e5['goqir']=_0xe13c9c(0x422,0x396,0x3e8,0x3de),_0x89c1e5[_0x2786a8(0x325,0x3c3,0x372,0x30f)]=_0xe13c9c(0x406,0x49c,0x462,0x4b1),_0x89c1e5[_0xe13c9c(0x3bd,0x3cc,0x3fa,0x42f)]=_0xe13c9c(0x3bc,0x35e,0x3c6,0x405),_0x89c1e5[_0x2786a8(0x35e,0x3c3,0x384,0x3bc)]=_0x2786a8(0x387,0x3df,0x38c,0x31a)+'x',_0x89c1e5[_0xe13c9c(0x39f,0x385,0x394,0x3db)]=_0x2786a8(0x412,0x3b6,0x3bd,0x3ef);const _0x2a9f05=_0x89c1e5,_0x20122c=document['getElement'+_0xe13c9c(0x3ba,0x3d6,0x382,0x36a)](_0x2a9f05[_0x2786a8(0x389,0x3ce,0x37a,0x3b6)]),_0x4931d7=document[_0xe13c9c(0x412,0x406,0x40c,0x3c0)+_0x2786a8(0x29b,0x2fd,0x2fe,0x2d7)](_0x2a9f05[_0x2786a8(0x2ee,0x2db,0x303,0x347)]),_0x5d6cbe=document['getElement'+_0xe13c9c(0x3d8,0x3a2,0x382,0x3c4)](_0xe13c9c(0x3d3,0x41b,0x3b6,0x3b6)+_0xe13c9c(0x43f,0x450,0x43e,0x3f2)+_0x2786a8(0x385,0x3bd,0x352,0x2ee));if(_0x1f20c5&&_0x1f20c5['startsWith'](_0x2a9f05[_0xe13c9c(0x448,0x3e6,0x3e7,0x3d8)])){_0x20122c[_0xe13c9c(0x337,0x423,0x3ad,0x35f)]=_0x1f20c5,_0x20122c[_0x2786a8(0x2db,0x30f,0x2e1,0x2a2)]['display']=_0x2a9f05[_0xe13c9c(0x3b4,0x489,0x418,0x3db)],_0x4931d7[_0x2786a8(0x2b5,0x2cb,0x2e1,0x272)][_0xe13c9c(0x339,0x3d8,0x37f,0x31a)]=_0x2a9f05[_0x2786a8(0x346,0x366,0x354,0x36a)],_0x5d6cbe[_0xe13c9c(0x355,0x3e8,0x387,0x398)]['display']=_0x2a9f05[_0x2786a8(0x369,0x368,0x384,0x3e1)];const _0x4d3407=_0x1f20c5[_0xe13c9c(0x456,0x47c,0x411,0x40f)](','),_0x5e624f=_0x4d3407[0x2b*-0x39+0x3*0xaf6+0x27*-0x99][_0xe13c9c(0x45e,0x3c1,0x411,0x42a)](':')[0x22cf+-0x116f+-0x115f][_0xe13c9c(0x41b,0x478,0x411,0x3cd)](';')[0x1588+0xb*0x379+-0x3bbb];nai3VibeTransferImageMimeType=_0x5e624f,window[_0xe13c9c(0x3ce,0x3dc,0x3c0,0x3f3)+_0x2786a8(0x365,0x2b6,0x325,0x398)+'e']=_0x4d3407[-0x775*0x3+-0x17*0x11a+0x2fb6];const _0x49aff2={};_0x49aff2['id']=NAI_VIBE_CACHE_KEY,_0x49aff2['data']=_0x1f20c5,dbs['storeReadW'+_0xe13c9c(0x464,0x443,0x406,0x3b1)](_0x49aff2);}else{const _0x4621da=_0x2a9f05[_0xe13c9c(0x393,0x32e,0x394,0x397)][_0x2786a8(0x324,0x301,0x36b,0x37e)]('|');let _0x1ed287=0x4d6*0x1+0xbfe+0x167*-0xc;while(!![]){switch(_0x4621da[_0x1ed287++]){case'0':_0x4931d7[_0x2786a8(0x2b1,0x2b9,0x2e1,0x338)][_0xe13c9c(0x330,0x310,0x37f,0x399)]='flex';continue;case'1':_0x20122c[_0xe13c9c(0x3dd,0x348,0x3ad,0x3e3)]='';continue;case'2':_0x5d6cbe['style'][_0x2786a8(0x316,0x2fd,0x2d9,0x30b)]=_0x2a9f05[_0xe13c9c(0x41b,0x44d,0x3fa,0x3db)];continue;case'3':_0x20122c['style'][_0x2786a8(0x2e9,0x316,0x2d9,0x2d5)]=_0x2a9f05[_0x2786a8(0x31f,0x2f0,0x354,0x3c7)];continue;case'4':window['nai3VibeTr'+_0xe13c9c(0x3e0,0x3f9,0x3cb,0x36f)+'e']=null;continue;}break;}}}function _0x271a33(_0x2e45b5,_0x589583,_0xee1ca,_0x26ddf7){return _0x1c45(_0x2e45b5- -0xda,_0xee1ca);}function removeNovelaiImage(){function _0x26c428(_0x348731,_0xe4d54,_0x28add4,_0x4563e0){return _0x13510d(_0x4563e0,_0x348731- -0x68e,_0x28add4-0x120,_0x4563e0-0x13e);}const _0x53de5c={'FWqIO':function(_0x12ba65,_0x5e07b3){return _0x12ba65(_0x5e07b3);}};function _0x3e855d(_0x1e90ba,_0x4bc6c0,_0x33dcb9,_0x4553e6){return _0x13510d(_0x4553e6,_0x33dcb9- -0x1db,_0x33dcb9-0x120,_0x4553e6-0x88);}_0x53de5c[_0x3e855d(0x2f3,0x281,0x2e6,0x284)](updateNovelaiImagePreview,null),dbs[_0x3e855d(0x2ad,0x2a9,0x2fb,0x32a)+'e'](NAI_VIBE_CACHE_KEY);}async function handleNovelaiImageUpload(_0xfd76f0){const _0x433620={'XmrHk':function(_0x185e2d,_0x123bbf,_0x383f9a){return _0x185e2d(_0x123bbf,_0x383f9a);},'qpSPW':function(_0x30a3d8,_0x14e88f){return _0x30a3d8===_0x14e88f;},'aALMb':'hxkwp','rfPtt':_0x43164d(0x2b4,0x30f,0x2e5,0x27c)+_0x43164d(0x2cf,0x2dc,0x261,0x28a)+_0x135f4a(0x47d,0x43c,0x4b0,0x510)+':','PjfhO':'图片处理失败:\x20'},_0x207d4e=_0xfd76f0['target'][_0x135f4a(0x3d5,0x390,0x3ff,0x395)][-0xad7+-0x1*0x2a1+-0x1af*-0x8];function _0x135f4a(_0x4f6c1d,_0x43bd09,_0x27e30e,_0x3dd8df){return _0x13510d(_0x4f6c1d,_0x27e30e- -0xa7,_0x27e30e-0xc4,_0x3dd8df-0x140);}function _0x43164d(_0x57afe0,_0x249225,_0x5e16dc,_0x5d83cd){return _0x271a33(_0x57afe0-0x172,_0x249225-0x8,_0x5e16dc,_0x5d83cd-0x11f);}if(!_0x207d4e)return;try{const _0x2b3581=await _0x433620[_0x135f4a(0x469,0x4a7,0x462,0x404)](processUploadedImage,_0x207d4e,!![]);updateNovelaiImagePreview(_0x2b3581);}catch(_0x474f81){if(_0x433620[_0x135f4a(0x409,0x3ea,0x40c,0x462)](_0x43164d(0x292,0x23c,0x2f9,0x225),_0x433620['aALMb'])){const _0x225bbb=_0x5646ed?function(){function _0x4bcfa5(_0x35fda6,_0xb35caf,_0x2cc077,_0x48419d){return _0x135f4a(_0x2cc077,_0xb35caf-0x51,_0x48419d-0x8f,_0x48419d-0x1c2);}if(_0x6240d2){const _0x46007a=_0x528b4c[_0x4bcfa5(0x4cc,0x51c,0x471,0x4aa)](_0x44e6f8,arguments);return _0x3b6619=null,_0x46007a;}}:function(){};return _0x38d1ec=![],_0x225bbb;}else console[_0x43164d(0x2a6,0x2cf,0x307,0x2dd)](_0x433620[_0x135f4a(0x4ee,0x490,0x4c1,0x49b)],_0x474f81),alert(_0x433620[_0x135f4a(0x3fe,0x406,0x463,0x4af)]+_0x474f81['message']);}}function updateNovelaiCharRefImagePreview(_0x35171b){const _0x531dac={};_0x531dac[_0x502033(0xfd,0x6d,0xa4,0xa3)]='previewIma'+'ge_nai_cha'+_0x502033(0x32,0x8e,0x33,0x71),_0x531dac[_0x502033(0xaa,0xa8,0xc4,0xc5)]=_0x4b8f11(0x1ed,0x1e8,0x20a,0x1bf)+_0x502033(0x75,0xe0,0x90,0xa1)+_0x502033(0x4b,0x93,0x7b,0x6e)+'w-containe'+'r\x20.st-chat'+_0x4b8f11(0x17a,0x112,0x1a5,0x1f0)+_0x4b8f11(0x1d3,0x1e4,0x1bb,0x1f8),_0x531dac[_0x4b8f11(0x214,0x1df,0x1b8,0x23f)]=_0x502033(0xfb,0x75,0x75,0x9e)+_0x4b8f11(0x18a,0x11a,0x1a1,0x128)+'ref-image-'+'btn',_0x531dac['dcuXU']='data:image',_0x531dac[_0x502033(0x84,0xc6,0x116,0xe7)]=_0x4b8f11(0x23c,0x210,0x270,0x1c8),_0x531dac[_0x502033(0xb2,0xb0,0xaa,0xc0)]=_0x502033(0xca,0xb6,0x80,0xae),_0x531dac[_0x4b8f11(0x1a9,0x194,0x176,0x141)]=_0x502033(0x184,0xee,0x184,0x11a)+'x',_0x531dac[_0x4b8f11(0x1de,0x1de,0x186,0x254)]=_0x4b8f11(0x235,0x226,0x274,0x1c3);function _0x502033(_0x4d47d3,_0x288761,_0x3e6519,_0x2b3d59){return _0x13510d(_0x3e6519,_0x2b3d59- -0x42f,_0x3e6519-0x1f4,_0x2b3d59-0x188);}const _0x157766=_0x531dac,_0x34dfaa=document[_0x4b8f11(0x20b,0x271,0x1b3,0x1b2)+_0x4b8f11(0x15c,0x186,0x15c,0x127)](_0x157766[_0x502033(0x116,0xf3,0x98,0xa3)]),_0x13ba02=document[_0x502033(0x95,0x9f,0xf9,0xf4)+_0x502033(0xb9,0xaa,0x98,0x8c)](_0x157766[_0x502033(0x70,0x64,0x11f,0xc5)]);function _0x4b8f11(_0xbe9f56,_0x3e28c8,_0x5ce61e,_0x5f323e){return _0x13510d(_0x3e28c8,_0xbe9f56- -0x33d,_0x5ce61e-0x4e,_0x5f323e-0x1a6);}const _0x2c3420=document[_0x4b8f11(0x20b,0x26b,0x256,0x197)+_0x4b8f11(0x15c,0xe8,0x145,0xf2)](_0x157766[_0x4b8f11(0x214,0x1a2,0x222,0x23c)]);if(_0x35171b&&_0x35171b[_0x4b8f11(0x1b0,0x20c,0x1ef,0x165)](_0x157766['dcuXU'])){_0x34dfaa[_0x502033(0x24,0xac,0xe9,0x95)]=_0x35171b,_0x34dfaa[_0x4b8f11(0x161,0x1b5,0x1c3,0x188)][_0x502033(0x43,0x73,0x1a,0x67)]=_0x157766[_0x502033(0x118,0x96,0x13d,0xe7)],_0x13ba02['style'][_0x4b8f11(0x159,0xff,0x103,0x19e)]=_0x157766[_0x502033(0x8f,0x77,0xbc,0xc0)],_0x2c3420[_0x4b8f11(0x161,0x187,0x18f,0x166)][_0x4b8f11(0x159,0x18d,0x17c,0x16b)]=_0x157766[_0x4b8f11(0x1a9,0x148,0x15b,0x1b3)];const _0x8f9c4f=_0x35171b['split'](','),_0x4e94ee=_0x8f9c4f[-0x23b9+0x11ee+0x5*0x38f]['split'](':')[0x1f72+0x2f*0x65+-0x31fc][_0x4b8f11(0x1eb,0x1d0,0x1b4,0x18a)](';')[0x8dd*-0x1+-0x8b*-0xd+0x1ce];nai3CharRefImageMimeType=_0x4e94ee,window[_0x4b8f11(0x1ac,0x138,0x1af,0x205)+'fImage']=_0x8f9c4f[-0x1e0+0x3*-0x3a7+0xcd6];const _0x11876a={};_0x11876a['id']=NAI_CHAR_REF_CACHE_KEY,_0x11876a[_0x4b8f11(0x17c,0x1b3,0x125,0x175)]=_0x35171b,dbs[_0x4b8f11(0x164,0xf3,0x1a6,0x1a7)+'rite'](_0x11876a);}else{const _0x4133bc=_0x157766[_0x502033(0x102,0x9f,0xde,0xec)][_0x502033(0x10d,0xd3,0x143,0xf9)]('|');let _0x27e63f=0x50*0x19+-0x22eb+0x1b1b*0x1;while(!![]){switch(_0x4133bc[_0x27e63f++]){case'0':_0x34dfaa[_0x4b8f11(0x161,0x179,0x13b,0x150)][_0x502033(0x5a,0xac,0xd9,0x67)]=_0x157766[_0x502033(0x7e,0x126,0xf3,0xc0)];continue;case'1':_0x34dfaa[_0x4b8f11(0x187,0x16f,0x196,0x1be)]='';continue;case'2':window[_0x502033(0x9e,0xaf,0x11f,0xba)+_0x4b8f11(0x189,0x1ff,0x1ff,0x189)]=null;continue;case'3':_0x2c3420[_0x502033(0x57,0x0,0x1c,0x6f)][_0x502033(0x4f,0x45,0xe,0x67)]=_0x157766[_0x4b8f11(0x1b2,0x1a6,0x202,0x1f7)];continue;case'4':_0x13ba02['style'][_0x502033(-0x8,0x7,0xa5,0x67)]='flex';continue;}break;}}}function _0x1c45(_0x7fb85,_0x384232){_0x7fb85=_0x7fb85-(0xb63+-0x268d+0x1*0x1d09);const _0x4058e3=_0x3b86();let _0xa3b1a1=_0x4058e3[_0x7fb85];if(_0x1c45['NpLWZk']===undefined){var _0x51cee1=function(_0x2f3352){const _0x3707c5='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x3cda19='',_0x1f16bd='',_0x3a7afc=_0x3cda19+_0x51cee1;for(let _0x5d00f2=0x1*-0xfe9+-0xdcd+-0xedb*-0x2,_0x50a106,_0x218a02,_0x549b4e=-0x4a*-0x1d+-0x2*0x11ff+-0x934*-0x3;_0x218a02=_0x2f3352['charAt'](_0x549b4e++);~_0x218a02&&(_0x50a106=_0x5d00f2%(0x4*-0x2fa+-0x18d8+-0x931*-0x4)?_0x50a106*(0x7*0x403+0x1c8f+-0x6*0x966)+_0x218a02:_0x218a02,_0x5d00f2++%(0x65*-0x49+-0x1921+0x35f2))?_0x3cda19+=_0x3a7afc['charCodeAt'](_0x549b4e+(0xe*0x12b+0x22f4+0x22*-0x182))-(0x1747+0x45c+-0x311*0x9)!==0x9*0x3b9+-0x27c+-0x1f05?String['fromCharCode'](0x73f+0x39a*-0x9+0x1a2a&_0x50a106>>(-(0xcd+0xf29*0x1+-0x7fa*0x2)*_0x5d00f2&0x1a09+-0x2397+-0x994*-0x1)):_0x5d00f2:-0x1*-0x8b3+0x1918+-0x21cb){_0x218a02=_0x3707c5['indexOf'](_0x218a02);}for(let _0x2065af=0xa59+0x12dc+-0x1d35,_0x55bc7e=_0x3cda19['length'];_0x2065af<_0x55bc7e;_0x2065af++){_0x1f16bd+='%'+('00'+_0x3cda19['charCodeAt'](_0x2065af)['toString'](-0x1f3*-0xd+0x23d+-0x1b84))['slice'](-(0x2332+-0x2*0x3be+0x1*-0x1bb4));}return decodeURIComponent(_0x1f16bd);};_0x1c45['DvFUaj']=_0x51cee1,_0x1c45['NKtlfl']={},_0x1c45['NpLWZk']=!![];}const _0x35fc79=_0x4058e3[0x1519+-0x15e7+0xce],_0x4d52ba=_0x7fb85+_0x35fc79,_0x266ee1=_0x1c45['NKtlfl'][_0x4d52ba];if(!_0x266ee1){const _0x2fde89=function(_0x47dfd8){this['hCOnyz']=_0x47dfd8,this['RNBeng']=[0x14*-0x1c+-0x3cb*0x1+0x4*0x17f,0xc88+0x931+-0x15b9,0x1251+0x1*0x23c1+-0x3612],this['WcObCa']=function(){return'newState';},this['aNpYGq']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['acwmyz']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x2fde89['prototype']['nsWiop']=function(){const _0x490324=new RegExp(this['aNpYGq']+this['acwmyz']),_0xed30aa=_0x490324['test'](this['WcObCa']['toString']())?--this['RNBeng'][-0x2012+0xb*-0x65+0x246a]:--this['RNBeng'][0x5*0x6aa+-0x242e+0x2dc];return this['bxwrTK'](_0xed30aa);},_0x2fde89['prototype']['bxwrTK']=function(_0x23746d){if(!Boolean(~_0x23746d))return _0x23746d;return this['fpqhMY'](this['hCOnyz']);},_0x2fde89['prototype']['fpqhMY']=function(_0x1b31a9){for(let _0x242338=-0x1*-0xf3f+-0xd74+-0x1cb,_0x3ca4b8=this['RNBeng']['length'];_0x242338<_0x3ca4b8;_0x242338++){this['RNBeng']['push'](Math['round'](Math['random']())),_0x3ca4b8=this['RNBeng']['length'];}return _0x1b31a9(this['RNBeng'][-0x872+0x1f24+-0x1*0x16b2]);},new _0x2fde89(_0x1c45)['nsWiop'](),_0xa3b1a1=_0x1c45['DvFUaj'](_0xa3b1a1),_0x1c45['NKtlfl'][_0x4d52ba]=_0xa3b1a1;}else _0xa3b1a1=_0x266ee1;return _0xa3b1a1;}function removeNovelaiCharRefImage(){const _0x3b001a={'hlVyo':function(_0x424fe4,_0x5f4cb6){return _0x424fe4(_0x5f4cb6);}};function _0x31197d(_0x115255,_0x1d61e3,_0x413b91,_0x27b15a){return _0x271a33(_0x413b91-0x13b,_0x1d61e3-0x1ba,_0x115255,_0x27b15a-0x3e);}function _0x556976(_0x349afe,_0x1fd087,_0x23e789,_0x22f6a1){return _0x13510d(_0x349afe,_0x23e789- -0x63,_0x23e789-0x1f0,_0x22f6a1-0x132);}_0x3b001a[_0x31197d(0x33e,0x2fc,0x2ce,0x2c3)](updateNovelaiCharRefImagePreview,null),dbs[_0x556976(0x419,0x40d,0x473,0x46e)+'e'](NAI_CHAR_REF_CACHE_KEY);}async function handleNovelaiCharRefImageUpload(_0x1ac3a7){const _0x151372={'CUJFT':function(_0x5aa542,_0x4ed7d9){return _0x5aa542(_0x4ed7d9);},'QDstR':function(_0x1d200b,_0x531903){return _0x1d200b===_0x531903;},'NHcgd':_0x1a56ec(-0x96,-0xa4,0x25,-0x44),'ScQES':_0x5290c6(0x41e,0x455,0x411,0x46c)+'essing\x20Nov'+'elAI\x20char\x20'+_0x5290c6(0x4a8,0x49d,0x4db,0x478),'imvTt':function(_0x17ed35,_0x2c4006){return _0x17ed35+_0x2c4006;},'BILvG':_0x1a56ec(-0xb8,-0x3c,-0x85,-0x46)};function _0x5290c6(_0x36a32f,_0x22ad17,_0x4939c1,_0x439507){return _0x271a33(_0x36a32f-0x2dc,_0x22ad17-0x167,_0x439507,_0x439507-0x15);}const _0x18ab95=_0x1ac3a7[_0x5290c6(0x42e,0x46d,0x44a,0x44d)][_0x1a56ec(-0x105,-0x152,-0xc3,-0x11e)][0x1*-0x21dd+-0x28b+0x2468];if(!_0x18ab95)return;function _0x1a56ec(_0x12e119,_0x3c032b,_0x26495,_0x59de97){return _0x13510d(_0x3c032b,_0x59de97- -0x5c4,_0x26495-0x41,_0x59de97-0xa7);}try{const _0x15161a=await _0x151372[_0x1a56ec(-0x15c,-0x105,-0x104,-0xf6)](processUploadedImage,_0x18ab95);_0x151372['CUJFT'](updateNovelaiCharRefImagePreview,_0x15161a);}catch(_0xa5ef93){_0x151372[_0x5290c6(0x47c,0x43d,0x458,0x495)](_0x151372['NHcgd'],_0x1a56ec(-0x70,0x15,-0x90,-0x44))?(console[_0x1a56ec(-0xff,-0xc4,-0xfa,-0xff)](_0x151372[_0x5290c6(0x47b,0x4ca,0x445,0x473)],_0xa5ef93),_0x151372[_0x5290c6(0x419,0x3a4,0x3d5,0x445)](alert,_0x151372['imvTt'](_0x151372[_0x1a56ec(0xd,-0xaf,-0x24,-0x69)],_0xa5ef93[_0x5290c6(0x459,0x411,0x49c,0x484)]))):_0x177f52[_0x1a56ec(-0x13e,-0x128,-0x12f,-0xce)+_0x5290c6(0x47f,0x41f,0x4f0,0x41d)](_0x50b201[_0x1a56ec(-0x104,-0x115,-0xee,-0x100)]);}}function updateComfyUIImagePreview(_0x43dacf){const _0x796c58={};_0x796c58[_0x426057(0x2da,0x2d7,0x2f4,0x2be)]=_0x4dea78(0x4d0,0x4aa,0x464,0x458)+'essing\x20Nov'+_0x426057(0x2e8,0x29f,0x2e7,0x349)+':',_0x796c58[_0x4dea78(0x504,0x4eb,0x4ea,0x4e3)]=_0x426057(0x29d,0x2c3,0x30e,0x2af),_0x796c58[_0x426057(0x2e3,0x265,0x2d5,0x344)]='previewIma'+_0x426057(0x2eb,0x31a,0x2e3,0x290),_0x796c58[_0x4dea78(0x4d2,0x569,0x50c,0x579)]='#comfyui-i'+_0x4dea78(0x4a6,0x4f2,0x4db,0x535)+_0x426057(0x346,0x27c,0x2d6,0x2b5)+_0x426057(0x295,0x20c,0x258,0x2b5)+'tu8-image-'+'placeholde'+'r',_0x796c58[_0x426057(0x2e5,0x2c0,0x2de,0x303)]='blob:',_0x796c58[_0x426057(0x2ca,0x2eb,0x2f2,0x2b0)]=function(_0xedd4d6,_0x713fa5){return _0xedd4d6!==_0x713fa5;},_0x796c58[_0x4dea78(0x55f,0x4c8,0x4e9,0x4e8)]=_0x4dea78(0x532,0x4f3,0x4e3,0x474),_0x796c58[_0x4dea78(0x485,0x502,0x4f1,0x4e5)]='block',_0x796c58['bfcPU']='none',_0x796c58[_0x4dea78(0x4d2,0x455,0x45c,0x426)]=_0x426057(0x234,0x22c,0x242,0x26a)+'3';function _0x4dea78(_0x4307a7,_0xec33b,_0x3d52bd,_0x258c0b){return _0x13510d(_0x258c0b,_0x3d52bd- -0x6f,_0x3d52bd-0x1e8,_0x258c0b-0x5c);}_0x796c58[_0x426057(0x23b,0x221,0x22f,0x28c)]=_0x426057(0x335,0x2b2,0x2cf,0x2ea);const _0x3cbe52=_0x796c58,_0x2c06fa=document[_0x426057(0x32f,0x2b2,0x2d8,0x2f8)+'ById'](_0x3cbe52['eFhWR']),_0x5e9fef=document[_0x426057(0x2c6,0x249,0x2b3,0x276)+_0x4dea78(0x445,0x4bc,0x44c,0x3f3)](_0x3cbe52['ddSbK']);function _0x426057(_0x3cfb99,_0x57f86a,_0x3bb551,_0x24e417){return _0x271a33(_0x3bb551-0x121,_0x57f86a-0x178,_0x3cfb99,_0x24e417-0x137);}const _0x2f1888=document[_0x426057(0x2b7,0x283,0x2d8,0x277)+'ById'](_0x4dea78(0x3c6,0x3f4,0x43b,0x453)+_0x4dea78(0x4f9,0x4c8,0x4e6,0x4da)+_0x426057(0x262,0x2f3,0x29f,0x2fb));_0x2c06fa['src']&&_0x2c06fa['src'][_0x426057(0x2ce,0x2dd,0x27d,0x2c4)](_0x3cbe52[_0x4dea78(0x4db,0x4aa,0x4df,0x53f)])&&_0x3cbe52[_0x4dea78(0x4d9,0x49e,0x4f3,0x541)](_0x2c06fa[_0x4dea78(0x401,0x41a,0x455,0x4ab)],_0x43dacf)&&URL['revokeObje'+_0x426057(0x310,0x25c,0x2c4,0x2b2)](_0x2c06fa[_0x426057(0x239,0x254,0x254,0x297)]);if(_0x43dacf)_0x3cbe52['BWQQQ']!==_0x3cbe52[_0x4dea78(0x503,0x51d,0x4e9,0x491)]?(_0x1f44a1[_0x426057(0x212,0x1f1,0x255,0x28a)](_0x3cbe52['reHxc'],_0x5e72cc),_0x2e4fc9(_0x3cbe52[_0x426057(0x322,0x291,0x2e9,0x2fc)]+_0x221516[_0x426057(0x2f8,0x25a,0x29e,0x306)])):(_0x2c06fa[_0x4dea78(0x44a,0x3ef,0x455,0x43f)]=_0x43dacf,_0x2c06fa[_0x426057(0x26c,0x1f0,0x22e,0x294)]['display']=_0x3cbe52[_0x4dea78(0x4f2,0x528,0x4f1,0x553)],_0x5e9fef[_0x426057(0x1fc,0x2a3,0x22e,0x251)][_0x426057(0x1d7,0x276,0x226,0x243)]=_0x3cbe52[_0x426057(0x325,0x34e,0x2ee,0x279)],_0x2f1888['style'][_0x4dea78(0x47d,0x44d,0x427,0x47a)]=_0x4dea78(0x4ab,0x4bb,0x4da,0x518)+'x');else{const _0x1af824=_0x3cbe52[_0x426057(0x298,0x213,0x25b,0x2c1)]['split']('|');let _0x3a25c0=-0x1c82*-0x1+-0x1e9f+0x21d;while(!![]){switch(_0x1af824[_0x3a25c0++]){case'0':_0x2c06fa[_0x426057(0x1ea,0x296,0x22e,0x207)][_0x4dea78(0x3d7,0x416,0x427,0x49c)]=_0x3cbe52[_0x426057(0x2c7,0x27d,0x2ee,0x329)];continue;case'1':_0x2f1888[_0x426057(0x215,0x221,0x22e,0x264)][_0x426057(0x288,0x273,0x226,0x234)]='none';continue;case'2':window[_0x426057(0x34b,0x312,0x2fd,0x2b4)+_0x426057(0x210,0x1fd,0x24e,0x274)]=null;continue;case'3':comfyuiImageObjectURL=null;continue;case'4':_0x5e9fef[_0x426057(0x1ef,0x275,0x22e,0x1ba)][_0x4dea78(0x3fd,0x417,0x427,0x3d7)]=_0x3cbe52[_0x426057(0x280,0x259,0x22f,0x20f)];continue;case'5':_0x2c06fa[_0x426057(0x200,0x261,0x254,0x287)]='';continue;}break;}}}function removeComfyUIImage(){function _0x3eeadf(_0x5d4b0c,_0x2309e6,_0x26c60e,_0x45dbc1){return _0x271a33(_0x45dbc1-0x41d,_0x2309e6-0x3f,_0x26c60e,_0x45dbc1-0x10a);}function _0x16ee8e(_0x4e0dc9,_0x587db5,_0x2f7a5f,_0xf07e28){return _0x13510d(_0xf07e28,_0x2f7a5f-0x3a,_0x2f7a5f-0x193,_0xf07e28-0x15c);}const _0x1411f3={'eLDUq':function(_0x3719f1,_0x463529){return _0x3719f1(_0x463529);}};_0x1411f3[_0x3eeadf(0x5e5,0x51e,0x553,0x594)](updateComfyUIImagePreview,null),dbs[_0x16ee8e(0x56c,0x509,0x510,0x545)+'e'](COMFYUI_REF_CACHE_KEY);}function _0x13510d(_0x554216,_0x386047,_0x64c4b1,_0x3e3a3f){return _0x1c45(_0x386047-0x2b7,_0x554216);}async function handleImageUpload2(_0x37af6e){function _0xc7c8de(_0x5d0758,_0x2d0e6b,_0x31c989,_0x1efe44){return _0x13510d(_0x31c989,_0x5d0758- -0x66d,_0x31c989-0x16a,_0x1efe44-0x147);}function _0x222f37(_0x4a49c3,_0x2f4e41,_0x553a91,_0x131950){return _0x271a33(_0x2f4e41-0x30,_0x2f4e41-0x82,_0x4a49c3,_0x131950-0x18d);}const _0x19496d={'USJtL':function(_0x205f0b,_0x282156){return _0x205f0b(_0x282156);},'EtUjd':_0xc7c8de(-0x19a,-0x137,-0x1d8,-0x14c)+_0x222f37(0x130,0x18d,0x12b,0x141)+_0x222f37(0x16c,0x19c,0x145,0x175)+_0xc7c8de(-0x110,-0x143,-0x17b,-0x153),'wrwRf':function(_0x54da58,_0xace6bf){return _0x54da58+_0xace6bf;},'oxtmK':_0x222f37(0x24f,0x21d,0x1ac,0x266),'CkcJf':function(_0x135dde,_0x4597d3){return _0x135dde(_0x4597d3);},'yfZOO':_0x222f37(0x218,0x202,0x197,0x1d5),'WRXDI':function(_0x5ca5d2,_0x3363a9){return _0x5ca5d2(_0x3363a9);},'XMRsK':_0x222f37(0x172,0x1a6,0x20d,0x14a)+'I\x20API地址。','emzOY':function(_0x226b06){return _0x226b06();},'XSVBn':function(_0x4dd4ec,_0x489e1a,_0x2fa053){return _0x4dd4ec(_0x489e1a,_0x2fa053);},'bplXs':_0xc7c8de(-0x191,-0x1af,-0x17b,-0x1f6)+_0x222f37(0x250,0x205,0x1e4,0x1fe),'yeWIf':function(_0x43d5cb,_0x45b3b0){return _0x43d5cb===_0x45b3b0;},'OVrlU':_0x222f37(0x1dd,0x1c6,0x15f,0x219),'GBJsI':'上传失败:\x20','SWcRj':_0xc7c8de(-0x1b5,-0x1b6,-0x154,-0x212),'RoDHj':function(_0x347f58,_0x5eaaeb){return _0x347f58!==_0x5eaaeb;},'hBoIu':'XSZvi','haqht':'RkRQM','adMOm':_0x222f37(0x189,0x1bd,0x148,0x1d6)+':\x20','NzVKQ':_0xc7c8de(-0x14f,-0x169,-0x156,-0x135)+':','qiGIZ':function(_0x1d01b8,_0x57ec38){return _0x1d01b8(_0x57ec38);}},_0x4836eb=extension_settings[extensionName],_0x14e800=_0x37af6e['target'][_0xc7c8de(-0x1c7,-0x1ab,-0x17c,-0x19a)][-0x25eb+-0x7*-0x411+0x14*0x79];if(!_0x14e800)return;try{const _0x1ea0c4=await processUploadedImageToBlob(_0x14e800),_0x25fb19=URL[_0xc7c8de(-0x198,-0x1f2,-0x1bb,-0x1ff)+_0xc7c8de(-0x139,-0x162,-0x194,-0x1aa)](_0x1ea0c4);comfyuiImageObjectURL=_0x25fb19,_0x19496d[_0xc7c8de(-0x132,-0x1a7,-0x1a3,-0x13b)](updateComfyUIImagePreview,_0x25fb19);const _0x10cbdb=new FormData();_0x10cbdb[_0x222f37(0x1e4,0x217,0x20e,0x222)](_0x19496d[_0x222f37(0x1cd,0x1e2,0x182,0x256)],_0x1ea0c4,_0x14e800[_0xc7c8de(-0x14b,-0x16d,-0x138,-0x176)]);let _0x3105e6=_0x4836eb[_0x222f37(0x136,0x14d,0xfb,0x1b7)][_0xc7c8de(-0x14c,-0x115,-0x13d,-0xe5)]();if(!_0x3105e6){_0x19496d['WRXDI'](alert,_0x19496d['XMRsK']),_0x19496d[_0xc7c8de(-0x11e,-0x112,-0xe4,-0x11b)](removeComfyUIImage);return;}const _0x5bf65c={};_0x5bf65c[_0xc7c8de(-0x133,-0x15d,-0x185,-0x116)]=_0xc7c8de(-0x1c6,-0x1da,-0x223,-0x236),_0x5bf65c[_0xc7c8de(-0x134,-0x113,-0xf3,-0xfe)]=_0x10cbdb;const _0x341f5d=await _0x19496d['XSVBn'](fetch,_0x3105e6+(_0x222f37(0x127,0x154,0x13c,0x1c7)+'age'),_0x5bf65c);if(_0x341f5d['ok']){const _0x23ae0a=await _0x341f5d['json']();window[_0xc7c8de(-0x100,-0x173,-0xfe,-0x10e)+_0x222f37(0x1a7,0x15d,0xef,0x104)]=_0x23ae0a[_0x222f37(0x1c1,0x1c1,0x21d,0x1e3)],_0x19496d['CkcJf'](addLog,_0x222f37(0x1b5,0x190,0x12d,0x1f2)+_0xc7c8de(-0x106,-0xf1,-0x152,-0x121)+JSON[_0xc7c8de(-0x17d,-0x176,-0x144,-0x118)](_0x23ae0a)),console[_0x222f37(0x193,0x1e6,0x24e,0x1ff)](_0x19496d[_0x222f37(0x1eb,0x1b1,0x1bc,0x14b)],_0x23ae0a);const _0x4a1a35=new FileReader();_0x4a1a35[_0xc7c8de(-0x154,-0x136,-0x165,-0x118)]=()=>{const _0x3c434b=_0x4a1a35[_0x4e4329(0x564,0x590,0x538,0x4c8)],_0x564d60={};function _0x536767(_0x44d164,_0x13163c,_0x456405,_0x3f7826){return _0x222f37(_0x3f7826,_0x13163c- -0x305,_0x456405-0x1b0,_0x3f7826-0x9c);}_0x564d60['data']=_0x3c434b,_0x564d60[_0x536767(-0x9b,-0x107,-0xeb,-0xa3)+_0x4e4329(0x56f,0x56a,0x51b,0x4f8)]=_0x23ae0a[_0x4e4329(0x593,0x524,0x558,0x578)];const _0x200adc=_0x564d60,_0xfb613e={};_0xfb613e['id']=COMFYUI_REF_CACHE_KEY;function _0x4e4329(_0x5bb1ae,_0x292e51,_0x421bde,_0x23d016){return _0xc7c8de(_0x421bde-0x6a3,_0x292e51-0x1d7,_0x5bb1ae,_0x23d016-0x157);}_0xfb613e['data']=_0x200adc,dbs[_0x536767(-0x19f,-0x1c5,-0x22b,-0x1eb)+_0x4e4329(0x534,0x529,0x553,0x58a)](_0xfb613e);},_0x4a1a35[_0x222f37(0x1d0,0x162,0x119,0x147)+_0x222f37(0x18f,0x148,0x124,0x15a)](_0x1ea0c4);}else{if(_0x19496d[_0xc7c8de(-0x1cb,-0x225,-0x21a,-0x1c2)](_0x19496d[_0x222f37(0x237,0x1d4,0x17a,0x1ab)],'AJHpH'))_0x19496d['USJtL'](_0x5b2bdd,null),_0x409664[_0xc7c8de(-0x197,-0x127,-0x1ce,-0x20b)+'e'](_0x238a37);else{const _0x5cbb16=await _0x341f5d[_0xc7c8de(-0x193,-0x152,-0x19c,-0x17e)]();_0x19496d[_0xc7c8de(-0x132,-0x127,-0x116,-0x100)](alert,_0x19496d[_0xc7c8de(-0x182,-0x199,-0x173,-0x110)](_0x19496d[_0xc7c8de(-0x16d,-0x180,-0x163,-0x1df)],_0x5cbb16)),addLog('图片上传失败,\x20错误'+_0xc7c8de(-0x12d,-0x139,-0x16b,-0x154)+_0x5cbb16),console[_0xc7c8de(-0x1a8,-0x20f,-0x1ce,-0x1f8)](_0x19496d[_0xc7c8de(-0x189,-0x1bc,-0x153,-0x134)],_0x5cbb16),_0x19496d[_0x222f37(0x1b4,0x1ee,0x205,0x196)](removeComfyUIImage);}}}catch(_0x688a6){_0x19496d[_0xc7c8de(-0x14d,-0xed,-0x12d,-0x11a)](_0x19496d[_0xc7c8de(-0x131,-0x16a,-0x18a,-0x112)],_0x19496d[_0x222f37(0x10a,0x153,0x1c6,0x16b)])?(alert(_0x19496d['wrwRf'](_0x19496d[_0x222f37(0x189,0x14b,0x153,0x117)],_0x688a6[_0xc7c8de(-0x15f,-0x191,-0x183,-0x1a3)])),console[_0xc7c8de(-0x1a8,-0x204,-0x19e,-0x1e8)](_0x19496d['NzVKQ'],_0x688a6),_0x19496d[_0x222f37(0x1b1,0x187,0x12e,0x187)](addLog,_0x222f37(0x215,0x216,0x1bb,0x21d)+'详情:\x20'+JSON[_0xc7c8de(-0x17d,-0x148,-0x141,-0x1c0)](_0x688a6)),_0x19496d['emzOY'](removeComfyUIImage)):(_0x330667[_0xc7c8de(-0x1a8,-0x178,-0x1f4,-0x17e)](_0x19496d[_0x222f37(0x20e,0x1cb,0x209,0x23a)],_0x3057f7),_0x1b7997(_0x19496d[_0x222f37(0x181,0x18a,0x1e5,0x153)](_0x19496d[_0xc7c8de(-0x1d1,-0x15c,-0x226,-0x17b)],_0x1a50f9[_0xc7c8de(-0x15f,-0x11e,-0x17d,-0x126)])));}}async function loadCachedImages(){const _0x5b78cd={'CjBLq':_0x4a6c85(0x3e2,0x384,0x33e,0x377),'tsnMk':_0x4a6c85(0x37f,0x2e5,0x2d6,0x315),'iwblg':_0x8bf6ea(0x292,0x285,0x276,0x2c1)+_0x8bf6ea(0x2db,0x239,0x28a,0x299)+_0x8bf6ea(0x27e,0x270,0x26e,0x2d3)+_0x8bf6ea(0x347,0x2df,0x301,0x2d4),'RJSwD':'bFVNk','FqHBU':'Error\x20load'+_0x8bf6ea(0x2bf,0x2e9,0x28a,0x2d0)+_0x4a6c85(0x2d9,0x31e,0x3af,0x34b)+_0x8bf6ea(0x2b3,0x30f,0x2d9,0x2e7)+_0x4a6c85(0x2ec,0x28b,0x27f,0x2dd),'UtZkE':function(_0x509130,_0x1bbe4c){return _0x509130===_0x1bbe4c;},'CYvTk':_0x8bf6ea(0x2a5,0x2be,0x30a,0x376),'dYPZx':function(_0xf083b3,_0x5b4d9b){return _0xf083b3!==_0x5b4d9b;},'Rrjqf':function(_0x5eb969,_0x55e3eb){return _0x5eb969(_0x55e3eb);},'LfsXj':function(_0x18562f,_0x2a8596){return _0x18562f(_0x2a8596);},'aqVhW':function(_0x490353,_0x43adfc){return _0x490353(_0x43adfc);},'WVHye':_0x8bf6ea(0x309,0x29a,0x2bb,0x2fc),'wzIvJ':function(_0x2ec1c9,_0x42e8e9){return _0x2ec1c9(_0x42e8e9);},'neNal':'Loaded\x20Com'+_0x8bf6ea(0x271,0x2cc,0x2e2,0x344)+_0x8bf6ea(0x364,0x321,0x2fe,0x346)+_0x8bf6ea(0x205,0x1f6,0x24f,0x2b1)+_0x8bf6ea(0x2b7,0x290,0x28d,0x25c)+_0x4a6c85(0x334,0x2eb,0x301,0x2d0)+'\x20to\x20update'+_0x8bf6ea(0x29e,0x2a9,0x2cb,0x2c2)+_0x4a6c85(0x318,0x343,0x340,0x2e8)+_0x8bf6ea(0x2ea,0x246,0x274,0x254)};await dbs['openDB']();function _0x4a6c85(_0x3b29cd,_0x16d39f,_0x2b38a3,_0x589eb7){return _0x13510d(_0x2b38a3,_0x589eb7- -0x1c8,_0x2b38a3-0xb6,_0x589eb7-0x51);}function _0x8bf6ea(_0x13e2d3,_0x2a687f,_0x5368da,_0x21c81a){return _0x271a33(_0x5368da-0x126,_0x2a687f-0xb1,_0x13e2d3,_0x21c81a-0x39);}try{const _0x213c69=await dbs['storeReadO'+_0x8bf6ea(0x23b,0x22f,0x29b,0x2f0)](NAI_VIBE_CACHE_KEY);_0x213c69&&_0x213c69[_0x4a6c85(0x287,0x2be,0x33d,0x2f1)]&&updateNovelaiImagePreview(_0x213c69[_0x8bf6ea(0x1e0,0x24e,0x24e,0x278)]);}catch(_0x45284a){console[_0x4a6c85(0x2ec,0x2da,0x2a2,0x2fd)](_0x5b78cd['iwblg'],_0x45284a);}try{const _0x23f096=await dbs[_0x8bf6ea(0x268,0x297,0x270,0x214)+_0x8bf6ea(0x27d,0x22e,0x29b,0x311)](NAI_CHAR_REF_CACHE_KEY);_0x23f096&&_0x23f096[_0x8bf6ea(0x220,0x25c,0x24e,0x2bf)]&&updateNovelaiCharRefImagePreview(_0x23f096[_0x8bf6ea(0x1d8,0x27f,0x24e,0x2a2)]);}catch(_0xb73c79){_0x5b78cd[_0x4a6c85(0x2ea,0x2f1,0x2d7,0x332)]!==_0x5b78cd[_0x4a6c85(0x35d,0x2d7,0x316,0x332)]?(_0x5f152a['src']='',_0x237e82[_0x8bf6ea(0x258,0x20f,0x233,0x229)]['display']='none',_0x3aec9c['style']['display']=_0x5b78cd[_0x4a6c85(0x2f5,0x37a,0x32e,0x352)],_0x6f0c9c[_0x4a6c85(0x309,0x2e0,0x338,0x2d6)]['display']='none',_0x1b455d['comfyuican'+_0x8bf6ea(0x1e4,0x223,0x253,0x2c5)]=null,_0x41dccf=null):console[_0x8bf6ea(0x21b,0x1ec,0x25a,0x29d)](_0x5b78cd[_0x8bf6ea(0x2ad,0x2df,0x2f1,0x2d8)],_0xb73c79);}try{if(_0x5b78cd[_0x8bf6ea(0x29b,0x2cf,0x2be,0x26f)](_0x4a6c85(0x3f7,0x3e3,0x383,0x3ad),_0x5b78cd[_0x4a6c85(0x339,0x2b3,0x2bb,0x30c)])){const _0x19f215=await dbs[_0x8bf6ea(0x27b,0x256,0x270,0x225)+'nly'](COMFYUI_REF_CACHE_KEY);if(_0x19f215&&_0x19f215['data']&&_0x19f215[_0x8bf6ea(0x2a0,0x211,0x24e,0x20a)][_0x8bf6ea(0x28e,0x268,0x24e,0x205)]&&_0x19f215[_0x4a6c85(0x2f4,0x2c9,0x31b,0x2f1)][_0x4a6c85(0x3b8,0x3d5,0x3ea,0x397)+_0x4a6c85(0x314,0x324,0x2a7,0x31d)]){if(_0x5b78cd[_0x4a6c85(0x38a,0x39c,0x39c,0x38e)](_0x4a6c85(0x27a,0x26e,0x2dd,0x2d3),'exYpw')){const _0x565267=_0x19f215[_0x4a6c85(0x2e9,0x364,0x2f7,0x2f1)],_0x46494d=await _0x5b78cd[_0x8bf6ea(0x30c,0x2f0,0x2d3,0x2d4)](fetch,_0x565267[_0x8bf6ea(0x29c,0x277,0x24e,0x29d)]),_0x554d4c=await _0x46494d[_0x8bf6ea(0x26b,0x2cc,0x299,0x2e8)](),_0x41cd67=URL[_0x8bf6ea(0x296,0x298,0x26a,0x213)+_0x4a6c85(0x3c0,0x2f6,0x337,0x36c)](_0x554d4c);_0x5b78cd[_0x8bf6ea(0x31e,0x300,0x2c3,0x255)](updateComfyUIImagePreview,_0x41cd67),comfyuiImageObjectURL=_0x41cd67,window[_0x8bf6ea(0x300,0x330,0x302,0x31f)+_0x4a6c85(0x2b9,0x33b,0x31d,0x2f6)]=_0x565267['serverFile'+_0x8bf6ea(0x260,0x29a,0x27a,0x2a3)],_0x5b78cd[_0x4a6c85(0x316,0x294,0x2d2,0x304)](addLog,_0x8bf6ea(0x324,0x2bf,0x2c8,0x319)+_0x4a6c85(0x353,0x38f,0x420,0x3ab)+_0x565267[_0x8bf6ea(0x2db,0x314,0x2f4,0x367)+_0x4a6c85(0x391,0x2cb,0x380,0x31d)]),console[_0x8bf6ea(0x2ec,0x33b,0x2dc,0x2cf)](_0x4a6c85(0x34a,0x2e5,0x31c,0x2db)+_0x4a6c85(0x385,0x3ef,0x340,0x385)+'\x20from\x20cach'+_0x4a6c85(0x27b,0x266,0x331,0x2cf)+_0x565267[_0x8bf6ea(0x31a,0x327,0x2f4,0x31d)+_0x4a6c85(0x2e5,0x384,0x374,0x31d)]);}else _0xe99a4a['src']='',_0x1b3592['style']['display']=_0x5b78cd['tsnMk'],_0x253499[_0x8bf6ea(0x1f7,0x2a3,0x233,0x21a)][_0x8bf6ea(0x23b,0x1d3,0x22b,0x1ba)]=_0x5b78cd[_0x8bf6ea(0x27b,0x2da,0x2af,0x248)],_0x4464cb[_0x8bf6ea(0x1fb,0x248,0x233,0x279)][_0x4a6c85(0x2b9,0x344,0x2a4,0x2ce)]=_0x5b78cd[_0x4a6c85(0x38b,0x3eb,0x3f9,0x3b4)],_0x2ce2e3[_0x4a6c85(0x35b,0x36f,0x2af,0x321)+'fImage']=null;}else{if(_0x19f215&&_0x5b78cd['UtZkE'](typeof _0x19f215[_0x8bf6ea(0x220,0x232,0x24e,0x1fe)],_0x5b78cd[_0x4a6c85(0x414,0x3ad,0x395,0x3a3)])){const _0x1be60a=await _0x5b78cd[_0x8bf6ea(0x310,0x33d,0x2e0,0x294)](fetch,_0x19f215[_0x8bf6ea(0x282,0x2a1,0x24e,0x1e9)]),_0x1521a4=await _0x1be60a[_0x8bf6ea(0x2b6,0x2ba,0x299,0x295)](),_0xf5913=URL[_0x8bf6ea(0x20f,0x21c,0x26a,0x263)+_0x4a6c85(0x30a,0x3c1,0x3c4,0x36c)](_0x1521a4);_0x5b78cd[_0x4a6c85(0x30e,0x327,0x2fd,0x304)](updateComfyUIImagePreview,_0xf5913),comfyuiImageObjectURL=_0xf5913,console['warn'](_0x5b78cd['neNal']);}}}else{const _0x56ffdc=_0x8bf6ea(0x318,0x2fe,0x2e1,0x343)[_0x4a6c85(0x323,0x327,0x3cb,0x360)]('|');let _0x14a40f=-0x1509+-0x8*-0x17d+0x921;while(!![]){switch(_0x56ffdc[_0x14a40f++]){case'0':_0x2a648c[_0x8bf6ea(0x24c,0x20c,0x233,0x2a3)]['display']=_0x5b78cd[_0x4a6c85(0x347,0x340,0x3a7,0x3b4)];continue;case'1':_0x313349[_0x4a6c85(0x31d,0x2c5,0x32f,0x2fc)]='';continue;case'2':_0x27d3cf[_0x4a6c85(0x262,0x349,0x2c1,0x2d6)][_0x8bf6ea(0x22d,0x268,0x22b,0x231)]=_0x5b78cd[_0x4a6c85(0x36f,0x3a3,0x34e,0x3b4)];continue;case'3':_0x88b628[_0x4a6c85(0x307,0x314,0x2ae,0x2d6)]['display']=_0x5b78cd[_0x8bf6ea(0x2db,0x2e6,0x2af,0x2ea)];continue;case'4':_0x20dbb5[_0x8bf6ea(0x284,0x225,0x26c,0x204)+'ansferImag'+'e']=null;continue;}break;}}}catch(_0x4e58e4){console[_0x4a6c85(0x2ba,0x315,0x304,0x2fd)](_0x4a6c85(0x2fe,0x358,0x312,0x319)+'ing\x20cached'+'\x20ComfyUI\x20i'+_0x8bf6ea(0x238,0x27b,0x29a,0x25c),_0x4e58e4);}}export function initImageUpload(_0x3f8da3){const _0x3fe332={'tcMvf':_0x2fa26f(0x4ef,0x519,0x516,0x50b)+'_novelai','gWzxP':_0x2fa26f(0x4c6,0x53b,0x4d0,0x540),'ttKsc':function(_0x553c9d){return _0x553c9d();},'zlnhr':function(_0x5b2334,_0x44f3a5){return _0x5b2334(_0x44f3a5);},'duuSl':function(_0x2de30f,_0x45257a){return _0x2de30f===_0x45257a;},'fbAcJ':'phROa','CDjwx':_0x2fa26f(0x4f0,0x506,0x516,0x56d),'ULJKv':_0xfdc016(0x2da,0x287,0x29c,0x2c6)+'_nai_char_'+'ref','bpPfA':_0x2fa26f(0x4b8,0x519,0x58e,0x4bb)+'2','FVeqO':_0xfdc016(0x201,0x259,0x265,0x2b6)+_0x2fa26f(0x573,0x531,0x532,0x4ce)+_0xfdc016(0x290,0x231,0x22e,0x1c2),'bkvub':_0x2fa26f(0x467,0x4da,0x48a,0x50c)+_0xfdc016(0x22d,0x261,0x244,0x226),'vbRff':_0x2fa26f(0x46f,0x4d4,0x4be,0x4ec),'RRekN':_0x2fa26f(0x48d,0x48e,0x48d,0x4ff),'blcSK':_0x2fa26f(0x4ff,0x4e2,0x4b5,0x477)+'elect-char'+_0x2fa26f(0x51a,0x4dd,0x545,0x50a)+_0x2fa26f(0x4ae,0x4f0,0x48c,0x544),'IbgVt':_0x2fa26f(0x50a,0x4da,0x4f7,0x523)+_0x2fa26f(0x4f6,0x562,0x5a7,0x575)+'_ref','DqYtI':_0x2fa26f(0x4f8,0x4da,0x504,0x54a)+'t2'};function _0xfdc016(_0x27bc86,_0x3537e2,_0x127f60,_0x492dba){return _0x13510d(_0x27bc86,_0x127f60- -0x29c,_0x127f60-0x1b3,_0x492dba-0xb8);}_0x3fe332[_0xfdc016(0x1f6,0x23a,0x21a,0x218)](loadCachedImages),_0x3f8da3[_0x2fa26f(0x514,0x4aa,0x518,0x4d4)](_0x3fe332[_0x2fa26f(0x59e,0x560,0x5bd,0x56a)])['on'](_0xfdc016(0x256,0x20d,0x211,0x1e5),()=>{function _0x241ee5(_0x31d53d,_0x2bf227,_0x21a8b0,_0x4a1cd4){return _0x2fa26f(_0x31d53d-0x73,_0x4a1cd4- -0x9a,_0x2bf227,_0x4a1cd4-0x92);}function _0x260b59(_0x1038c4,_0x22eaa1,_0x21f5bc,_0x27a156){return _0x2fa26f(_0x1038c4-0x12b,_0x22eaa1-0x4a,_0x1038c4,_0x27a156-0x17);}document[_0x260b59(0x5a7,0x573,0x5e4,0x544)+_0x260b59(0x524,0x4c4,0x4a4,0x47e)](_0x3fe332['tcMvf'])[_0x241ee5(0x38d,0x443,0x415,0x3f4)]();}),_0x3f8da3[_0xfdc016(0x268,0x207,0x22d,0x1fb)](_0x3fe332[_0x2fa26f(0x50a,0x4ec,0x490,0x4cf)])['on'](_0x3fe332[_0xfdc016(0x2a8,0x271,0x271,0x280)],handleNovelaiImageUpload),_0x3f8da3[_0x2fa26f(0x4ea,0x4aa,0x4bf,0x4e7)]('#novelai-r'+_0xfdc016(0x2f7,0x2d8,0x2a1,0x264)+_0xfdc016(0x236,0x21f,0x22e,0x1b9))['on'](_0x3fe332[_0x2fa26f(0x541,0x4d3,0x4de,0x464)],()=>{function _0x30a7c4(_0x34f2d8,_0x209791,_0x4f60f5,_0x41542b){return _0x2fa26f(_0x34f2d8-0x14b,_0x4f60f5- -0x314,_0x34f2d8,_0x41542b-0xda);}function _0x4c881e(_0x21609c,_0x1fa9ef,_0x48e358,_0x3f0d80){return _0xfdc016(_0x21609c,_0x1fa9ef-0xbf,_0x3f0d80-0x1ef,_0x3f0d80-0x148);}_0x3fe332[_0x4c881e(0x428,0x461,0x4fe,0x495)]!==_0x3fe332[_0x4c881e(0x48a,0x48f,0x499,0x495)]?_0x4cbfe4():_0x3fe332[_0x30a7c4(0x12e,0x12e,0x183,0x195)](removeNovelaiImage);}),_0x3f8da3[_0x2fa26f(0x480,0x4aa,0x47f,0x4dc)](_0x3fe332[_0xfdc016(0x244,0x290,0x220,0x1d8)])['on'](_0x3fe332[_0x2fa26f(0x4c8,0x4d3,0x47f,0x4fd)],()=>{function _0x3873a2(_0x56851e,_0x43a0d1,_0x2f1436,_0x15d134){return _0x2fa26f(_0x56851e-0x17e,_0x43a0d1- -0x17d,_0x56851e,_0x15d134-0x1ed);}function _0x4b4fcf(_0x4edec6,_0x951107,_0x30e0ed,_0x3b0212){return _0x2fa26f(_0x4edec6-0xef,_0x30e0ed-0x85,_0x951107,_0x3b0212-0x12e);}_0x3fe332[_0x3873a2(0x322,0x396,0x32a,0x3ed)](_0x3fe332[_0x3873a2(0x3b2,0x383,0x358,0x352)],_0x3fe332[_0x3873a2(0x31d,0x313,0x2f1,0x387)])?_0x3fe332[_0x4b4fcf(0x578,0x549,0x50e,0x4a0)](_0x46e276,_0x25bb1c[_0x3873a2(0x35d,0x31d,0x34e,0x355)]):document[_0x4b4fcf(0x5e9,0x5ce,0x5ae,0x553)+_0x4b4fcf(0x4e9,0x53b,0x4ff,0x56d)](_0x3fe332[_0x3873a2(0x2f5,0x350,0x376,0x2fb)])['click']();});function _0x2fa26f(_0x2090a7,_0x39e3bd,_0x507c70,_0x271bc2){return _0x271a33(_0x39e3bd-0x372,_0x39e3bd-0x88,_0x507c70,_0x271bc2-0x18c);}_0x3f8da3[_0xfdc016(0x237,0x29b,0x22d,0x1b8)](_0x3fe332[_0xfdc016(0x2bd,0x338,0x2d4,0x333)])['on'](_0x3fe332[_0xfdc016(0x2b9,0x27c,0x271,0x245)],handleNovelaiCharRefImageUpload),_0x3f8da3['find'](_0x2fa26f(0x55a,0x552,0x5bf,0x51f)+'emove-char'+'-ref-image'+_0xfdc016(0x2cb,0x29b,0x273,0x216))['on'](_0x3fe332[_0x2fa26f(0x4c2,0x4d3,0x4f5,0x4d7)],()=>{function _0x387277(_0x184280,_0x161455,_0x4c9e64,_0x5f0f48){return _0x2fa26f(_0x184280-0x6,_0x161455- -0x274,_0x184280,_0x5f0f48-0x38);}_0x3fe332[_0x387277(0x1d9,0x223,0x1fd,0x26b)](removeNovelaiCharRefImage);}),_0x3f8da3['find'](_0xfdc016(0x28e,0x329,0x2d2,0x296)+_0xfdc016(0x309,0x2ba,0x2b4,0x280)+_0x2fa26f(0x46c,0x4ab,0x51e,0x494))['on'](_0xfdc016(0x231,0x1c3,0x211,0x22a),()=>{function _0x15a319(_0x41701b,_0x550c14,_0x593ea4,_0x13b5c3){return _0xfdc016(_0x550c14,_0x550c14-0x7f,_0x41701b- -0x27d,_0x13b5c3-0x1b);}function _0x38830b(_0x4c95cf,_0x399c9b,_0x36b849,_0x567ac9){return _0xfdc016(_0x399c9b,_0x399c9b-0x14f,_0x36b849- -0x354,_0x567ac9-0xc6);}document[_0x15a319(0x2f,0x92,-0x3f,0x6a)+_0x38830b(-0x18f,-0x18a,-0x157,-0x18b)](_0x3fe332[_0x38830b(-0xba,-0xf7,-0x106,-0xdc)])[_0x15a319(-0x6c,-0x7e,-0x21,0x6)]();}),_0x3f8da3[_0x2fa26f(0x4cc,0x4aa,0x4fc,0x45f)](_0x3fe332[_0x2fa26f(0x50c,0x4f5,0x558,0x568)])['on'](_0x3fe332[_0x2fa26f(0x4ed,0x4ee,0x4a6,0x48a)],handleImageUpload2),_0x3f8da3[_0x2fa26f(0x4e2,0x4aa,0x4e8,0x4d1)](_0xfdc016(0x2e4,0x2cb,0x2c9,0x2aa)+_0x2fa26f(0x581,0x51e,0x4c7,0x55b)+_0xfdc016(0x1fa,0x1cd,0x22e,0x25d))['on'](_0x2fa26f(0x453,0x48e,0x440,0x4e6),()=>{removeComfyUIImage();});}export{updateNovelaiImagePreview,updateNovelaiCharRefImagePreview,updateComfyUIImagePreview,nai3VibeTransferImageMimeType,nai3CharRefImageMimeType,comfyuiImageObjectURL};