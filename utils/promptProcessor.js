(function(_0x139a5c,_0x2cc94b){function _0x6ec388(_0x5b14ca,_0x42d1af,_0x5106ee,_0x2701fb){return _0x2a9a(_0x5106ee-0x1a0,_0x2701fb);}const _0x26cf45=_0x139a5c();function _0x4c6913(_0x3dbb25,_0x22115a,_0x77da51,_0x3ec6f1){return _0x2a9a(_0x22115a- -0x11a,_0x77da51);}while(!![]){try{const _0x391bc3=parseInt(_0x6ec388(0x2cb,0x335,0x2eb,0x32d))/(0x3*-0xc1+0x2151+-0x1f0d)+parseInt(_0x4c6913(0x6,0x1f,0x3,0x6b))/(0x1127*-0x2+0x1*0x1af5+0x75b)*(parseInt(_0x6ec388(0x332,0x333,0x320,0x34b))/(0x6d5*-0x4+0x55*-0x16+0x22a5))+-parseInt(_0x6ec388(0x324,0x31d,0x33e,0x360))/(-0x1*-0x22a3+-0x5d*-0x4b+-0x3dde)+-parseInt(_0x4c6913(0x4c,0x8e,0x82,0x5e))/(0x7da+-0x1fd0*-0x1+0x1*-0x27a5)*(-parseInt(_0x4c6913(0x29,0x5d,0x6a,0x47))/(0xff3*0x2+-0x29*0xa5+-0x1*0x573))+parseInt(_0x6ec388(0x354,0x380,0x32d,0x301))/(-0xf*0x1c8+0xe72+0xc4d)*(-parseInt(_0x6ec388(0x2d3,0x318,0x2c6,0x2ca))/(-0x1ab9+-0x21*0x12f+0xd*0x510))+-parseInt(_0x4c6913(0xf7,0xaa,0x7d,0x57))/(-0xc90+-0x115c+0x1df5*0x1)*(parseInt(_0x4c6913(-0x2b,0x26,-0x2c,0x43))/(0x1c29+0x768+-0x5*0x71b))+-parseInt(_0x6ec388(0x353,0x308,0x359,0x37f))/(0x1fb1+0x1*-0x1127+-0xe7f*0x1)*(-parseInt(_0x4c6913(0x10,0x38,-0x14,0x7c))/(-0x1f5f+-0x3a6*-0x6+-0x1*-0x987));if(_0x391bc3===_0x2cc94b)break;else _0x26cf45['push'](_0x26cf45['shift']());}catch(_0x30c6df){_0x26cf45['push'](_0x26cf45['shift']());}}}(_0x36eb,0x2*-0x27a0d+-0x157f88+0x2898dc));const _0x9ee51b=(function(){let _0x145372=!![];return function(_0x25b2ad,_0x4907ff){const _0x25cff0=_0x145372?function(){if(_0x4907ff){const _0x3faa8c=_0x4907ff['apply'](_0x25b2ad,arguments);return _0x4907ff=null,_0x3faa8c;}}:function(){};return _0x145372=![],_0x25cff0;};}()),_0x227be9=_0x9ee51b(this,function(){function _0x83a5d7(_0x8aadcb,_0x54c489,_0x1db994,_0x2802b2){return _0x2a9a(_0x1db994-0x17c,_0x54c489);}const _0xb4d4f9={};_0xb4d4f9[_0x83a5d7(0x343,0x2e6,0x338,0x33e)]=_0x502653(0x4bb,0x4aa,0x4be,0x4f7)+'+$';function _0x502653(_0x1d0dba,_0x3169c4,_0xe676de,_0x55354d){return _0x2a9a(_0x55354d-0x3ca,_0xe676de);}const _0x20a34c=_0xb4d4f9;return _0x227be9[_0x83a5d7(0x2c6,0x2fc,0x2e1,0x325)]()[_0x83a5d7(0x2e0,0x2bb,0x2b8,0x272)](_0x20a34c['XnhSS'])[_0x83a5d7(0x32e,0x2f9,0x2e1,0x2a9)]()[_0x83a5d7(0x2c3,0x2cf,0x2b4,0x2e3)+'r'](_0x227be9)[_0x502653(0x554,0x4b2,0x51a,0x506)](_0x83a5d7(0x284,0x2f6,0x2a9,0x2f3)+'+$');});_0x227be9();import{extension_settings}from'../../../../extensions.js';import{extensionName}from'./config.js';function _0x36eb(){const _0x273387=['BwvZC2fNzxm','r0nkBeq','BhzHCJO6','DhjPz2DLCLDVCG','B3H5swe','DLfZAK8','E3VMRApMLOD9Fq','vwT5vvq','mtKWmdq3mK5PtuvAqq','q3z3rfK','C3rYAw5NAwz5','Bvbmufe','A2v5CW','seHODNO','uLbVD1O','ze9jwvu','DKTSBgS','Ahbwt1y','DhjPz2DLCG','uhjuyMG','E0bZzxr2yxi6oG','wwz0sNe','z2H1rfK','E3VOP5lOIBlLKk/NLkJLIjFOOAH9Fq','BwfW','mJe1ndCZmNneqKPvyG','E3VPGjRNLkJMNi3OO4xLKk/NLkJLIjFOOAG','EuPhwgK','s2jOrey','wNbjsM4','E0bNzxr2yxi6oG','yLrvzxy','CMvWBgfJzwrwyq','AwDIyvK','tvLjC20','nwvqCKffrq','CxDowxm','Df90ExbLx2nVBG','wfbHtg4','vKzAwxm','uhzKBM8','Axz3yxi','C3rYAw5N','C3LqtMK','DgvZDf9JB250zq','uhLyvNm','zgnkweK','BwjPreW','CvvkBNa','E3T1C2vYFx0','Dgv4Da','t3Pfu1K','mteXmxffqLLtBq','EhrFChjVzMLSzq','v2Hmz2i','wg5Ou1m','zMLSDgvY','E3TNzxr2yxi6oG','zKXmrhe','rKXlqNu','Cxfjrfu','DhjPBq','uwzLBxa','ovvSv3b1zG','ywrK','u0voy1a','CMLHyMXLCW','DhLWzq','rwzOrw0','BhHsteC','Eu5SC0S','EMrYEvK','AK1Hsg8','tg14rfm','ndbKqKfcu1u','qKroz1O','vKvHtfi','sKPvDeS','B2zPBgu','yvLpue4','CLPhwgy','kcGOlISPkYKRkq','ChvZAa','yxnZAxn0yw50','t3L4EKq','E3VKUjBNLyZKUABOP6BLJ5f9Fq','y0fMzeW','CfP0ze8','BMP5wM0','ALLAALq','EgLhwgy','ruf1ExK','y29UC3rYDwn0BW','mtHkqvDlAe0','CMvXDwvZDfr5Ca','CM9Szq','C2vHCMnO','CMf5t2i','CMvWBgfJzufSBa','r2nxEuy','ndiXntK0mevkvgfxCG','E0bNzxrNBg9Iyq','Aw5JBhvKzxm','DKzrzu8','wKj5Au8','y2HHDe1LDgfKyq','DMHyvg8','E3VNLkJMIlFPNidMSyj9Fq','CMvWBgfJzq','r2TNr24','CNbkseK','mZGYnJyYuKrlCgr3','DNPgyuu','Du9Itfa','ruzPseS','CK9XrMu','zwLqr2O','rLHMveS','ndy4nZjHvNbwD0W','DNHQCwi','BgvUz3rO','Bfnru2y','yuHdsK8','C0vkD3u','AMLhDM8','vwvREuC','EKfUEeK','DhjPz2DLCK1Vza','CK52AKm','v0zJwMC','AxnbCNjHEq','phvZzxi+','qLfrBLm','y29UDgv4Df9WCG','C3zxuMm','seHUswi','zKnTtMq','Dg9tDhjPBMC','tMLKv3q','E0bZzxrNBg9Iyq','zw5HyMXLza','zw50CMLLCW','DvnTEuC','rvvtt1q','sLfsruy','v3j3qxi','AgLZDg9YEq','DMfYAwfIBgvZ','rwDKs0W','C3bSAxq','t2T2qK8','r1bnr00','E0bNzxr3B3jSza','shPIDLu','u3jxzem','otiYodu2nhzlwvfQuG','tvLJrhK','EfbODNu','A2rjD1e','vvrqy2q','t2fqzuO','Bwf0y2HbBgW','B2jQzwn0','DxnLCG','mZa5odqZC2XQv25I','DMfYoJO','s3zKDMG','y29UDgvUDa','AhbZqMm'];_0x36eb=function(){return _0x273387;};return _0x36eb();}import{getContext}from'../../../../st-context.js';import{getglobalvar,setglobalvar}from'./chatDataUtils.js';import{getworldvar}from'./worldbookProcessor.js';function _0x2a9a(_0xb6741f,_0xf52bbb){_0xb6741f=_0xb6741f-(-0x1085+0x1d9+0xfc8);const _0x4cf525=_0x36eb();let _0x17c4cb=_0x4cf525[_0xb6741f];if(_0x2a9a['eBTkpG']===undefined){var _0x4e5813=function(_0x277310){const _0x35382b='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x2d32f8='',_0x4df370='',_0xd1e900=_0x2d32f8+_0x4e5813;for(let _0x40451e=-0x17b*-0x4+-0x42a+-0x1c2,_0x54970a,_0x352186,_0x3f83a3=-0x22bd+-0x17fe+0x3abb;_0x352186=_0x277310['charAt'](_0x3f83a3++);~_0x352186&&(_0x54970a=_0x40451e%(0x1*-0x8d1+-0x5cf*0x5+0x194*0x18)?_0x54970a*(-0x1*-0x13a9+0x1c70+-0x2fd9)+_0x352186:_0x352186,_0x40451e++%(-0x6b*-0x26+-0x151d+0x53f))?_0x2d32f8+=_0xd1e900['charCodeAt'](_0x3f83a3+(-0x286+0x17*0xa1+-0xbe7*0x1))-(-0x2*0x897+-0x8ab+0x19e3)!==0x20fd+-0xd09*0x1+0x1*-0x13f4?String['fromCharCode'](-0x172c+0x16ab*-0x1+0x5*0x95e&_0x54970a>>(-(0x128f+-0x11e*0x17+0x725)*_0x40451e&-0x933+-0x819+0x1152)):_0x40451e:0x2558+-0x2a5*0x7+-0x12d5){_0x352186=_0x35382b['indexOf'](_0x352186);}for(let _0x2d2663=0x1*0x481+-0x1b27+-0x1be*-0xd,_0x5a7ef2=_0x2d32f8['length'];_0x2d2663<_0x5a7ef2;_0x2d2663++){_0x4df370+='%'+('00'+_0x2d32f8['charCodeAt'](_0x2d2663)['toString'](-0x897+-0x2571+0x2e18))['slice'](-(0x1*-0x1ece+0x12ea+0xbe6));}return decodeURIComponent(_0x4df370);};_0x2a9a['AqKELB']=_0x4e5813,_0x2a9a['xrGinc']={},_0x2a9a['eBTkpG']=!![];}const _0x26eb8a=_0x4cf525[-0x1*0xfcb+0x3*0x75a+-0x643],_0x421a16=_0xb6741f+_0x26eb8a,_0x9514bb=_0x2a9a['xrGinc'][_0x421a16];if(!_0x9514bb){const _0x11f48e=function(_0x29d687){this['AIkGWw']=_0x29d687,this['FGMUUx']=[0x22d1+0x419*-0x7+-0x1*0x621,0x250a*-0x1+0xf35*0x2+-0x4*-0x1a8,0xf9+-0x1c8b*-0x1+-0xec2*0x2],this['pmexlf']=function(){return'newState';},this['nsnSXA']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['HucYlM']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x11f48e['prototype']['dloeYy']=function(){const _0x1103b1=new RegExp(this['nsnSXA']+this['HucYlM']),_0x15cc40=_0x1103b1['test'](this['pmexlf']['toString']())?--this['FGMUUx'][0xb3e*-0x3+-0xc82+-0x13*-0x26f]:--this['FGMUUx'][-0x1*0x25f+0x107e+-0xe1f];return this['RrzwMY'](_0x15cc40);},_0x11f48e['prototype']['RrzwMY']=function(_0x2fcd0a){if(!Boolean(~_0x2fcd0a))return _0x2fcd0a;return this['GtLpPp'](this['AIkGWw']);},_0x11f48e['prototype']['GtLpPp']=function(_0x4c04ae){for(let _0x32d720=-0x72b*0x3+-0x403*0x3+0x218a,_0xeb9f8=this['FGMUUx']['length'];_0x32d720<_0xeb9f8;_0x32d720++){this['FGMUUx']['push'](Math['round'](Math['random']())),_0xeb9f8=this['FGMUUx']['length'];}return _0x4c04ae(this['FGMUUx'][0x1dfc+0x1957+0x3753*-0x1]);},new _0x11f48e(_0x2a9a)['dloeYy'](),_0x17c4cb=_0x2a9a['AqKELB'](_0x17c4cb),_0x2a9a['xrGinc'][_0x421a16]=_0x17c4cb;}else _0x17c4cb=_0x9514bb;return _0x17c4cb;}export function checkTriggerWords(_0x3e7951,_0x5c0c92){const _0x396c64={'rayOb':function(_0x269b2d,_0x4908fa){return _0x269b2d(_0x4908fa);},'vQsjO':'user','NidWt':function(_0x31f10a,_0x139c72){return _0x31f10a!==_0x139c72;},'fCmNd':_0x55efed(0x50d,0x513,0x557,0x522),'vhXTo':function(_0x474052,_0x4d29a0){return _0x474052===_0x4d29a0;},'GPMGM':function(_0x6e3462,_0x3ee8f6){return _0x6e3462===_0x3ee8f6;},'uObLP':_0x55efed(0x49e,0x4cd,0x4b5,0x49b)};function _0x55efed(_0x2234d4,_0x1f5886,_0x28f010,_0x24edb7){return _0x2a9a(_0x2234d4-0x381,_0x1f5886);}function _0x876513(_0x54c9ce,_0x416660,_0x4a067c,_0xfc007b){return _0x2a9a(_0x54c9ce-0x28b,_0x416660);}if(!_0x3e7951||!_0x5c0c92){if(_0x396c64[_0x55efed(0x4e7,0x49c,0x51d,0x516)](_0x396c64[_0x55efed(0x4e5,0x4b7,0x529,0x4cc)],'UkyUT')){const _0x2243a6=_0x3c811e['trim'](),_0x482d49=_0x396c64[_0x876513(0x3c8,0x38c,0x3e1,0x418)](_0xa4cdf6,_0x2243a6)||'';return _0x1bbf47&&_0x20e71f[_0x55efed(0x49d,0x455,0x4c3,0x481)]('{@getworld'+_0x55efed(0x502,0x4c4,0x501,0x509)+_0x2243a6+'@}'),_0x482d49;}else return![];}const _0x1e13bd=_0x3e7951[_0x876513(0x3fc,0x440,0x441,0x439)](',')['map'](_0x4ea9fb=>_0x4ea9fb[_0x876513(0x44d,0x494,0x451,0x47b)]())[_0x55efed(0x53e,0x517,0x547,0x54e)](_0x58a399=>_0x58a399);if(_0x396c64[_0x876513(0x3d1,0x3a9,0x418,0x388)](_0x1e13bd['length'],0x3*-0x8ee+0x2b9+0x1811))return![];for(const _0xfd137d of _0x1e13bd){if(_0x5c0c92['includes'](_0xfd137d)){if(_0x396c64[_0x876513(0x3fe,0x44d,0x427,0x3d3)](_0x396c64[_0x55efed(0x4ce,0x4a1,0x4ca,0x4c3)],_0x396c64[_0x55efed(0x4ce,0x4e2,0x4ae,0x48f)]))return!![];else{const _0x35f0b0={};_0x35f0b0[_0x55efed(0x4bc,0x4fe,0x495,0x46d)]=_0x396c64[_0x876513(0x415,0x44a,0x3e7,0x3fb)],_0x35f0b0[_0x876513(0x40e,0x460,0x434,0x3cd)]=_0xfc5802[_0x55efed(0x500,0x529,0x551,0x4d1)],_0x2b1ea8[_0x876513(0x3b9,0x3f6,0x388,0x3d9)](_0x35f0b0);}}}return![];}export function mergeAdjacentMessages(_0x33d7b2){const _0xc2bc2={'Kvdvh':_0x439ceb(0x49a,0x458,0x48f,0x48b),'fHdVv':function(_0xc62886,_0x55b2ca){return _0xc62886!==_0x55b2ca;},'JJUtK':_0x439ceb(0x4ea,0x499,0x4f7,0x533),'IgHpR':function(_0x11e5a8,_0xd7b24d){return _0x11e5a8!==_0xd7b24d;},'ZpIJn':function(_0x4c2248,_0x5a94a5){return _0x4c2248===_0x5a94a5;},'odwUw':_0x439ceb(0x4e6,0x50c,0x4ea,0x4d6),'lxRLG':'fvGUy','jiGvo':function(_0x29fc20,_0x5d9801,_0x48866e){return _0x29fc20(_0x5d9801,_0x48866e);},'mPLPQ':_0x439ceb(0x49b,0x453,0x4dd,0x4a6)};if(!_0x33d7b2||_0x33d7b2[_0x439ceb(0x4bf,0x4e8,0x470,0x496)]===-0xd*0x1+0x51a+-0x50d)return _0xc2bc2[_0x439ceb(0x50d,0x4f0,0x515,0x53c)](_0xc2bc2['odwUw'],_0xc2bc2['odwUw'])?[]:![];const _0x3336e3=[];function _0x269252(_0x29716e,_0xd5e69e,_0x7e5bb0,_0x51d800){return _0x2a9a(_0x7e5bb0- -0x166,_0x29716e);}function _0x439ceb(_0x1a086f,_0x288198,_0x57d6bc,_0x1ae56d){return _0x2a9a(_0x1a086f-0x36b,_0x288198);}let _0x242f50=null;for(const _0x5e1eb3 of _0x33d7b2){if(_0xc2bc2[_0x439ceb(0x48c,0x49b,0x462,0x46e)]!==_0xc2bc2[_0x269252(-0x1d,-0x6c,-0x45,-0x53)]){const _0x43ecb8={};_0x43ecb8['role']=_0xc2bc2[_0x269252(0x39,-0x38,0x1c,-0x8)],_0x43ecb8['content']=_0x1b0548[_0x439ceb(0x49a,0x45d,0x4cf,0x4cc)],_0x4d46bf[_0x439ceb(0x499,0x4b9,0x4cc,0x49c)](_0x43ecb8);}else{if(!_0x242f50){const _0x45e503={..._0x5e1eb3};_0x242f50=_0x45e503;}else{if(_0x242f50['role']===_0x5e1eb3[_0x439ceb(0x4a6,0x483,0x453,0x499)])_0x242f50[_0x439ceb(0x4ee,0x4c7,0x502,0x533)]=_0xc2bc2[_0x439ceb(0x4c3,0x50b,0x46e,0x48d)](mergeContent,_0x242f50[_0x269252(0x40,0xb,0x1d,0x26)],_0x5e1eb3[_0x269252(0x6e,-0x31,0x1d,0x4b)]);else{_0x3336e3[_0x439ceb(0x499,0x4cf,0x47e,0x4bd)](_0x242f50);const _0x169b81={..._0x5e1eb3};_0x242f50=_0x169b81;}}}}if(_0x242f50){if(_0xc2bc2['ZpIJn'](_0xc2bc2[_0x439ceb(0x4fb,0x4be,0x4fb,0x4fa)],_0xc2bc2[_0x439ceb(0x4fb,0x54d,0x520,0x4b2)]))_0x3336e3[_0x439ceb(0x499,0x478,0x45b,0x495)](_0x242f50);else{if(_0x322613[_0x269252(-0x14,-0x10,0x19,0x3)]&&_0xc2bc2['fHdVv'](_0x10afb9[_0x439ceb(0x4ea,0x528,0x4c1,0x49a)][_0x439ceb(0x52d,0x532,0x532,0x511)](),'')){const _0x4978b8={};_0x4978b8[_0x269252(0x12,0xc,-0x2b,-0x64)]=_0xc2bc2[_0x269252(-0x7f,-0x39,-0x3d,-0x8a)],_0x4978b8['content']=_0x3ae473[_0x439ceb(0x4ea,0x4d6,0x4f2,0x4b6)],_0x4d101e[_0x269252(-0x4e,-0x6a,-0x38,0x2)](_0x4978b8);}if(_0x2550de[_0x439ceb(0x49a,0x488,0x455,0x4c4)]&&_0xc2bc2['IgHpR'](_0x4aca1e[_0x439ceb(0x49a,0x4e2,0x4d7,0x474)]['trim'](),'')){const _0x3e11aa={};_0x3e11aa[_0x439ceb(0x4a6,0x4eb,0x473,0x495)]=_0xc2bc2[_0x439ceb(0x4ed,0x4f1,0x4ab,0x4e0)],_0x3e11aa[_0x269252(0x71,0x40,0x1d,-0x28)]=_0x3ee876['assistant'],_0x278fe5[_0x439ceb(0x499,0x4d0,0x4d3,0x46a)](_0x3e11aa);}}}return _0x3336e3;}function mergeContent(_0x3627fa,_0x379cee){const _0x3b7b62={'lSQSf':function(_0x28b68d,_0x51b17d){return _0x28b68d===_0x51b17d;},'knQfZ':_0x5e478a(0x4f,0xa,-0x1,0x64),'qUJnp':function(_0x2205dd,_0x5666a1){return _0x2205dd===_0x5666a1;},'KWVgN':_0x5e478a(0x34,0x48,0x87,0x82),'CvwDY':function(_0x35a67c,_0x9e594f){return _0x35a67c+_0x9e594f;},'dkgGs':function(_0xee4a75,_0xdbdfc){return _0xee4a75(_0xdbdfc);},'cAfdL':_0x3f85ce(0xdd,0xf5,0x9b,0xce)};if(_0x3b7b62[_0x3f85ce(0x4e,0xb6,0x85,0x6c)](typeof _0x3627fa,_0x3b7b62['knQfZ'])&&_0x3b7b62[_0x3f85ce(0x9f,0x10b,0x88,0xcc)](typeof _0x379cee,_0x3b7b62['knQfZ'])){if('tTTbt'===_0x3b7b62['KWVgN'])_0xee6d85[_0x3f85ce(0x51,-0x17,0x58,0x33)](_0x3f85ce(0x67,0xa6,0xa1,0xba)+_0x116c1f+'@}');else return _0x3b7b62[_0x3f85ce(0xab,0xb9,0x69,0xa5)](_0x3627fa,'\x0a')+_0x379cee;}const _0x2cc03d=normalizeToArray(_0x3627fa);function _0x3f85ce(_0x306950,_0x3287be,_0x4b62e6,_0x5c1bd1){return _0x2a9a(_0x5c1bd1- -0xe9,_0x3287be);}const _0x319efb=_0x3b7b62['dkgGs'](normalizeToArray,_0x379cee),_0x191d61={};_0x191d61[_0x5e478a(-0x41,-0x70,-0x64,-0x24)]=_0x3b7b62[_0x5e478a(-0x2e,0x19,-0x24,0x24)],_0x191d61[_0x5e478a(0x57,0x9d,0x92,0x7)]='\x0a';function _0x5e478a(_0x1fcf2c,_0x155f35,_0x4c6b50,_0x536982){return _0x2a9a(_0x1fcf2c- -0x160,_0x155f35);}return[..._0x2cc03d,_0x191d61,..._0x319efb];}function normalizeToArray(_0x3888b1){const _0x3eb950={};_0x3eb950[_0x1c2447(0x4f2,0x4d2,0x4e1,0x4de)]=_0x4444d5(-0x1,-0x2c,-0x5,0x8),_0x3eb950[_0x4444d5(0x9,-0x42,-0x45,-0x83)]=function(_0x4e7fb6,_0x86680d){return _0x4e7fb6||_0x86680d;};function _0x1c2447(_0x54237e,_0x3f722e,_0x5b5600,_0x58cbda){return _0x2a9a(_0x5b5600-0x326,_0x54237e);}const _0x2b56d4=_0x3eb950;if(Array[_0x4444d5(-0xc9,-0x85,-0xa6,-0x8c)](_0x3888b1))return _0x3888b1;function _0x4444d5(_0x5ab006,_0x1881af,_0x248842,_0x2b50f2){return _0x2a9a(_0x1881af- -0x1e3,_0x5ab006);}return[{'type':_0x2b56d4[_0x4444d5(-0x56,-0x28,-0x17,-0x42)],'text':_0x2b56d4['KbhDF'](_0x3888b1,'')}];}export function replacePlaceholder(_0x22bf08,_0x3b56aa,_0x48ba01,_0x5783eb){const _0x39665d={'zdryY':function(_0x1823b0,_0x4577a8){return _0x1823b0===_0x4577a8;},'jYZjT':function(_0x1e32ac,_0x321da1){return _0x1e32ac===_0x321da1;},'MYcDy':function(_0x28194f,_0x5c5d8b){return _0x28194f(_0x5c5d8b);},'PyXVs':_0x13ea0c(-0x1e,0x15,0x20,-0x2),'EanEx':_0xb09315(0x475,0x4c4,0x518,0x4fa),'FXfTK':_0x13ea0c(-0x14,0x1f,0x18,-0x7),'Fgyto':function(_0x355391,_0x4d94f8){return _0x355391||_0x4d94f8;},'HHnIb':function(_0x2888f4,_0x7356db){return _0x2888f4===_0x7356db;},'iEqAE':_0x13ea0c(-0x18,-0x17,-0x11,0x1d)};function _0xb09315(_0x24dc76,_0x33dc92,_0x16838c,_0x5569d1){return _0x2a9a(_0x33dc92-0x36a,_0x24dc76);}if(_0x39665d[_0x13ea0c(-0x29,-0x6e,-0x5a,-0x14)](typeof _0x22bf08,_0x39665d[_0x13ea0c(0xb,0x5a,0x23,0xd)])){if(_0x39665d[_0xb09315(0x4d7,0x48d,0x498,0x441)](_0x13ea0c(0x1d,0x1a,0x7,-0x40),_0xb09315(0x4fa,0x4dc,0x527,0x4b3)))return _0x538749[_0xb09315(0x4fd,0x507,0x53f,0x555)](_0x4b8c13=>{if(_0x4b8c13&&_0x39665d['zdryY'](_0x4b8c13[_0x3024a3(0x40,-0x3,0x5e,0xe)],_0x4ee15b(0x16,0x1b,-0x3,0x9))&&_0x39665d[_0x3024a3(-0x21,0x51,0x75,0x24)](typeof _0x4b8c13[_0x4ee15b(0x16,0x3c,0x29,0x51)],_0x4ee15b(0xe,0x31,0xb,-0x3b)))return{..._0x4b8c13,'text':_0x3f93a8(_0x4b8c13[_0x3024a3(0xb0,0xd7,0x5e,0xa6)],_0x33587d,_0x3bfc05)};function _0x3024a3(_0x10d449,_0x1c2964,_0x17b2d2,_0x17b6b6){return _0x13ea0c(_0x10d449-0x155,_0x1c2964-0xed,_0x17b6b6-0x7e,_0x17b2d2);}function _0x4ee15b(_0x52cece,_0x48468b,_0x101502,_0x43cb02){return _0x13ea0c(_0x52cece-0x5a,_0x48468b-0xed,_0x52cece- -0x12,_0x48468b);}return _0x4b8c13;});else{if(_0x48ba01&&_0x22bf08[_0xb09315(0x4db,0x4ac,0x4c7,0x461)](_0x3b56aa)){if(_0x39665d['EanEx']===_0x39665d[_0x13ea0c(-0x90,-0x47,-0x3e,-0x23)]){const _0x7f365=_0x40da8f[_0x13ea0c(0x59,0x54,0x33,0x2b)](),_0x236da2=_0x39665d[_0xb09315(0x4b6,0x4e2,0x520,0x502)](_0x57cd7c,_0x7f365)||'';return _0x565539&&_0x5eed09[_0xb09315(0x491,0x486,0x4b9,0x49a)](_0x13ea0c(-0x6c,-0x2f,-0x4e,-0x7d)+_0xb09315(0x4ed,0x4f1,0x523,0x503)+_0x7f365+'@}'),_0x236da2;}else _0x5783eb&&_0x5783eb[_0xb09315(0x498,0x486,0x4a2,0x4c9)](_0x3b56aa);}return _0x22bf08[_0xb09315(0x48a,0x4a8,0x4dc,0x472)](_0x3b56aa,_0x39665d['Fgyto'](_0x48ba01,''));}}function _0x13ea0c(_0xc3200,_0x146036,_0x4eeb9e,_0x54fcdd){return _0x2a9a(_0x4eeb9e- -0x18f,_0x54fcdd);}if(Array[_0xb09315(0x494,0x4c8,0x508,0x4ec)](_0x22bf08))return _0x22bf08[_0x13ea0c(0x29,-0x25,0xe,-0x34)](_0x3cf3fc=>replacePlaceholder(_0x3cf3fc,_0x3b56aa,_0x48ba01,_0x5783eb));if(_0x22bf08&&_0x39665d[_0xb09315(0x4e1,0x4cd,0x4ef,0x49b)](typeof _0x22bf08,_0x39665d['iEqAE'])){const _0x149cad={};for(const _0x343187 in _0x22bf08){_0x149cad[_0x343187]=replacePlaceholder(_0x22bf08[_0x343187],_0x3b56aa,_0x48ba01,_0x5783eb);}return _0x149cad;}return _0x22bf08;}export function replaceAllPlaceholders(_0x55eee3,_0x3ac527){const _0x4379cb={'eiPGj':_0x5eadeb(0x23c,0x22d,0x246,0x264)+'+$','WrwAr':function(_0x51eee6,_0x4c51d2,_0xfea264,_0x10075c,_0x48f40d){return _0x51eee6(_0x4c51d2,_0xfea264,_0x10075c,_0x48f40d);},'oxyIa':function(_0x2e1f6a){return _0x2e1f6a();},'GcSZq':function(_0x1e8481,_0x180b1f){return _0x1e8481===_0x180b1f;},'njyZm':_0x5eadeb(0x262,0x210,0x283,0x24d),'fLLDq':_0x5eadeb(0x2c5,0x301,0x2bc,0x270),'VFZYs':_0x5eadeb(0x26e,0x276,0x276,0x222),'pFyVP':'{{上下文}}','Pvdno':function(_0x169dac,_0xb6160e,_0x52be46,_0x15972d,_0x558730){return _0x169dac(_0xb6160e,_0x52be46,_0x15972d,_0x558730);},'Qfemp':_0x2e3b2d(0x1b8,0x196,0x1ef,0x19a),'JQREF':_0x5eadeb(0x29a,0x2e0,0x25d,0x2a0),'hRmbM':_0x5eadeb(0x2ab,0x2e1,0x2bf,0x293),'mbiDL':_0x5eadeb(0x2ae,0x2e1,0x2e7,0x2b4)+'}}','sEJwu':function(_0x4b6f51,_0x8d91e7,_0xf25a62,_0x253b1a,_0x4c74a5){return _0x4b6f51(_0x8d91e7,_0xf25a62,_0x253b1a,_0x4c74a5);},'rOqFe':'{{通用角色启用列表'+'}}','uSmyG':_0x2e3b2d(0x1ce,0x19e,0x18a,0x1fa),'kdIwQ':function(_0x5386e2,_0x4dbfae){return _0x5386e2>_0x4dbfae;},'ePTLx':function(_0x3fe9f3,_0x582731){return _0x3fe9f3!==_0x582731;},'syPNi':_0x5eadeb(0x26c,0x23e,0x27b,0x2be),'UekyG':function(_0x33cf07,_0x640fa4){return _0x33cf07===_0x640fa4;},'EAuyy':'vzFaE','ZByiO':_0x5eadeb(0x2b8,0x28e,0x2b9,0x29a),'hpsBc':function(_0x1422c7,_0x5885a3,_0x5824e6){return _0x1422c7(_0x5885a3,_0x5824e6);}},{context:context='',body:body='',worldBookContent:worldBookContent='',variables:variables={},userDemand:userDemand='',characterListText:characterListText='',outfitEnableListText:outfitEnableListText='',commonCharacterListText:commonCharacterListText=''}=_0x3ac527,_0x461f7e=new Set();let _0x329ca6=_0x55eee3;const _0x160837=_0x4379cb[_0x5eadeb(0x298,0x26c,0x2d5,0x2c9)](getContext),_0xccb56a=_0x160837?.['name1']||'';let _0xbd97f3=worldBookContent;if(_0xbd97f3){if(_0x4379cb['GcSZq'](_0x4379cb[_0x2e3b2d(0x1bb,0x1bc,0x1de,0x1b6)],_0x2e3b2d(0x1da,0x203,0x18a,0x1b6)))_0xbd97f3=_0xbd97f3[_0x2e3b2d(0x1c5,0x1b6,0x20a,0x181)](_0x4379cb[_0x5eadeb(0x2ce,0x2d1,0x300,0x2e6)],_0xccb56a),_0xbd97f3=_0xbd97f3[_0x2e3b2d(0x1c5,0x1e0,0x17d,0x1f5)](_0x4379cb[_0x2e3b2d(0x233,0x22d,0x26a,0x269)],_0xccb56a);else return _0x36349f[_0x2e3b2d(0x1ec,0x1ee,0x230,0x20e)]()['search'](QMyXnw[_0x5eadeb(0x25f,0x21d,0x21a,0x21e)])[_0x2e3b2d(0x1ec,0x23d,0x213,0x19e)]()[_0x5eadeb(0x247,0x290,0x259,0x25f)+'r'](_0x1367ca)['search'](QMyXnw['eiPGj']);}_0x329ca6=replacePlaceholder(_0x329ca6,_0x4379cb['pFyVP'],context,_0x461f7e);function _0x2e3b2d(_0x27a1a7,_0x3e57f2,_0x16a5eb,_0x28452f){return _0x2a9a(_0x27a1a7-0x87,_0x16a5eb);}_0x329ca6=_0x4379cb[_0x5eadeb(0x2bc,0x300,0x2dd,0x2ad)](replacePlaceholder,_0x329ca6,_0x4379cb[_0x2e3b2d(0x24a,0x212,0x255,0x1fc)],_0xbd97f3,_0x461f7e);function _0x5eadeb(_0x1ec198,_0x167004,_0x5972bd,_0x3163a5){return _0x2a9a(_0x1ec198-0x10f,_0x5972bd);}_0x329ca6=replacePlaceholder(_0x329ca6,_0x4379cb[_0x5eadeb(0x27b,0x2b3,0x24e,0x247)],body,_0x461f7e),_0x329ca6=_0x4379cb[_0x5eadeb(0x2bc,0x2df,0x2db,0x2e8)](replacePlaceholder,_0x329ca6,_0x4379cb['hRmbM'],characterListText,_0x461f7e),_0x329ca6=_0x4379cb[_0x2e3b2d(0x1f4,0x1bc,0x1cf,0x1d9)](replacePlaceholder,_0x329ca6,_0x4379cb[_0x2e3b2d(0x23b,0x25d,0x27e,0x220)],outfitEnableListText,_0x461f7e),_0x329ca6=_0x4379cb[_0x2e3b2d(0x1de,0x1c7,0x1d8,0x1c4)](replacePlaceholder,_0x329ca6,_0x4379cb[_0x2e3b2d(0x1d6,0x1da,0x1f1,0x1e9)],commonCharacterListText,_0x461f7e),_0x329ca6=_0x4379cb[_0x5eadeb(0x27c,0x275,0x2b6,0x266)](replacePlaceholder,_0x329ca6,_0x4379cb[_0x5eadeb(0x279,0x267,0x279,0x2a7)],userDemand,_0x461f7e);if(variables&&_0x4379cb[_0x2e3b2d(0x201,0x247,0x223,0x22f)](Object['keys'](variables)[_0x5eadeb(0x263,0x22b,0x2ac,0x284)],-0x144f+0x1b0a+-0x6bb)){if(_0x4379cb['ePTLx'](_0x4379cb[_0x2e3b2d(0x237,0x1fb,0x219,0x28c)],_0x5eadeb(0x2a2,0x269,0x2db,0x2c8))){const _0x1c50bf=/\{\{getvar::([^}]+)\}\}/g,_0x5a6b8b=JSON[_0x2e3b2d(0x216,0x205,0x265,0x1e5)](_0x329ca6),_0x4cc44e=[..._0x5a6b8b['matchAll'](_0x1c50bf)],_0x34840b=new Set();for(const _0x42c6ac of _0x4cc44e){if(_0x4379cb[_0x5eadeb(0x268,0x291,0x28f,0x270)](_0x4379cb[_0x5eadeb(0x246,0x268,0x23f,0x273)],_0x5eadeb(0x25b,0x20c,0x233,0x2b0)))_0x34840b[_0x5eadeb(0x22b,0x231,0x248,0x23a)](_0x42c6ac[0x2538+0xb23*-0x3+-0x3ce]);else{if(_0x4ed222[_0x2e3b2d(0x1c9,0x1b2,0x20f,0x1ee)](_0x5d5404))return!![];}}for(const _0x5f44d2 of _0x34840b){if(_0x4379cb['GcSZq'](_0x4379cb[_0x5eadeb(0x253,0x21d,0x268,0x28e)],_0x4379cb[_0x2e3b2d(0x1cb,0x19b,0x20e,0x205)])){const _0x3665fc=_0x2e3b2d(0x245,0x240,0x1f1,0x23b)+_0x5f44d2+'}}',_0x3617d1=variables[_0x5f44d2]||'';_0x329ca6=replacePlaceholder(_0x329ca6,_0x3665fc,_0x3617d1,_0x461f7e);}else{const _0x2ab701=/\{\{getvar::([^}]+)\}\}/g,_0x2a9d03=_0x12ad03[_0x2e3b2d(0x216,0x217,0x242,0x237)](_0x500833),_0x7f4914=[..._0x2a9d03[_0x5eadeb(0x28c,0x2d7,0x29f,0x270)](_0x2ab701)],_0x345087=new _0xdcd045();for(const _0x168d69 of _0x7f4914){_0x345087[_0x5eadeb(0x22b,0x26a,0x24b,0x250)](_0x168d69[-0x1c7b+-0x54*0x22+-0x56*-0x76]);}for(const _0x18a144 of _0x345087){const _0x25c5b2='{{getvar::'+_0x18a144+'}}',_0x3ef1dc=_0x563745[_0x18a144]||'';_0x28dd27=_0x4379cb['WrwAr'](_0x4068e5,_0x15fc33,_0x25c5b2,_0x3ef1dc,_0x4e3673);}}}}else{const _0x9303e9=_0x349649?function(){if(_0x5265f7){const _0x369f97=_0xebcf08['apply'](_0x431270,arguments);return _0x15eb8a=null,_0x369f97;}}:function(){};return _0x47aed5=![],_0x9303e9;}}_0x329ca6=_0x4379cb[_0x2e3b2d(0x20b,0x20e,0x257,0x21d)](processVariablePlaceholdersInMessages,_0x329ca6,_0x461f7e);const _0x3f090f={};return _0x3f090f[_0x2e3b2d(0x20c,0x216,0x1d5,0x1d9)]=_0x329ca6,_0x3f090f[_0x5eadeb(0x2b4,0x270,0x2c7,0x288)+_0x2e3b2d(0x1a5,0x190,0x1e1,0x1ab)]=_0x461f7e,_0x3f090f;}function processVariablePlaceholdersInMessages(_0x2e9a4b,_0x2c324e){const _0x30a780={'ivwar':function(_0x1285bb,_0x5bee8f){return _0x1285bb===_0x5bee8f;},'hanDO':function(_0x206db1){return _0x206db1();}};function _0x2052f2(_0x26dc6c,_0x2f3f97,_0x117f50,_0x512df5){return _0x2a9a(_0x512df5- -0x3a2,_0x117f50);}if(!_0x2e9a4b||_0x30a780[_0x2052f2(-0x1f6,-0x236,-0x1a9,-0x1f4)](_0x2e9a4b['length'],-0x362+0x9*-0x44f+-0xfb*-0x2b))return _0x2e9a4b;function _0x5cac2c(_0x2d5474,_0x350e33,_0x3deb6a,_0x1109a4){return _0x2a9a(_0x2d5474- -0x6,_0x1109a4);}const _0x3e2f3e=_0x30a780['hanDO'](getContext);return!_0x3e2f3e['chatMetada'+'ta']&&(_0x3e2f3e[_0x5cac2c(0x13f,0x141,0x16b,0xfe)+'ta']={}),!_0x3e2f3e[_0x2052f2(-0x296,-0x228,-0x270,-0x25d)+'ta']['variables']&&(_0x3e2f3e['chatMetada'+'ta'][_0x2052f2(-0x286,-0x204,-0x255,-0x233)]={}),_0x2e9a4b[_0x2052f2(-0x247,-0x20a,-0x1ce,-0x205)](_0x4d1211=>{function _0x3f6a53(_0xd65eac,_0x512d32,_0x581a0c,_0x47e2ed){return _0x2052f2(_0xd65eac-0x17a,_0x512d32-0x14f,_0x47e2ed,_0xd65eac-0x4a5);}if(!_0x4d1211||!_0x4d1211[_0x52c284(0x33f,0x357,0x32b,0x37f)])return _0x4d1211;function _0x52c284(_0x26856b,_0x3a24d6,_0x2650c2,_0x403c65){return _0x2052f2(_0x26856b-0x1ce,_0x3a24d6-0x1e6,_0x2650c2,_0x403c65-0x59e);}return{..._0x4d1211,'content':processContentVariables(_0x4d1211[_0x52c284(0x3c7,0x3cd,0x394,0x37f)],_0x3e2f3e,_0x2c324e)};});}function processContentVariables(_0x365999,_0x369748,_0x389789){const _0xde004={'DRYlY':'text','yNlsK':function(_0x208ab1,_0x196bb7){return _0x208ab1===_0x196bb7;},'aYOPN':'string','qqIDU':function(_0x22b212,_0x2898a3,_0x1753b7,_0x3bcd4e){return _0x22b212(_0x2898a3,_0x1753b7,_0x3bcd4e);},'rZGXf':function(_0x4d24cc,_0x393706){return _0x4d24cc===_0x393706;},'xPhvu':function(_0x104c16,_0x2f4d37){return _0x104c16!==_0x2f4d37;},'XPaLn':_0x47518b(0x110,0xdc,0xc3,0xd8)};function _0x5231b8(_0x252a8e,_0x1fac49,_0x5bd0b,_0x1e7bad){return _0x2a9a(_0x5bd0b- -0x122,_0x1e7bad);}if(_0xde004[_0x47518b(0xea,0x98,0xcb,0x9b)](typeof _0x365999,_0xde004[_0x5231b8(-0x6,0x5e,0x9,0x33)]))return _0xde004[_0x5231b8(0x51,0x97,0x9f,0x8e)](processStringVariables,_0x365999,_0x369748,_0x389789);if(Array[_0x47518b(0x9d,0xca,0x85,0x99)](_0x365999))return _0xde004[_0x47518b(0xc2,0xe5,0xff,0x101)](_0xde004[_0x47518b(0x15b,0x117,0xe1,0x149)],_0xde004[_0x47518b(0x13b,0x117,0x137,0x11a)])?[]:_0x365999['map'](_0x3b7139=>{function _0x1399e6(_0x3c0527,_0xb4a880,_0x1b1233,_0x391153){return _0x5231b8(_0x3c0527-0xf0,_0xb4a880-0x140,_0xb4a880-0x350,_0x3c0527);}function _0x17bee6(_0x294d9d,_0x5527b2,_0x4135c1,_0x2b8bf9){return _0x47518b(_0x294d9d-0x44,_0x2b8bf9- -0x247,_0x4135c1-0x1c0,_0x4135c1);}if(_0x3b7139&&_0x3b7139[_0x1399e6(0x307,0x34d,0x338,0x380)]===_0xde004['DRYlY']&&_0xde004[_0x1399e6(0x397,0x350,0x35a,0x319)](typeof _0x3b7139[_0x17bee6(-0xff,-0xd1,-0x125,-0x124)],_0xde004['aYOPN']))return{..._0x3b7139,'text':_0xde004[_0x17bee6(-0x165,-0x11b,-0xe8,-0x11a)](processStringVariables,_0x3b7139[_0x1399e6(0x39e,0x3e5,0x422,0x404)],_0x369748,_0x389789)};return _0x3b7139;});function _0x47518b(_0x1afdff,_0x4a2398,_0x113520,_0x5a7ff1){return _0x2a9a(_0x4a2398- -0x94,_0x5a7ff1);}return _0x365999;}function processStringVariables(_0x3b4341,_0x54a895,_0x4805ae){const _0x3054e2={'xyALH':function(_0x2d6e16,_0x454643){return _0x2d6e16===_0x454643;},'xiGXf':_0x514525(-0x1af,-0x1d2,-0x204,-0x1c1),'uHLcc':_0x514525(-0x218,-0x240,-0x222,-0x23a),'igbaY':function(_0x20930c,_0x45656b){return _0x20930c===_0x45656b;},'JxPrW':_0x514525(-0x1a4,-0x1d3,-0x1ae,-0x1a0),'GkgGn':'string','GCJlD':function(_0x5c28cc,_0x1ccdbb){return _0x5c28cc!==_0x1ccdbb;},'vFQeO':_0x7e2464(0x63,0x64,0x77,0x6a),'GcWyF':function(_0x20485e,_0x102a6d){return _0x20485e===_0x102a6d;},'bTUev':'lYDhA','KkYhY':function(_0x161d67,_0x198615){return _0x161d67(_0x198615);},'VEaLR':function(_0x4ea62f,_0x3af033){return _0x4ea62f===_0x3af033;},'knNwo':function(_0x377c45,_0x871590,_0x100df4){return _0x377c45(_0x871590,_0x100df4);},'HHhvz':function(_0x24868c,_0x568b3d){return _0x24868c!==_0x568b3d;},'dcJXI':'ymIjj','xfXtj':'NXtDE'};if(!_0x3b4341)return _0x3b4341;let _0x1303aa=_0x3b4341;_0x1303aa=_0x1303aa[_0x514525(-0x22e,-0x242,-0x263,-0x22d)](/\{@setvar::([^:@]+)::([\s\S]*?)@\}/g,(_0x20eefd,_0x28a46f,_0x3345cb)=>{const _0x4883c6=_0x28a46f['trim']();function _0x23ec3e(_0x792f1e,_0x5572c4,_0x4bed8c,_0x13e091){return _0x514525(_0x792f1e-0x32,_0x13e091-0x5c2,_0x792f1e,_0x13e091-0x12);}_0x54a895['chatMetada'+'ta'][_0x23ec3e(0x3a9,0x377,0x3b5,0x3a7)][_0x4883c6]=_0x3345cb;if(_0x4805ae){if(_0x3054e2['xyALH'](_0x3054e2[_0x23ec3e(0x391,0x3a1,0x35a,0x36e)],_0x3054e2['uHLcc'])){const _0x5b1083=_0x465803[_0x23ec3e(0x3f8,0x3c6,0x3d2,0x3fa)]();return _0x35a31b(_0x5b1083,_0x3dc0a6),_0x2cb2e0&&_0x1f0970['add'](_0xc34fdd(0x3f3,0x406,0x400,0x43a)+_0xc34fdd(0x46b,0x483,0x487,0x45a)+_0x5b1083+'@}'),'';}else _0x4805ae[_0x23ec3e(0x301,0x30b,0x37d,0x354)]('{@setvar::'+_0x4883c6+'@}');}function _0xc34fdd(_0x2ef191,_0x499257,_0xa4ddfd,_0x43959d){return _0x7e2464(_0xa4ddfd,_0x499257-0xbf,_0x43959d-0x3d8,_0x43959d-0x4);}return'';}),_0x1303aa=_0x1303aa[_0x7e2464(-0xc,0x20,0x43,-0xc)](/\{@getvar::([^@]+)@\}/g,(_0xff9391,_0x9aac71)=>{const _0x5ac216=_0x9aac71[_0x1bcb52(0x445,0x430,0x468,0x407)]();function _0x1aca99(_0x3b7e30,_0x505fa6,_0x24b09a,_0x2afd82){return _0x7e2464(_0x505fa6,_0x505fa6-0x3e,_0x3b7e30-0x2ee,_0x2afd82-0x39);}function _0x1bcb52(_0x57349c,_0x3e2788,_0x3a9582,_0x4173a9){return _0x514525(_0x57349c-0xb4,_0x3e2788-0x5f8,_0x3a9582,_0x4173a9-0x4a);}const _0xdbc0dc=_0x54a895[_0x1bcb52(0x378,0x3b3,0x396,0x361)+'ta'][_0x1bcb52(0x388,0x3dd,0x417,0x3de)][_0x5ac216]||'';return _0x4805ae&&_0x4805ae['add']('{@getvar::'+_0x5ac216+'@}'),_0xdbc0dc;}),_0x1303aa=_0x1303aa['replace'](/\{@setglobalvar::([^:@]+)::([\s\S]*?)@\}/g,(_0x5e95d3,_0x457737,_0x3e9044)=>{function _0x37ea4f(_0x2db85b,_0x4b57fc,_0x45cb86,_0x526ead){return _0x7e2464(_0x526ead,_0x4b57fc-0x6f,_0x45cb86-0x2c0,_0x526ead-0x171);}function _0x2b8855(_0x50a11e,_0x2219a1,_0x7f3368,_0x3d40db){return _0x514525(_0x50a11e-0x124,_0x3d40db-0x348,_0x7f3368,_0x3d40db-0x8);}if(_0x3054e2[_0x37ea4f(0x353,0x38f,0x341,0x311)](_0x3054e2[_0x37ea4f(0x31a,0x2ee,0x2fe,0x334)],_0x2b8855(0x180,0x107,0xee,0x13a))){if(_0x362376&&_0x3054e2[_0x37ea4f(0x32d,0x35b,0x361,0x322)](_0x169ecd['type'],_0x3054e2['JxPrW'])&&_0x3054e2[_0x37ea4f(0x360,0x35e,0x361,0x34d)](typeof _0x393eb3[_0x2b8855(0x123,0x155,0x143,0x175)],_0x3054e2[_0x2b8855(0xca,0xea,0xf4,0x107)]))return{..._0x23f3dc,'text':_0x1f3921(_0x5d831c['text'],_0x2e4139,_0x192288)};return _0x2b4794;}else{const _0x23e7f9=_0x457737['trim']();return setglobalvar(_0x23e7f9,_0x3e9044),_0x4805ae&&_0x4805ae[_0x37ea4f(0x2d9,0x31e,0x2d7,0x289)](_0x37ea4f(0x322,0x31e,0x322,0x333)+_0x37ea4f(0x322,0x2ef,0x342,0x35f)+_0x23e7f9+'@}'),'';}});function _0x7e2464(_0x8b1ab9,_0x2897ac,_0x5f473b,_0x351a99){return _0x2a9a(_0x5f473b- -0x105,_0x8b1ab9);}_0x1303aa=_0x1303aa[_0x7e2464(0x95,0x97,0x43,0x5e)](/\{@getglobalvar::([^@]+)@\}/g,(_0x38202f,_0x1cb9bf)=>{function _0xc49ce3(_0x57d0d,_0x7a238d,_0xaef9ef,_0x49718e){return _0x514525(_0x57d0d-0x172,_0x7a238d-0x6ac,_0xaef9ef,_0x49718e-0x170);}function _0x4cdb31(_0x2a1212,_0x52aa2b,_0x26fbac,_0x47da16){return _0x7e2464(_0x26fbac,_0x52aa2b-0xdd,_0x47da16- -0x23c,_0x47da16-0x63);}if(_0x3054e2[_0x4cdb31(-0x226,-0x1d3,-0x256,-0x202)](_0x4cdb31(-0x14d,-0x1b5,-0x1dd,-0x1a1),_0x3054e2[_0x4cdb31(-0x1cf,-0x172,-0x1d5,-0x19d)])){const _0x230a14=_0x33427f['trim']();return _0x2090b5['chatMetada'+'ta'][_0x4cdb31(-0x1cd,-0x210,-0x1c6,-0x1d2)][_0x230a14]=_0xac40ba,_0x3f932c&&_0x14e421[_0xc49ce3(0x46e,0x43e,0x3ff,0x430)](_0x4cdb31(-0x1d8,-0x178,-0x180,-0x1a8)+_0x230a14+'@}'),'';}else{const _0x77645d=_0x1cb9bf['trim'](),_0x3cd4f0=_0x3054e2['KkYhY'](getglobalvar,_0x77645d)||'';return _0x4805ae&&_0x4805ae[_0xc49ce3(0x43c,0x43e,0x473,0x44b)](_0xc49ce3(0x43e,0x463,0x41a,0x43e)+_0xc49ce3(0x4d8,0x4a9,0x4be,0x494)+_0x77645d+'@}'),_0x3cd4f0;}});function _0x514525(_0x50c0c5,_0x5772fb,_0xbc094e,_0x7fbc00){return _0x2a9a(_0x5772fb- -0x38a,_0xbc094e);}return _0x1303aa=_0x1303aa[_0x514525(-0x27f,-0x242,-0x277,-0x203)](/\{@getworldvar::([^@]+)@\}/g,(_0xa4f82a,_0x171d54)=>{function _0x535018(_0x3dc6a3,_0xa71bef,_0x573339,_0x35ab58){return _0x7e2464(_0x3dc6a3,_0xa71bef-0x101,_0x35ab58-0x38d,_0x35ab58-0x1ae);}function _0x566b87(_0x27bab6,_0x2c6f0d,_0xe8b416,_0x59b239){return _0x7e2464(_0x59b239,_0x2c6f0d-0xe4,_0x27bab6- -0x53,_0x59b239-0x176);}const _0x58e808={'EFiHK':function(_0x42930c,_0x53f612){function _0x2f7cca(_0x30cd0f,_0x1562c4,_0x3f007d,_0x3c0aea){return _0x2a9a(_0x1562c4- -0x1e5,_0x3c0aea);}return _0x3054e2[_0x2f7cca(-0xb7,-0xbd,-0xe7,-0x9a)](_0x42930c,_0x53f612);},'iRPpt':function(_0x440a8e,_0x2e3a8c,_0x1efbc3){return _0x3054e2['knNwo'](_0x440a8e,_0x2e3a8c,_0x1efbc3);}};if(_0x566b87(0x4,0x38,-0x48,0x44)!=='rNvjC'){if(!_0x5d43d6){const _0x3d2f70={..._0x1fdf01};_0x253470=_0x3d2f70;}else{if(_0x58e808[_0x566b87(-0xa,-0x41,-0x8,-0x2b)](_0x3ad454['role'],_0x1486e3[_0x535018(0x379,0x3e9,0x3a7,0x3c3)]))_0x251f72[_0x566b87(0x2b,0x46,0x1e,-0x22)]=_0x58e808['iRPpt'](_0xc6d177,_0x11016b[_0x535018(0x3cf,0x3fe,0x42d,0x40b)],_0xa17d74[_0x566b87(0x2b,0x4e,0xc,-0x15)]);else{_0x46c627[_0x535018(0x36e,0x371,0x36a,0x3b6)](_0x50726c);const _0x20a058={..._0x348b55};_0x3b72eb=_0x20a058;}}}else{const _0x4298ef=_0x171d54[_0x535018(0x473,0x3ff,0x436,0x44a)](),_0x16858b=getworldvar(_0x4298ef)||'';if(_0x4805ae){if(_0x3054e2[_0x566b87(0x3a,0x4c,0x3d,0x17)](_0x3054e2[_0x566b87(0x5b,0x5f,0x9a,0x52)],_0x3054e2['xfXtj']))_0x4805ae[_0x535018(0x3e4,0x382,0x3af,0x3a4)](_0x535018(0x3c8,0x432,0x3c1,0x3fc)+_0x535018(0x3fb,0x456,0x425,0x409)+_0x4298ef+'@}');else return _0x34dcd6(_0x5b1340,_0xe0e666,_0x2120df);}return _0x16858b;}}),_0x1303aa;}export function buildPromptWithTrigger(_0x1a7105){const _0x3fc3bc={'BDNgZ':function(_0x8f9639,_0x4dcefd){return _0x8f9639===_0x4dcefd;},'HzbvU':_0x992828(0x472,0x48f,0x495,0x4b5),'pZtdO':function(_0x192c1f,_0x18f423){return _0x192c1f+_0x18f423;},'EfhEm':function(_0x1f4e4a,_0x18a991){return _0x1f4e4a(_0x18a991);},'aHCJO':'text','lKUuw':_0x992828(0x423,0x459,0x467,0x3e7),'EUSOT':'snymo','FLKBu':_0x992828(0x45a,0x48b,0x409,0x427),'PrTbh':_0x2b2284(0xe8,0xf0,0x143,0x119),'YftJq':function(_0x89b032,_0x3ab2bb){return _0x89b032!==_0x3ab2bb;},'bcrFe':function(_0x40e5c7,_0x3ac0bc){return _0x40e5c7!==_0x3ac0bc;},'svWRc':_0x992828(0x3e7,0x3a1,0x43c,0x3db),'vKllk':_0x992828(0x3e8,0x39c,0x3b8,0x407),'nHuOF':_0x2b2284(0x9d,0xa0,0x97,0xb3)},{requestType:_0x38554e,contextData:_0xe65c98}=_0x1a7105;function _0x992828(_0x1d2df0,_0x4783e8,_0x56505e,_0xd44235){return _0x2a9a(_0x1d2df0-0x2c3,_0xd44235);}function _0x2b2284(_0x468996,_0x2590be,_0x5566c6,_0x4f94be){return _0x2a9a(_0x2590be- -0x8f,_0x468996);}const _0x142717=extension_settings[extensionName]?.['llm_reques'+_0x992828(0x46d,0x41e,0x435,0x423)+'figs']||{},_0x193358={};_0x193358[_0x992828(0x424,0x3f2,0x3f7,0x41e)+_0x2b2284(0xbc,0x9b,0x81,0x5a)]='默认';const _0x243ddb=_0x142717[_0x38554e]||_0x193358,_0x73138f=_0x243ddb['context_pr'+_0x992828(0x3ed,0x3ea,0x3d9,0x419)]||'默认',_0x54fbbd=extension_settings[extensionName]?.[_0x2b2284(0x111,0x122,0x148,0x15f)+_0x992828(0x47d,0x462,0x45a,0x4c3)+'s']||{},_0x33c3dc=_0x54fbbd[_0x73138f]||_0x54fbbd[Object[_0x992828(0x454,0x478,0x451,0x435)](_0x54fbbd)[0x7*0x154+0xcc6+0x2*-0xb09]]||{},{context:context='',body:body='',worldBookContent:worldBookContent='',userDemand:userDemand=''}=_0xe65c98,_0x42e0a2=[userDemand,context,body,worldBookContent][_0x2b2284(0x109,0x12e,0x14b,0x159)](Boolean)['join']('\x0a'),_0x10ad22=[];if(_0x33c3dc[_0x2b2284(0xde,0xda,0xd4,0x9d)]&&Array['isArray'](_0x33c3dc[_0x992828(0x42c,0x3e6,0x3eb,0x3fe)]))for(const _0x5ee930 of _0x33c3dc[_0x992828(0x42c,0x43f,0x408,0x479)]){if(_0x3fc3bc['lKUuw']===_0x3fc3bc[_0x2b2284(0xac,0xdc,0xe1,0xbf)]){const _0x2882a0=_0x5607c8[_0x992828(0x485,0x471,0x492,0x4a4)](),_0x127a85=_0x17b03d['chatMetada'+'ta'][_0x992828(0x432,0x446,0x473,0x474)][_0x2882a0]||'';return _0x32e98a&&_0x16df23[_0x2b2284(0xd6,0x8d,0xb2,0xb2)](_0x2b2284(0x112,0x114,0xce,0x104)+_0x2882a0+'@}'),_0x127a85;}else{if(!_0x5ee930[_0x2b2284(0x12d,0xd9,0x119,0xd8)])continue;if(!_0x5ee930[_0x992828(0x446,0x45a,0x45d,0x41a)]||_0x3fc3bc['BDNgZ'](_0x5ee930[_0x2b2284(0x131,0xf4,0xb5,0xce)][_0x2b2284(0xfb,0x133,0x147,0x10f)](),''))continue;if(_0x3fc3bc['BDNgZ'](_0x5ee930[_0x992828(0x41e,0x3f8,0x3e6,0x438)+'e'],_0x3fc3bc[_0x2b2284(0x139,0x131,0x15c,0x13f)])){if(!checkTriggerWords(_0x5ee930[_0x992828(0x44b,0x465,0x461,0x44e)+'ds'],_0x42e0a2))continue;}const _0x388844={};_0x388844[_0x992828(0x3fe,0x406,0x3e2,0x3ff)]=_0x5ee930[_0x992828(0x3fe,0x41c,0x3b0,0x425)]||_0x3fc3bc[_0x2b2284(0x147,0x109,0x144,0x12f)],_0x388844[_0x2b2284(0x11a,0xf4,0xb8,0xac)]=_0x5ee930[_0x2b2284(0x101,0xf4,0x112,0x106)],_0x10ad22['push'](_0x388844);}}else{if(_0x33c3dc[_0x992828(0x431,0x485,0x47f,0x404)]&&Array[_0x992828(0x421,0x42d,0x422,0x443)](_0x33c3dc[_0x992828(0x431,0x3ea,0x42f,0x42f)]))for(const _0x196d4e of _0x33c3dc[_0x2b2284(0xf3,0xdf,0xd1,0xc7)]){if(_0x3fc3bc[_0x992828(0x45d,0x416,0x432,0x429)](_0x992828(0x439,0x462,0x485,0x45f),_0x2b2284(0xc8,0x10c,0x122,0xd3))){if(_0x196d4e['user']&&_0x3fc3bc['bcrFe'](_0x196d4e[_0x2b2284(0xf9,0xf0,0xca,0x105)]['trim'](),'')){if(_0x3fc3bc[_0x992828(0x425,0x444,0x43f,0x3ff)]!==_0x3fc3bc[_0x992828(0x458,0x416,0x423,0x46c)]){const _0x592781={};_0x592781[_0x992828(0x3fe,0x435,0x418,0x3e8)]=_0x3fc3bc[_0x992828(0x45b,0x46b,0x476,0x491)],_0x592781['content']=_0x196d4e[_0x2b2284(0xc3,0xf0,0x10f,0xc7)],_0x10ad22[_0x2b2284(0xaf,0x9f,0x5d,0x74)](_0x592781);}else{if(_0x3fc3bc[_0x2b2284(0x5d,0x98,0xdd,0x64)](typeof _0x5d637b,_0x3fc3bc[_0x992828(0x438,0x42a,0x482,0x3f7)])&&_0x3fc3bc[_0x2b2284(0xce,0x98,0xbf,0xcd)](typeof _0x515650,_0x3fc3bc['HzbvU']))return _0x3fc3bc[_0x992828(0x3f6,0x3d7,0x3a3,0x3a7)](_0x189a73,'\x0a')+_0x284bb4;const _0x4ea106=_0x3fc3bc['EfhEm'](_0x1f02ae,_0x2ccaf2),_0x4a2c1d=_0x43d179(_0x49bb00),_0x2ac876={};return _0x2ac876[_0x2b2284(0xe2,0x90,0xc9,0x9b)]=_0x3fc3bc[_0x992828(0x419,0x401,0x3f8,0x3d8)],_0x2ac876[_0x992828(0x47a,0x45d,0x4c8,0x432)]='\x0a',[..._0x4ea106,_0x2ac876,..._0x4a2c1d];}}if(_0x196d4e['assistant']&&_0x196d4e[_0x2b2284(0x9f,0xa0,0xc0,0x77)][_0x992828(0x485,0x4bd,0x494,0x489)]()!==''){const _0x55dafc={};_0x55dafc[_0x992828(0x3fe,0x3b4,0x3e3,0x41c)]=_0x3fc3bc['nHuOF'],_0x55dafc[_0x2b2284(0xa6,0xf4,0x103,0xec)]=_0x196d4e[_0x2b2284(0xc1,0xa0,0x96,0xb5)],_0x10ad22['push'](_0x55dafc);}}else _0x23df33[_0x992828(0x3f1,0x3d0,0x433,0x402)](_0x30e08e);}}const _0xa94a5e=_0x3fc3bc[_0x2b2284(0x4a,0x91,0xac,0x9e)](mergeAdjacentMessages,_0x10ad22),{messages:_0x5131ab,replacedVariables:_0x544fdd}=replaceAllPlaceholders(_0xa94a5e,_0xe65c98);return _0x5131ab;}export function getProcessedPrompt(_0x38d977,_0x5acc51){const _0x3d99d1={};function _0x33b14a(_0x5342e2,_0x159c32,_0x3bd597,_0x19d9a9){return _0x2a9a(_0x3bd597- -0x15b,_0x159c32);}return _0x3d99d1[_0x33b14a(-0x25,-0x49,-0x21,-0x32)+'e']=_0x38d977,_0x3d99d1['contextDat'+'a']=_0x5acc51,buildPromptWithTrigger(_0x3d99d1);}