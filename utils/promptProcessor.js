(function(_0x315f98,_0x7b4be2){function _0x10b69a(_0x3059af,_0x287a89,_0x2c8136,_0x111880){return _0xbaea(_0x111880-0x329,_0x2c8136);}function _0x152c8e(_0xacafa8,_0xc98742,_0x562997,_0x3518ca){return _0xbaea(_0xacafa8- -0x197,_0x562997);}const _0x438162=_0x315f98();while(!![]){try{const _0x4ade4b=parseInt(_0x10b69a(0x501,0x46e,0x468,0x4b6))/(0xa5c+-0x1*0x16f7+0xc9c)+-parseInt(_0x152c8e(-0x4f,-0x80,-0x95,-0x82))/(-0x1717+-0x252a*0x1+0x3c43)*(-parseInt(_0x10b69a(0x46a,0x434,0x470,0x47f))/(-0x13cb+0xdf*-0xb+0x1d63*0x1))+-parseInt(_0x10b69a(0x490,0x4c9,0x51a,0x4d1))/(0xb7e*-0x1+-0x70e+0x1290)+-parseInt(_0x10b69a(0x43f,0x49d,0x4d3,0x485))/(-0x15e1+0xe6b+-0x77b*-0x1)+parseInt(_0x152c8e(-0x5,-0x2d,0x19,-0x14))/(0x1*0x2582+-0x5c0+-0x1fbc)+-parseInt(_0x10b69a(0x4bb,0x478,0x4ad,0x4a5))/(0x1eeb*-0x1+-0xc4+0x3*0xa92)*(parseInt(_0x152c8e(0x3a,0xf,0x5a,-0x12))/(-0x9f6+-0xa99+0x1497))+-parseInt(_0x152c8e(-0x11,0x6,0x22,-0x40))/(0x377+-0x1bd8+0x186a);if(_0x4ade4b===_0x7b4be2)break;else _0x438162['push'](_0x438162['shift']());}catch(_0x8afeff){_0x438162['push'](_0x438162['shift']());}}}(_0x1070,0xf5c5+0x1*-0x210e+0x1c958*0x1));const _0x3d3032=(function(){const _0x5ed9c6={};_0x5ed9c6['IRKrE']=function(_0x49acf3,_0x12e591){return _0x49acf3!==_0x12e591;};function _0x56548f(_0x3a832b,_0x28c412,_0x2aaaaa,_0x13bc20){return _0xbaea(_0x13bc20- -0x2e1,_0x3a832b);}_0x5ed9c6[_0x56548f(-0x169,-0x134,-0x12a,-0x125)]='VWCln',_0x5ed9c6['IrmQZ']=_0x233ac4(0x43e,0x47f,0x43c,0x47b),_0x5ed9c6[_0x233ac4(0x413,0x44a,0x420,0x42a)]=function(_0x2a393d,_0x430213){return _0x2a393d===_0x430213;},_0x5ed9c6[_0x233ac4(0x482,0x4a7,0x4d1,0x48e)]='crkxL';const _0x4e8fad=_0x5ed9c6;function _0x233ac4(_0x3cb1c1,_0x4277e8,_0x316221,_0x44bb2c){return _0xbaea(_0x4277e8-0x2dd,_0x44bb2c);}let _0x554be2=!![];return function(_0x167624,_0x25c115){const _0xb215c8={'QcGnM':function(_0x29d63d,_0x5dd460,_0xa754dc){return _0x29d63d(_0x5dd460,_0xa754dc);}},_0xeecc5c=_0x554be2?function(){function _0x33b66d(_0x5f39b3,_0x3cbb0e,_0x2f679b,_0x2c6d7a){return _0xbaea(_0x2c6d7a- -0x27f,_0x5f39b3);}function _0x1cd1c8(_0xf9bd8b,_0x3cfe3e,_0x1c1aa7,_0x807279){return _0xbaea(_0x1c1aa7-0x220,_0x3cfe3e);}if(_0x4e8fad[_0x1cd1c8(0x3e0,0x3cc,0x3be,0x3c7)](_0x4e8fad[_0x33b66d(-0xc3,-0xac,-0xaf,-0xc3)],_0x4e8fad[_0x33b66d(-0xc6,-0xc6,-0xe9,-0x10d)])){if(_0x25c115){if(_0x4e8fad[_0x33b66d(-0xf9,-0xfd,-0xc2,-0x112)](_0x4e8fad['mmvfL'],'oFmuB'))_0x2fdabc[_0x1cd1c8(0x3fe,0x411,0x3d5,0x415)](_0x1cd1c8(0x352,0x385,0x3a2,0x3ad)+_0x33b66d(-0xa4,-0x105,-0xbc,-0xf5)+_0x2bcbc1+'@}');else{const _0x6c4c38=_0x25c115[_0x1cd1c8(0x366,0x3c8,0x39a,0x349)](_0x167624,arguments);return _0x25c115=null,_0x6c4c38;}}}else{const _0x5e15ec=_0x4d9b7c['trim']();return _0xb215c8[_0x33b66d(-0x115,-0xc4,-0x80,-0xd3)](_0xe7c57f,_0x5e15ec,_0x4148b7),_0x21e719&&_0x320e82[_0x33b66d(-0xbc,-0xa3,-0x7a,-0xca)](_0x1cd1c8(0x396,0x31e,0x352,0x2ff)+_0x33b66d(-0x106,-0xb0,-0xee,-0xf5)+_0x5e15ec+'@}'),'';}}:function(){};return _0x554be2=![],_0xeecc5c;};}()),_0x908be=_0x3d3032(this,function(){const _0x56fc52={};_0x56fc52[_0x55b4fb(0x3d6,0x3c5,0x3d6,0x408)]=_0x55b4fb(0x3ee,0x3fa,0x3d9,0x405)+'+$';function _0x21442(_0x5684b4,_0x32ec53,_0x530ddf,_0x3cc99e){return _0xbaea(_0x32ec53- -0x290,_0x5684b4);}function _0x55b4fb(_0x2c3d33,_0x24e123,_0x19e2ef,_0x2c1635){return _0xbaea(_0x24e123-0x224,_0x2c1635);}const _0x28e4e2=_0x56fc52;return _0x908be['toString']()[_0x55b4fb(0x397,0x35c,0x326,0x351)](_0x28e4e2[_0x55b4fb(0x411,0x3c5,0x3b8,0x3a0)])[_0x55b4fb(0x395,0x35d,0x31e,0x321)]()[_0x21442(-0xf8,-0xf7,-0x13e,-0xef)+'r'](_0x908be)[_0x21442(-0x131,-0x158,-0x120,-0x118)](_0x28e4e2[_0x21442(-0x13e,-0xef,-0xc2,-0x13c)]);});function _0xbaea(_0x8e9e58,_0x37c0d5){_0x8e9e58=_0x8e9e58-(-0x108d*0x1+0x23e+0xf7f);const _0x41879c=_0x1070();let _0x2df7ed=_0x41879c[_0x8e9e58];if(_0xbaea['aigRTx']===undefined){var _0x52173c=function(_0x1c22f9){const _0x30313c='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x193fda='',_0x1e79bd='',_0x28f37c=_0x193fda+_0x52173c;for(let _0x1fa64f=-0x1d80+0xf75+0x1*0xe0b,_0x36696e,_0x590153,_0xd73e15=-0x7b4+-0x2*0xc0d+0x6*0x54d;_0x590153=_0x1c22f9['charAt'](_0xd73e15++);~_0x590153&&(_0x36696e=_0x1fa64f%(0x1f6a*-0x1+0x22e3+0xf*-0x3b)?_0x36696e*(-0xdc9+-0x2307+0x3110)+_0x590153:_0x590153,_0x1fa64f++%(0x184+-0x46b+0x1*0x2eb))?_0x193fda+=_0x28f37c['charCodeAt'](_0xd73e15+(0x7*0x1c1+-0x1339+0x3*0x254))-(0x13ce+-0x1*0x7c7+-0xbfd)!==-0x23ac+0x2*0x129e+-0x190?String['fromCharCode'](0xddd+-0x109*-0x16+0x8e9*-0x4&_0x36696e>>(-(-0x19*-0xaf+0x1e42+-0x1*0x2f57)*_0x1fa64f&-0x1187+-0x959+0x1ae6)):_0x1fa64f:0x1*0x14ac+-0x832+-0xc7a){_0x590153=_0x30313c['indexOf'](_0x590153);}for(let _0x2cc12e=0x35*-0x2f+-0x42*-0x1b+-0x2c5*-0x1,_0x3b4a53=_0x193fda['length'];_0x2cc12e<_0x3b4a53;_0x2cc12e++){_0x1e79bd+='%'+('00'+_0x193fda['charCodeAt'](_0x2cc12e)['toString'](-0x9*0xf1+-0x1*-0xca9+-0x420))['slice'](-(-0x5*0x16c+-0xab*-0x2f+-0x1847));}return decodeURIComponent(_0x1e79bd);};_0xbaea['LMlQZJ']=_0x52173c,_0xbaea['InqXGL']={},_0xbaea['aigRTx']=!![];}const _0x44995d=_0x41879c[-0x7*0x189+0x2358+-0x1899],_0x252a02=_0x8e9e58+_0x44995d,_0x4ee5f3=_0xbaea['InqXGL'][_0x252a02];if(!_0x4ee5f3){const _0x1bf411=function(_0x3bcf85){this['DKWopF']=_0x3bcf85,this['JPeWyY']=[-0x20e1+0x21e9+-0x107,-0x1*0x1a17+0x12a6+-0x1*-0x771,-0x15f7+0x6*-0x3c3+-0x36d*-0xd],this['sqyLql']=function(){return'newState';},this['sUpztO']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['wgYVfn']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x1bf411['prototype']['axBILd']=function(){const _0x35c475=new RegExp(this['sUpztO']+this['wgYVfn']),_0x3265d7=_0x35c475['test'](this['sqyLql']['toString']())?--this['JPeWyY'][0x1453+0x1*0x217c+-0x47*0xc2]:--this['JPeWyY'][0x1d90+0x1561+-0x32f1];return this['wATBff'](_0x3265d7);},_0x1bf411['prototype']['wATBff']=function(_0x2fe0dc){if(!Boolean(~_0x2fe0dc))return _0x2fe0dc;return this['yDoOaU'](this['DKWopF']);},_0x1bf411['prototype']['yDoOaU']=function(_0x5d56a4){for(let _0x1081bb=0x2385+0x15*-0x15+-0x21cc,_0x1ab8ed=this['JPeWyY']['length'];_0x1081bb<_0x1ab8ed;_0x1081bb++){this['JPeWyY']['push'](Math['round'](Math['random']())),_0x1ab8ed=this['JPeWyY']['length'];}return _0x5d56a4(this['JPeWyY'][-0x12e5*0x1+-0x12f*0x1a+0x31ab]);},new _0x1bf411(_0xbaea)['axBILd'](),_0x2df7ed=_0xbaea['LMlQZJ'](_0x2df7ed),_0xbaea['InqXGL'][_0x252a02]=_0x2df7ed;}else _0x2df7ed=_0x4ee5f3;return _0x2df7ed;}_0x908be();import{extension_settings}from'../../../../extensions.js';import{extensionName}from'./config.js';import{getContext}from'../../../../st-context.js';import{getglobalvar,setglobalvar}from'./chatDataUtils.js';import{getworldvar}from'./worldbookProcessor.js';export function checkTriggerWords(_0x5c128c,_0x473e11){const _0x49fac2={};_0x49fac2[_0x52ea21(0x3c3,0x3f5,0x370,0x3b8)]=function(_0x604c72,_0xb730f2){return _0x604c72||_0xb730f2;},_0x49fac2[_0x52ea21(0x337,0x334,0x30a,0x33f)]=function(_0x30ebc0,_0x398ef8){return _0x30ebc0===_0x398ef8;};function _0x52ea21(_0x1cd20e,_0x2c3249,_0xf4863,_0x4790f1){return _0xbaea(_0x4790f1-0x202,_0x2c3249);}function _0x4f95ee(_0x5510dd,_0x88821,_0x1e612b,_0x1c5259){return _0xbaea(_0x1e612b-0x32c,_0x88821);}_0x49fac2[_0x4f95ee(0x440,0x4a3,0x486,0x452)]='kEXBF',_0x49fac2[_0x4f95ee(0x458,0x48f,0x47e,0x48d)]=_0x52ea21(0x319,0x34f,0x395,0x363);const _0x31bb61=_0x49fac2;if(_0x31bb61['cYsrc'](!_0x5c128c,!_0x473e11))return _0x31bb61['gplLA'](_0x31bb61[_0x52ea21(0x346,0x39f,0x373,0x35c)],_0x31bb61[_0x52ea21(0x389,0x369,0x31d,0x35c)])?![]:![];const _0x59969d=_0x5c128c[_0x52ea21(0x353,0x37a,0x38a,0x364)](',')[_0x52ea21(0x350,0x3aa,0x349,0x385)](_0x1f9d48=>_0x1f9d48[_0x52ea21(0x39e,0x3af,0x391,0x3a8)]())[_0x4f95ee(0x510,0x531,0x4df,0x4d3)](_0xd4e3a6=>_0xd4e3a6);if(_0x31bb61[_0x52ea21(0x369,0x321,0x343,0x33f)](_0x59969d[_0x52ea21(0x3a1,0x388,0x3f1,0x3d2)],0x1*0x2507+-0x2059+-0x1*0x4ae))return![];for(const _0x2e3835 of _0x59969d){if(_0x31bb61[_0x52ea21(0x37b,0x34a,0x375,0x354)]===_0x31bb61['pRFwE']){if(_0x473e11['includes'](_0x2e3835))return!![];}else _0x1af1b8['add'](_0x4f95ee(0x4ae,0x4fa,0x4f1,0x4ef)+_0x54b902+'@}');}return![];}export function mergeAdjacentMessages(_0x32b7e6){function _0x44b573(_0x2c405a,_0x2c02ff,_0x331180,_0x46aae4){return _0xbaea(_0x2c02ff-0x47,_0x2c405a);}const _0x19bb8c={'APrOy':function(_0x345eb7,_0x15f798){return _0x345eb7===_0x15f798;},'RAXEo':_0x3d4a85(0x5f,0x60,0x2a,0x24),'NyFvi':function(_0x9f2f8a,_0x25453a){return _0x9f2f8a!==_0x25453a;},'MmdXT':'hqILR','pFxwP':function(_0x3ae5c0,_0x1dbf7b,_0x26a3d2){return _0x3ae5c0(_0x1dbf7b,_0x26a3d2);}};function _0x3d4a85(_0x27267d,_0x4a90d4,_0x2784b7,_0x10c636){return _0xbaea(_0x4a90d4- -0x120,_0x2784b7);}if(!_0x32b7e6||_0x19bb8c[_0x3d4a85(-0x13,0x13,0x1e,0x1b)](_0x32b7e6[_0x44b573(0x1cb,0x217,0x21a,0x1ed)],-0x75b*-0x1+-0x1c7e+0x1523)){if(_0x19bb8c['APrOy'](_0x19bb8c[_0x3d4a85(0x39,0x7d,0x8b,0x3d)],_0x19bb8c[_0x3d4a85(0x90,0x7d,0xaf,0x4a)]))return[];else{const _0x5bc66d=_0x959023?function(){function _0xf87bab(_0x3c9fb2,_0x42059b,_0x5cc637,_0x46911f){return _0x44b573(_0x42059b,_0x5cc637- -0x345,_0x5cc637-0x1c3,_0x46911f-0x144);}if(_0x44c43d){const _0x9e7a54=_0x168978[_0xf87bab(-0x1b7,-0x165,-0x184,-0x1a6)](_0xe6261b,arguments);return _0x318994=null,_0x9e7a54;}}:function(){};return _0x304fb4=![],_0x5bc66d;}}const _0x3d2b94=[];let _0x4cc63b=null;for(const _0x37244c of _0x32b7e6){if(!_0x4cc63b){const _0x310589={..._0x37244c};_0x4cc63b=_0x310589;}else{if(_0x19bb8c[_0x44b573(0x12e,0x17a,0x144,0x18c)](_0x4cc63b['role'],_0x37244c[_0x3d4a85(0x2f,0x2d,0x14,0x22)])){if(_0x19bb8c[_0x3d4a85(0x9b,0x99,0xb9,0x86)](_0x19bb8c['MmdXT'],_0x19bb8c[_0x3d4a85(0x91,0x74,0x45,0x5a)])){_0x29ba57[_0x44b573(0x1c2,0x1cc,0x202,0x1eb)](_0xfd86e1);const _0x2596a1={..._0x51a0ab};_0x4672e9=_0x2596a1;}else _0x4cc63b[_0x44b573(0x1b1,0x1f4,0x212,0x1b8)]=_0x19bb8c[_0x44b573(0x18d,0x196,0x16b,0x179)](mergeContent,_0x4cc63b[_0x3d4a85(0x68,0x8d,0xce,0x79)],_0x37244c['content']);}else{_0x3d2b94[_0x3d4a85(0x69,0x65,0x39,0x21)](_0x4cc63b);const _0x2bdd72={..._0x37244c};_0x4cc63b=_0x2bdd72;}}}return _0x4cc63b&&_0x3d2b94[_0x3d4a85(0x5d,0x65,0x77,0x9b)](_0x4cc63b),_0x3d2b94;}function mergeContent(_0x1e491a,_0xced108){const _0xb2019f={'ghdEA':function(_0x28cfab,_0x1b43c6){return _0x28cfab===_0x1b43c6;},'rLrtZ':function(_0x59fed4,_0x316980){return _0x59fed4===_0x316980;},'feqGM':function(_0x2016b6,_0xe59c77){return _0x2016b6+_0xe59c77;},'jHlLE':function(_0x310e7f,_0x5c0e5b){return _0x310e7f(_0x5c0e5b);},'GwYaU':_0x131233(-0x1a0,-0x17f,-0x174,-0x1a3)};if(_0xb2019f[_0x131233(-0x1c6,-0x172,-0x1c9,-0x1c9)](typeof _0x1e491a,_0x131233(-0x1b3,-0x1d0,-0x19e,-0x1db))&&_0xb2019f[_0x209dfd(0x2d5,0x2c1,0x2a0,0x2d5)](typeof _0xced108,_0x131233(-0x1b3,-0x165,-0x18c,-0x1e3)))return _0xb2019f['feqGM'](_0xb2019f[_0x131233(-0x17d,-0x12d,-0x16f,-0x149)](_0x1e491a,'\x0a'),_0xced108);const _0x19423c=_0xb2019f[_0x209dfd(0x25e,0x2c1,0x2b1,0x270)](normalizeToArray,_0x1e491a),_0x3d58fd=_0xb2019f[_0x209dfd(0x252,0x289,0x2a5,0x270)](normalizeToArray,_0xced108),_0x579f93={};function _0x131233(_0x7c9285,_0x5f3385,_0x40fcba,_0x390994){return _0xbaea(_0x7c9285- -0x352,_0x390994);}_0x579f93[_0x131233(-0x1ad,-0x174,-0x1f2,-0x1e9)]=_0xb2019f[_0x209dfd(0x252,0x237,0x286,0x269)];function _0x209dfd(_0x3448eb,_0x385ae9,_0xa30d2b,_0x125420){return _0xbaea(_0x125420-0x124,_0xa30d2b);}return _0x579f93['text']='\x0a',[..._0x19423c,_0x579f93,..._0x3d58fd];}function normalizeToArray(_0x54fbcf){const _0x8ee028={};_0x8ee028[_0x3f75eb(0x42d,0x41d,0x44e,0x440)]=_0x3f75eb(0x42f,0x47f,0x43d,0x3f5);function _0x5dd9cd(_0xe1c063,_0x34957b,_0x42db40,_0x4a5050){return _0xbaea(_0x4a5050- -0x30c,_0xe1c063);}function _0x3f75eb(_0x399dfd,_0x31d66a,_0x4d3d92,_0x4066af){return _0xbaea(_0x399dfd-0x27d,_0x4d3d92);}_0x8ee028[_0x3f75eb(0x3c0,0x40c,0x382,0x3cf)]=function(_0x4283a7,_0x29dacf){return _0x4283a7||_0x29dacf;};const _0x2ff163=_0x8ee028;if(Array[_0x3f75eb(0x450,0x495,0x472,0x3fd)](_0x54fbcf))return _0x54fbcf;return[{'type':_0x2ff163[_0x5dd9cd(-0x191,-0x14f,-0x115,-0x15c)],'text':_0x2ff163[_0x3f75eb(0x3c0,0x3f0,0x3d9,0x39c)](_0x54fbcf,'')}];}function _0x1070(){const _0x332b7d=['suLmuxu','DMfYAwfIBgvZ','DgvZDf9JB250zq','DhLWzq','DhjPBq','EuDXvMy','mtaWnJbzyvD4zfy','zfjsyKS','qwHNrhi','B2jQzwn0','uwnhBK0','y29UDgvUDa','CwTUwxq','qM9dr3i','BwHjyKG','CKXYDfO','Dgv4Da','zMLSDgvY','uff6zhi','ywrK','y1LZCMm','t3PdyMy','yxnZAxn0yw50','tNLgDMK','BMfTzte','vK9ztfG','D2DWyuS','zvzkqu0','uur5v2e','D2XqvxC','zePHz1O','DhjPz2DLCG','E0bNzxr3B3jSza','t255EMK','rvrRs0m','E0bZzxr2yxi6oG','teHyrKy','tuP1teq','C09IEKK','Aw5JBhvKzxm','Bw12zKW','DxnLCG','CMLHyMXLCW','z2fvCLK','DhjPz2DLCLDVCG','y2HHDe1LDgfKyq','BgvUz3rO','oerbB2TezG','E3T1C2vYFx0','AxnbCNjHEq','t1PLy2W','zMvXr00','kcGOlISPkYKRkq','vM9wzvy','v1rIvey','E0bZzxrNBg9Iyq','qvbYt3K','zMLNCW','zvj0DxO','sKDQD00','wxjMBM4','C2vHCMnO','Dg9tDhjPBMC','Df90ExbLx2nVBG','CMvWBgfJzwrwyq','E3VMRApMLOD9Fq','z3bStee','svLHquS','wxrbsfm','s2jRBve','A2POzhO','u1bSweS','BuzMyNm','CMvWBgfJzq','r3Dzyvu','r0j0Bee','yxHtDLG','mtrrDffcCMG','E0bNzxr2yxi6oG','A0fWvuO','DvrAs0u','AKHSteu','CM9Szq','zNzzELi','Cez4D1a','AgrgwxK','E3VKUjBNLyZKUABOP6BLJ5f9Fq','CfjgD0u','CMvWBgfJzufSBa','zhfRq0O','CgHoBKu','nJmYodjorxf2DxC','z0jLCeG','Bwf0y2HbBgW','yMjOsum','zwTNrum','CLrqDw8','mJyYntm1CLvrwgLT','uhfxsuu','wLbfqMe','zw50CMLLCW','zw5HyMXLza','vfDurLa','C3bSAxq','u0LUsMK','rezJsKO','BwvZC2fNzxm','t1LNtfm','EhPIAxO','rMrxAKq','CuzRs2W','yvfUv2u','Eg5eCgW','sgX5u0O','DNbJzeK','EhrFChjVzMLSzq','sM9dtwW','wfDNvey','vNbtsMC','sxjTuvO','AM9PBG','EMD4r2m','DNzer0m','tNjPBKm','rLPgDK0','E3VPGjRNLkJMNi3OO4xLKk/NLkJLIjFOOAG','phvZzxi+','yxbWBhK','DMfYoJO','mZuYnJzhrLzZrgi','u1z5rfm','E3VKUiRKUiVMLOD9Fq','AwfLtvq','D3jLwMi','A2v5CW','E0bNzxrNBg9Iyq','BwfW','C3rYAw5NAwz5','ChvZAa','mJi2otuWm2jKDgjksG','veXsteO','r2v3wg0','y29UDgv4Df9WCG','BhzHCJO6','y2jKruy','z2HKrue','mJmYng94BhfRAW','ENPczuq','zK1iuu4','wefnwfi','shnzBhm','mJaWmJy4mgfAwKTSuW','zeLgA2K','tw1Kwfq','E3VNLkJMIlFPNidMSyj9Fq','E3TNzxr2yxi6oG','EvbLwvq','qw9uz0q','y29UC3rYDwn0BW','AMndAKO','tLHVs3y','qwnXD3K','uKfyrw8','svjlCKu','C3rYAw5N','AgLZDg9YEq','svHoyuu'];_0x1070=function(){return _0x332b7d;};return _0x1070();}export function replacePlaceholder(_0x3e04da,_0x219fd8,_0x3b6cdb,_0x9755d1){const _0x30c7a1={'phNnE':function(_0x49484d,_0x42d8f2){return _0x49484d!==_0x42d8f2;},'yPeYT':_0x15f6e3(0x58,0x1c,0x7b,0x77),'bbhIC':_0x3b9d8e(0x341,0x360,0x31f,0x331),'VOYLX':function(_0x399a6c,_0x37163d){return _0x399a6c===_0x37163d;},'jjEUx':_0x15f6e3(0x2c,-0x26,0x6d,0x64),'WLyZk':function(_0x4e60fa,_0x2057c5){return _0x4e60fa===_0x2057c5;},'qFkKl':'kStKM','RUrlR':_0x15f6e3(0x50,-0x4,0x8b,0x19),'gaUrY':_0x15f6e3(0x28,0x58,0x1,0xc),'zzBeD':function(_0x21c5fc,_0x221ee2){return _0x21c5fc||_0x221ee2;},'OzCbf':function(_0x73c6b,_0x5a9235){return _0x73c6b===_0x5a9235;},'kApUJ':_0x3b9d8e(0x318,0x361,0x347,0x335),'NrinC':function(_0x2e7a1a,_0x26d3b5){return _0x2e7a1a===_0x26d3b5;},'tSAFj':_0x3b9d8e(0x334,0x2ec,0x37d,0x35a),'Mynqm':function(_0x147b8c,_0x14442c){return _0x147b8c===_0x14442c;},'GBtlA':_0x3b9d8e(0x34d,0x313,0x38b,0x308),'xnDpl':function(_0x30fe34,_0x3bbc37,_0x56751f,_0x119ad5,_0xc5852a){return _0x30fe34(_0x3bbc37,_0x56751f,_0x119ad5,_0xc5852a);}};if(_0x30c7a1[_0x3b9d8e(0x344,0x35f,0x367,0x36c)](typeof _0x3e04da,_0x30c7a1['jjEUx'])){if(_0x30c7a1[_0x15f6e3(0x48,0x84,0x27,0x19)](_0x3b9d8e(0x2bf,0x2a2,0x2da,0x30d),'JGjwM')){if(_0x3b6cdb&&_0x3e04da[_0x3b9d8e(0x352,0x374,0x33f,0x36e)](_0x219fd8)){if(_0x30c7a1['WLyZk'](_0x30c7a1[_0x15f6e3(-0xa,0x1c,-0x22,-0x4d)],_0x30c7a1['RUrlR'])){const _0xd810ff=_0x2bf272[_0x3b9d8e(0x303,0x2dd,0x30b,0x2ca)](_0x42618c,arguments);return _0x5d22bf=null,_0xd810ff;}else{if(_0x9755d1){if(_0x30c7a1[_0x15f6e3(0x48,0x70,0x1d,0x92)](_0x30c7a1[_0x3b9d8e(0x356,0x313,0x3a9,0x393)],_0x3b9d8e(0x324,0x2da,0x2db,0x34a)))_0x9755d1[_0x3b9d8e(0x33e,0x320,0x31a,0x2ef)](_0x219fd8);else for(const _0x3a57e6 of _0x2aa436['history']){if(_0x3a57e6[_0x3b9d8e(0x354,0x3a4,0x33f,0x35f)]&&_0x30c7a1[_0x3b9d8e(0x2de,0x2a6,0x32d,0x28e)](_0x3a57e6['user']['trim'](),'')){const _0x1770f6={};_0x1770f6[_0x3b9d8e(0x2d6,0x2ca,0x2da,0x2f0)]=_0x30c7a1[_0x15f6e3(0x24,0x77,0x17,0x5d)],_0x1770f6[_0x3b9d8e(0x336,0x305,0x366,0x334)]=_0x3a57e6[_0x15f6e3(0x58,0x90,0x93,0x72)],_0xed26de[_0x15f6e3(0x12,-0x15,-0x25,0x11)](_0x1770f6);}if(_0x3a57e6[_0x15f6e3(0x45,0x1b,0x80,-0x9)]&&_0x30c7a1[_0x15f6e3(-0x1e,0xd,0x31,-0x4e)](_0x3a57e6[_0x15f6e3(0x45,0x8f,0x4c,0x6)][_0x3b9d8e(0x32f,0x35e,0x32b,0x312)](),'')){const _0x584159={};_0x584159['role']=_0x30c7a1[_0x15f6e3(-0x1a,-0x5f,-0x16,0x38)],_0x584159['content']=_0x3a57e6['assistant'],_0x5b8f0a[_0x15f6e3(0x12,0x36,0x5b,0x2)](_0x584159);}}}}}return _0x3e04da[_0x15f6e3(-0x20,-0x72,-0x24,-0x21)](_0x219fd8,_0x30c7a1[_0x3b9d8e(0x317,0x352,0x30a,0x2dc)](_0x3b6cdb,''));}else _0x3a5c24['add'](_0x33dd33[-0xd41+0xd8d*0x1+0x5*-0xf]);}if(Array[_0x15f6e3(0x60,0x43,0x30,0x99)](_0x3e04da)){if(_0x30c7a1[_0x3b9d8e(0x340,0x30e,0x334,0x33e)](_0x30c7a1[_0x3b9d8e(0x2d3,0x311,0x30a,0x2b7)],'ghnNL')){const _0x4ecdeb={};_0x4ecdeb['role']=_0x30c7a1[_0x3b9d8e(0x320,0x2f2,0x34a,0x357)],_0x4ecdeb[_0x15f6e3(0x3a,0x10,0x2d,0x6d)]=_0x10938c[_0x15f6e3(0x58,0x6d,0x58,0x1c)],_0x383967['push'](_0x4ecdeb);}else return _0x3e04da[_0x3b9d8e(0x30c,0x336,0x335,0x360)](_0x2eb215=>replacePlaceholder(_0x2eb215,_0x219fd8,_0x3b6cdb,_0x9755d1));}function _0x15f6e3(_0x3cd072,_0xfd28e0,_0x3b0c74,_0x6bb3fb){return _0xbaea(_0x3cd072- -0x173,_0xfd28e0);}if(_0x3e04da&&_0x30c7a1[_0x15f6e3(0x3,0x56,-0x4e,-0x34)](typeof _0x3e04da,_0x30c7a1['tSAFj'])){if(_0x30c7a1['Mynqm'](_0x15f6e3(-0x3,0x24,0x2,-0x3),_0x30c7a1[_0x15f6e3(-0x2d,0x1b,0x7,-0x3d)])){if(_0x354139[_0x15f6e3(0x56,0x94,0x66,0x3a)](_0x107146))return!![];}else{const _0x280184={};for(const _0x64926 in _0x3e04da){_0x280184[_0x64926]=_0x30c7a1[_0x15f6e3(-0x8,0x19,-0x46,0xa)](replacePlaceholder,_0x3e04da[_0x64926],_0x219fd8,_0x3b6cdb,_0x9755d1);}return _0x280184;}}function _0x3b9d8e(_0x23cd4f,_0x1804a6,_0x27c66a,_0x302b7c){return _0xbaea(_0x23cd4f-0x189,_0x1804a6);}return _0x3e04da;}export function replaceAllPlaceholders(_0x26c329,_0x20bd10){const _0x362ef7={'VoVeV':function(_0x4aa542){return _0x4aa542();},'jcCjJ':_0x3fafd5(0x507,0x525,0x53c,0x545),'VpSJg':_0x3fafd5(0x517,0x51e,0x50a,0x4ec),'rTPuo':_0x3fafd5(0x4b0,0x4ae,0x4b0,0x4f1),'uONcp':function(_0x2e47ba,_0x3dbd29,_0x5f580e,_0x26107d,_0x5e2d56){return _0x2e47ba(_0x3dbd29,_0x5f580e,_0x26107d,_0x5e2d56);},'DFcJJ':_0x24101d(0x437,0x448,0x414,0x3f1),'KbkmQ':function(_0x1fedbe,_0x21f02c,_0x253eb6,_0x536bc2,_0x21115d){return _0x1fedbe(_0x21f02c,_0x253eb6,_0x536bc2,_0x21115d);},'PqWIE':_0x3fafd5(0x470,0x480,0x4c9,0x4af),'nQPju':function(_0x15a96d,_0x5bd0df,_0xd14c9b,_0x3aa85f,_0x500640){return _0x15a96d(_0x5bd0df,_0xd14c9b,_0x3aa85f,_0x500640);},'Acqwy':function(_0x1afdd9,_0xb8be1a,_0x4508e8,_0x45f863,_0x4dba9a){return _0x1afdd9(_0xb8be1a,_0x4508e8,_0x45f863,_0x4dba9a);},'TLRLJ':_0x24101d(0x45e,0x487,0x484,0x416)+'}}','BoCGr':function(_0x1a75ac,_0x5c2cb2,_0x4cace3,_0x568306,_0x2e2bd4){return _0x1a75ac(_0x5c2cb2,_0x4cace3,_0x568306,_0x2e2bd4);},'cbdEF':'{{通用角色启用列表'+'}}','isXKU':function(_0x258b9a,_0x52910e,_0x4a6c0d,_0x3b97e0,_0x921752){return _0x258b9a(_0x52910e,_0x4a6c0d,_0x3b97e0,_0x921752);},'GTwce':_0x24101d(0x47b,0x4a4,0x4b0,0x4a0),'xRUcY':function(_0x1d93ba,_0x39c5a3){return _0x1d93ba!==_0x39c5a3;},'gBepH':'PUAkE','wlPUw':function(_0x44cf51,_0x27fbd6,_0xcaed1d,_0x4fdbdf,_0xa557b8){return _0x44cf51(_0x27fbd6,_0xcaed1d,_0x4fdbdf,_0xa557b8);}},{context:context='',body:body='',worldBookContent:worldBookContent='',variables:variables={},userDemand:userDemand='',characterListText:characterListText='',outfitEnableListText:outfitEnableListText='',commonCharacterListText:commonCharacterListText=''}=_0x20bd10,_0x1ae3d4=new Set();let _0xe683d4=_0x26c329;const _0x29edbb=_0x362ef7[_0x24101d(0x416,0x3d2,0x450,0x3e2)](getContext),_0x51d9a5=_0x29edbb?.[_0x24101d(0x4a0,0x49a,0x4db,0x485)]||'';let _0x1da3db=worldBookContent;_0x1da3db&&(_0x1da3db=_0x1da3db[_0x3fafd5(0x4e7,0x494,0x48b,0x4c6)](_0x362ef7[_0x3fafd5(0x53b,0x527,0x4ce,0x50d)],_0x51d9a5),_0x1da3db=_0x1da3db[_0x24101d(0x439,0x414,0x40e,0x484)](_0x362ef7[_0x24101d(0x457,0x460,0x459,0x411)],_0x51d9a5));_0xe683d4=replacePlaceholder(_0xe683d4,_0x362ef7[_0x3fafd5(0x4c4,0x4b0,0x493,0x4ce)],context,_0x1ae3d4),_0xe683d4=_0x362ef7['uONcp'](replacePlaceholder,_0xe683d4,_0x362ef7[_0x3fafd5(0x503,0x4a4,0x4cb,0x4d7)],_0x1da3db,_0x1ae3d4),_0xe683d4=_0x362ef7[_0x3fafd5(0x4c4,0x464,0x4f0,0x4b3)](replacePlaceholder,_0xe683d4,_0x362ef7[_0x24101d(0x443,0x47c,0x433,0x412)],body,_0x1ae3d4),_0xe683d4=_0x362ef7['nQPju'](replacePlaceholder,_0xe683d4,'{{角色启用列表}}',characterListText,_0x1ae3d4),_0xe683d4=_0x362ef7[_0x3fafd5(0x4e1,0x4d3,0x554,0x50f)](replacePlaceholder,_0xe683d4,_0x362ef7[_0x24101d(0x46d,0x484,0x421,0x490)],outfitEnableListText,_0x1ae3d4),_0xe683d4=_0x362ef7[_0x3fafd5(0x539,0x532,0x558,0x522)](replacePlaceholder,_0xe683d4,_0x362ef7[_0x3fafd5(0x50d,0x51d,0x526,0x4fe)],commonCharacterListText,_0x1ae3d4),_0xe683d4=_0x362ef7['isXKU'](replacePlaceholder,_0xe683d4,_0x362ef7['GTwce'],userDemand,_0x1ae3d4);if(variables&&Object[_0x3fafd5(0x51d,0x536,0x4af,0x4f4)](variables)[_0x24101d(0x4b6,0x4b2,0x47c,0x487)]>0x1619+0xfaa+0x565*-0x7){const _0x2fae0c=/\{\{getvar::([^}]+)\}\}/g,_0x356823=JSON[_0x24101d(0x46a,0x4b9,0x4a9,0x452)](_0xe683d4),_0x4ec281=[..._0x356823['matchAll'](_0x2fae0c)],_0x34276f=new Set();for(const _0x3a304 of _0x4ec281){if(_0x362ef7['xRUcY'](_0x362ef7[_0x24101d(0x43d,0x45d,0x443,0x450)],_0x362ef7[_0x3fafd5(0x4e5,0x51a,0x480,0x4ca)]))return![];else _0x34276f[_0x24101d(0x49b,0x49a,0x45c,0x4dd)](_0x3a304[-0x2*0x1304+-0x12fe+0x3907]);}for(const _0x4c8ba1 of _0x34276f){const _0x517241=_0x24101d(0x47c,0x4c6,0x46e,0x46a)+_0x4c8ba1+'}}',_0x3426fd=variables[_0x4c8ba1]||'';_0xe683d4=_0x362ef7[_0x24101d(0x4a5,0x48d,0x49f,0x4e0)](replacePlaceholder,_0xe683d4,_0x517241,_0x3426fd,_0x1ae3d4);}}_0xe683d4=processVariablePlaceholdersInMessages(_0xe683d4,_0x1ae3d4);const _0x1d36ae={};function _0x24101d(_0x5ea2da,_0x299eb6,_0x2f4faf,_0x39ec1c){return _0xbaea(_0x5ea2da-0x2e6,_0x2f4faf);}function _0x3fafd5(_0x1f86dd,_0x28c62b,_0x217e62,_0x266dd1){return _0xbaea(_0x266dd1-0x373,_0x1f86dd);}return _0x1d36ae[_0x24101d(0x44b,0x47c,0x45f,0x42d)]=_0xe683d4,_0x1d36ae[_0x24101d(0x421,0x415,0x43f,0x442)+_0x24101d(0x4b2,0x4b6,0x495,0x482)]=_0x1ae3d4,_0x1d36ae;}function processVariablePlaceholdersInMessages(_0x225c8d,_0x3d4eee){function _0x4e4954(_0x280b51,_0x33a9ee,_0x2c09e5,_0x9a31f5){return _0xbaea(_0x280b51- -0xb9,_0x9a31f5);}const _0x4bbc48={'wpwaw':function(_0x324aff,_0x3b0f7a,_0x2a05cf,_0x3fa4a1){return _0x324aff(_0x3b0f7a,_0x2a05cf,_0x3fa4a1);},'YtAHS':function(_0x4b31f0,_0x954cb6){return _0x4b31f0===_0x954cb6;},'XAMXR':function(_0x47c1f0,_0x4e14c3){return _0x47c1f0===_0x4e14c3;},'dqkCJ':_0x4d32fa(0x422,0x3f6,0x3dd,0x3a9)};if(!_0x225c8d||_0x4bbc48[_0x4d32fa(0x370,0x381,0x3b6,0x3cd)](_0x225c8d['length'],0x1b47+-0x1382+-0x33*0x27))return _0x225c8d;const _0x5d8efe=getContext();function _0x4d32fa(_0x2678dd,_0x28b597,_0x219f19,_0x12b1a3){return _0xbaea(_0x219f19-0x277,_0x12b1a3);}return!_0x5d8efe[_0x4d32fa(0x44d,0x498,0x446,0x425)+'ta']&&(_0x4bbc48[_0x4e4954(0xd7,0x10c,0xcb,0x109)](_0x4bbc48[_0x4d32fa(0x3b4,0x3ee,0x3cb,0x3e7)],_0x4bbc48[_0x4e4954(0x9b,0x77,0x73,0x86)])?_0x5d8efe['chatMetada'+'ta']={}:_0x28a6ec[_0x4d32fa(0x41e,0x407,0x42c,0x448)](_0x4e4954(0x109,0xc8,0x13c,0x108)+_0x4e4954(0xc2,0xe8,0xc6,0xa3)+_0x3f5b30+'@}')),!_0x5d8efe[_0x4e4954(0x116,0x136,0x14d,0xc8)+'ta'][_0x4d32fa(0x44a,0x405,0x41a,0x429)]&&(_0x5d8efe[_0x4e4954(0x116,0x10f,0x137,0x10b)+'ta'][_0x4d32fa(0x3ef,0x42d,0x41a,0x3e7)]={}),_0x225c8d[_0x4d32fa(0x440,0x3b3,0x3fa,0x3b3)](_0x112f16=>{if(!_0x112f16||!_0x112f16[_0xe97c41(-0x153,-0x17a,-0x1b5,-0x165)])return _0x112f16;function _0xe97c41(_0x504654,_0x4aabc8,_0x120957,_0xf1dd0){return _0x4e4954(_0xf1dd0- -0x259,_0x4aabc8-0x5d,_0x120957-0x151,_0x504654);}return{..._0x112f16,'content':_0x4bbc48['wpwaw'](processContentVariables,_0x112f16['content'],_0x5d8efe,_0x3d4eee)};});}function processContentVariables(_0x35fe61,_0x3a8b8b,_0x30fed2){function _0x2e38e4(_0x8636bc,_0x1013cb,_0x56abfd,_0x5a3504){return _0xbaea(_0x8636bc- -0x240,_0x56abfd);}const _0xefc3d8={'nehrt':function(_0x330d51,_0x48410c,_0x4f0802,_0x1d7667,_0x394dbc){return _0x330d51(_0x48410c,_0x4f0802,_0x1d7667,_0x394dbc);},'ZPEBa':function(_0x232caa,_0x33a04c){return _0x232caa===_0x33a04c;},'JoCMl':function(_0x1a8547,_0x4fd98f){return _0x1a8547+_0x4fd98f;},'eRtuz':_0x564c47(0xd9,0xa2,0xc9,0xb7),'uTZKE':function(_0x51c61c,_0x45b7e3){return _0x51c61c===_0x45b7e3;},'QDyWa':_0x564c47(0xeb,0xc5,0xc0,0x109),'JCYXt':function(_0x560c31,_0x15c4b8,_0xe4e079,_0x173ea9){return _0x560c31(_0x15c4b8,_0xe4e079,_0x173ea9);},'eVJAM':function(_0x421e69,_0x35550d){return _0x421e69===_0x35550d;},'yGqVf':_0x2e38e4(-0xa1,-0x9b,-0xac,-0xca),'AhgDr':function(_0x50ac2b,_0xc17536){return _0x50ac2b!==_0xc17536;},'WTbTF':_0x2e38e4(-0xaf,-0xc5,-0xb9,-0xe5),'qknYt':'eeuth'};if(_0xefc3d8[_0x564c47(0xf9,0xb4,0xd4,0x8a)](typeof _0x35fe61,_0xefc3d8[_0x564c47(0xc4,0x8c,0xbe,0x10e)])){if(_0xefc3d8[_0x564c47(0xa8,0xf2,0xc1,0x101)](_0xefc3d8[_0x564c47(0xb,0x6c,0x48,0x86)],_0xefc3d8[_0x2e38e4(-0x92,-0x4b,-0x5f,-0xd7)]))return _0xefc3d8['JCYXt'](processStringVariables,_0x35fe61,_0x3a8b8b,_0x30fed2);else _0xfbc32f[_0x41faef]=_0xefc3d8['nehrt'](_0x1d06d3,_0x154fe1[_0x37e05c],_0x1a818f,_0x31f41c,_0xf7f87e);}if(Array[_0x2e38e4(-0x6d,-0x75,-0x4d,-0x46)](_0x35fe61))return _0x35fe61['map'](_0x16ef46=>{const _0x117670={'IYaAK':function(_0x4d3703,_0x3c6f5a){function _0x126319(_0x4ac558,_0x40cc56,_0x1f22e4,_0x52a0dc){return _0xbaea(_0x1f22e4-0x148,_0x40cc56);}return _0xefc3d8[_0x126319(0x255,0x298,0x2a6,0x281)](_0x4d3703,_0x3c6f5a);},'sObzI':'string','dJagZ':function(_0x509c12,_0x1583a6){function _0x30ed69(_0x6e89d3,_0x26cadd,_0x1a2f99,_0x28a5a0){return _0xbaea(_0x6e89d3- -0x2a5,_0x1a2f99);}return _0xefc3d8[_0x30ed69(-0x136,-0x139,-0x138,-0x122)](_0x509c12,_0x1583a6);},'hdFYy':function(_0x3040a8,_0x3667bc){return _0x3040a8(_0x3667bc);},'SInJi':_0x402390(-0x260,-0x22c,-0x221,-0x207)};function _0x58bf50(_0x32f176,_0x4869cb,_0x5adcf1,_0x242bc6){return _0x564c47(_0x32f176,_0x4869cb-0x178,_0x242bc6- -0x106,_0x242bc6-0x68);}function _0x402390(_0x3d9206,_0x44bd2e,_0x3dc8ab,_0x1aa24d){return _0x2e38e4(_0x3dc8ab- -0x193,_0x44bd2e-0x12a,_0x1aa24d,_0x1aa24d-0x18e);}if(_0xefc3d8['ZPEBa'](_0x402390(-0x223,-0x25e,-0x256,-0x21c),_0x58bf50(-0x28,-0x68,-0x5c,-0x72))){if(_0x16ef46&&_0x16ef46['type']===_0xefc3d8[_0x402390(-0x266,-0x2d1,-0x29e,-0x2cd)]&&_0xefc3d8[_0x58bf50(-0xcc,-0xad,-0xf5,-0xa4)](typeof _0x16ef46['text'],_0x58bf50(-0x3d,-0x74,-0x72,-0x50))){if(_0xefc3d8[_0x402390(-0x1e5,-0x238,-0x215,-0x234)]!==_0xefc3d8['QDyWa']){const _0x2910a2=_0x848b08['trim'](),_0xd809fb=_0x54b958[_0x402390(-0x1d0,-0x222,-0x204,-0x247)+'ta'][_0x402390(-0x239,-0x1fa,-0x230,-0x234)][_0x2910a2]||'';return _0x194e84&&_0x362c9e[_0x402390(-0x233,-0x234,-0x21e,-0x20b)](_0x402390(-0x2c5,-0x2c7,-0x28a,-0x2bc)+_0x2910a2+'@}'),_0xd809fb;}else return{..._0x16ef46,'text':_0xefc3d8['JCYXt'](processStringVariables,_0x16ef46['text'],_0x3a8b8b,_0x30fed2)};}return _0x16ef46;}else{if(_0x117670[_0x402390(-0x2a7,-0x286,-0x295,-0x263)](typeof _0x588e24,_0x117670[_0x58bf50(0xe,-0x24,-0x21,-0x27)])&&_0x117670['IYaAK'](typeof _0x4f3481,_0x402390(-0x268,-0x21b,-0x234,-0x234)))return _0x117670[_0x402390(-0x22c,-0x1d7,-0x213,-0x24c)](_0x117670['dJagZ'](_0x8ccd43,'\x0a'),_0x74b5ff);const _0xc6c17=_0x4392ce(_0x1ef058),_0x56f914=_0x117670[_0x402390(-0x243,-0x2bf,-0x283,-0x2aa)](_0x53c52e,_0x49c882),_0x5e55d2={};return _0x5e55d2['type']=_0x117670[_0x402390(-0x2b8,-0x2a2,-0x270,-0x251)],_0x5e55d2[_0x58bf50(-0x5f,-0x15,-0x32,-0x3d)]='\x0a',[..._0xc6c17,_0x5e55d2,..._0x56f914];}});function _0x564c47(_0x430e64,_0x3bcd9d,_0x1c957b,_0x1a97ac){return _0xbaea(_0x1c957b- -0xe9,_0x430e64);}return _0x35fe61;}function processStringVariables(_0x113c15,_0x2d08e8,_0x45f159){const _0x2538b7={'Yrfnn':function(_0x5833c4,_0x48a5d5,_0x51e49d,_0x565824,_0x379747){return _0x5833c4(_0x48a5d5,_0x51e49d,_0x565824,_0x379747);},'ttHPY':function(_0x4527d4,_0x478729){return _0x4527d4!==_0x478729;},'PQzdr':_0x235a52(0x327,0x31a,0x344,0x315),'MJuLD':_0x235a52(0x345,0x327,0x336,0x329),'jerJZ':function(_0x1b3386,_0x1d69a9){return _0x1b3386(_0x1d69a9);},'SPlXK':function(_0x140052,_0x21c97e){return _0x140052===_0x21c97e;},'zgxGc':_0xad06dd(-0x17f,-0x1cb,-0x18f,-0x181),'OZecl':function(_0x2b1b92,_0x497047){return _0x2b1b92===_0x497047;},'iaeMT':_0xad06dd(-0x100,-0xae,-0x130,-0xd2),'HlySJ':'QLYKz'};function _0xad06dd(_0x354dd9,_0x404747,_0x845612,_0x33cad9){return _0xbaea(_0x354dd9- -0x2c6,_0x33cad9);}if(!_0x113c15)return _0x113c15;function _0x235a52(_0x1e9bd4,_0x2a49a9,_0x144cfc,_0x470e9d){return _0xbaea(_0x144cfc-0x1cf,_0x470e9d);}let _0x1e1fa9=_0x113c15;return _0x1e1fa9=_0x1e1fa9[_0x235a52(0x2d9,0x2c3,0x313,0x346)](/\{@setvar::([^:@]+)::([\s\S]*?)@\}/g,(_0x15060b,_0x3306d7,_0x3d0ce7)=>{function _0x2cc257(_0x300dea,_0x1d00b3,_0x6bc939,_0x2c83e2){return _0xad06dd(_0x2c83e2-0x3e0,_0x1d00b3-0xa,_0x6bc939-0xa3,_0x300dea);}function _0x54359c(_0x2ab54a,_0x10bb64,_0x3ce6e7,_0x4e3fa2){return _0xad06dd(_0x10bb64-0x17b,_0x10bb64-0xf,_0x3ce6e7-0x3c,_0x3ce6e7);}const _0x5c779e=_0x3306d7['trim']();return _0x2d08e8['chatMetada'+'ta']['variables'][_0x5c779e]=_0x3d0ce7,_0x45f159&&_0x45f159[_0x54359c(0xb2,0x6a,0x26,0xa9)](_0x54359c(0x67,0x7a,0x35,0xb0)+_0x5c779e+'@}'),'';}),_0x1e1fa9=_0x1e1fa9[_0xad06dd(-0x182,-0x1cc,-0x14f,-0x154)](/\{@getvar::([^@]+)@\}/g,(_0x2767d4,_0x26d81d)=>{function _0x4716d9(_0x41a6e1,_0x282eab,_0x5a878c,_0x5cc8be){return _0x235a52(_0x41a6e1-0x49,_0x282eab-0x79,_0x5cc8be-0x203,_0x282eab);}const _0x2d762=_0x26d81d[_0x3acba3(0x364,0x314,0x328,0x2fb)](),_0x1a932e=_0x2d08e8[_0x3acba3(0x340,0x33d,0x319,0x363)+'ta']['variables'][_0x2d762]||'';function _0x3acba3(_0x18a9c7,_0x2313e9,_0x31c390,_0x23d9d5){return _0xad06dd(_0x2313e9-0x434,_0x2313e9-0x164,_0x31c390-0x4a,_0x31c390);}if(_0x45f159){if(_0x2538b7['ttHPY'](_0x3acba3(0x2c5,0x2d6,0x2aa,0x2e7),_0x3acba3(0x2d1,0x2d6,0x2d4,0x29b))){const _0x69a67b=/\{\{getvar::([^}]+)\}\}/g,_0x2449b4=_0x51597b[_0x4716d9(0x57e,0x517,0x59c,0x556)](_0x26c585),_0x5a6327=[..._0x2449b4[_0x4716d9(0x558,0x528,0x538,0x52a)](_0x69a67b)],_0x26deee=new _0x5057da();for(const _0x4c5f3d of _0x5a6327){_0x26deee[_0x3acba3(0x31c,0x323,0x36e,0x33f)](_0x4c5f3d[-0x1*0xbee+0xb*-0x2c7+-0x2*-0x153e]);}for(const _0x2399d9 of _0x26deee){const _0x19897e=_0x4716d9(0x571,0x52b,0x530,0x568)+_0x2399d9+'}}',_0x436529=_0x29b1bf[_0x2399d9]||'';_0x143de5=_0x2538b7[_0x3acba3(0x279,0x2a5,0x2f7,0x2df)](_0x456a57,_0x40239d,_0x19897e,_0x436529,_0x1a368d);}}else _0x45f159[_0x4716d9(0x595,0x5d0,0x54e,0x587)]('{@getvar::'+_0x2d762+'@}');}return _0x1a932e;}),_0x1e1fa9=_0x1e1fa9[_0xad06dd(-0x182,-0x13d,-0x164,-0x15b)](/\{@setglobalvar::([^:@]+)::([\s\S]*?)@\}/g,(_0x17e7b5,_0x2e2cb5,_0x2c09ce)=>{function _0x21317d(_0x432a4d,_0x2d6d5f,_0x1c875c,_0x12760a){return _0xad06dd(_0x1c875c- -0x7a,_0x2d6d5f-0x17f,_0x1c875c-0x23,_0x2d6d5f);}function _0x1ed154(_0x312576,_0x3571d5,_0x574dc8,_0xa613fc){return _0x235a52(_0x312576-0x159,_0x3571d5-0x46,_0x312576- -0x1c3,_0x574dc8);}if(_0x2538b7[_0x1ed154(0x1c0,0x1d3,0x189,0x1be)]!==_0x2538b7[_0x1ed154(0x1d3,0x18b,0x1d1,0x1b8)]){const _0x5ba45e=_0x2e2cb5[_0x1ed154(0x1b2,0x199,0x161,0x1e0)]();return setglobalvar(_0x5ba45e,_0x2c09ce),_0x45f159&&_0x45f159[_0x21317d(-0x1c5,-0x1b6,-0x18b,-0x1b1)](_0x21317d(-0x230,-0x261,-0x20e,-0x216)+'lvar::'+_0x5ba45e+'@}'),'';}else return{..._0x4d153c,'text':_0x22bbc0(_0x4fb278['text'],_0x3d8f5c,_0x29c2a3)};}),_0x1e1fa9=_0x1e1fa9[_0x235a52(0x334,0x31b,0x313,0x353)](/\{@getglobalvar::([^@]+)@\}/g,(_0x1c60c0,_0x18214d)=>{const _0x2014f7=_0x18214d[_0x1c4efe(0x99,0x89,0xd8,0x111)](),_0x38648a=_0x2538b7['jerJZ'](getglobalvar,_0x2014f7)||'';function _0x295be5(_0x5e7db7,_0x11a9b0,_0x435675,_0x4a25e4){return _0xad06dd(_0x5e7db7-0x360,_0x11a9b0-0x11,_0x435675-0x111,_0x435675);}function _0x1c4efe(_0x22729d,_0x193bc2,_0x5af869,_0x2fecf7){return _0xad06dd(_0x5af869-0x1f8,_0x193bc2-0x141,_0x5af869-0x55,_0x22729d);}if(_0x45f159){if(_0x2538b7[_0x1c4efe(0x65,0x90,0x74,0x23)](_0x295be5(0x1e1,0x21b,0x227,0x203),_0x2538b7[_0x295be5(0x20e,0x1f9,0x1f8,0x1de)]))_0x45f159[_0x1c4efe(0xbc,0xe3,0xe7,0x120)](_0x295be5(0x21c,0x1e7,0x216,0x222)+'lvar::'+_0x2014f7+'@}');else return!![];}return _0x38648a;}),_0x1e1fa9=_0x1e1fa9['replace'](/\{@getworldvar::([^@]+)@\}/g,(_0x3d1fc7,_0x373a81)=>{function _0x5986c4(_0xbb525e,_0x31a363,_0x5c7c64,_0x894e9a){return _0x235a52(_0xbb525e-0xc,_0x31a363-0x1f3,_0x5c7c64- -0x193,_0xbb525e);}function _0x51d316(_0x36045c,_0x47637f,_0x3f6dd0,_0x2769a2){return _0xad06dd(_0x3f6dd0-0x162,_0x47637f-0x4e,_0x3f6dd0-0x6b,_0x47637f);}if(_0x2538b7[_0x5986c4(0x1bc,0x21e,0x210,0x245)](_0x2538b7[_0x5986c4(0x1aa,0x1ac,0x1bb,0x178)],_0x2538b7[_0x51d316(-0x3d,-0x1d,0x8,-0x3)])){if(_0x183a85){const _0x22aadf=_0x43152f['apply'](_0x388fad,arguments);return _0x47dbc4=null,_0x22aadf;}}else{const _0x3d19f9=_0x373a81[_0x51d316(-0x9,0x6,0x42,0x50)](),_0x1bc375=_0x2538b7['jerJZ'](getworldvar,_0x3d19f9)||'';return _0x45f159&&_0x45f159[_0x5986c4(0x21a,0x1b2,0x1f1,0x1b9)](_0x5986c4(0x1e6,0x1c9,0x1fe,0x1f6)+_0x5986c4(0x1e3,0x1b2,0x1b7,0x169)+_0x3d19f9+'@}'),_0x1bc375;}}),_0x1e1fa9;}export function buildPromptWithTrigger(_0x41aafd){const _0x528671={'GewXm':function(_0x1e91e5,_0x3911c0,_0x55b9e1){return _0x1e91e5(_0x3911c0,_0x55b9e1);},'FEUcQ':function(_0x1e8d3e,_0x2b8584){return _0x1e8d3e===_0x2b8584;},'FZFvM':_0x14b80a(-0x70,-0x8a,-0x65,-0xa0),'aQnWe':function(_0x13736a,_0x5f4d80){return _0x13736a!==_0x5f4d80;},'kjhdz':function(_0x4e559d,_0x16000c){return _0x4e559d!==_0x16000c;},'AoTgD':function(_0x312c52,_0x45667b){return _0x312c52(_0x45667b);}};function _0x14b80a(_0x2dfbc7,_0x5322a4,_0xe54300,_0x14561d){return _0xbaea(_0xe54300- -0x230,_0x14561d);}const {requestType:_0x183d37,contextData:_0xc39d3e}=_0x41aafd,_0x468703=extension_settings[extensionName]?.['llm_reques'+_0x1ff2e4(-0x97,-0x75,-0x45,-0x8d)+_0x1ff2e4(-0x3c,-0x7b,-0xad,-0xbe)]||{},_0x50e282={};function _0x1ff2e4(_0x4fe110,_0x579a,_0x3f8384,_0x4dd320){return _0xbaea(_0x579a- -0x1af,_0x4dd320);}_0x50e282[_0x14b80a(-0xb8,-0xaf,-0xa7,-0xbb)+'ofile']='默认';const _0x3bee9a=_0x468703[_0x183d37]||_0x50e282,_0x5b141a=_0x3bee9a[_0x14b80a(-0xc7,-0xb5,-0xa7,-0xea)+'ofile']||'默认',_0x4e10aa=extension_settings[extensionName]?.[_0x1ff2e4(-0x3b,-0xb,-0x2b,-0x4)+_0x14b80a(-0xbd,-0x96,-0xc2,-0xad)+'s']||{},_0x3eaedf=_0x4e10aa[_0x5b141a]||_0x4e10aa[Object[_0x1ff2e4(-0x5f,-0x2e,0xa,-0x3d)](_0x4e10aa)[0xaad*-0x1+0x3ba+0x1*0x6f3]]||{},{context:context='',body:body='',worldBookContent:worldBookContent='',userDemand:userDemand=''}=_0xc39d3e,_0x2d954c=[userDemand,context,body,worldBookContent]['filter'](Boolean)[_0x14b80a(-0xe8,-0x7f,-0xbd,-0x95)]('\x0a'),_0x178468=[];if(_0x3eaedf[_0x14b80a(-0x10e,-0x8c,-0xd1,-0xe5)]&&Array[_0x1ff2e4(0x51,0x24,0x2a,-0x12)](_0x3eaedf[_0x1ff2e4(-0x42,-0x50,-0x6e,-0x68)]))for(const _0x25f12c of _0x3eaedf[_0x14b80a(-0x93,-0x124,-0xd1,-0xbe)]){if(!_0x25f12c[_0x1ff2e4(-0x6b,-0x4f,-0x71,-0x1e)])continue;if(!_0x25f12c[_0x14b80a(-0x4e,-0x41,-0x83,-0xd3)]||_0x528671['FEUcQ'](_0x25f12c[_0x14b80a(-0x69,-0x6e,-0x83,-0x81)][_0x14b80a(-0xab,-0x7f,-0x8a,-0x3a)](),''))continue;if(_0x25f12c['triggerMod'+'e']===_0x14b80a(-0xb6,-0xac,-0x6f,-0x6a)){if(!_0x528671[_0x1ff2e4(-0x1d,-0x27,0x20,0x1d)](checkTriggerWords,_0x25f12c[_0x14b80a(-0x23,-0xb2,-0x62,-0xb1)+'ds'],_0x2d954c))continue;}const _0x3ab5fe={};_0x3ab5fe[_0x1ff2e4(-0x84,-0x62,-0x81,-0xa0)]=_0x25f12c[_0x14b80a(-0xae,-0xfa,-0xe3,-0x113)]||_0x528671[_0x1ff2e4(-0x4b,-0x38,-0xb,-0x21)],_0x3ab5fe[_0x1ff2e4(0x33,-0x2,-0x25,0x2a)]=_0x25f12c[_0x1ff2e4(0x1f,-0x2,-0x53,0x4c)],_0x178468[_0x14b80a(-0x66,-0x87,-0xab,-0xf9)](_0x3ab5fe);}else{if(_0x3eaedf[_0x14b80a(-0x7a,-0x63,-0x90,-0x3f)]&&Array[_0x1ff2e4(0x48,0x24,0x5e,-0x4)](_0x3eaedf[_0x14b80a(-0x8c,-0x7a,-0x90,-0x9a)]))for(const _0x2d61d1 of _0x3eaedf[_0x1ff2e4(0x23,-0xf,0xc,-0x25)]){if(_0x2d61d1['user']&&_0x528671[_0x14b80a(-0x104,-0x97,-0xc6,-0x10c)](_0x2d61d1[_0x1ff2e4(-0x11,0x1c,0x33,0x51)][_0x14b80a(-0x72,-0x98,-0x8a,-0x99)](),'')){if(_0x528671['aQnWe'](_0x1ff2e4(-0x7d,-0x61,-0x33,-0x85),_0x14b80a(-0x119,-0x93,-0xe2,-0x111)))_0x3a321b['content']=_0x528671['GewXm'](_0x22bdb3,_0x136718[_0x14b80a(-0x54,-0x31,-0x83,-0xc8)],_0x24aa3d[_0x14b80a(-0x95,-0xd6,-0x83,-0x4a)]);else{const _0x3521bd={};_0x3521bd['role']=_0x528671[_0x14b80a(-0xc3,-0x86,-0xb9,-0x7e)],_0x3521bd[_0x1ff2e4(0x4,-0x2,-0x3f,0x0)]=_0x2d61d1[_0x1ff2e4(0x47,0x1c,0x19,0x4f)],_0x178468['push'](_0x3521bd);}}if(_0x2d61d1[_0x1ff2e4(-0x2a,0x9,0xa,0x0)]&&_0x528671[_0x14b80a(-0xb3,-0x11f,-0xef,-0xb4)](_0x2d61d1[_0x14b80a(-0x4d,-0x9a,-0x78,-0x44)][_0x14b80a(-0x83,-0x86,-0x8a,-0x7b)](),'')){const _0x4377e8={};_0x4377e8[_0x14b80a(-0xd7,-0xee,-0xe3,-0xa4)]=_0x1ff2e4(0x4,0x9,-0x2b,0x21),_0x4377e8[_0x1ff2e4(-0x4f,-0x2,0x42,0x44)]=_0x2d61d1[_0x1ff2e4(0x4,0x9,-0x2c,-0x11)],_0x178468['push'](_0x4377e8);}}}const _0x232a01=_0x528671[_0x14b80a(-0xbb,-0x4d,-0x98,-0x50)](mergeAdjacentMessages,_0x178468),{messages:_0x45e6c0,replacedVariables:_0x42b622}=_0x528671['GewXm'](replaceAllPlaceholders,_0x232a01,_0xc39d3e);return _0x45e6c0;}export function getProcessedPrompt(_0x4e5e38,_0x18386f){const _0x56fedb={'dIFki':function(_0x17d16d,_0x26bcab){return _0x17d16d(_0x26bcab);}},_0x19bc9c={};_0x19bc9c['requestTyp'+'e']=_0x4e5e38,_0x19bc9c['contextDat'+'a']=_0x18386f;function _0x450677(_0x40cf06,_0x5ecb30,_0xb3798a,_0x191d26){return _0xbaea(_0x40cf06-0x164,_0x5ecb30);}return _0x56fedb[_0x450677(0x2f7,0x339,0x2b8,0x2fa)](buildPromptWithTrigger,_0x19bc9c);}