(function(_0x395beb,_0xd07683){const _0x1aa2bb=_0x395beb();function _0x50adf5(_0x1fef63,_0x223284,_0xbb9704,_0x36b2ef){return _0x242f(_0x223284-0x12c,_0x1fef63);}function _0x31fced(_0x56395b,_0x3614ff,_0x2c57a0,_0x267ff2){return _0x242f(_0x56395b-0xe,_0x2c57a0);}while(!![]){try{const _0x3a1f30=-parseInt(_0x50adf5(0x219,0x222,0x263,0x1e8))/(0x7ef*0x3+-0x2f*-0x1f+-0x1d7d)*(-parseInt(_0x50adf5(0x2c6,0x2b0,0x2c4,0x27a))/(-0x747+-0x172b*0x1+0x1e74*0x1))+-parseInt(_0x50adf5(0x291,0x262,0x250,0x269))/(0x617+0x158f+-0x5*0x587)+-parseInt(_0x31fced(0x19e,0x1ec,0x19d,0x1c5))/(0x5*-0x38f+0x1557+-0x388)+parseInt(_0x31fced(0x160,0x15a,0x16a,0x18b))/(-0x1f73+-0x114d+0x5*0x9c1)*(-parseInt(_0x50adf5(0x325,0x2cd,0x2f2,0x2d9))/(-0x1c*-0x2f+-0x2614+0x107b*0x2))+parseInt(_0x50adf5(0x2bd,0x29e,0x2e8,0x269))/(-0xf*-0x61+0xa9*0x39+-0x62f*0x7)+-parseInt(_0x31fced(0x189,0x1d5,0x1a8,0x173))/(-0x2313+-0x1c28+0xca7*0x5)+parseInt(_0x50adf5(0x29a,0x266,0x26d,0x226))/(0x1c4f*0x1+-0x10d*-0x9+-0x25bb)*(parseInt(_0x50adf5(0x24c,0x276,0x22b,0x226))/(-0xb9*0x1+-0x3*0xa9a+0xadb*0x3));if(_0x3a1f30===_0xd07683)break;else _0x1aa2bb['push'](_0x1aa2bb['shift']());}catch(_0x33d876){_0x1aa2bb['push'](_0x1aa2bb['shift']());}}}(_0x39eb,-0x1*0x3f9d7+0x33c1e+0x74e93*0x1));const _0xd9f981=(function(){const _0x53c970={};function _0x550878(_0x334536,_0x962355,_0x107458,_0x48b278){return _0x242f(_0x334536- -0x25f,_0x107458);}function _0x11110a(_0x469242,_0x988224,_0x5f46a5,_0x4a8005){return _0x242f(_0x988224-0x227,_0x469242);}_0x53c970[_0x11110a(0x379,0x33a,0x38a,0x301)]=_0x11110a(0x371,0x3a6,0x3e1,0x398);const _0x25ff89=_0x53c970;let _0x66acf2=!![];return function(_0x2d2260,_0x234a5c){const _0x42f346={};_0x42f346[_0x4a272f(0x25d,0x2a3,0x26a,0x258)]=function(_0x189e9a,_0x56a661){return _0x189e9a===_0x56a661;};function _0x4a272f(_0x42b5d9,_0x3db3ea,_0x4b69dd,_0x32a31e){return _0x11110a(_0x42b5d9,_0x3db3ea- -0x11a,_0x4b69dd-0x6f,_0x32a31e-0x100);}_0x42f346['IzSrg']=_0x25ff89['kTFvP'];const _0x2fe0f2=_0x42f346,_0x2a074b=_0x66acf2?function(){function _0x675b98(_0x1938d5,_0x3a70eb,_0x38db98,_0x1aea09){return _0x4a272f(_0x1938d5,_0x1aea09- -0x31d,_0x38db98-0x69,_0x1aea09-0x69);}function _0xddb15e(_0xfec8da,_0xa2f559,_0x19a689,_0x4f9ac3){return _0x4a272f(_0xa2f559,_0x19a689- -0x122,_0x19a689-0x1a,_0x4f9ac3-0x147);}if(_0x234a5c){if(_0x2fe0f2['yQHZO'](_0x675b98(-0xd0,-0x65,-0xdb,-0x91),_0x2fe0f2[_0xddb15e(0x1ad,0x15e,0x161,0x13b)])){const _0x4f6a6d=_0x234a5c[_0x675b98(-0xb1,-0x8b,-0xcd,-0xe2)](_0x2d2260,arguments);return _0x234a5c=null,_0x4f6a6d;}else{const _0x1d5982=_0x4637a5[_0x675b98(-0x104,-0xba,-0x8e,-0xe2)](_0x2df07f,arguments);return _0x5ed87b=null,_0x1d5982;}}}:function(){};return _0x66acf2=![],_0x2a074b;};}()),_0x3d1009=_0xd9f981(this,function(){const _0x2aad04={};_0x2aad04[_0x94d1b7(0x163,0x1a0,0x1b5,0x1e8)]=_0x481177(-0x2c5,-0x30f,-0x288,-0x30e)+'+$';function _0x94d1b7(_0x5ef756,_0x1e0df3,_0x270d6a,_0x19eae1){return _0x242f(_0x1e0df3-0x8a,_0x5ef756);}const _0x290920=_0x2aad04;function _0x481177(_0xc90ce3,_0x5bffea,_0x3ed811,_0x25fb4b){return _0x242f(_0xc90ce3- -0x3ce,_0x25fb4b);}return _0x3d1009[_0x94d1b7(0x1ff,0x1eb,0x220,0x19f)]()[_0x94d1b7(0x1d6,0x203,0x1b0,0x1e3)](_0x290920[_0x94d1b7(0x1ef,0x1a0,0x188,0x1d2)])[_0x481177(-0x26d,-0x2a6,-0x2b9,-0x284)]()['constructo'+'r'](_0x3d1009)[_0x481177(-0x255,-0x21c,-0x26d,-0x270)]('(((.+)+)+)'+'+$');});_0x3d1009();import{extension_settings}from'../../../../extensions.js';import{extensionName}from'./config.js';import{getContext}from'../../../../st-context.js';import{getglobalvar,setglobalvar}from'./chatDataUtils.js';function _0x242f(_0x1e319c,_0xf8ac8b){_0x1e319c=_0x1e319c-(-0xfa5+-0x1ab*-0x11+-0x3*0x3eb);const _0xabc669=_0x39eb();let _0xcec4f4=_0xabc669[_0x1e319c];if(_0x242f['hOLbLH']===undefined){var _0x444ee9=function(_0x109b6c){const _0x1bd9df='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x47a2c2='',_0x1a8330='',_0x4e8b2b=_0x47a2c2+_0x444ee9;for(let _0x5eac4d=0xe0b+-0x37e+-0xa8d*0x1,_0x164726,_0x4f7e16,_0x364684=-0x40b+-0x5*-0x6be+-0x1dab;_0x4f7e16=_0x109b6c['charAt'](_0x364684++);~_0x4f7e16&&(_0x164726=_0x5eac4d%(0x3d5*0x6+-0x3d*0x83+-0x2bf*-0x3)?_0x164726*(-0x1a56+0x1*0x268b+0x1*-0xbf5)+_0x4f7e16:_0x4f7e16,_0x5eac4d++%(-0x15f3+0x19*-0xe1+-0x8*-0x57e))?_0x47a2c2+=_0x4e8b2b['charCodeAt'](_0x364684+(-0x6ae+-0x1c55+0x230d))-(-0x943+-0x1*0xa28+0x125*0x11)!==0x1434+-0x1*-0x136c+0x13d*-0x20?String['fromCharCode'](-0x1200+-0x12e7+0x1b9*0x16&_0x164726>>(-(-0x9*-0x1fa+-0xafd*-0x1+-0x1cc5)*_0x5eac4d&-0x293*-0x2+-0x1d28+0x1808)):_0x5eac4d:-0xbf*-0x1a+0x2*0x9a5+-0x8*0x4d6){_0x4f7e16=_0x1bd9df['indexOf'](_0x4f7e16);}for(let _0x2b98b6=-0x11*-0x227+-0x1674+-0xe23,_0x5ac0cd=_0x47a2c2['length'];_0x2b98b6<_0x5ac0cd;_0x2b98b6++){_0x1a8330+='%'+('00'+_0x47a2c2['charCodeAt'](_0x2b98b6)['toString'](0x518+-0x58b+-0x83*-0x1))['slice'](-(0x101*-0x20+-0x1463+0x3485));}return decodeURIComponent(_0x1a8330);};_0x242f['NXspEh']=_0x444ee9,_0x242f['FQfNYb']={},_0x242f['hOLbLH']=!![];}const _0x4a58eb=_0xabc669[0x1*0x355+0x1*-0x1a0b+0x143*0x12],_0x316d1c=_0x1e319c+_0x4a58eb,_0x4de1fe=_0x242f['FQfNYb'][_0x316d1c];if(!_0x4de1fe){const _0x2583c5=function(_0x224a29){this['LprBsh']=_0x224a29,this['IlUEyO']=[0x1b04+-0x2*0x925+-0x8b9,-0x329+0x1550+-0x1*0x1227,0x9e+-0xaea+0xa4c],this['giNbtu']=function(){return'newState';},this['XcGmtp']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['uDFjRX']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x2583c5['prototype']['CmeYvn']=function(){const _0x3bae21=new RegExp(this['XcGmtp']+this['uDFjRX']),_0x3eb7b1=_0x3bae21['test'](this['giNbtu']['toString']())?--this['IlUEyO'][0x943*-0x4+-0x13*0xb+0x83*0x4a]:--this['IlUEyO'][-0x237b*0x1+-0x108f+0x1a05*0x2];return this['YOdooR'](_0x3eb7b1);},_0x2583c5['prototype']['YOdooR']=function(_0x234a8a){if(!Boolean(~_0x234a8a))return _0x234a8a;return this['hJOCBL'](this['LprBsh']);},_0x2583c5['prototype']['hJOCBL']=function(_0x3efbb8){for(let _0x442c62=-0x182f+-0x2680+0x1*0x3eaf,_0x3db575=this['IlUEyO']['length'];_0x442c62<_0x3db575;_0x442c62++){this['IlUEyO']['push'](Math['round'](Math['random']())),_0x3db575=this['IlUEyO']['length'];}return _0x3efbb8(this['IlUEyO'][0xa06+0xd7e+-0x1784]);},new _0x2583c5(_0x242f)['CmeYvn'](),_0xcec4f4=_0x242f['NXspEh'](_0xcec4f4),_0x242f['FQfNYb'][_0x316d1c]=_0xcec4f4;}else _0xcec4f4=_0x4de1fe;return _0xcec4f4;}import{getworldvar}from'./worldbookProcessor.js';export function checkTriggerWords(_0x25fd6f,_0x512413){const _0x735969={'dpHQN':function(_0x389fb2,_0xdef25b,_0x242fad,_0x3d16a4){return _0x389fb2(_0xdef25b,_0x242fad,_0x3d16a4);},'WYWQm':function(_0x635fc2,_0x30d531){return _0x635fc2||_0x30d531;},'kzwtb':function(_0x2f79b5,_0x2145fe){return _0x2f79b5!==_0x2145fe;},'gRVjX':'QJyPf'};function _0x4ca344(_0x565d34,_0x2be198,_0x3ee992,_0x22d13a){return _0x242f(_0x2be198-0x78,_0x22d13a);}if(_0x735969[_0x4ca344(0x18d,0x188,0x130,0x18c)](!_0x25fd6f,!_0x512413))return![];function _0x2c3f67(_0x1942b9,_0x56765f,_0x30299c,_0x11e60d){return _0x242f(_0x1942b9-0x99,_0x30299c);}const _0x44d053=_0x25fd6f[_0x4ca344(0x20c,0x1fa,0x1e8,0x1a3)](',')[_0x2c3f67(0x1bc,0x1d0,0x1d3,0x1b2)](_0x45beda=>_0x45beda[_0x4ca344(0x1cc,0x215,0x20d,0x1e0)]())['filter'](_0xa39e77=>_0xa39e77);if(_0x44d053[_0x4ca344(0x1e8,0x1e8,0x1fa,0x1de)]===-0x13b5+0x1901+-0xe2*0x6)return _0x735969[_0x4ca344(0x189,0x1aa,0x1ca,0x18d)](_0x735969[_0x2c3f67(0x1ce,0x1a6,0x1ed,0x1f4)],_0x735969[_0x2c3f67(0x1ce,0x1c6,0x1dd,0x1a1)])?{..._0x6164a,'text':_0x735969[_0x4ca344(0x1c4,0x218,0x257,0x25d)](_0x25c906,_0x2c2b01['text'],_0x5aaefa,_0xd57e7)}:![];for(const _0x268036 of _0x44d053){if(_0x512413['includes'](_0x268036))return!![];}return![];}export function mergeAdjacentMessages(_0x29c82b){function _0x20e217(_0x1e3670,_0x2b6875,_0x3b52af,_0x545358){return _0x242f(_0x545358-0x252,_0x1e3670);}const _0xd3abf7={'yDiFm':function(_0x1eb56f,_0x1f2d74){return _0x1eb56f(_0x1f2d74);},'oazwH':function(_0x31b32e,_0x46a41f){return _0x31b32e===_0x46a41f;},'EJQmM':function(_0xa7845d,_0x40f7c6,_0x2f522e){return _0xa7845d(_0x40f7c6,_0x2f522e);},'UoSOi':function(_0x1832bf,_0x1b09c0){return _0x1832bf!==_0x1b09c0;},'GQIlF':_0x20e217(0x389,0x34c,0x30e,0x359),'Kuqol':function(_0x7f08f,_0x56749a){return _0x7f08f!==_0x56749a;},'zSRle':_0x20e217(0x351,0x353,0x3c7,0x392),'qSymq':_0x2f7bca(-0x146,-0x188,-0xf2,-0x12f),'AfnMn':function(_0x7eae90,_0x29c6fe,_0x37c26c){return _0x7eae90(_0x29c6fe,_0x37c26c);},'UyBsv':function(_0x497b3d,_0x33d7a9){return _0x497b3d!==_0x33d7a9;},'tlRVk':'UtsdP','ogOVU':'DyQLM'};if(!_0x29c82b||_0x29c82b['length']===0x17cb+-0x164b*-0x1+-0x15b*0x22){if(_0xd3abf7[_0x2f7bca(-0x17a,-0x1ca,-0x176,-0x1b6)](_0x2f7bca(-0x18c,-0x18a,-0x1d3,-0x1a8),_0xd3abf7['GQIlF'])){const _0x2f3011={};return _0x2f3011[_0x20e217(0x34f,0x2fc,0x395,0x34f)+'e']=_0x53672d,_0x2f3011[_0x20e217(0x3b4,0x38c,0x396,0x3b6)+'a']=_0x53cd41,_0xd3abf7[_0x2f7bca(-0x10a,-0x112,-0x15c,-0x134)](_0x2bb14a,_0x2f3011);}else return[];}const _0x3be434=[];let _0x206251=null;for(const _0x56ce7b of _0x29c82b){if(_0xd3abf7['Kuqol'](_0xd3abf7[_0x20e217(0x3d9,0x364,0x3b9,0x3bb)],_0xd3abf7['zSRle']))_0x4c3096[_0x32283c]=_0x1fa450(_0x16516e[_0x1e57a4],_0x4a8880,_0x3fd05c,_0x31e68c);else{if(!_0x206251){const _0x508b01={..._0x56ce7b};_0x206251=_0x508b01;}else{if(_0x206251['role']===_0x56ce7b[_0x20e217(0x35a,0x3ae,0x34e,0x357)])_0xd3abf7[_0x20e217(0x3c5,0x38c,0x3df,0x395)](_0xd3abf7[_0x2f7bca(-0x162,-0x144,-0x198,-0x171)],_0xd3abf7[_0x20e217(0x3cb,0x356,0x3d4,0x383)])?_0x206251[_0x20e217(0x3d3,0x3e5,0x3c8,0x391)]=_0xd3abf7[_0x20e217(0x356,0x387,0x387,0x356)](mergeContent,_0x206251[_0x20e217(0x35b,0x3d6,0x3c5,0x391)],_0x56ce7b[_0x2f7bca(-0x154,-0x121,-0x107,-0x11c)]):_0x43b88f[_0x20e217(0x39f,0x339,0x398,0x353)](_0x2f7bca(-0x107,-0xd6,-0xd8,-0xca)+_0x20e217(0x3e4,0x3c5,0x3ad,0x3c0)+_0x4675a9+'@}');else{if(_0xd3abf7['UyBsv'](_0xd3abf7[_0x2f7bca(-0x129,-0xf6,-0x111,-0x173)],_0x2f7bca(-0x17f,-0x151,-0x1cb,-0x140))){_0x3be434['push'](_0x206251);const _0x4e422d={..._0x56ce7b};_0x206251=_0x4e422d;}else{if(!_0xc1aa6e){const _0x55f73c={..._0x1448d6};_0x5c58a9=_0x55f73c;}else{if(_0xd3abf7[_0x20e217(0x3dd,0x3d8,0x3e2,0x395)](_0x1af4ef[_0x2f7bca(-0x18e,-0x15a,-0x1d8,-0x1d6)],_0x1e270b[_0x2f7bca(-0x18e,-0x174,-0x1c2,-0x1a7)]))_0x5e3c95[_0x20e217(0x36c,0x3cc,0x3df,0x391)]=_0xd3abf7[_0x20e217(0x31d,0x31a,0x356,0x372)](_0x2546f2,_0x1e6672[_0x20e217(0x33f,0x39f,0x3c4,0x391)],_0x249d22[_0x2f7bca(-0x154,-0x117,-0x14a,-0x191)]);else{_0x35e836[_0x2f7bca(-0x14b,-0x15c,-0x14d,-0x17c)](_0x28ebf6);const _0x37a173={..._0xbb5c87};_0x2e847e=_0x37a173;}}}}}}}if(_0x206251){if(_0xd3abf7[_0x20e217(0x376,0x3f7,0x39d,0x3ab)](_0xd3abf7[_0x20e217(0x393,0x3ab,0x397,0x38d)],_0xd3abf7['ogOVU']))return![];else _0x3be434[_0x2f7bca(-0x14b,-0x156,-0x175,-0x17d)](_0x206251);}function _0x2f7bca(_0x5d60bd,_0x3ada59,_0x3823e4,_0x344b5d){return _0x242f(_0x5d60bd- -0x293,_0x3823e4);}return _0x3be434;}function mergeContent(_0x528e7c,_0x20d570){const _0x4468e2={'uqKuq':function(_0x56e3e8,_0x48b6bf){return _0x56e3e8===_0x48b6bf;},'QQwZJ':_0x17cf2e(0x2f4,0x2fb,0x2f6,0x2be),'RBClS':function(_0x4b3c30,_0x3e8d1c){return _0x4b3c30!==_0x3e8d1c;},'OsFPh':function(_0x287474,_0x5003fe){return _0x287474+_0x5003fe;},'ZAyWR':function(_0x31e739,_0x8cd183){return _0x31e739(_0x8cd183);},'zFNDk':_0x4c47ab(0x287,0x248,0x276,0x1fd)};if(_0x4468e2['uqKuq'](typeof _0x528e7c,_0x4468e2[_0x4c47ab(0x1ea,0x238,0x1fd,0x24d)])&&typeof _0x20d570===_0x4468e2[_0x4c47ab(0x287,0x238,0x231,0x24b)])return _0x4468e2[_0x4c47ab(0x22d,0x282,0x284,0x25c)](_0x4c47ab(0x2a4,0x264,0x29a,0x224),_0x17cf2e(0x28f,0x2b0,0x2b8,0x27c))?_0x4468e2[_0x17cf2e(0x2c0,0x2e1,0x2ed,0x2f2)](_0x528e7c+'\x0a',_0x20d570):!![];function _0x17cf2e(_0x3683f8,_0x2784a2,_0x37f5c2,_0x5e22a6){return _0x242f(_0x3683f8-0x160,_0x5e22a6);}const _0x2e87e0=_0x4468e2[_0x4c47ab(0x2b4,0x284,0x23e,0x2ac)](normalizeToArray,_0x528e7c),_0xcbe777=_0x4468e2[_0x4c47ab(0x276,0x284,0x2b7,0x275)](normalizeToArray,_0x20d570),_0x13897d={};_0x13897d[_0x17cf2e(0x2ed,0x2c7,0x2d6,0x315)]=_0x4468e2['zFNDk'],_0x13897d['text']='\x0a';function _0x4c47ab(_0xcec75f,_0x2c3e0e,_0x1e9a06,_0x16b9df){return _0x242f(_0x2c3e0e-0x13d,_0xcec75f);}return[..._0x2e87e0,_0x13897d,..._0xcbe777];}function normalizeToArray(_0x1ff2cf){function _0x3f40b5(_0x28025d,_0x539a61,_0x4783b5,_0x2182e2){return _0x242f(_0x28025d-0x66,_0x539a61);}const _0x3af52e={};_0x3af52e[_0x3f40b5(0x1f1,0x232,0x232,0x206)]=_0x54ac4e(0x3c6,0x409,0x3b7,0x3ef),_0x3af52e[_0x3f40b5(0x1e9,0x1d9,0x1d8,0x1c5)]=function(_0x4a4161,_0x5a8516){return _0x4a4161||_0x5a8516;};const _0x32df04=_0x3af52e;function _0x54ac4e(_0x430437,_0x1eed85,_0x479194,_0x216f89){return _0x242f(_0x430437-0x2bb,_0x216f89);}if(Array[_0x54ac4e(0x41a,0x400,0x3fa,0x42b)](_0x1ff2cf))return _0x1ff2cf;return[{'type':_0x32df04[_0x54ac4e(0x446,0x417,0x43c,0x3f9)],'text':_0x32df04['RZzWg'](_0x1ff2cf,'')}];}export function replacePlaceholder(_0x56e46b,_0xaefd91,_0x3df3fe,_0x264908){const _0x586a09={'ZNmVw':function(_0x4677b5,_0x17952a){return _0x4677b5(_0x17952a);},'NzBwf':function(_0x581a24,_0x3a27f0){return _0x581a24===_0x3a27f0;},'eDbOM':_0x494cf9(0x3cb,0x3ce,0x3d4,0x3d3),'BAanf':function(_0x34de3f,_0x340291){return _0x34de3f||_0x340291;},'BkAlL':_0xb9dc80(-0x202,-0x20f,-0x1c1,-0x1f9)};if(_0x586a09[_0xb9dc80(-0x276,-0x265,-0x24a,-0x22d)](typeof _0x56e46b,_0x586a09[_0xb9dc80(-0x1ec,-0x1f1,-0x1b3,-0x201)]))return _0x3df3fe&&_0x56e46b['includes'](_0xaefd91)&&(_0x264908&&_0x264908[_0x494cf9(0x338,0x32c,0x34e,0x387)](_0xaefd91)),_0x56e46b[_0x494cf9(0x3b7,0x3ab,0x392,0x3e1)](_0xaefd91,_0x586a09[_0x494cf9(0x341,0x348,0x362,0x355)](_0x3df3fe,''));function _0x494cf9(_0x4ee4cb,_0x215a18,_0x123599,_0x499b2d){return _0x242f(_0x4ee4cb-0x237,_0x499b2d);}if(Array[_0xb9dc80(-0x1ef,-0x19f,-0x1f7,-0x1cb)](_0x56e46b)){if(_0x586a09['BkAlL']==='BKWhr'){const _0x4d296f=_0xde4156[_0x494cf9(0x3d4,0x3bf,0x3b9,0x41b)](),_0xea5510=_0x9f976d[_0xb9dc80(-0x19b,-0x1af,-0x1e7,-0x1a5)+'ta']['variables'][_0x4d296f]||'';return _0x27d007[_0x494cf9(0x3b4,0x382,0x35d,0x406)]('[promptPro'+_0x494cf9(0x3af,0x406,0x3ad,0x3a8)+_0xb9dc80(-0x207,-0x199,-0x1e5,-0x221)+_0x4d296f+_0x494cf9(0x378,0x36c,0x3af,0x371)+_0x586a09[_0x494cf9(0x38e,0x38c,0x3a7,0x340)](_0x1aa0b9,_0xea5510)[_0x494cf9(0x3d6,0x3b6,0x3bf,0x394)](-0x1825+-0xa15+-0xd*-0x2a2,-0x4*-0x8a9+-0x1*-0x5bf+-0x2831)+_0x494cf9(0x374,0x346,0x398,0x368)),_0x2ef30b&&_0x28edf6[_0x494cf9(0x338,0x350,0x2e4,0x313)](_0xb9dc80(-0x26d,-0x22c,-0x241,-0x26e)+_0x4d296f+'@}'),_0xea5510;}else return _0x56e46b[_0x494cf9(0x35a,0x342,0x31c,0x30c)](_0x22c20c=>replacePlaceholder(_0x22c20c,_0xaefd91,_0x3df3fe,_0x264908));}if(_0x56e46b&&typeof _0x56e46b==='object'){const _0x1663c2={};for(const _0x5aa69b in _0x56e46b){_0x1663c2[_0x5aa69b]=replacePlaceholder(_0x56e46b[_0x5aa69b],_0xaefd91,_0x3df3fe,_0x264908);}return _0x1663c2;}function _0xb9dc80(_0x4f7984,_0x212b20,_0x390a83,_0x5e050a){return _0x242f(_0x390a83- -0x356,_0x212b20);}return _0x56e46b;}export function replaceAllPlaceholders(_0x27f3b1,_0x3b5b6c){const _0x2814cf={'SbFsb':function(_0x28ffa2){return _0x28ffa2();},'HtPoO':_0x2fd3f6(-0x18a,-0x14a,-0x141,-0x120),'XUnSo':function(_0x172400,_0x4bf9e2,_0x3cfe0c,_0x516d61,_0x37c0ef){return _0x172400(_0x4bf9e2,_0x3cfe0c,_0x516d61,_0x37c0ef);},'ZhLhE':_0x189af6(0x5a3,0x56e,0x55c,0x552),'TUUJV':_0x189af6(0x5a6,0x50c,0x537,0x555),'odqcX':'{{正文}}','zdsjt':'{{角色启用列表}}','SiFNF':function(_0x35d34b,_0xd47603,_0x29f220,_0x5e59e7,_0x21d34d){return _0x35d34b(_0xd47603,_0x29f220,_0x5e59e7,_0x21d34d);},'HQNzc':_0x189af6(0x49c,0x4d7,0x536,0x4f4)+'}}','iNRPH':_0x2fd3f6(-0x12d,-0x175,-0x170,-0x1a6),'Darii':function(_0x215149,_0x3cc51f){return _0x215149>_0x3cc51f;},'pSYss':'qxsxx','UvVMe':'IWAIY','luIyj':function(_0x1c6ae7,_0x8d94fa,_0x1c0fb3,_0x1eca5f,_0x4b3873){return _0x1c6ae7(_0x8d94fa,_0x1c0fb3,_0x1eca5f,_0x4b3873);},'QpHNM':function(_0x350b3d,_0x306336,_0x319711){return _0x350b3d(_0x306336,_0x319711);}},{context:context='',body:body='',worldBookContent:worldBookContent='',variables:variables={},userDemand:userDemand='',characterListText:characterListText='',outfitEnableListText:outfitEnableListText='',commonCharacterListText:commonCharacterListText=''}=_0x3b5b6c,_0xf5a40=new Set();let _0x10dab5=_0x27f3b1;const _0x4280a6=_0x2814cf[_0x2fd3f6(-0x1c1,-0x170,-0x151,-0x1c1)](getContext);function _0x189af6(_0xd97fb4,_0x34a31b,_0x5e873,_0x38b58a){return _0x242f(_0x38b58a-0x3c4,_0x5e873);}const _0x20862a=_0x4280a6?.[_0x189af6(0x52e,0x55e,0x4f0,0x542)]||'';let _0x48dde9=worldBookContent;_0x48dde9&&(_0x48dde9=_0x48dde9[_0x2fd3f6(-0x183,-0x13e,-0x175,-0x12f)](_0x2814cf[_0x2fd3f6(-0x173,-0x136,-0x158,-0x137)],_0x20862a),_0x48dde9=_0x48dde9[_0x189af6(0x59a,0x56c,0x52c,0x544)]('<user>',_0x20862a));_0x10dab5=_0x2814cf[_0x2fd3f6(-0x178,-0x15b,-0x14c,-0x176)](replacePlaceholder,_0x10dab5,_0x2814cf['ZhLhE'],context,_0xf5a40),_0x10dab5=_0x2814cf['XUnSo'](replacePlaceholder,_0x10dab5,_0x2814cf[_0x2fd3f6(-0x179,-0x151,-0x195,-0x154)],_0x48dde9,_0xf5a40),_0x10dab5=replacePlaceholder(_0x10dab5,_0x2814cf[_0x189af6(0x4f8,0x556,0x501,0x51f)],body,_0xf5a40),_0x10dab5=_0x2814cf[_0x189af6(0x527,0x535,0x55d,0x527)](replacePlaceholder,_0x10dab5,_0x2814cf[_0x2fd3f6(-0x1a8,-0x169,-0x18b,-0x14e)],characterListText,_0xf5a40),_0x10dab5=_0x2814cf[_0x189af6(0x4e1,0x50f,0x545,0x4fc)](replacePlaceholder,_0x10dab5,_0x2814cf[_0x189af6(0x4b6,0x4fe,0x4da,0x4ed)],outfitEnableListText,_0xf5a40),_0x10dab5=_0x2814cf[_0x2fd3f6(-0x19a,-0x186,-0x1c7,-0x186)](replacePlaceholder,_0x10dab5,_0x189af6(0x4ea,0x513,0x56c,0x514)+'}}',commonCharacterListText,_0xf5a40),_0x10dab5=_0x2814cf['SiFNF'](replacePlaceholder,_0x10dab5,_0x2814cf[_0x2fd3f6(-0xe6,-0x11a,-0x172,-0xe7)],userDemand,_0xf5a40);if(variables&&_0x2814cf[_0x189af6(0x57c,0x515,0x57f,0x553)](Object['keys'](variables)[_0x2fd3f6(-0x165,-0x14e,-0x187,-0x15e)],-0x1*-0x136b+0x1*-0x15c3+0x19*0x18)){if(_0x2814cf[_0x189af6(0x525,0x4d0,0x527,0x4d5)]===_0x2814cf['pSYss']){const _0x3d3334=/\{\{getvar::([^}]+)\}\}/g,_0x3d969a=JSON[_0x189af6(0x4ba,0x4c5,0x4c4,0x4ef)](_0x10dab5),_0x71af4d=[..._0x3d969a[_0x189af6(0x4e5,0x542,0x545,0x50a)](_0x3d3334)],_0x5c6a57=new Set();for(const _0x428b7b of _0x71af4d){_0x5c6a57[_0x189af6(0x4e2,0x4bb,0x48e,0x4c5)](_0x428b7b[-0x37*0x37+0x2*0x1227+0x61f*-0x4]);}for(const _0x294e11 of _0x5c6a57){if(_0x2fd3f6(-0x18d,-0x1bb,-0x16a,-0x1e3)!==_0x2814cf[_0x2fd3f6(-0x132,-0x120,-0x129,-0x141)]){const _0x50952f=_0x189af6(0x55a,0x4c7,0x56b,0x51a)+_0x294e11+'}}',_0x44c3a4=variables[_0x294e11]||'';_0x10dab5=_0x2814cf[_0x189af6(0x596,0x58b,0x4eb,0x540)](replacePlaceholder,_0x10dab5,_0x50952f,_0x44c3a4,_0xf5a40);}else{_0x50a8ec['push'](_0x195e1f);const _0x40e4c6={..._0x3157b3};_0xe93620=_0x40e4c6;}}}else{const _0x3d71a8=_0x47be90[_0x189af6(0x58c,0x55e,0x569,0x561)]();return _0x395c8d[_0x2fd3f6(-0x171,-0x141,-0x14e,-0xf0)]('[promptPro'+'cessor]\x20se'+'tvar:\x20'+_0x3d71a8+'\x20=\x20'+_0x169b80[_0x189af6(0x594,0x527,0x566,0x563)](-0x7*0x301+-0x24aa+-0x133b*-0x3,-0x15b5+-0x13d5+-0x2*-0x14de)+'...'),_0x3d8986['chatMetada'+'ta'][_0x189af6(0x47b,0x4c7,0x48d,0x4c4)][_0x3d71a8]=_0x2ea2ef,_0x37eff3&&_0x39261a[_0x2fd3f6(-0x195,-0x1bd,-0x1e2,-0x17c)]('{@setvar::'+_0x3d71a8+'@}'),'';}}_0x10dab5=_0x2814cf[_0x189af6(0x4c2,0x514,0x52a,0x517)](processVariablePlaceholdersInMessages,_0x10dab5,_0xf5a40);function _0x2fd3f6(_0x58df56,_0x59f480,_0x4ba978,_0x4e7644){return _0x242f(_0x59f480- -0x2be,_0x4e7644);}const _0x4fcf70={};return _0x4fcf70[_0x2fd3f6(-0x1a0,-0x149,-0x102,-0x16e)]=_0x10dab5,_0x4fcf70[_0x2fd3f6(-0xe8,-0x137,-0xef,-0xf2)+'riables']=_0xf5a40,_0x4fcf70;}function processVariablePlaceholdersInMessages(_0x5a38ed,_0x3e8d88){const _0x4a5abc={'LjyIo':function(_0x3285f9,_0x9e04a4,_0x27da00,_0x15db15){return _0x3285f9(_0x9e04a4,_0x27da00,_0x15db15);},'lRfHU':function(_0x1d054d,_0x53ead2){return _0x1d054d===_0x53ead2;}};if(!_0x5a38ed||_0x4a5abc[_0x406e92(-0xc1,-0xae,-0x101,-0xfc)](_0x5a38ed[_0x406e92(-0x96,-0xa3,-0xa5,-0x92)],0x2578*0x1+-0x4b2+-0x20c6))return _0x5a38ed;const _0x5175da=getContext();!_0x5175da[_0x406e92(-0xb0,-0xa4,-0xfb,-0x9b)+'ta']&&(_0x5175da[_0x2159c4(0x3d7,0x3fe,0x400,0x3f8)+'ta']={});function _0x2159c4(_0x1d1259,_0x531c71,_0x32d6fe,_0x3da131){return _0x242f(_0x531c71-0x28f,_0x1d1259);}!_0x5175da[_0x2159c4(0x3ee,0x3fe,0x3de,0x414)+'ta'][_0x2159c4(0x3c2,0x38f,0x3ac,0x36f)]&&(_0x5175da['chatMetada'+'ta']['variables']={});function _0x406e92(_0x2c8f13,_0x1c2405,_0x58bcd2,_0x6ad360){return _0x242f(_0x1c2405- -0x213,_0x2c8f13);}return _0x5a38ed[_0x2159c4(0x3c3,0x3b2,0x3f7,0x3b3)](_0x42a74c=>{if(!_0x42a74c||!_0x42a74c[_0x507f54(0x1dd,0x21b,0x22f,0x236)])return _0x42a74c;function _0x3aeba3(_0x210571,_0x2ddf67,_0x35c81b,_0x2a8f34){return _0x406e92(_0x35c81b,_0x210571- -0xa6,_0x35c81b-0x146,_0x2a8f34-0x1ec);}function _0x507f54(_0x4930a0,_0x1efc8f,_0x5a65cd,_0x22f20b){return _0x406e92(_0x4930a0,_0x1efc8f-0x2ef,_0x5a65cd-0x144,_0x22f20b-0x149);}return{..._0x42a74c,'content':_0x4a5abc['LjyIo'](processContentVariables,_0x42a74c[_0x3aeba3(-0x17a,-0x174,-0x1c7,-0x12e)],_0x5175da,_0x3e8d88)};});}function processContentVariables(_0xc84328,_0x4a66d1,_0x44a52f){function _0x2fe354(_0xaa8662,_0x222b00,_0x5dbcde,_0x39214c){return _0x242f(_0x222b00- -0x17c,_0xaa8662);}const _0xda2344={'SGUqz':function(_0x26d42b,_0x4d9f34){return _0x26d42b===_0x4d9f34;},'JKNvB':_0x406e80(0x48b,0x4f6,0x4e8,0x4d7),'dAsWP':function(_0x1be16e,_0x56e5ae){return _0x1be16e+_0x56e5ae;},'mcfJf':function(_0x218fe0,_0xcf2ffe){return _0x218fe0(_0xcf2ffe);},'QyQyH':function(_0x22b3d4,_0x45e339){return _0x22b3d4===_0x45e339;},'seILn':_0x406e80(0x49c,0x481,0x483,0x485),'PzVpn':_0x406e80(0x4b5,0x493,0x51e,0x4c9),'QPiXh':_0x406e80(0x426,0x49b,0x466,0x44e),'pyFLy':function(_0x25ea00,_0x44c5ec){return _0x25ea00===_0x44c5ec;},'fVIIy':function(_0xe9c416,_0x1e4d87,_0x512643,_0x5cdc11){return _0xe9c416(_0x1e4d87,_0x512643,_0x5cdc11);}};function _0x406e80(_0x1125fe,_0xcd92e1,_0x2ed740,_0x47b8b1){return _0x242f(_0x47b8b1-0x343,_0xcd92e1);}if(_0xda2344['pyFLy'](typeof _0xc84328,_0xda2344[_0x406e80(0x537,0x51c,0x49b,0x4df)])){if(_0x2fe354(0x7,-0x1f,-0x73,-0xe)===_0x2fe354(0x3,-0x1f,-0x18,-0x46))return _0xda2344[_0x406e80(0x4a5,0x42c,0x45a,0x45b)](processStringVariables,_0xc84328,_0x4a66d1,_0x44a52f);else{if(_0xda2344[_0x2fe354(-0x55,-0x9,0x13,-0x19)](typeof _0x197f86,_0xda2344[_0x406e80(0x52c,0x534,0x4cd,0x4df)])&&_0xda2344[_0x406e80(0x47f,0x4f6,0x4a1,0x4b6)](typeof _0x278747,'string'))return _0xda2344[_0x2fe354(-0xcd,-0x82,-0x93,-0x45)](_0x4a1e64,'\x0a')+_0x462bd1;const _0x36d940=_0xda2344[_0x2fe354(0x2f,0x16,0x21,-0x34)](_0x48ffa9,_0x4ac000),_0x5051d8=_0x13eb0b(_0x3d486f),_0x59d9ea={};return _0x59d9ea[_0x2fe354(0x41,0x11,-0x24,0x31)]=_0x2fe354(-0x33,-0x71,-0xc5,-0xb1),_0x59d9ea['text']='\x0a',[..._0x36d940,_0x59d9ea,..._0x5051d8];}}if(Array[_0x406e80(0x4ed,0x45f,0x4f0,0x4a2)](_0xc84328))return _0xc84328['map'](_0x23fb3e=>{function _0xa0ec5e(_0x1b4615,_0x1a052f,_0x803a0c,_0x59c855){return _0x2fe354(_0x59c855,_0x1a052f-0x559,_0x803a0c-0x1,_0x59c855-0x186);}function _0x50e845(_0x195e02,_0x3c0803,_0x59b6f2,_0x9830fd){return _0x406e80(_0x195e02-0x133,_0x59b6f2,_0x59b6f2-0x98,_0x9830fd- -0x724);}if(_0xda2344[_0xa0ec5e(0x568,0x574,0x51d,0x5ae)](_0xda2344[_0x50e845(-0x2d2,-0x2ea,-0x283,-0x2c3)],_0xda2344[_0x50e845(-0x2a0,-0x298,-0x293,-0x2ca)]))_0x526cb9[_0x50e845(-0x2bd,-0x32b,-0x2e9,-0x2e0)](_0x565311[0x1f07+0x23c7+0x15d*-0x31]);else{if(_0x23fb3e&&_0x23fb3e['type']===_0xda2344[_0x50e845(-0x261,-0x22c,-0x234,-0x276)]&&_0xda2344[_0x50e845(-0x23b,-0x227,-0x279,-0x267)](typeof _0x23fb3e[_0x50e845(-0x2ad,-0x293,-0x2ff,-0x2d6)],_0xda2344[_0xa0ec5e(0x5c3,0x579,0x57b,0x54b)]))return{..._0x23fb3e,'text':_0xda2344[_0xa0ec5e(0x4e3,0x4f5,0x4ae,0x4c2)](processStringVariables,_0x23fb3e[_0xa0ec5e(0x4dd,0x4e8,0x53b,0x4ba)],_0x4a66d1,_0x44a52f)};return _0x23fb3e;}});return _0xc84328;}function processStringVariables(_0x278850,_0x511790,_0x4f8717){const _0x4eb7e4={'xXuPd':'hAAde','YuKDC':function(_0x175bcd,_0x3c6bac){return _0x175bcd(_0x3c6bac);},'nDGJw':function(_0x241eba,_0x108f8a){return _0x241eba!==_0x108f8a;},'omJMj':function(_0x9ed171,_0x552647){return _0x9ed171!==_0x552647;},'rdZbM':_0xcf5d7c(0x3eb,0x3c9,0x41b,0x450),'TeQKE':function(_0x4faf88,_0x2278ac){return _0x4faf88===_0x2278ac;},'TCtMU':'NCuak','MHEOU':'MFwFv','AOHYO':_0x267e4a(0x23f,0x21b,0x22d,0x22e)+'+$','ybwOH':function(_0x17e934,_0x40b452){return _0x17e934(_0x40b452);},'fYAuo':function(_0x54d7c8,_0x499b5f){return _0x54d7c8!==_0x499b5f;},'Jdfsy':'GEPdi','dOEHJ':_0xcf5d7c(0x4ac,0x47e,0x460,0x486)};if(!_0x278850)return _0x278850;let _0x1a8849=_0x278850;_0x1a8849=_0x1a8849['replace'](/\{@setvar::([^:@]+)::([\s\S]*?)@\}/g,(_0x149f69,_0xcd533c,_0x35bae3)=>{const _0x19fa43=_0xcd533c['trim']();console[_0x3207f4(0x16d,0x100,0x11e,0x129)](_0x37f42c(0xdf,0xe7,0x132,0x178)+_0x3207f4(0xee,0x79,0xea,0xcd)+'tvar:\x20'+_0x19fa43+_0x37f42c(0xb5,0x103,0xfc,0x11d)+_0x35bae3[_0x3207f4(0x12c,0x126,0x184,0x14b)](-0xc9+-0xa92+0x33*0x39,0x247d+0x2*-0x5eb+-0x1875)+_0x3207f4(0xf5,0xb8,0x130,0xe9));function _0x3207f4(_0x5a8f84,_0x2db01f,_0x27526d,_0x1bfc8e){return _0x267e4a(_0x5a8f84,_0x2db01f-0x181,_0x27526d-0xee,_0x1bfc8e- -0x179);}function _0x37f42c(_0x11a83c,_0x574b3b,_0x95cb29,_0x27e45c){return _0xcf5d7c(_0x11a83c-0x84,_0x574b3b-0x18d,_0x95cb29- -0x32a,_0x574b3b);}_0x511790['chatMetada'+'ta']['variables'][_0x19fa43]=_0x35bae3;if(_0x4f8717){if(_0x4eb7e4[_0x3207f4(0x58,0xf9,0xfc,0xa5)]!==_0x4eb7e4[_0x37f42c(0xc0,0x118,0xcd,0x107)])return _0x1d6d71;else _0x4f8717[_0x37f42c(0x11a,0x93,0xd5,0x8f)](_0x3207f4(0x9a,0x61,0x4d,0xa3)+_0x19fa43+'@}');}return'';}),_0x1a8849=_0x1a8849[_0xcf5d7c(0x452,0x4d6,0x497,0x461)](/\{@getvar::([^@]+)@\}/g,(_0x4bc24a,_0x458bff)=>{function _0x2240d7(_0x5d44a2,_0x31079d,_0x38da88,_0x52867e){return _0x267e4a(_0x31079d,_0x31079d-0x175,_0x38da88-0x63,_0x38da88- -0x23);}const _0x3ff307=_0x458bff['trim'](),_0x2ea655=_0x511790['chatMetada'+'ta']['variables'][_0x3ff307]||'';console[_0x2240d7(0x263,0x237,0x27f,0x25b)](_0x2240d7(0x27c,0x247,0x260,0x263)+_0x5cebf9(-0x239,-0x204,-0x1e4,-0x1e6)+_0x2240d7(0x257,0x240,0x273,0x26e)+_0x3ff307+_0x2240d7(0x247,0x22d,0x243,0x21c)+_0x4eb7e4[_0x5cebf9(-0x23a,-0x1ac,-0x1fb,-0x1f7)](String,_0x2ea655)['substring'](-0x1*0x1feb+-0x1*-0x26ef+-0x1*0x704,-0x2*0xf81+-0x2*0x8c6+0x30c0)+'...');_0x4f8717&&_0x4f8717[_0x5cebf9(-0x257,-0x286,-0x29d,-0x25d)](_0x2240d7(0x225,0x263,0x217,0x20d)+_0x3ff307+'@}');function _0x5cebf9(_0x2955a6,_0x53df85,_0x48c88d,_0xe4767b){return _0x267e4a(_0x2955a6,_0x53df85-0x10b,_0x48c88d-0x187,_0xe4767b- -0x483);}return _0x2ea655;}),_0x1a8849=_0x1a8849[_0x267e4a(0x30a,0x2a6,0x2a3,0x2be)](/\{@setglobalvar::([^:@]+)::([\s\S]*?)@\}/g,(_0x52c6ae,_0x5bf499,_0x48b538)=>{function _0x340a27(_0x26ff9e,_0x3ffc0f,_0x401758,_0x4a50db){return _0x267e4a(_0x26ff9e,_0x3ffc0f-0x1cd,_0x401758-0x9c,_0x4a50db- -0xf3);}function _0x3705f7(_0x2eb5ae,_0x1c5e60,_0x26e908,_0x38287c){return _0x267e4a(_0x38287c,_0x1c5e60-0x6c,_0x26e908-0x1c1,_0x26e908- -0x420);}if(_0x4eb7e4[_0x340a27(0x182,0x1e1,0x17c,0x1b7)](_0x4eb7e4[_0x3705f7(-0x196,-0x218,-0x1d5,-0x1cc)],_0x4eb7e4[_0x3705f7(-0x219,-0x1c3,-0x1ee,-0x1a0)]))for(const _0xa65388 of _0x45bc9d[_0x3705f7(-0x16e,-0x19d,-0x171,-0x16a)]){if(_0xa65388[_0x3705f7(-0x218,-0x171,-0x1c8,-0x1cd)]&&_0x4eb7e4[_0x3705f7(-0x151,-0x101,-0x159,-0x189)](_0xa65388[_0x340a27(0x1a7,0x17f,0x11f,0x165)][_0x340a27(0x1bc,0x1fa,0x1a2,0x1cf)](),'')){const _0xc563e2={};_0xc563e2['role']=_0x340a27(0x19b,0x132,0x182,0x165),_0xc563e2[_0x340a27(0x11b,0x11d,0x1bd,0x171)]=_0xa65388['user'],_0x2dea87['push'](_0xc563e2);}if(_0xa65388['assistant']&&_0x4eb7e4[_0x3705f7(-0x215,-0x1c9,-0x1d1,-0x1c3)](_0xa65388[_0x3705f7(-0x1d4,-0x206,-0x1de,-0x1d8)][_0x340a27(0x1f9,0x1e3,0x19f,0x1cf)](),'')){const _0x2e66e9={};_0x2e66e9['role']=_0x4eb7e4[_0x3705f7(-0x1bf,-0x1bc,-0x1f9,-0x1a5)],_0x2e66e9[_0x3705f7(-0x17b,-0x1d4,-0x1bc,-0x1c1)]=_0xa65388[_0x3705f7(-0x220,-0x22c,-0x1de,-0x1b6)],_0x5d9cc8[_0x340a27(0x155,0x123,0x163,0x17a)](_0x2e66e9);}}else{const _0x361a77=_0x5bf499[_0x3705f7(-0x15d,-0x15e,-0x15e,-0x11f)]();return console[_0x340a27(0x1e5,0x197,0x1fe,0x1af)](_0x340a27(0x165,0x19e,0x163,0x190)+_0x340a27(0x190,0x11c,0x15d,0x153)+_0x3705f7(-0x1ac,-0x1f5,-0x1ed,-0x1e3)+':\x20'+_0x361a77+'\x20=\x20'+_0x48b538[_0x3705f7(-0x13d,-0x148,-0x15c,-0x13e)](0x1*-0xfef+-0x134e+0x233d,-0xd*0x150+-0xea4+0x1fe6)+'...'),setglobalvar(_0x361a77,_0x48b538),_0x4f8717&&_0x4f8717[_0x3705f7(-0x238,-0x242,-0x1fa,-0x1ef)](_0x3705f7(-0x1c0,-0x22b,-0x1dc,-0x1bb)+_0x340a27(0x157,0x193,0x138,0x144)+_0x361a77+'@}'),'';}});function _0x267e4a(_0x33a809,_0x409edb,_0x4fb1f9,_0x666468){return _0x242f(_0x666468-0x125,_0x33a809);}_0x1a8849=_0x1a8849[_0xcf5d7c(0x45a,0x462,0x497,0x4dd)](/\{@getglobalvar::([^@]+)@\}/g,(_0x16fe78,_0x3927a6)=>{function _0x994e71(_0x2edda5,_0x1ea6c8,_0x5e7733,_0x47a755){return _0xcf5d7c(_0x2edda5-0x138,_0x1ea6c8-0x1be,_0x47a755-0x60,_0x5e7733);}function _0x3be719(_0x238805,_0x48f610,_0x44d28e,_0x2caead){return _0xcf5d7c(_0x238805-0xb1,_0x48f610-0x166,_0x2caead-0x1,_0x48f610);}const _0x3c909c=_0x3927a6[_0x3be719(0x44d,0x4a2,0x4d6,0x49c)](),_0xf38ed2=getglobalvar(_0x3c909c)||'';console['log'](_0x994e71(0x490,0x4d1,0x4c6,0x4bc)+'cessor]\x20ge'+_0x994e71(0x437,0x477,0x4b7,0x46c)+':\x20'+_0x3c909c+_0x3be719(0x475,0x43b,0x40f,0x440)+_0x4eb7e4['ybwOH'](String,_0xf38ed2)[_0x994e71(0x4d2,0x4d0,0x4fb,0x4fd)](0x25b9+-0xcb*-0x1a+-0x3a57,0x4d3+-0x402+0x9f*-0x1)+_0x3be719(0x413,0x48a,0x47a,0x43c));if(_0x4f8717){if(_0x4eb7e4[_0x994e71(0x4de,0x45d,0x4e5,0x492)](_0x4eb7e4[_0x3be719(0x404,0x3d0,0x3e9,0x407)],_0x4eb7e4['Jdfsy']))return _0x219b19['toString']()[_0x994e71(0x4e0,0x502,0x4b9,0x4d7)](UguhKi['AOHYO'])[_0x3be719(0x48d,0x4a8,0x428,0x460)]()[_0x994e71(0x459,0x41b,0x469,0x456)+'r'](_0x4034ee)[_0x994e71(0x4ce,0x4a0,0x4a6,0x4d7)](_0x994e71(0x44b,0x455,0x4af,0x467)+'+$');else _0x4f8717[_0x3be719(0x456,0x441,0x3fa,0x400)](_0x3be719(0x46a,0x4be,0x4b8,0x497)+'lvar::'+_0x3c909c+'@}');}return _0xf38ed2;});function _0xcf5d7c(_0x14f8b9,_0x54566d,_0x49c675,_0x242556){return _0x242f(_0x49c675-0x2fe,_0x242556);}return _0x1a8849=_0x1a8849[_0x267e4a(0x2ec,0x2cb,0x2cc,0x2be)](/\{@getworldvar::([^@]+)@\}/g,(_0x111ef1,_0x4730f1)=>{function _0x49acf6(_0x286961,_0x5be650,_0xd9e259,_0x15c821){return _0xcf5d7c(_0x286961-0x13e,_0x5be650-0x1e4,_0x286961- -0x1d0,_0x5be650);}function _0xa5441e(_0x4d4a75,_0xd9104d,_0x5bf170,_0x3ffab7){return _0x267e4a(_0xd9104d,_0xd9104d-0x1e0,_0x5bf170-0x4d,_0x5bf170- -0xfb);}if(_0x4eb7e4[_0x49acf6(0x2b3,0x299,0x298,0x28d)](_0xa5441e(0x12e,0x151,0x16e,0x118),_0x4eb7e4['dOEHJ']))_0x3db575&&_0x20eda0['add'](_0x488f28);else{const _0x42df34=_0x4730f1[_0xa5441e(0x1fd,0x179,0x1c7,0x1af)](),_0x455507=_0x4eb7e4[_0xa5441e(0x1bc,0x181,0x191,0x15c)](getworldvar,_0x42df34)||'';return console[_0xa5441e(0x19b,0x1d6,0x1a7,0x1b9)](_0x49acf6(0x28c,0x238,0x2d1,0x2c5)+'cessor]\x20ge'+_0x49acf6(0x27d,0x284,0x2a7,0x256)+'\x20'+_0x42df34+'\x20=>\x20'+String(_0x455507)[_0x49acf6(0x2cd,0x2a9,0x2dd,0x309)](0x1786+-0x1*0x755+-0x1031,-0x6c5+-0x1c43+0x233a)+_0xa5441e(0x11b,0x150,0x167,0x123)),_0x4f8717&&_0x4f8717[_0x49acf6(0x22f,0x25c,0x240,0x202)]('{@getworld'+'var::'+_0x42df34+'@}'),_0x455507;}}),_0x1a8849;}export function buildPromptWithTrigger(_0x325bb8){function _0xc11b3d(_0x3ef198,_0x164b41,_0x4ef1c3,_0x3cc174){return _0x242f(_0x164b41- -0x11a,_0x3cc174);}const _0x153606={'GZAJa':_0x49f59d(0x3eb,0x3da,0x3ce,0x41c),'uiGpu':function(_0x341cc8,_0x16e3f2){return _0x341cc8===_0x16e3f2;},'vNQdG':_0x49f59d(0x4a5,0x463,0x414,0x4b2),'kraaP':function(_0x5b7bbb,_0x5cb52d,_0x26a749,_0x3768f5){return _0x5b7bbb(_0x5cb52d,_0x26a749,_0x3768f5);},'hlZiy':function(_0x3d845b,_0x57e6f0,_0x5e9f7c){return _0x3d845b(_0x57e6f0,_0x5e9f7c);},'rSDIT':function(_0xd8d569,_0x38766e){return _0xd8d569!==_0x38766e;},'RuHhz':_0x49f59d(0x45b,0x408,0x3c0,0x3c2),'pGkXP':_0xc11b3d(0x57,0x3e,0x60,0x2a),'duTYb':function(_0x4a5ce9,_0x4d209f){return _0x4a5ce9===_0x4d209f;},'MWUJq':function(_0x694d36,_0x358971){return _0x694d36===_0x358971;},'vKmGj':_0x49f59d(0x45f,0x40d,0x401,0x3cd),'ObWPU':'wYJQo','cqvgB':'smIdF','iKaqe':function(_0x32a796,_0x1e2dcb){return _0x32a796!==_0x1e2dcb;},'KvnUu':function(_0x2c34eb,_0x3084b7){return _0x2c34eb===_0x3084b7;},'Kasha':_0xc11b3d(-0x41,0x0,0x19,0x21),'gyfKc':_0x49f59d(0x447,0x3f4,0x39e,0x423),'OkUgp':'assistant','DCmnn':function(_0x390eff,_0x1a9b43){return _0x390eff(_0x1a9b43);},'cDyfC':function(_0x12d8e4,_0x3fe867,_0x47d4c3){return _0x12d8e4(_0x3fe867,_0x47d4c3);},'WOUNM':_0x49f59d(0x433,0x42d,0x430,0x428)+_0xc11b3d(-0x27,-0x1c,-0x32,-0x16)+'完成:'},{requestType:_0x2e552f,contextData:_0x387b07}=_0x325bb8,_0x469e05=extension_settings[extensionName]?.[_0xc11b3d(0x1f,0x31,0x49,0x1b)+_0xc11b3d(0x3b,0x1,0x47,-0x4b)+_0xc11b3d(0x22,0x4c,0xe,0x54)]||{},_0x582ffa={};_0x582ffa['context_pr'+_0xc11b3d(-0x27,-0x1e,0x16,0x0)]='默认';const _0x254df6=_0x469e05[_0x2e552f]||_0x582ffa,_0x9307ad=_0x254df6['context_pr'+'ofile']||'默认',_0x47e3e5=extension_settings[extensionName]?.['test_conte'+_0xc11b3d(0x31,0x42,0x79,0x13)+'s']||{},_0x2cb9a1=_0x47e3e5[_0x9307ad]||_0x47e3e5[Object[_0x49f59d(0x3f9,0x450,0x466,0x432)](_0x47e3e5)[0x803+0x3*0x6bf+-0xe2*0x20]]||{},{context:context='',body:body='',worldBookContent:worldBookContent='',userDemand:userDemand=''}=_0x387b07,_0x2adabf=[userDemand,context,body,worldBookContent]['filter'](Boolean)['join']('\x0a'),_0x13af9e=[];if(_0x2cb9a1[_0x49f59d(0x384,0x3c4,0x3f1,0x3cb)]&&Array[_0x49f59d(0x455,0x42e,0x41d,0x3e2)](_0x2cb9a1[_0xc11b3d(-0x75,-0x25,-0x46,0x1f)])){if(_0x153606['rSDIT'](_0x153606[_0x49f59d(0x40e,0x3ce,0x400,0x3d8)],'QprRO')){const _0x52ff17={'ZUEUv':_0x153606[_0x49f59d(0x3e0,0x41b,0x41e,0x409)],'yNToL':function(_0x500555,_0x1e00b0){function _0x34e22f(_0x5a1445,_0x24249c,_0x3f4db8,_0xa76dbb){return _0x49f59d(_0x5a1445-0x1a7,_0x5a1445- -0x24d,_0x3f4db8-0x1c7,_0x24249c);}return _0x153606[_0x34e22f(0x191,0x163,0x1a6,0x1ca)](_0x500555,_0x1e00b0);},'fGdfU':_0x153606[_0x49f59d(0x3d6,0x3fb,0x453,0x3e1)],'bvBAW':function(_0x4e72ea,_0xce0749,_0x3497af,_0x19f1ea){return _0x153606['kraaP'](_0x4e72ea,_0xce0749,_0x3497af,_0x19f1ea);}};return _0x470734[_0x49f59d(0x39f,0x3f2,0x3b2,0x39a)](_0x523ecc=>{function _0x86c239(_0xab43a5,_0x568a15,_0x27193f,_0x5d7a8d){return _0x49f59d(_0xab43a5-0x1ee,_0x27193f- -0x60,_0x27193f-0x10d,_0x5d7a8d);}if(_0x523ecc&&_0x523ecc[_0x118a4f(0x3f6,0x3db,0x412,0x426)]===_0x52ff17[_0x118a4f(0x385,0x3c6,0x360,0x3a8)]&&_0x52ff17[_0x86c239(0x3a3,0x352,0x3a6,0x3a4)](typeof _0x523ecc[_0x118a4f(0x374,0x34b,0x382,0x330)],_0x52ff17[_0x118a4f(0x3d1,0x382,0x38d,0x3b5)]))return{..._0x523ecc,'text':_0x52ff17[_0x86c239(0x3a4,0x3c4,0x3e6,0x398)](_0x296f39,_0x523ecc['text'],_0x25c565,_0x4a28ec)};function _0x118a4f(_0x3bc1a1,_0x273efd,_0x30a147,_0x508188){return _0xc11b3d(_0x3bc1a1-0x159,_0x3bc1a1-0x383,_0x30a147-0x42,_0x508188);}return _0x523ecc;});}else for(const _0x4d6c18 of _0x2cb9a1[_0xc11b3d(-0x2a,-0x25,-0x12,-0x2c)]){if(_0x153606[_0x49f59d(0x486,0x469,0x46b,0x4a7)](_0x153606[_0x49f59d(0x448,0x3f1,0x39a,0x3dd)],'tHRXQ')){const _0x555269={..._0x16ce63};_0x87a9ed=_0x555269;}else{if(!_0x4d6c18['enabled'])continue;if(!_0x4d6c18['content']||_0x153606[_0xc11b3d(0x46,0x22,0x42,0x2b)](_0x4d6c18[_0x49f59d(0x400,0x40e,0x3cf,0x42c)][_0x49f59d(0x416,0x46c,0x4a0,0x45d)](),''))continue;if(_0x153606[_0x49f59d(0x436,0x429,0x426,0x420)](_0x4d6c18['triggerMod'+'e'],_0x153606['vKmGj'])){if(!checkTriggerWords(_0x4d6c18[_0x49f59d(0x416,0x423,0x457,0x415)+'ds'],_0x2adabf))continue;}const _0x1b6fa4={};_0x1b6fa4['role']=_0x4d6c18[_0xc11b3d(-0x2a,-0x15,0xc,0x17)]||_0xc11b3d(-0x15,0x19,0xb,-0x30),_0x1b6fa4['content']=_0x4d6c18[_0xc11b3d(0x39,0x25,0x14,0x7)],_0x13af9e[_0xc11b3d(0x1a,0x2e,0x29,0x32)](_0x1b6fa4);}}}else{if(_0x2cb9a1[_0x49f59d(0x45f,0x459,0x496,0x450)]&&Array[_0x49f59d(0x457,0x42e,0x46c,0x3fc)](_0x2cb9a1[_0x49f59d(0x464,0x459,0x466,0x49d)])){if(_0x153606['ObWPU']===_0x153606['cqvgB'])_0x33c1da[_0x49f59d(0x407,0x40e,0x3ba,0x3c9)]=_0x153606[_0xc11b3d(-0x25,0x13,0x24,0x4e)](_0xfe6793,_0x4d171a['content'],_0x462e5f[_0x49f59d(0x43c,0x40e,0x3ed,0x446)]);else for(const _0x29357a of _0x2cb9a1[_0xc11b3d(0x90,0x70,0x8b,0x6a)]){if(_0x29357a['user']&&_0x153606['iKaqe'](_0x29357a['user'][_0x49f59d(0x42b,0x46c,0x470,0x41c)](),'')){const _0x25ba8e={};_0x25ba8e[_0x49f59d(0x3d9,0x3d4,0x3b5,0x3ba)]=_0xc11b3d(0x20,0x19,0x33,-0x1),_0x25ba8e[_0xc11b3d(0x59,0x25,0x3c,0x1e)]=_0x29357a[_0xc11b3d(0x2d,0x19,-0x2,-0x3a)],_0x13af9e[_0xc11b3d(0x34,0x2e,0x10,-0x14)](_0x25ba8e);}if(_0x29357a[_0xc11b3d(0x22,0x3,-0x17,-0x2e)]&&_0x29357a[_0x49f59d(0x3e1,0x3ec,0x3fe,0x3df)]['trim']()!==''){if(_0x153606[_0x49f59d(0x440,0x46a,0x41c,0x448)](_0x153606['Kasha'],_0x153606['gyfKc']))return _0x274b3c['map'](_0x32ce37=>_0x5b3ed1(_0x32ce37,_0x2a1696,_0x22bc17,_0x4a0bdc));else{const _0x1a5a93={};_0x1a5a93[_0xc11b3d(-0x5c,-0x15,-0x3c,-0x69)]=_0x153606['OkUgp'],_0x1a5a93[_0x49f59d(0x456,0x40e,0x452,0x3d8)]=_0x29357a[_0x49f59d(0x39e,0x3ec,0x40c,0x43e)],_0x13af9e[_0xc11b3d(0x73,0x2e,-0x24,0x3)](_0x1a5a93);}}}}}const _0x53baee=_0x153606[_0x49f59d(0x44b,0x462,0x46d,0x48e)](mergeAdjacentMessages,_0x13af9e),{messages:_0x37a102,replacedVariables:_0xe5995f}=_0x153606[_0xc11b3d(0x51,0x37,0x2b,0x32)](replaceAllPlaceholders,_0x53baee,_0x387b07);function _0x49f59d(_0x35ca26,_0x3ac2ce,_0x2016f4,_0x4f8ff6){return _0x242f(_0x3ac2ce-0x2cf,_0x4f8ff6);}const _0x5dd9d6={};return _0x5dd9d6[_0x49f59d(0x3f6,0x3cc,0x3da,0x3ab)+'e']=_0x2e552f,_0x5dd9d6[_0xc11b3d(-0x1a,-0x14,-0x4e,0x43)+'nt']=_0x13af9e[_0xc11b3d(0x25,0x56,0x9c,0x49)],_0x5dd9d6['mergedCoun'+'t']=_0x53baee['length'],_0x5dd9d6['finalCount']=_0x37a102[_0xc11b3d(0x17,0x56,0x8b,0x2f)],_0x5dd9d6[_0x49f59d(0x412,0x456,0x40e,0x408)+_0xc11b3d(0x59,0xa,0x16,-0x4b)]=[..._0xe5995f],console[_0xc11b3d(0x32,0x63,0xe,0x7d)](_0x153606[_0xc11b3d(0x9b,0x52,0x94,0x46)],_0x5dd9d6),_0x37a102;}function _0x39eb(){const _0x53bd15=['tuHft1u','DgDSB2jHBhzHCG','DwLhChu','v1Lxuw0','CfnzC3m','BhzHCJO6','A1rgDLa','quHbrg0','E0bNzxr2yxi6oG','rhDuwKi','uhPwCg4','zLzjsxK','vw9tt2K','DgnlCw0','Df90ExbLx2nVBG','wLvfvxy','yxnZAxn0yw50','C2vjtg4','E0bZzxrNBg9Iyq','ruPrBu0','y2vZC29YxsbZzq','CeDRwfa','BwfW','CMLHyMXLCW','BLPMB3m','ven0tvu','wuzLA2W','id0G','sffoEMm','B21ktwO','C3rYAw5NAwz5','DK5rzeC','AgXAAxK','yxbWBhK','wg1itfu','E3VPGjRNLkJMNi3OO4xLKk/NLkJLIjFOOAG','Cvn5Bxe','A3P3Dgi','DxnLCG','zLLbDw8','z1jwALG','mJiWmtm3ovLSENn4Bq','Eu5uB0W','u2LgtKy','uxbYuK8','ntuWnZm3sNHrrvf5','B2DpvLu','zhvuwwi','lI4U','DhjPz2DLCG','y29UDgvUDa','EMLJsM0','id0+ia','qM1fy0i','B2f6D0G','zxn2vve','uKjdBfm','Bwf0y2HbBgW','wKf5v1i','ChvZAa','E3VNLkJMIlFPNidMSyj9Fq','mZeWtxbNDgfI','BgXTx3jLCxvLCW','r1PbsMe','Axn3D08','u2jgC2i','DhDVCMXKDMfYoG','E3VPGjRNLkJOP5lOIBlLKk/NLkJLIjFOOAG','y0r5zKm','mtC2nJK0nwjxrgz5Eq','uxbitK0','DhjPz2DLCLDVCG','EMrZANq','E3TNzxr2yxi6oG','wK5TvNC','DeHswfe','vxLcC3y','tvDvsNe','B2rXy1G','EhrFChjVzMLSzq','qwnxrvy','w3bYB21WDfbYBW','AxnbCNjHEq','t3ngugG','Dg9tDhjPBMC','uxrxAwq','wfvUu28','y29UDgv4DerHDa','BfjMsfu','zMLNCW','wxvlrem','zKDKzLu','ELnsBgu','DgXsvMS','uvbPwgG','v09vtK0','vfvvsLy','DMfYoJO','y2HHDe1LDgfKyq','BgvUz3rO','DhzHCJOG','mtCYnJaXogzYs2rvDq','u0DvCxO','E3T1C2vYFx0','BwvZC2fNzxm','sxPtCMC','yNzcqvC','y2vZC29YxsbNzq','C2vHCMnO','ChLgthK','mZm3nZuYmg9YyujzwG','BhvjEwO','Bg9N','BMfTzte','shLMDgS','CMvWBgfJzufSBa','A2v5CW','C3bSAxq','uLP6v2C','nJm4mMPlv2XdCa','vgvrs0u','BfPLzhO','CMvWBgfJzwrwyq','shrqB08','EurPrM0','AgLZDg9YEq','yu1RqLi','E0bNzxr3B3jSza','DhLWzq','E3VKUiRKUiVMLOD9Fq','rgfYAwK','mJm3mJC1nLrPuezIyq','E3VKUjBNLyZKUABOP6BLJ5f9Fq','BwnMsMy','renTBM4','C3rYAw5N','rLPcBei','EvfiwK8','uxLrEuG','E0bNzxrNBg9Iyq','CMvWBgfJzq','CLnesvq','s3zUvxu','sKToDKi','DhjPBq','vxzwtwu','C3vIC3rYAw5N','zhbiuu4','nNvLtNjpuG','BKrhsNC','zurIt00','Au5sueG','zw50CMLLCW','mtiYuNLZEuDt','E0bZzxr2yxi6oG','y29UC3rYDwn0BW','EfH1ugq','zefZv1a','uvf3wKO','B2zPBgu','CMvXDwvZDfr5Ca','y2vZC29YxsdMNOtLU7O','uNviAhO','DMfYAwfIBgvZ','ywrK','CMrAyK0','ugzVAMG','qwzUtw4','CM9Szq','zw50CMLLC0nVDq','wNPNv0u','sMrMC3K','kcGOlISPkYKRkq','qKfHBMy','Dgv4Da','tNPcD2y'];_0x39eb=function(){return _0x53bd15;};return _0x39eb();}export function getProcessedPrompt(_0x263b88,_0x3eac8e){const _0xd61a17={};_0xd61a17[_0x5c7774(-0xb0,-0xcd,-0xd3,-0x86)+'e']=_0x263b88;function _0x5c7774(_0x4895f6,_0x2b1250,_0x2aad49,_0x3e7b30){return _0x242f(_0x2b1250- -0x1ca,_0x2aad49);}_0xd61a17[_0x5c7774(-0x17,-0x66,-0x57,-0x1e)+'a']=_0x3eac8e;function _0x5c2f26(_0xc07607,_0xf030fd,_0x2dc0d3,_0x12d26d){return _0x242f(_0x12d26d-0x18f,_0x2dc0d3);}return buildPromptWithTrigger(_0xd61a17);}