(function(_0x1cb882,_0x817d82){function _0x5c2d72(_0x3a455e,_0x5c5285,_0xfb1c77,_0xd8d59b){return _0x4a31(_0x3a455e- -0x309,_0xd8d59b);}function _0x3ee0a1(_0xa87af9,_0x5403f7,_0x2dc91e,_0x117df6){return _0x4a31(_0x117df6-0xda,_0x2dc91e);}const _0x174163=_0x1cb882();while(!![]){try{const _0x31b73d=-parseInt(_0x5c2d72(-0x216,-0x25c,-0x2a4,-0x2b3))/(-0x218*0x4+-0x1*-0x1519+-0x58*0x25)*(-parseInt(_0x3ee0a1(0x2de,0x26d,0x332,0x307))/(-0x1*-0x496+-0x1d*-0xef+-0x1fa7))+parseInt(_0x5c2d72(-0x15f,-0x19a,-0x1c8,-0x1bf))/(0x1504+-0x18b9+0x8*0x77)*(parseInt(_0x3ee0a1(0x1eb,0x24b,0x17e,0x1e2))/(-0x1f*-0x12+0xc*-0xa+-0x1b2))+-parseInt(_0x5c2d72(-0xc4,-0x139,-0x14a,-0x176))/(-0xd19+0x1*0x1a39+-0xd1b)+parseInt(_0x3ee0a1(0x286,0x34c,0x357,0x31b))/(-0x1450+0x1602*0x1+-0x1ac)*(parseInt(_0x5c2d72(-0xfb,-0x54,-0x80,-0xd4))/(0x158f+-0x83f+0x1*-0xd49))+-parseInt(_0x5c2d72(-0x221,-0x2cc,-0x1c8,-0x20f))/(0x2*0x6da+-0x1*0x190f+0x5*0x247)*(-parseInt(_0x5c2d72(-0xe1,-0x145,-0x131,-0x82))/(0x1089+-0x1e56+-0xe*-0xfd))+-parseInt(_0x5c2d72(-0x1d6,-0x282,-0x276,-0x1f8))/(0x1*-0x24f5+-0x5*0x78b+-0x2*-0x255b)+parseInt(_0x5c2d72(-0x206,-0x15a,-0x2ab,-0x16d))/(-0x49*-0x3e+0x37*-0x6d+-0x94*-0xa)*(-parseInt(_0x3ee0a1(0x28b,0x2d7,0x2f9,0x280))/(0x19*-0x5d+0x136*-0xd+0x18df));if(_0x31b73d===_0x817d82)break;else _0x174163['push'](_0x174163['shift']());}catch(_0x397642){_0x174163['push'](_0x174163['shift']());}}}(_0x8a22,-0x2f*-0x644b+-0xb1af7*-0x1+-0x137b51));function _0x4a31(_0x23cf49,_0x370afe){_0x23cf49=_0x23cf49-(0xd*-0x278+-0xe87*0x1+-0x1f*-0x188);const _0x206717=_0x8a22();let _0x2740ae=_0x206717[_0x23cf49];if(_0x4a31['LfsaAc']===undefined){var _0x20c7bb=function(_0x199b01){const _0x1103e2='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x403e5d='',_0x145cb7='',_0x54fe9f=_0x403e5d+_0x20c7bb;for(let _0x2fe1b2=0x260d+0x1*0x15d3+0x1df0*-0x2,_0xc7b2bc,_0x4853fd,_0x2fac0c=0x1657+0x396+0x1*-0x19ed;_0x4853fd=_0x199b01['charAt'](_0x2fac0c++);~_0x4853fd&&(_0xc7b2bc=_0x2fe1b2%(-0x1b0a*-0x1+-0x18e3*-0x1+-0x33e9)?_0xc7b2bc*(0x99*-0x1d+0x129c+-0x107)+_0x4853fd:_0x4853fd,_0x2fe1b2++%(-0x42d*-0x7+0x26cb+-0x2201*0x2))?_0x403e5d+=_0x54fe9f['charCodeAt'](_0x2fac0c+(-0x54c+0x527+0x2f*0x1))-(-0x1372*0x1+0x264*0x5+0x788)!==0x13a4+-0x22f5+0xf51?String['fromCharCode'](0x315*-0x2+0x12db+-0xbb2&_0xc7b2bc>>(-(0x2*-0xf04+0x20f2*0x1+-0xf8*0x3)*_0x2fe1b2&0x23ed+-0x2325+-0xc2)):_0x2fe1b2:-0x1f1*0x9+0x1d16+-0xb9d){_0x4853fd=_0x1103e2['indexOf'](_0x4853fd);}for(let _0x548616=-0x1ec8+-0x18df*-0x1+-0x5e9*-0x1,_0x1213bb=_0x403e5d['length'];_0x548616<_0x1213bb;_0x548616++){_0x145cb7+='%'+('00'+_0x403e5d['charCodeAt'](_0x548616)['toString'](0x3d*0x52+0xd54+0x13*-0x1ba))['slice'](-(-0x23*0xc5+-0x1*-0x5f1+0x380*0x6));}return decodeURIComponent(_0x145cb7);};_0x4a31['fwBLXI']=_0x20c7bb,_0x4a31['SLcqZU']={},_0x4a31['LfsaAc']=!![];}const _0x47371c=_0x206717[0xad*0xb+-0xf14+-0x67*-0x13],_0x203c88=_0x23cf49+_0x47371c,_0x7fba80=_0x4a31['SLcqZU'][_0x203c88];if(!_0x7fba80){const _0xf8a3e6=function(_0x200ff5){this['JzmZMz']=_0x200ff5,this['eZtGPX']=[0xb83+0xa8e*0x3+0x133*-0x24,-0x700+-0x8ac+-0x3eb*-0x4,0xfb1+0x6*-0xbf+0x1*-0xb37],this['QFjwCT']=function(){return'newState';},this['dkZnpe']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['SXElVx']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0xf8a3e6['prototype']['shFtIE']=function(){const _0x1bfa47=new RegExp(this['dkZnpe']+this['SXElVx']),_0x1f24cb=_0x1bfa47['test'](this['QFjwCT']['toString']())?--this['eZtGPX'][-0x171d+0x1*-0xcf1+0x1*0x240f]:--this['eZtGPX'][0x21b8+0x1*0xf4e+0xfb*-0x32];return this['knDBTz'](_0x1f24cb);},_0xf8a3e6['prototype']['knDBTz']=function(_0x5af89b){if(!Boolean(~_0x5af89b))return _0x5af89b;return this['ZntdXp'](this['JzmZMz']);},_0xf8a3e6['prototype']['ZntdXp']=function(_0x4f2273){for(let _0x26edcf=-0x26e5+-0xe*0x105+0x352b*0x1,_0x1d0fd1=this['eZtGPX']['length'];_0x26edcf<_0x1d0fd1;_0x26edcf++){this['eZtGPX']['push'](Math['round'](Math['random']())),_0x1d0fd1=this['eZtGPX']['length'];}return _0x4f2273(this['eZtGPX'][-0x1b9c+-0x1*-0xe11+0xd8b]);},new _0xf8a3e6(_0x4a31)['shFtIE'](),_0x2740ae=_0x4a31['fwBLXI'](_0x2740ae),_0x4a31['SLcqZU'][_0x203c88]=_0x2740ae;}else _0x2740ae=_0x7fba80;return _0x2740ae;}const _0x5f1a0a=(function(){function _0xb239b1(_0x3d0121,_0x55e9f8,_0x18f025,_0x2e15f5){return _0x4a31(_0x55e9f8- -0xf9,_0x3d0121);}const _0x14dc71={'jeoYG':function(_0x388a87){return _0x388a87();},'NkBDb':_0x3995ee(0x319,0x3bd,0x336,0x288)+_0x3995ee(0x34d,0x325,0x339,0x3c8),'vjAcR':function(_0x385287,_0x1a6e18){return _0x385287+_0x1a6e18;},'SfeeT':function(_0x36a423,_0x641fc5){return _0x36a423===_0x641fc5;},'LFtNp':_0x3995ee(0x2e3,0x230,0x31d,0x2d6),'uAXwy':function(_0x5ca655,_0x2978f9){return _0x5ca655!==_0x2978f9;},'CyVfd':_0x3995ee(0x41e,0x426,0x38d,0x418)};function _0x3995ee(_0x37597c,_0x133219,_0x4d24cb,_0x1c3d3d){return _0x4a31(_0x37597c-0x1fa,_0x4d24cb);}let _0x8e100b=!![];return function(_0x427e12,_0x588ba6){function _0x1e351a(_0x3f39aa,_0x55815f,_0x20239f,_0x4b1f6f){return _0xb239b1(_0x3f39aa,_0x20239f- -0x25b,_0x20239f-0x8e,_0x4b1f6f-0xb5);}function _0x4e602a(_0x261d08,_0x527db6,_0x3713e7,_0x4401f4){return _0x3995ee(_0x3713e7- -0x432,_0x527db6-0x115,_0x527db6,_0x4401f4-0x17f);}const _0x2a1941={'RzcnD':function(_0x4cffa4){function _0x41d18c(_0x17a955,_0x3e21fc,_0xdaaa7e,_0x3087c6){return _0x4a31(_0xdaaa7e-0x1ce,_0x17a955);}return _0x14dc71[_0x41d18c(0x367,0x435,0x3ed,0x44a)](_0x4cffa4);},'nTDVy':function(_0x1a595e){function _0x99b040(_0x1faa2d,_0x4b2930,_0x1fea2d,_0x572fb3){return _0x4a31(_0x4b2930-0x340,_0x572fb3);}return _0x14dc71[_0x99b040(0x54f,0x55f,0x59c,0x5a1)](_0x1a595e);},'bTYbR':_0x14dc71[_0x1e351a(-0x24f,-0x23c,-0x1b9,-0x222)],'QnSgp':function(_0x3a2bac,_0x3e6517){function _0x25c2d4(_0x3f2b3f,_0x3a7c62,_0xd413b9,_0x1350cd){return _0x1e351a(_0x1350cd,_0x3a7c62-0x22,_0x3f2b3f-0x275,_0x1350cd-0x1cb);}return _0x14dc71[_0x25c2d4(0x12e,0xfc,0x134,0x82)](_0x3a2bac,_0x3e6517);},'XOdfn':function(_0x4203d9,_0x444b6b){return _0x14dc71['SfeeT'](_0x4203d9,_0x444b6b);},'aJPsU':_0x14dc71['LFtNp'],'qhSah':_0x4e602a(-0xc7,-0xff,-0x122,-0x140),'vGWww':_0x1e351a(-0x9e,-0x14f,-0xff,-0xb3)};if(_0x14dc71[_0x4e602a(-0x12c,-0xb5,-0x133,-0x7e)]('siOis',_0x14dc71[_0x4e602a(0x20,0xa,-0x81,0x41)]))!_0x4026a3[_0x1e351a(-0x307,-0x1ee,-0x259,-0x1df)+_0x4e602a(-0xcb,-0x1a4,-0x12f,-0x9f)]&&(_0x566086['initialize'+_0x1e351a(-0x1ef,-0x281,-0x24b,-0x28d)]=!![],_0x2a1941[_0x4e602a(-0xf3,-0x156,-0x131,-0x14d)](_0x20dffc)),_0x2a1941['nTDVy'](_0x56c3ed);else{const _0x36ea56=_0x8e100b?function(){function _0x46db64(_0x285f99,_0x40ef6f,_0x57b72a,_0xdf33e6){return _0x1e351a(_0x57b72a,_0x40ef6f-0x1cd,_0x285f99-0x5c9,_0xdf33e6-0xc3);}function _0x21475a(_0x4f50b1,_0x417c3a,_0x2d1c9f,_0x4fefda){return _0x4e602a(_0x4f50b1-0x151,_0x4f50b1,_0x4fefda-0x22f,_0x4fefda-0x8);}if(_0x2a1941[_0x46db64(0x475,0x466,0x48c,0x4b7)](_0x2a1941[_0x21475a(0x18a,0xfc,0x234,0x1a2)],_0x2a1941[_0x46db64(0x379,0x312,0x3fe,0x339)]))throw new _0x3ea4c2(_0x2a1941[_0x21475a(0x99,0x194,0x172,0x10b)]);else{if(_0x588ba6){if(_0x2a1941[_0x21475a(0x2a3,0x17f,0x27b,0x1f7)]('YTZzu',_0x2a1941[_0x21475a(0x50,0x13c,0x169,0x101)])){const _0x479143=_0x588ba6['apply'](_0x427e12,arguments);return _0x588ba6=null,_0x479143;}else _0x4482f2=_0x2a1941['QnSgp'](_0x2a1941[_0x46db64(0x3e8,0x42a,0x34a,0x448)](_0x5bc00d,',\x20'),_0x32217c['Character\x20'+_0x137a95+'\x20Prompt']);}}}:function(){};return _0x8e100b=![],_0x36ea56;}};}()),_0x3bc820=_0x5f1a0a(this,function(){function _0x5126b0(_0x36aacd,_0x596b4f,_0x3aa6dc,_0x3cb497){return _0x4a31(_0x3cb497-0x220,_0x596b4f);}function _0x3993e2(_0x5e1a04,_0x235c30,_0x12f5b1,_0x459e28){return _0x4a31(_0x5e1a04-0x36a,_0x235c30);}const _0x469deb={};_0x469deb[_0x3993e2(0x5bc,0x593,0x5ad,0x595)]=_0x3993e2(0x55e,0x570,0x578,0x5e1)+'+$';const _0x12d254=_0x469deb;return _0x3bc820[_0x5126b0(0x41a,0x3bb,0x40c,0x37c)]()['search'](_0x12d254[_0x5126b0(0x501,0x453,0x410,0x472)])[_0x5126b0(0x366,0x2fa,0x438,0x37c)]()[_0x3993e2(0x547,0x4c8,0x4c5,0x5b7)+'r'](_0x3bc820)[_0x3993e2(0x4a3,0x536,0x561,0x544)](_0x12d254[_0x5126b0(0x421,0x492,0x3c4,0x472)]);});_0x3bc820();import{sleep,zhengmian,fumian,deepMerge,getSDMode,setSDMode,addLog,getRequestHeaders,clearLog,prompt_replace,getsdAuth,parsePromptStringWithCoordinates,prompt_replace_for_character,stripChineseAnnotations,convertImageToJpeg,deduplicateTags}from'./utils.js';import{setItemImg}from'./database.js';import{extension_settings}from'../../../../extensions.js';import{extensionName,EventType}from'./config.js';function _0x8a22(){const _0x4b2d12=['5Q2J6z2I5O+q56s6icHqCM9T','og4UChq','5Qch5yEg5QIH5BYpoIdKVB/NLkJOR7FMSyi','5y+r6ycbu0tNLj/LM77LPlhOTkxLK43LUPq','cI0GkIRPH43NU5JLUyxLUQyG','q1ngEwC','vM9sExO','u1Lqte4','we9KzM4','ptaUosXLBJTXpq','DxvwzMO','Dhj1zq','r3jhywO','kfnHBxbSzxiPoG','ksbbChbSzvDLyG','y1bYsLe','yxv0B191CMW','zgf0ytPPBwfNzq','q2HHCMfJDgvYia','mc44','wNjqA1G','DMPby1i','mJHvtefgvxG','ksaTifbYB21WDa','B2rLBcK6kIOG','wKXJrKS','C2tOR7FMSylNLj/LM77PLjNOR686ia','6z2I5O+q56s66k+noG','vKTuthK','5z2q5Qch55Qe5O+q56s66k+n5A2x56YM5lIY44cc','uhjVBxb0ktOQkG','Bw9Kzq','AgfYywn0zxjozq','wKXuuNm','cI0TlqOGicaG','EgLPreq','zNH0suu','kIOG','y211uhq','AMvVwuC','Bw1RAxy','Aw9U','zwPsz3q','ktOQkIa','C2LpAxm','Eu92rxO','C0nlyKi','CwHxAui','otLQCKXRCLa','AwTLieDLy2TVkq','CMf0Aw5NigLTyq','vxnLCI1bz2vUDa','Aw1Hz2vhzw5jBG','mtuWmduWu0fjDgni','5lU75yQH5BEY6kkR55sO5OI35y+w5RAi44cc','of9TB2rLBa','ChqPoIOQia','cI0GkIRMLl7LPkFLGi3NJOCG','v1PqA24','56cboIa','BMvYyxrL','kerPDMLKzv9YBW','yxv0Aa','vunqx3nK','qwnJzxb0luXHBG','wKHUy1O','AEAyR+wqPUATO+w4UowqR+wkQo+8Jow5TUAJGa','l3nKyxbPl3yXlW','AuzyswK','rNHwDMK','z3vHz2u','sxjXBLy','DhjPBq','mtG4odC4mNbqyMXQvq','uvzoEfK','tMnHu0m','EuzbrwK','mtm4ndeWywTdANfI','Dgv4Da','rKzHAva','ALveCvG','cI0GkIPdrKCGuW','CKnuugO','BgvUz3rO','u0tNLj/LM77MTyhNQiVMJzxOJRFLIldLVii','C2fTCgXLCL9Uyq','s2XuDeW','kerLBM9PC2LUzW','u2TPCdOQkIa','re9rv2m','CwTIs0u','Aw1Hz2u6','thf5rgy','wvrAENu','Df9LBMq','C3vJy2vZCW','y3nny04','y29TCgXLDgvuyq','r0vorvjbvevFsq','zwvKktOQkIa','uKTLB1e','Bg9Hza','mJiYmG','ifbYB21WDa','vLz0Cuq','ke5Lz2f0AxzLia','C3vIC3rYAw5N','zMfJzv95B2XVDG','CgfYC2u','C2rdzMDty2fSzq','cI0GkIRNP43LRzaGkfm','6i635y+w5OIw6icf5yIh5O2I5QIH5z6l5AsX6lsL','s2nODw8','tLnf','5BcD6k+v5l2C5lI65y6F5AEliejHCW','BNnUsge','CMvTB3zLtgLZDa','mZG1ntC2Ew1iB2TJ','AxLcyKe','y2vZ','AhDQsfC','zMfJzsdKUlRLVidLKk8','5BEY5ywZ6zET44cc','yw1L','A29jCfK','ifn0CMvUz3rOkq','cI0GkIRPQ5JMUixKV67LPi0G','B2DsAhO','mtnvBvLiA0G','cI0GkIRPH4FMOlFMLRNMS5uG','AePzC1u','of9Zy2HLzhvSzq','cI0GkIRLSlRLR7GGkfm','zhfXtei','sMLjvxm','DvDbCvq','Aw5PDgLHBgL6zq','5zon5BQu5yAf5A65oG','DwzeELm','keHPCMvZiezPEa','zurMwNC','Aw5JBhvKzxm','C2rvCMW','Cgf5Bg9Hza','mti4nJu2ntvfANDzsgS','CwHtywG','DufyD3K','qxfYDvi','uNPJBKq','ndi1nMLmzeLnAa','u0rmAxn0zw5LCG','DKDxD3C','w1nexsdLKiJLUBBOP5lOIBlOTj8','wwrhzfu','sLnptIdOP6pMNPdLPlhOTkxVViW','DtHFC2rFyxv0Aa','B3zLCNjPzgvFCW','y2zNx3nJywXL','A0nvEMS','6i635y+w5QIH5z6l5AsX6lsLoIa','lI4U','yLrzyLi','yNveqxK','A3bcqxa','ren6zwy','ywrKvgfZAW','DMHXuge','lcdOR6BMG4u6ia','sfntuve','CM9S','D2DIvxe','sxfYt1q','qvbj5zon5BQu5lIT5PYQ5OM+5yIW5zU+','DxbKyxrLu3rHDa','v3bRtui','zw5LCG','vgDvEgu','tK9Us3C','sMnAA2q','of91ChnJywXLCG','oIOQia','CgzZBg0','q2fJAguTq29UDa','q29UDgvUDc1uEq','77Ym6k+35Qoa5P+LC2r3zwj1','z1vUvMW','s2L0lZuZnY4ZnG','Dg9Rzw4','5lU75yQH5BEY5y+w5RAi','EgLHBMnOzw5Nia','A2LW','twXotxe','otuZmJq2meX3wwDNtW','ENPXyMS','AgvPz2H0','cI0GkIPdBgLWia','CMvZDg9Yzv9Myq','ANnVBG','C2vHCMnO','C2rFy3DPzhrO','6zQp5PY6kc0Xkq','vNLLDg4','zgvUB2LZAw5NxW','CMvZDg9YzuzHyW','ugzQBfi','5BEY5yID5AEl5yYw44cc','B3nPDgLVBG','Dc1TB2rLBa','Cuz1yvu','uhjHz21H','CeTivem','Bg9N','teDhyK0','C3rFy2HHDhu4xW','zw1PDa','5zU+5y+c5PwW5OQL5zgkcI0GkIO','kfjLC3rVCMuGrG','Aw1Hz2veyxrH','tufhrv9srvnqtW','rvzzzfm','r0PguLe','rwviy2W','yLLkuKu','AhjFC2nHBgu','5yop5PwW5O2U44cc','5Q2J5zYO5yIh5O2I5QIH5z6l5lI6','DxjS','y29UDMvYDfrVsG','svnAyxO','s2jNwgG','EKTSB2u','5zU+5yop5BEY5OIq5yQF6i635y+w5BM25Qc85BYp','of92ywu','Dg9tDhjPBMC','mc4WlJaUmcbtyq','C2rFy2fKzxrHAq','tw96AwXSys81lG','l2fWAs9Zzc9Zzq','tgPSzMG','ve9RuMi','BI9QC29U','Aw1Hz2vZ','zxvL','C2rFy3vWC2nHBa','5Q2J5zYO6k6+572U5QIH5z6llI4U5lI6','whvluKq','yxrFBgfZDf9Syq','mcaOv2LUzg93CW','C2vLza','44cc5zon5BQu5yAf5A65oIa','zgzpuu4','ELDPDKW','EKz4reO','ywrLDgfPBgvYxW','EwvYCW','te9nCwO','uw5tz3a','rKvoEgG','of9Zyw1WBgvYtG','v0zOAu8','zty0ioAvSoAnRUwKHoEqHUoaGG','t29XAvu','D2LKDgG','C3rLChm','rKXPCMW','Bw9KzwW','BMvYyxrPB24','tM1zqMe','5yIh5O2I5QIH5z6l5AsX6lsLoIa','cI0GkIRMQkhLNOSGke0','zNjwuLu','CM9sEui','rxjYB3iGz2vUzq','A1vlrvG','vfrrAvK','suq6ia','BfnJwgi','z2DJyMe','6k+V44cc54Q25Ocb56cboIa','l2fWAs9Zzc9Nzq','De12BNG','y2HHBMDL','yu92DvC','z2u6','cI0GkIPwquu6kG','tezUyxq','v2LUnJq7ihG2na','u0qG55sF5zU+5lQl5lU255Ur5zcS5zMO','tMjVvLu','DhH0mMLTzW','yMvUthi','icHjrdOG','qwv0zwK','C2rFy2nOyxr1xW','C2rFy2rLBM9PCW','BMvNyxrPDMvqCG','tMTcrgi','AxnuyxnRsw5rDq','EgLHBMnOzw5N','6k+35Rgc5AsX6lsLloEkTUAaGEEGGtOG','icHlsfrntcWGBa','vgrly2u','vKjHy00','6zsz6k+VoIa','BMHQy0W','5yYw5lI6igrHDgeGvvi','D3Prs0C','mtjZy0vSvMK','loAOOEwEI+s4UG','6AUy5RIf5l+U5Asnios4UG','zKztt3y','mtiZANPqzxzj','yuPqC1u','5y+r6ycbu0tNLj/LM77MIjdLIP/LK43LUPq','suDUAeG','C2rFyxv0Aa','ic0Gq2HHBMDLoG','cI0TlqOJiYmG55sF','ExvZAgu','uhjLA0G','5zU+5yop5BEY5A2y5ywL5PwW5O2U5BQtigy','wxnWAgS','5lI6Dhj1zq','BgvY','q3LwzMq','cI0GkIROTj/PNAlMJ5dNPlOG','ktOG','55sO5lQo55sF5OIq55QevgfNoIa','EMGTq04SEMG7Cq','AfnxD1G','uw5psvu','tKrWBhe','C3rHDhvZvgv4Da','5Q2J5zYO6k6+572U5QIH5z6l5lI6','zv9Mywn0B3i','DgvYDMfS','rg5zDge','Afzcu0q','yKPjyuq','B2jRD20','57Yt5A2y6k6+572U5lI65lIn5A2y5ywL5PwW5O2U','u3zmt2S','C3rHDhvZ','zw5HyMXLx2HY','C2rFy2HPCMvZxW','5P+L5QIH5z6l5PIV5zcM5Q2J56gU44cc','r1HpDMW','Aw5Nx3n0CMvUzW','zxjYB3i','teHRBLq','u2nLBMuGq29TCa','uw5jzfC','5BI4icHjrdOG','CgvNu3rVCMfNzq','yuzLsuu','y2XPzw50','Aw5MBW','zMfYAs81mZCUmW','z2f0AxzLCW','C3rYAw5NAwz5','r3DRBg0','EKnsB1q','y29UC3rYDwn0BW','cI0GkIRMRAxMLBaGkfm','BwvZC2fNzq','r3bvALO','5yIg6kEs6iMY5QIH5BYpoIdOP6pMNPdLUky','y2Dfu2u','se1izeu','t09Usvu','sMLQzxu','zenmyMC','yvfQvgi','AML1z3vHBG','C2rFy2nSAxbFCW','DwPcvxm','y2fJAgu','6yws6AAgioI/LowBNUMuMEIVR+oaGUEkTUAaGq','DgvWCYK6kIOG','ChjVBxb0','ie5uideWlJa7ia','AhDOAue','zML4zwrqCM9TCa','5lIT55QeihbYB21WDooaGG','ue9tva','kcGOlISPkYKRkq','zxr0Aw5NCW','5Ps25yIWu0tNLj/LM77OR7FMSyiGka','yxbWBgLJyxrPBW'];_0x8a22=function(){return _0x4b2d12;};return _0x8a22();}import{saveSettingsDebounced,eventSource}from'../../../../../script.js';import{initializeImageProcessing}from'./iframe.js';import{processCharacterPrompt}from'./characterprompt.js';import{bananaGenerate}from'./banana.js';import{taskQueue,TaskType}from'./taskQueue.js';function getDirectHeaders(_0x103d3a=null,_0x3e3fdc=null){function _0x2f5a83(_0x4a91d1,_0x4b52b9,_0x8b6dd4,_0x13ba6a){return _0x4a31(_0x4b52b9-0x4d,_0x4a91d1);}const _0x458674={'aQjTb':function(_0x3d62cd,_0x2043fa){return _0x3d62cd(_0x2043fa);},'TTQiY':_0x2f5a83(0x219,0x1ac,0x14b,0x183)+_0x3b5c45(-0x211,-0x1c3,-0x1ef,-0x2ae)+_0x2f5a83(0x2d5,0x23c,0x27d,0x242)+_0x2f5a83(0x134,0x1de,0x29c,0x27a)+_0x2f5a83(0x196,0x253,0x2ba,0x2d1)+_0x2f5a83(0xba,0x17a,0x15a,0x1b1)+_0x3b5c45(-0x220,-0xfa,-0x1ba,-0x1e7)+_0x2f5a83(0x31f,0x276,0x2a9,0x2bf)+'\x20Chrome/12'+_0x3b5c45(-0x196,-0x2bb,-0x1fc,-0x14b)+_0x2f5a83(0x24c,0x225,0x260,0x2a0)+'6','QVNxY':'no-cache','hwjHW':function(_0x36ecc0,_0x434ee3){return _0x36ecc0!==_0x434ee3;},'wOFDU':'Authorizat'+_0x2f5a83(0x279,0x26e,0x32b,0x2e4)},_0x454ca0={};_0x454ca0[_0x3b5c45(-0x1ac,-0x157,-0x12e,-0x169)]=_0x458674[_0x2f5a83(0x113,0x1d2,0x277,0x18e)],_0x454ca0['Accept']='*/*',_0x454ca0[_0x2f5a83(0x332,0x285,0x1fe,0x22f)+_0x2f5a83(0x226,0x28b,0x2e2,0x316)]=_0x3b5c45(-0x163,-0x134,-0x19e,-0x11a)+_0x3b5c45(-0x1f9,-0xca,-0x158,-0x11f)+_0x2f5a83(0x312,0x258,0x2ac,0x2ff),_0x454ca0[_0x3b5c45(-0x1b0,-0x29a,-0x230,-0x1ac)+_0x3b5c45(-0x1be,-0x2cd,-0x23d,-0x29a)]=_0x458674[_0x3b5c45(-0x13d,-0xf4,-0x117,-0x5f)],_0x454ca0[_0x3b5c45(-0x157,-0x276,-0x215,-0x258)]=_0x458674['QVNxY'];const _0x556d13=_0x454ca0;_0x103d3a&&(_0x556d13[_0x2f5a83(0x15d,0x177,0x237,0x11a)+'pe']=_0x103d3a);function _0x3b5c45(_0x2ff6df,_0x44f75f,_0x4fc529,_0x4db85a){return _0x4a31(_0x4fc529- -0x359,_0x44f75f);}return _0x3e3fdc&&(_0x458674[_0x2f5a83(0xf4,0x138,0xe6,0x12d)](_0x2f5a83(0x1a9,0x1e0,0x1b1,0x29f),_0x3b5c45(-0x1ad,-0x178,-0x1c6,-0x287))?_0x4f2655[_0x3b5c45(-0x253,-0x242,-0x25e,-0x2d5)+'SDListener']&&(_0x59a7c2[_0x3b5c45(-0x276,-0x291,-0x272,-0x2c9)+'ener'](_0x177bac[_0x3b5c45(-0x3d,-0x11b,-0xff,-0xf7)+'MAGE_REQUE'+'ST'],_0xed6d1c),_0x25c6ad[_0x2f5a83(0xba,0x148,0x1c7,0x168)+'SDListener']=![],_0x458674[_0x3b5c45(-0xd4,-0xbf,-0x172,-0x220)](_0x1d367a,_0x2f5a83(0x272,0x1df,0x1fb,0x159)+_0x3b5c45(-0x2fd,-0x31e,-0x26c,-0x29c))):_0x556d13[_0x458674['wOFDU']]=_0x3e3fdc),_0x556d13;}let currentTaskId=null;async function generateSDImage({prompt:_0x4dac51,width:_0xd8cf3b,height:_0x4439c,change:_0x774bba}){const _0x17cd67={'VoRyz':function(_0x554144,_0xc89164){return _0x554144(_0xc89164);},'xiiDD':_0x2f2c28(0x44f,0x48e,0x4b3,0x4fe)+_0x2f2c28(0x427,0x4d2,0x461,0x38b)+_0x2f2c28(0x4b9,0x558,0x527,0x402),'PrekH':function(_0x501be7){return _0x501be7();},'KbgXh':'标准模式:\x20使用请求'+_0x2f2c28(0x534,0x4fc,0x4ff,0x509),'csMcN':function(_0x1accf9,_0x23dba8){return _0x1accf9(_0x23dba8);},'MdUog':function(_0x496daa,_0x2f5859){return _0x496daa+_0x2f5859;},'CSFyg':function(_0x49af7d,_0x1126c5){return _0x49af7d+_0x1126c5;},'ogRhz':function(_0x345ca6,_0x59b9b0){return _0x345ca6(_0x59b9b0);},'TieeV':'sd_stop_ge'+_0x2f2c28(0x4bf,0x49a,0x4a0,0x4d3),'HSSQQ':_0x387892(-0x26c,-0x25e,-0x24f,-0x2df),'dCLbg':function(_0x45def7,_0x1d4701){return _0x45def7(_0x1d4701);},'bJIaD':_0x387892(-0x271,-0x292,-0x330,-0x322)+'pe','pKHTC':_0x387892(-0x22b,-0x1f3,-0x223,-0x24c)+_0x2f2c28(0x42e,0x413,0x4db,0x450),'NOnKw':function(_0x4c6f8c,_0x8d26a3,_0x9bd0f3){return _0x4c6f8c(_0x8d26a3,_0x9bd0f3);},'NcaSC':_0x2f2c28(0x420,0x4b3,0x497,0x3eb)+_0x2f2c28(0x53b,0x488,0x55f,0x484),'FxVvi':function(_0x357788,_0x594d0a){return _0x357788===_0x594d0a;},'cgESe':function(_0x284e8b,_0x2c9c2f){return _0x284e8b(_0x2c9c2f);},'JSumN':_0x2f2c28(0x4c5,0x4cb,0x502,0x42a)+_0x387892(-0x171,-0x1c5,-0x144,-0x1ae)+_0x387892(-0x20d,-0x1da,-0x284,-0x28b),'ggcba':_0x387892(-0x26b,-0x230,-0x2c7,-0x28d)+_0x2f2c28(0x4f7,0x585,0x542,0x56f),'fmpul':_0x387892(-0x1ba,-0x148,-0x23a,-0x130)+_0x2f2c28(0x557,0x59f,0x554,0x56a),'ejRgt':_0x387892(-0x1ca,-0x24d,-0x1ed,-0x177)+_0x2f2c28(0x483,0x433,0x505,0x4b1),'kSGGZ':function(_0x5a216f,_0x5556c5){return _0x5a216f+_0x5556c5;},'IrqnV':function(_0x1d2ac2,_0x56f36b){return _0x1d2ac2+_0x56f36b;},'VKTLy':function(_0x4bbfed,_0x2b98b1){return _0x4bbfed(_0x2b98b1);},'FENxh':function(_0x10b8a4){return _0x10b8a4();},'ZLcFK':function(_0x3531e8,_0x574a56){return _0x3531e8+_0x574a56;},'lScXb':function(_0x4ae697,_0x14cae3){return _0x4ae697||_0x14cae3;},'GrGaj':function(_0x3fcfe9,_0x5d1f9e){return _0x3fcfe9>_0x5d1f9e;},'IGnhH':function(_0x37753c,_0x13001a){return _0x37753c(_0x13001a);},'MlNMq':function(_0x1769bc,_0x48e593){return _0x1769bc(_0x48e593);},'roRyB':function(_0x1eceb9,_0x80100c){return _0x1eceb9!==_0x80100c;},'SvLOk':_0x387892(-0x19c,-0x1ac,-0x12e,-0x211),'Vyetn':function(_0x58ba94,_0x1244fb){return _0x58ba94(_0x1244fb);},'QnIdW':function(_0x45e02c,_0x1d9e95){return _0x45e02c<=_0x1d9e95;},'zWivL':_0x2f2c28(0x4bd,0x485,0x515,0x52c),'wgbUq':'WmMxo','DnYta':'oZcbx','wzLQR':function(_0x2fe7bb,_0x106a68){return _0x2fe7bb+_0x106a68;},'buDAy':function(_0x3d5572,_0x544d9d){return _0x3d5572+_0x544d9d;},'ISZaz':function(_0x4950a7,_0x1efb0d){return _0x4950a7(_0x1efb0d);},'OoqiU':function(_0x3a2416,_0x5a1923){return _0x3a2416(_0x5a1923);},'LHknT':function(_0x5287b8,_0x45c66c){return _0x5287b8===_0x45c66c;},'TOkRb':_0x2f2c28(0x490,0x408,0x4b7,0x49a),'fxtIE':function(_0x384d27,_0x392311){return _0x384d27+_0x392311;},'BesuX':function(_0x271e24,_0x564de9){return _0x271e24+_0x564de9;},'qFuaU':function(_0x457a82,_0xa913ed){return _0x457a82(_0xa913ed);},'XuKRD':function(_0x24ef7c,_0x42e40a,_0x24c6c8,_0x436d82,_0x1619a3,_0x4d2d3f){return _0x24ef7c(_0x42e40a,_0x24c6c8,_0x436d82,_0x1619a3,_0x4d2d3f);},'JiIUs':function(_0x6f7402,_0x4da366,_0x3627b0){return _0x6f7402(_0x4da366,_0x3627b0);},'koIpY':function(_0x2f4e94,_0xb6ea5d){return _0x2f4e94(_0xb6ea5d);},'yOvEz':_0x2f2c28(0x44d,0x449,0x38c,0x4f0)+_0x387892(-0x188,-0x12e,-0x233,-0x10c),'HMHdE':function(_0x519e98,_0x2c1e2c){return _0x519e98(_0x2c1e2c);},'Ysphk':function(_0x1d9b2a){return _0x1d9b2a();},'oTjSS':_0x387892(-0x1b3,-0x220,-0x18c,-0x1f1),'nsnHa':function(_0x266d70,_0x542dfa,_0x219714){return _0x266d70(_0x542dfa,_0x219714);},'ZLTRs':_0x387892(-0x1a8,-0x199,-0x219,-0x119),'gUnVl':function(_0x15e5c1,_0x1706eb){return _0x15e5c1(_0x1706eb);},'bMMTj':'extension_'+'settingss.'+_0x2f2c28(0x4da,0x52f,0x52b,0x545)+_0x2f2c28(0x571,0x515,0x56e,0x5b2),'zzqbk':function(_0x790adf,_0x505bbf){return _0x790adf!=_0x505bbf;},'RKeoQ':function(_0x2ae55f,_0x58089f){return _0x2ae55f!==_0x58089f;},'fFSOv':_0x387892(-0x210,-0x2b0,-0x183,-0x244),'kCUzk':'BhuhX','benLr':function(_0x3801a0,_0xc0a2cb){return _0x3801a0(_0xc0a2cb);},'TdKce':function(_0x3bf883,_0x4f6568){return _0x3bf883===_0x4f6568;},'QnOIU':_0x387892(-0x1dd,-0x1ad,-0x1dd,-0x1cf),'yFAEi':function(_0x5b3e28,_0x3c4f63){return _0x5b3e28(_0x3c4f63);},'SArZj':function(_0x4baa91,_0x5583a4){return _0x4baa91(_0x5583a4);},'ujBUs':function(_0x36044c,_0xfe47ac){return _0x36044c(_0xfe47ac);},'dfOQN':function(_0x4397ca,_0x5c4f38){return _0x4397ca==_0x5c4f38;},'ufDzS':_0x387892(-0x198,-0x176,-0x134,-0x239),'cmuPt':function(_0x2cb73c,_0x3608fb){return _0x2cb73c==_0x3608fb;},'Gwklm':function(_0x598514,_0x4dadc1){return _0x598514(_0x4dadc1);},'zCRoT':function(_0x2c8237,_0x4d25e1){return _0x2c8237===_0x4d25e1;},'TgUxe':function(_0x5dd9f9,_0x2618ca){return _0x5dd9f9==_0x2618ca;},'EeHcl':_0x2f2c28(0x444,0x3e7,0x4c5,0x3c0),'pfslm':function(_0x1570ed,_0x576fff){return _0x1570ed===_0x576fff;},'bYJRE':'rqKQI','WZPkn':_0x2f2c28(0x593,0x5a2,0x61b,0x5bd),'dqqLB':function(_0x5a8005,_0x125de4){return _0x5a8005(_0x125de4);},'Aetei':function(_0x3b0eb0,_0x1bc9b2){return _0x3b0eb0!==_0x1bc9b2;},'Kchuo':_0x387892(-0x276,-0x284,-0x326,-0x314),'vkuMl':'running','aGASM':'Ckfmp','fDfJs':_0x2f2c28(0x463,0x3fb,0x3d3,0x410),'aOvuW':_0x387892(-0x16d,-0x151,-0x1c7,-0x1af),'KlTtL':'payst_chat'+_0x2f2c28(0x450,0x452,0x3af,0x4b3)+_0x387892(-0x13e,-0x174,-0x163,-0xbb),'eDfZw':_0x387892(-0x211,-0x27c,-0x1ba,-0x2b4)+_0x387892(-0x167,-0x1e3,-0x147,-0xc2),'mQhhS':function(_0x335ec1,_0x3b4c30){return _0x335ec1(_0x3b4c30);},'FFaiP':_0x2f2c28(0x43e,0x4ae,0x445,0x3fb),'LqyDf':function(_0x48d81b,_0x34801d){return _0x48d81b!==_0x34801d;},'jUDqX':'eQyba','GUndy':_0x2f2c28(0x568,0x4cb,0x5b4,0x4dc),'VBacM':function(_0x10a924,_0x393a11){return _0x10a924(_0x393a11);},'GpUjZ':function(_0x5c6f3c,_0x4e404a){return _0x5c6f3c+_0x4e404a;},'BoVyT':_0x387892(-0x192,-0x188,-0x204,-0x1d9)+'/png;base6'+'4,','mmkiv':function(_0x2360ab,_0x1b610b){return _0x2360ab(_0x1b610b);},'uuVfj':function(_0x32c746,_0x7056dc,_0x5e7791){return _0x32c746(_0x7056dc,_0x5e7791);},'LFnat':function(_0x2f9563,_0x479eff){return _0x2f9563(_0x479eff);},'HhkDG':function(_0x5ae1b6,_0x2c574f){return _0x5ae1b6!==_0x2c574f;},'DCzef':_0x387892(-0x15f,-0x1ec,-0x143,-0x17e),'SjExu':function(_0x56e8a0,_0x3c5d2b){return _0x56e8a0(_0x3c5d2b);},'nhjcL':function(_0x16db29,_0x262a6a){return _0x16db29!==_0x262a6a;},'ieoJp':_0x2f2c28(0x569,0x559,0x50a,0x5b7),'Ljlfh':function(_0x294e71,_0x4d600c){return _0x294e71(_0x4d600c);},'weXEH':function(_0x5e1292,_0x15c3f8){return _0x5e1292+_0x15c3f8;},'GJFRQ':_0x387892(-0x1a4,-0x202,-0x1e5,-0x1f5)+_0x2f2c28(0x4a5,0x555,0x505,0x552),'IqrOT':function(_0x3cc262,_0x5d23f2,_0x3ee8d0){return _0x3cc262(_0x5d23f2,_0x3ee8d0);},'YdGdU':function(_0x46a78b,_0x505802){return _0x46a78b(_0x505802);},'NwERx':_0x2f2c28(0x461,0x40c,0x4dc,0x4e3)+_0x2f2c28(0x495,0x489,0x4d0,0x53c),'kUKEX':function(_0x3bcac8,_0x131e74){return _0x3bcac8(_0x131e74);},'ZrPkX':_0x2f2c28(0x49c,0x409,0x3eb,0x40b)+_0x2f2c28(0x4e6,0x552,0x542,0x572)+'L。','cocQn':function(_0x330d78,_0x1ee790){return _0x330d78===_0x1ee790;},'wzQKG':function(_0x5b9bb7,_0x14b3fd){return _0x5b9bb7(_0x14b3fd);},'PfjlR':function(_0x4f4787,_0x606572){return _0x4f4787||_0x606572;},'zFxDJ':_0x387892(-0x225,-0x27c,-0x214,-0x2d0),'OOnIU':function(_0x9b1e58,_0x2987c1){return _0x9b1e58(_0x2987c1);}};_0x17cd67[_0x387892(-0x227,-0x23f,-0x23d,-0x2b5)](clearLog);const _0x46332a=taskQueue[_0x387892(-0x283,-0x206,-0x24c,-0x28a)]({'name':_0x17cd67[_0x2f2c28(0x553,0x4bf,0x534,0x4d8)](_0x17cd67[_0x387892(-0x214,-0x159,-0x184,-0x27b)](_0x4dac51,'')[_0x2f2c28(0x41f,0x385,0x41c,0x381)](-0x749+-0x12bd*0x1+0x1a06,0x1331+-0x218c+0xe79),_0x4dac51&&_0x17cd67[_0x2f2c28(0x546,0x497,0x588,0x5dc)](_0x4dac51[_0x387892(-0x150,-0x1fc,-0x158,-0x159)],0x1e7+0x1*0x1f60+-0x2129)?_0x2f2c28(0x455,0x46c,0x4ce,0x431):''),'type':TaskType['SD'],'prompt':_0x4dac51});currentTaskId=_0x46332a;let _0x42358b=_0x774bba;_0x4dac51=processCharacterPrompt(_0x4dac51),_0x774bba=_0x17cd67['IGnhH'](processCharacterPrompt,_0x774bba),_0x4dac51=await _0x17cd67[_0x2f2c28(0x474,0x405,0x51a,0x4f7)](stripChineseAnnotations,_0x4dac51),_0x774bba=await stripChineseAnnotations(_0x774bba);const _0x5cd494=extension_settings[extensionName][_0x387892(-0x29a,-0x2ff,-0x293,-0x222)][_0x2f2c28(0x582,0x5c7,0x50a,0x4cc)](),_0x2082f0=extension_settings[extensionName];_0x17cd67[_0x387892(-0x19d,-0x100,-0x1d3,-0x205)](addLog,'正在通过sdwebu'+'i生成图片...客户'+'端为'+_0x2082f0[_0x2f2c28(0x518,0x5d8,0x4e8,0x4a1)]+_0x2f2c28(0x4e9,0x57e,0x580,0x442)+_0x2082f0['sd_cchatu_'+'8_model']);const _0x3a7008=_0x774bba&&_0x774bba[_0x2f2c28(0x582,0x5a7,0x570,0x63f)]()!==''?_0x774bba:_0x4dac51;addLog(_0x2f2c28(0x4fc,0x59a,0x4eb,0x58c)+_0x3a7008);let _0x3db8f3=![];if(_0x3a7008['includes'](_0x17cd67[_0x387892(-0x179,-0x186,-0x220,-0x196)])){if(_0x17cd67[_0x2f2c28(0x4c4,0x517,0x496,0x56f)](_0x17cd67[_0x387892(-0x1d3,-0x1e8,-0x221,-0x22d)],_0x17cd67[_0x387892(-0x1d3,-0x277,-0x265,-0x275)])){const _0x37a9b9=_0x325824[_0x2f2c28(0x421,0x417,0x44f,0x45f)](_0x2165f5);_0x595902=_0x37a9b9[_0x2f2c28(0x4a6,0x4da,0x4f6,0x50d)][-0x1*0xd6+-0xb9*0xc+-0x982*-0x1];}else _0x3db8f3=!![];}_0x17cd67[_0x387892(-0x25f,-0x292,-0x284,-0x317)](addLog,'是否启用分角色模式\x20'+_0x2f2c28(0x577,0x584,0x53f,0x57b)+'les):\x20'+_0x3db8f3);let _0x1d91a8={},_0x239071='',_0x1b2cf9='';if(_0x3db8f3){_0x17cd67[_0x387892(-0x269,-0x26a,-0x28b,-0x1e1)](addLog,_0x2f2c28(0x523,0x596,0x4b0,0x47d)+_0x387892(-0x186,-0x18f,-0x12c,-0x166)),_0x1d91a8=parsePromptStringWithCoordinates(_0x3a7008),_0x239071=_0x1d91a8[_0x17cd67[_0x387892(-0x179,-0x1a1,-0x21b,-0x1a4)]];for(let _0x4ede28=0x2660+-0x1e9d+-0x3*0x296;_0x17cd67[_0x2f2c28(0x514,0x532,0x49c,0x4fe)](_0x4ede28,-0x9fe+0x2b*-0xb1+0x27bd);_0x4ede28++){_0x17cd67[_0x387892(-0x22d,-0x2d9,-0x2c9,-0x1c0)]!=='FLirl'?(_0x17cd67[_0x2f2c28(0x540,0x5e8,0x4e4,0x5a2)](_0x131fc9,_0x17cd67[_0x387892(-0x180,-0x10e,-0x111,-0xe2)]),_0x48bea6=_0x5b5cd4):_0x1d91a8[_0x387892(-0x191,-0x11e,-0x14f,-0x11a)+_0x4ede28+_0x387892(-0x2c1,-0x23f,-0x269,-0x24f)]&&(_0x17cd67[_0x2f2c28(0x45f,0x4c3,0x473,0x40d)]!==_0x17cd67[_0x387892(-0x1d8,-0x27c,-0x157,-0x123)]?_0x1b2cf9=_0x17cd67['wzLQR'](_0x17cd67[_0x387892(-0x286,-0x20c,-0x32c,-0x1fa)](_0x1b2cf9,',\x20'),_0x1d91a8[_0x2f2c28(0x54c,0x4e1,0x5a4,0x5be)+_0x4ede28+_0x387892(-0x2c1,-0x2d8,-0x302,-0x247)]):(_0x2fb649[_0x387892(-0x2a0,-0x2d7,-0x32a,-0x25d)+_0x2f2c28(0x44b,0x395,0x3e7,0x4b1)]=!![],_0x17cd67[_0x387892(-0x1e9,-0x17b,-0x290,-0x1d8)](_0x50b185)));}}else _0x17cd67[_0x387892(-0x15e,-0x16b,-0x17e,-0x10f)](_0x2f2c28(0x437,0x3f8,0x4a5,0x46d),'RACdl')?(_0x5ef5db[_0x387892(-0x255,-0x233,-0x2f2,-0x2e4)]('xiancheng\x20'+_0x387892(-0x1e6,-0x15a,-0x17f,-0x29d)),_0xaea5a3[_0x387892(-0x1fe,-0x27e,-0x1b2,-0x21f)]=!![]):(_0x17cd67['ISZaz'](addLog,_0x387892(-0x1a1,-0x1f1,-0x144,-0xf4)+'中的\x20prompt。'),_0x239071=_0x17cd67[_0x2f2c28(0x4ba,0x485,0x4f0,0x417)](deduplicateTags,_0x3a7008));let {modifiedPrompt:_0x1be44c,insertions:_0x3a0da6}=await _0x17cd67['NOnKw'](prompt_replace,_0x239071,_0x1b2cf9);if(_0x3db8f3)for(let _0x19dc82=0x545*-0x6+-0x51a*-0x5+0x139*0x5;_0x19dc82<=-0x1*0xa1b+0x3e2*0x6+0x1*-0xd2d;_0x19dc82++){_0x17cd67[_0x387892(-0x1cb,-0x22a,-0x242,-0x272)](_0x17cd67[_0x2f2c28(0x4a4,0x43d,0x46a,0x3f4)],_0x17cd67[_0x387892(-0x239,-0x1ea,-0x271,-0x198)])?_0x1d91a8['Character\x20'+_0x19dc82+'\x20Prompt']&&(_0x1be44c=_0x17cd67[_0x2f2c28(0x55e,0x4c3,0x4ba,0x577)](_0x17cd67['BesuX'](_0x1be44c,',\x20'),_0x17cd67[_0x387892(-0x258,-0x2e6,-0x25d,-0x2bc)](prompt_replace_for_character,_0x1d91a8[_0x387892(-0x191,-0xfb,-0x189,-0x114)+_0x19dc82+'\x20Prompt']))):(_0x17cd67[_0x387892(-0x19d,-0x170,-0x15f,-0x15d)](_0x4b3f00,_0x17cd67[_0x387892(-0x243,-0x218,-0x1a4,-0x2c4)]),_0x3113a8=_0x17cd67['csMcN'](_0x58d75b,_0x425e7b));}let _0x2c82e7=await _0x17cd67[_0x2f2c28(0x4aa,0x4cc,0x44c,0x4a3)](zhengmian,extension_settings[extensionName][_0x387892(-0x1ea,-0x273,-0x18c,-0x15a)][extension_settings[extensionName]['yusheid_sd']][_0x2f2c28(0x533,0x5b7,0x508,0x506)+'t'],_0x1be44c,extension_settings[extensionName]['yushe'][extension_settings[extensionName]['yusheid_sd']]['fixedPromp'+_0x2f2c28(0x598,0x5df,0x626,0x5aa)],extension_settings[extensionName]['AQT_sd'],_0x3a0da6),_0x319026=await _0x17cd67[_0x2f2c28(0x43b,0x3c9,0x465,0x4b9)](fumian,extension_settings[extensionName][_0x387892(-0x1ea,-0x1ef,-0x1a0,-0x212)][extension_settings[extensionName]['yusheid_sd']][_0x387892(-0x201,-0x1a8,-0x282,-0x209)+'ompt'],extension_settings[extensionName][_0x2f2c28(0x579,0x5b9,0x4d2,0x502)]);if(!_0x3db8f3&&window['collectedC'+_0x2f2c28(0x55a,0x4b9,0x513,0x555)+_0x387892(-0x1c2,-0x238,-0x247,-0x18a)]){const _0x7cd9c0=window['collectedC'+_0x387892(-0x183,-0x15d,-0x220,-0x224)+'gatives'][_0x387892(-0x15b,-0x164,-0x1d0,-0x1df)]();_0x7cd9c0&&(_0x319026=_0x319026?_0x319026+',\x20'+_0x7cd9c0:_0x7cd9c0,_0x17cd67[_0x387892(-0x2ac,-0x281,-0x2d4,-0x2e0)](addLog,'[角色负面]\x20添加角'+'色负面提示词:\x20'+_0x7cd9c0),console[_0x387892(-0x255,-0x1b5,-0x1ef,-0x243)](_0x17cd67[_0x2f2c28(0x567,0x56a,0x4ba,0x50a)],_0x7cd9c0));}_0x17cd67[_0x387892(-0x1b8,-0x1b4,-0x21a,-0x208)](addLog,'负面为:\x20'+_0x319026),extension_settings['sd'][_0x2f2c28(0x54a,0x4aa,0x499,0x5bd)]=_0x5cd494,await _0x17cd67[_0x2f2c28(0x4f6,0x4f9,0x5a2,0x54d)](saveSettingsDebounced);try{if(_0x2082f0[_0x2f2c28(0x518,0x4d5,0x56a,0x4a2)]===_0x17cd67['oTjSS']){const _0x217beb={};_0x217beb['auth']=_0x2082f0['st_chatu8_'+_0x387892(-0x1ed,-0x1ab,-0x15f,-0x15d)]?_0x2082f0[_0x387892(-0x253,-0x29e,-0x279,-0x217)+_0x387892(-0x1ed,-0x167,-0x21a,-0x15a)]:'',_0x217beb[_0x387892(-0x246,-0x260,-0x1bd,-0x306)]=_0x5cd494;const _0x2e7245=await _0x17cd67[_0x2f2c28(0x428,0x3ce,0x49a,0x431)](fetch,_0x387892(-0x211,-0x238,-0x1b6,-0x279)+_0x2f2c28(0x484,0x420,0x50b,0x507),{'method':_0x17cd67[_0x2f2c28(0x55b,0x49e,0x575,0x5d5)],'body':JSON[_0x387892(-0x1c1,-0x1b4,-0x21d,-0x181)](_0x217beb),'headers':_0x17cd67[_0x2f2c28(0x46e,0x50d,0x3ef,0x3d1)](getRequestHeaders,window[_0x387892(-0x26d,-0x248,-0x20f,-0x276)])});if(!_0x2e7245['ok']){_0x17cd67[_0x2f2c28(0x528,0x4dc,0x52b,0x50b)](addLog,'获取模型失败:\x20'+_0x2e7245[_0x2f2c28(0x50b,0x467,0x5a1,0x526)]+'\x20'+_0x2e7245[_0x387892(-0x1dc,-0x245,-0x124,-0x19a)]);throw new Error(_0x2f2c28(0x454,0x427,0x4de,0x4cf)+_0x2e7245[_0x387892(-0x1d2,-0x188,-0x196,-0x188)]+'\x20'+_0x2e7245['statusText']);}let _0x2ec646=await _0x2e7245[_0x387892(-0x155,-0x1ef,-0x1f8,-0xf8)]();console[_0x2f2c28(0x488,0x406,0x547,0x3e7)]('cmodel2222'+_0x387892(-0x2c2,-0x2c5,-0x203,-0x25b),_0x2ec646),console['log'](_0x17cd67['bMMTj'],_0x2082f0[_0x387892(-0x203,-0x1e7,-0x229,-0x2bf)+'8_model']);if(_0x17cd67[_0x387892(-0x267,-0x2f4,-0x2f1,-0x1c1)](_0x2ec646,_0x2082f0[_0x2f2c28(0x4da,0x4cf,0x487,0x559)+'8_model'])){if(_0x17cd67[_0x387892(-0x13f,-0xea,-0xc1,-0x101)](_0x17cd67[_0x2f2c28(0x4eb,0x4c6,0x49c,0x597)],_0x17cd67[_0x387892(-0x28a,-0x1f1,-0x347,-0x22a)])){_0x17cd67[_0x2f2c28(0x474,0x4c4,0x3c9,0x3cd)](addLog,_0x387892(-0x1db,-0x1cc,-0x24d,-0x142)+_0x2082f0[_0x387892(-0x203,-0x23e,-0x19b,-0x15f)+_0x387892(-0x16c,-0xac,-0x166,-0xd1)]+_0x387892(-0x288,-0x266,-0x1f6,-0x256)),toastr[_0x387892(-0x1c4,-0x11c,-0x15c,-0x118)](_0x2f2c28(0x4a9,0x40a,0x434,0x3f8)+_0x2082f0[_0x2f2c28(0x4da,0x4a7,0x484,0x4ad)+_0x2f2c28(0x571,0x565,0x53b,0x4c7)]);const _0xd7687c={};_0xd7687c[_0x2f2c28(0x578,0x5ca,0x5ec,0x50b)]=_0x2082f0[_0x2f2c28(0x48a,0x4e8,0x3c9,0x541)+_0x387892(-0x1ed,-0x187,-0x1e1,-0x213)]?_0x2082f0[_0x387892(-0x253,-0x1ca,-0x2db,-0x1cc)+_0x2f2c28(0x4f0,0x55d,0x483,0x507)]:'',_0xd7687c[_0x387892(-0x246,-0x288,-0x2ff,-0x1d7)]=_0x5cd494,_0xd7687c[_0x387892(-0x21f,-0x207,-0x1ce,-0x2a2)]=_0x2082f0[_0x2f2c28(0x4da,0x590,0x4a0,0x4cd)+'8_model'];const _0x4b5e4e=await fetch(_0x387892(-0x23b,-0x260,-0x216,-0x17d)+_0x387892(-0x259,-0x28b,-0x198,-0x198),{'method':'POST','body':JSON['stringify'](_0xd7687c),'headers':_0x17cd67[_0x387892(-0x206,-0x1ae,-0x26e,-0x1ec)](getRequestHeaders,window['token'])});if(!_0x4b5e4e['ok']){_0x17cd67['VKTLy'](addLog,_0x387892(-0x21c,-0x177,-0x1d6,-0x257)+_0x4b5e4e[_0x2f2c28(0x50b,0x479,0x54c,0x52e)]+'\x20'+_0x4b5e4e['statusText']);throw new Error('切换模型失败:\x20'+_0x4b5e4e['status']+'\x20'+_0x4b5e4e[_0x387892(-0x1dc,-0x27f,-0x1ed,-0x157)]);}toastr[_0x2f2c28(0x519,0x4cc,0x4e8,0x5b0)]('设置模型...为'+_0x2082f0['sd_cchatu_'+_0x2f2c28(0x571,0x4c0,0x5a1,0x57b)]+'成功');}else _0xc7b2bc[_0x387892(-0x191,-0x125,-0x22c,-0x1eb)+_0x4853fd+_0x2f2c28(0x41c,0x35b,0x384,0x3b2)]&&(_0x1bfa47=_0x17cd67['MdUog'](_0x17cd67[_0x387892(-0x19e,-0x1d9,-0x221,-0x1ee)](_0x1f24cb,',\x20'),_0x17cd67[_0x2f2c28(0x434,0x474,0x445,0x4e5)](_0x5af89b,_0x4f2273[_0x387892(-0x191,-0x18a,-0x173,-0xdb)+_0x26edcf+_0x387892(-0x2c1,-0x270,-0x2b7,-0x321)])));}}else{if(_0x17cd67[_0x387892(-0x1fb,-0x1c9,-0x2bd,-0x18d)](_0x17cd67[_0x387892(-0x1de,-0x288,-0x250,-0x1a1)],_0x17cd67['QnOIU'])){let _0x4912ae=await _0x17cd67['MlNMq'](getSDMode,_0x5cd494);_0x17cd67[_0x387892(-0x267,-0x1dd,-0x288,-0x1c7)](_0x4912ae,_0x2082f0[_0x387892(-0x203,-0x1e8,-0x196,-0x206)+_0x387892(-0x16c,-0x15c,-0x198,-0xfc)])&&(_0x17cd67[_0x2f2c28(0x586,0x523,0x4ec,0x5e8)](addLog,_0x387892(-0x247,-0x255,-0x29a,-0x232)+_0x2082f0[_0x387892(-0x203,-0x28e,-0x20d,-0x2c5)+'8_model']+_0x387892(-0x288,-0x309,-0x22f,-0x325)),await _0x17cd67[_0x2f2c28(0x428,0x442,0x3ba,0x49f)](setSDMode,_0x5cd494,_0x2082f0[_0x2f2c28(0x4da,0x482,0x55e,0x557)+'8_model']));}else{_0x232a62(_0x387892(-0x16d,-0x13c,-0x193,-0xf7)),_0x59721c[_0x387892(-0x252,-0x2dd,-0x1a6,-0x22c)](_0x17cd67['TieeV']);throw new _0x46672d(_0x17cd67['HSSQQ']);}}}catch(_0x35a9cb){_0x17cd67[_0x2f2c28(0x4ba,0x429,0x45a,0x51e)](addLog,_0x387892(-0x2b9,-0x21a,-0x35a,-0x204)+':\x20'+_0x35a9cb['message']+('。请检查sdwebu'+_0x2f2c28(0x57c,0x4cb,0x59d,0x5ae)+_0x2f2c28(0x50e,0x59c,0x5c7,0x4f7))),taskQueue[_0x2f2c28(0x59b,0x5f9,0x611,0x5d4)+'sk'](_0x46332a,![]),currentTaskId=null;throw new Error(_0x2f2c28(0x424,0x4cd,0x3c3,0x433)+_0x387892(-0x270,-0x314,-0x307,-0x1d0)+_0x2f2c28(0x57c,0x585,0x635,0x4e9)+_0x387892(-0x1cf,-0x134,-0x195,-0x16e));}let _0x28a155=-(0x1670+0x2*-0x9bc+-0x2f7);function _0x387892(_0x439a4a,_0xcf8888,_0x11b5ae,_0x5739dc){return _0x4a31(_0x439a4a- -0x39b,_0x11b5ae);}const _0xbc7ae4=_0x2082f0['sd_cseed'];_0x17cd67[_0x387892(-0x219,-0x1cf,-0x1cc,-0x1bc)](_0xbc7ae4,'')&&_0x17cd67[_0x2f2c28(0x4c4,0x4ce,0x456,0x522)](_0xbc7ae4,null)&&!_0x17cd67['SArZj'](isNaN,_0x17cd67[_0x2f2c28(0x499,0x404,0x54b,0x449)](Number,_0xbc7ae4))&&_0x17cd67['ujBUs'](Number,_0xbc7ae4)>=-0x1bb6+-0x17f6+0x33ac&&(_0x28a155=_0x17cd67[_0x2f2c28(0x52c,0x4ac,0x4da,0x52a)](Number,_0xbc7ae4));let _0xb06366={'prompt':_0x2c82e7,'negative_prompt':_0x319026,'sampler_name':_0x2082f0['sd_cchatu_'+_0x2f2c28(0x4b7,0x4fb,0x41b,0x49a)+_0x387892(-0x2ad,-0x264,-0x2bf,-0x2dc)],'scheduler':_0x2082f0[_0x2f2c28(0x4da,0x57a,0x4f3,0x56e)+_0x387892(-0x2a5,-0x2a7,-0x2b9,-0x236)+'r'],'steps':_0x2082f0['sd_csteps'],'cfg_scale':_0x2082f0[_0x387892(-0x2bb,-0x2a9,-0x298,-0x34a)],'width':_0xd8cf3b?_0xd8cf3b:_0x2082f0[_0x2f2c28(0x47c,0x421,0x506,0x3d2)],'height':_0x4439c?_0x4439c:_0x2082f0['sd_cheight'],'restore_faces':_0x17cd67[_0x2f2c28(0x4af,0x498,0x4bf,0x52e)](_0x2082f0[_0x2f2c28(0x480,0x458,0x3c0,0x415)+'es'],_0x17cd67['ufDzS']),'enable_hr':_0x17cd67['cmuPt'](_0x2082f0['sd_chires_'+'fix'],_0x17cd67[_0x387892(-0x29e,-0x282,-0x263,-0x335)]),'hr_upscaler':_0x2082f0[_0x387892(-0x203,-0x1c1,-0x160,-0x1bd)+_0x2f2c28(0x468,0x428,0x45a,0x4a1)],'hr_scale':_0x2082f0[_0x387892(-0x235,-0x1d3,-0x2d5,-0x209)+_0x387892(-0x1da,-0x16c,-0x11a,-0x1ec)],'hr_additional_modules':[],'denoising_strength':_0x2082f0[_0x387892(-0x202,-0x1e6,-0x236,-0x1b4)+_0x2f2c28(0x510,0x5b9,0x587,0x49a)+'th'],'hr_second_pass_steps':_0x2082f0[_0x2f2c28(0x50d,0x4a8,0x4ec,0x58a)+'steps'],'seed':_0x28a155,'override_settings':{'CLIP_stop_at_last_layers':_0x17cd67[_0x2f2c28(0x528,0x4db,0x481,0x5a6)](Number,_0x2082f0[_0x2f2c28(0x52b,0x4ff,0x5ab,0x5ba)+_0x2f2c28(0x473,0x3fb,0x42b,0x3e8)]),'sd_vae':_0x2082f0[_0x387892(-0x203,-0x2bd,-0x1da,-0x204)+_0x387892(-0x240,-0x1a1,-0x1e5,-0x2ea)]},'override_settings_restore_afterwards':!![],'save_images':!![],'send_images':!![],'do_not_save_grid':![],'do_not_save_samples':![]};_0x17cd67['yFAEi'](addLog,_0x2f2c28(0x479,0x444,0x4ad,0x4cd)+'ces\x20脸部修复\x20为'+_0xb06366[_0x2f2c28(0x479,0x53a,0x4d8,0x453)+_0x387892(-0x2b1,-0x366,-0x36d,-0x323)]),_0x17cd67['VoRyz'](addLog,'enable_hr\x20'+_0x387892(-0x1f3,-0x28f,-0x182,-0x222)+_0xb06366[_0x387892(-0x1d1,-0x193,-0x169,-0x225)]);_0x17cd67[_0x387892(-0x17d,-0xd0,-0x228,-0x18c)](_0x2082f0[_0x2f2c28(0x4a0,0x408,0x50f,0x503)+_0x387892(-0x1e5,-0x286,-0x14c,-0x18c)],_0x17cd67[_0x387892(-0x29e,-0x335,-0x2e4,-0x213)])&&(_0x17cd67[_0x387892(-0x1c0,-0x25c,-0x143,-0x17d)](addLog,_0x17cd67['pKHTC']),_0xb06366=_0x17cd67[_0x387892(-0x277,-0x334,-0x1db,-0x28b)](deepMerge,_0xb06366,{'alwayson_scripts':{'ADetailer':{'args':[!![],!![],{'ad_model':_0x17cd67[_0x2f2c28(0x585,0x501,0x5ca,0x4dd)]}]}}}));const _0x15fdf3=_0x387892(-0x1eb,-0x170,-0x249,-0x247)+_0x2f2c28(0x48c,0x455,0x3dd,0x542)+_0x2f2c28(0x53a,0x584,0x4c7,0x4ce)+_0x387892(-0x16b,-0xd9,-0x180,-0x18c)+_0x2c82e7+(_0x2f2c28(0x4fa,0x57f,0x538,0x4e7)+_0x2f2c28(0x41e,0x481,0x490,0x418)+_0x387892(-0x185,-0xd4,-0x1cb,-0xc9)+'\x20')+_0x319026+(_0x387892(-0x2a7,-0x2b9,-0x2d1,-0x351)+_0x387892(-0x196,-0x1f8,-0x22e,-0x14e)+_0x2f2c28(0x55f,0x5fc,0x505,0x542))+_0xb06366[_0x2f2c28(0x58f,0x641,0x5f1,0x587)+'me']+(_0x2f2c28(0x520,0x4af,0x551,0x5af)+_0x2f2c28(0x52f,0x4c1,0x4e6,0x590))+_0xb06366[_0x2f2c28(0x4bc,0x4f8,0x486,0x4f5)]+(_0x387892(-0x152,-0x16f,-0x156,-0x159)+'cale:**\x20')+_0xb06366[_0x2f2c28(0x452,0x457,0x498,0x3ee)]+(_0x387892(-0x2a4,-0x301,-0x25c,-0x238)+'ize):**\x20')+_0xb06366[_0x2f2c28(0x4bb,0x525,0x46c,0x523)]+'x'+_0xb06366[_0x387892(-0x266,-0x1e1,-0x2b0,-0x1e2)]+(_0x2f2c28(0x423,0x379,0x3bf,0x460)+_0x2f2c28(0x59d,0x63b,0x548,0x5c0))+(_0x17cd67[_0x2f2c28(0x51e,0x5a6,0x472,0x54a)](_0xb06366[_0x387892(-0x230,-0x1c4,-0x16e,-0x2d8)],-(0x1efb+-0x1*-0x598+0x2492*-0x1))?_0x2f2c28(0x47d,0x4e7,0x4ac,0x4bd):_0xb06366[_0x387892(-0x230,-0x1cc,-0x296,-0x1ab)])+(_0x2f2c28(0x4c2,0x520,0x47a,0x412)+_0x2f2c28(0x552,0x4eb,0x4c7,0x5c8))+_0x2082f0[_0x387892(-0x203,-0x249,-0x175,-0x1b9)+_0x2f2c28(0x571,0x5ae,0x603,0x550)]+(_0x2f2c28(0x4d1,0x582,0x4f0,0x4a7)+'*\x20')+_0xb06366['override_s'+'ettings']['sd_vae']+(_0x387892(-0x265,-0x307,-0x2a9,-0x267)+_0x387892(-0x14b,-0x15c,-0x1e7,-0x17a))+_0xb06366[_0x2f2c28(0x451,0x39b,0x4ee,0x400)+_0x387892(-0x1a6,-0x103,-0x226,-0x14e)]['CLIP_stop_'+_0x387892(-0x232,-0x262,-0x25b,-0x183)+_0x387892(-0x22a,-0x1d0,-0x1fb,-0x23c)]+(_0x387892(-0x2aa,-0x342,-0x2ad,-0x342)+_0x387892(-0x29d,-0x30d,-0x2a2,-0x291)+_0x2f2c28(0x565,0x60c,0x4b3,0x57e))+_0xb06366[_0x2f2c28(0x50c,0x4da,0x57e,0x5c6)]+(_0x2f2c28(0x573,0x4ff,0x4fe,0x559)+'(Upscale\x20F'+'actor):**\x20')+_0xb06366[_0x2f2c28(0x494,0x423,0x469,0x462)]+(_0x387892(-0x19f,-0x186,-0x250,-0xe9)+_0x2f2c28(0x591,0x527,0x615,0x534)+_0x387892(-0x2ab,-0x1ec,-0x2aa,-0x200)+_0x2f2c28(0x469,0x4f1,0x4f4,0x456))+_0xb06366[_0x2f2c28(0x47f,0x400,0x49c,0x3cc)+'strength']+('\x0a-\x20**脸部修复\x20'+_0x387892(-0x250,-0x220,-0x269,-0x2aa)+'aces):**\x20')+_0xb06366[_0x2f2c28(0x479,0x3f5,0x3ce,0x3bd)+'ces']+('\x0a-\x20**ADeta'+'iler:**\x20')+_0x17cd67[_0x2f2c28(0x465,0x4b7,0x3ad,0x3fd)](_0x2082f0[_0x2f2c28(0x4a0,0x53f,0x553,0x549)+'ler'],_0x387892(-0x198,-0x18b,-0x14a,-0x18a))+_0x2f2c28(0x55c,0x4bc,0x5d3,0x61e);_0x17cd67[_0x387892(-0x1ee,-0x254,-0x275,-0x197)](addLog,_0x15fdf3),_0x17cd67['csMcN'](addLog,'sdwebui生图参'+'数为'+JSON[_0x2f2c28(0x51c,0x48c,0x4bb,0x534)](_0xb06366)),console[_0x2f2c28(0x488,0x4bc,0x522,0x3f7)](_0x17cd67[_0x2f2c28(0x492,0x459,0x4f5,0x401)],_0xb06366);while(!window[_0x2f2c28(0x4df,0x4a8,0x4af,0x546)]){_0x17cd67['pfslm'](_0x17cd67[_0x387892(-0x24a,-0x2d9,-0x25a,-0x291)],_0x17cd67[_0x387892(-0x169,-0x22b,-0x192,-0x1f1)])?_0x17cd67[_0x387892(-0x1b5,-0x19c,-0x1df,-0x150)](_0x2eacfd,_0x387892(-0x1d4,-0x211,-0x274,-0x1d9)+'库'):await _0x17cd67[_0x387892(-0x2a3,-0x2d2,-0x202,-0x292)](sleep,0x1174+0x173d+-0x24c9);}function _0x2f2c28(_0x2ba753,_0x2d6e03,_0x2f106e,_0x4ccc7e){return _0x4a31(_0x2ba753-0x342,_0x2f106e);};try{if(_0x17cd67[_0x2f2c28(0x4d9,0x520,0x56d,0x4e5)](_0x17cd67[_0x2f2c28(0x425,0x4e7,0x379,0x447)],_0x17cd67[_0x387892(-0x2b8,-0x368,-0x279,-0x1f8)]))_0x56e3dd[_0x17cd67[_0x387892(-0x1d6,-0x11f,-0x284,-0x1ef)]]=_0x50fdd6;else{window[_0x2f2c28(0x4df,0x532,0x481,0x50e)]=![],taskQueue[_0x387892(-0x27b,-0x275,-0x2a6,-0x2cb)+'us'](_0x46332a,_0x17cd67['vkuMl']);if(_0x17cd67[_0x2f2c28(0x46a,0x3c4,0x401,0x45e)](_0x2082f0[_0x387892(-0x1c5,-0x1c2,-0x271,-0x12b)],_0x387892(-0x1b3,-0x124,-0x12b,-0x258))){if(_0x17cd67['aGASM']===_0x17cd67['fDfJs'])_0x17cd67[_0x2f2c28(0x59a,0x5a1,0x560,0x5db)](_0x1572e1,_0x17cd67[_0x2f2c28(0x487,0x3fd,0x4ec,0x46a)]),_0x87138=_0x17cd67[_0x387892(-0x277,-0x2cc,-0x287,-0x1c6)](_0x3d93a8,_0x1f7bb6,{'alwayson_scripts':{'ADetailer':{'args':[!![],!![],{'ad_model':_0x17cd67['NcaSC']}]}}});else{if(!taskQueue[_0x2f2c28(0x4de,0x4bf,0x4e3,0x57d)+_0x387892(-0x236,-0x244,-0x29e,-0x2b1)](_0x46332a)){_0x17cd67[_0x387892(-0x1b1,-0xf0,-0x144,-0x115)](addLog,_0x17cd67[_0x2f2c28(0x4cf,0x4f5,0x54d,0x4b1)]),eventSource['emit'](_0x17cd67['TieeV']);throw new Error(_0x17cd67[_0x387892(-0x280,-0x2f5,-0x2ce,-0x20c)]);}_0xb06366[_0x387892(-0x246,-0x29b,-0x23c,-0x2b9)]=_0x5cd494,console[_0x2f2c28(0x488,0x4cc,0x4e9,0x44d)](_0x17cd67[_0x387892(-0x14d,-0x20e,-0x1b4,-0x1b3)],_0x2082f0[_0x2f2c28(0x48a,0x406,0x488,0x41c)+_0x387892(-0x1ed,-0x1ba,-0x1c0,-0x1ea)]),_0xb06366[_0x2f2c28(0x578,0x5a3,0x4ff,0x547)]=_0x2082f0[_0x2f2c28(0x48a,0x408,0x441,0x41e)+_0x2f2c28(0x4f0,0x49a,0x432,0x42d)]?_0x2082f0[_0x387892(-0x253,-0x1ae,-0x2f9,-0x1ac)+'sd_auth']:'';const _0x1112ac=await fetch(_0x17cd67[_0x387892(-0x29c,-0x2f0,-0x210,-0x31d)],{'method':_0x17cd67['ZLTRs'],'headers':_0x17cd67['mQhhS'](getRequestHeaders,window['token']),'body':JSON['stringify'](_0xb06366)});if(!_0x1112ac['ok']){const _0x1962e8=await _0x1112ac['text']();addLog(_0x387892(-0x1af,-0x172,-0x255,-0x109)+_0x387892(-0x168,-0x16b,-0x1d3,-0x141)+_0x1112ac['status']+'。响应内容:\x20'+_0x1962e8),console[_0x387892(-0x255,-0x2cc,-0x295,-0x25b)](_0x17cd67[_0x387892(-0x154,-0xdc,-0xc1,-0x10b)],_0x1962e8);throw new Error(_0x2f2c28(0x4e0,0x534,0x45a,0x553)+_0x1112ac['status']+',\x20详情:\x20'+_0x1962e8);}const _0x3df7e2=await _0x1112ac[_0x2f2c28(0x588,0x602,0x4dd,0x5e7)]();let _0x4d81af='';try{const _0x54b001=JSON[_0x2f2c28(0x421,0x48e,0x49e,0x3cb)](_0x3df7e2);_0x4d81af=_0x54b001[_0x387892(-0x237,-0x1ed,-0x1bd,-0x2c2)][0x99b*-0x3+0x1749+-0x8*-0xb1];}catch(_0x5d3a37){if(_0x17cd67[_0x2f2c28(0x596,0x5c5,0x51d,0x575)](_0x17cd67[_0x2f2c28(0x58a,0x4eb,0x635,0x5a0)],_0x17cd67['GUndy']))_0x17cd67[_0x387892(-0x1fa,-0x236,-0x1cd,-0x172)](addLog,_0x17cd67['xiiDD']),_0x4d81af=_0x3df7e2;else{_0x2b3f6c['xiancheng']=!![];if(_0x17cd67[_0x387892(-0x15e,-0x149,-0x187,-0x1ef)](_0x4f916e[_0x2f2c28(0x521,0x4ed,0x4ab,0x579)],_0x17cd67['HSSQQ'])){}else _0x2fa7d3[_0x387892(-0x142,-0xf8,-0xcf,-0x83)+'sk'](_0x41bc07,![]);_0x87540c=null,_0x17cd67[_0x387892(-0x1b9,-0x110,-0x1af,-0x1b5)](_0x56dc8f,_0x387892(-0x189,-0x20d,-0xd4,-0x155)+_0x187962['message']),_0x4aef85[_0x387892(-0x1cc,-0x26a,-0x1f4,-0x212)](_0x17cd67['JSumN'],_0x517433);throw _0x5dde4b;}}const _0x3e8be9=_0x17cd67[_0x2f2c28(0x522,0x5af,0x5e4,0x467)](_0x17cd67['BoVyT'],_0x4d81af);_0x17cd67[_0x2f2c28(0x562,0x4c6,0x4b3,0x506)](addLog,_0x387892(-0x241,-0x1a2,-0x233,-0x212)+_0x2f2c28(0x4e6,0x4eb,0x4eb,0x49e)+'L。'),_0x17cd67[_0x387892(-0x199,-0x136,-0x1d4,-0x156)](setTimeout,()=>{console['log'](_0x17cd67['ggcba']),window['xiancheng']=!![];},extension_settings[extensionName][_0x387892(-0x16f,-0x120,-0x15d,-0x19a)+_0x387892(-0x1d9,-0x1d3,-0x1e6,-0x29a)]);;taskQueue[_0x2f2c28(0x59b,0x4df,0x655,0x4eb)+'sk'](_0x46332a,!![]),currentTaskId=null;if(_0x17cd67['FxVvi'](_0x17cd67[_0x2f2c28(0x4d2,0x4df,0x426,0x471)](String,extension_settings[extensionName][_0x387892(-0x245,-0x20d,-0x222,-0x21a)+_0x2f2c28(0x516,0x453,0x4bb,0x48d)]),_0x17cd67[_0x387892(-0x29e,-0x21b,-0x325,-0x246)])){if(_0x17cd67['HhkDG']('iFXIi',_0x17cd67[_0x2f2c28(0x459,0x4a6,0x39d,0x3b5)])){_0x17cd67[_0x387892(-0x1b9,-0x15e,-0x243,-0x241)](_0xff6aa,_0x17cd67['fmpul']),_0x59d413=_0x17cd67[_0x387892(-0x1b9,-0x213,-0x1e5,-0x167)](_0xac20d8,_0x478996),_0x3ff488=_0x5e51c4[_0x17cd67[_0x387892(-0x179,-0x167,-0x169,-0x218)]];for(let _0x3fb3cb=0x2*-0xd45+-0x197c+0x3407;_0x3fb3cb<=-0x435*0x6+0x1dcf+-0x48d;_0x3fb3cb++){_0x33be05['Character\x20'+_0x3fb3cb+_0x387892(-0x2c1,-0x351,-0x240,-0x266)]&&(_0x38c305=_0x17cd67['kSGGZ'](_0x17cd67[_0x387892(-0x15c,-0x209,-0xe3,-0xd3)](_0x1d4902,',\x20'),_0x366d0e[_0x2f2c28(0x54c,0x50c,0x50c,0x5a0)+_0x3fb3cb+_0x387892(-0x2c1,-0x2d7,-0x2a7,-0x254)]));}}else _0x3e8be9=await _0x17cd67['SjExu'](convertImageToJpeg,_0x3e8be9);}return{'image':_0x3e8be9,'change':_0x17cd67[_0x387892(-0x214,-0x1bc,-0x261,-0x1af)](_0x774bba,'')};}}else{if(!taskQueue[_0x2f2c28(0x4de,0x4fd,0x50d,0x517)+_0x387892(-0x236,-0x2be,-0x2ea,-0x1a5)](_0x46332a)){if(_0x17cd67[_0x2f2c28(0x4e5,0x428,0x530,0x533)](_0x17cd67['ieoJp'],_0x387892(-0x1df,-0x1ca,-0x1a4,-0x26f))){_0x17cd67[_0x2f2c28(0x4a3,0x52d,0x407,0x519)](addLog,_0x17cd67['aOvuW']);throw new Error(_0x17cd67[_0x387892(-0x280,-0x1d4,-0x337,-0x30f)]);}else _0xa85bbe[_0x2f2c28(0x488,0x49c,0x46f,0x405)](_0x17cd67[_0x387892(-0x213,-0x1f4,-0x1c0,-0x256)]),_0x5f5b2b[_0x387892(-0x1fe,-0x1a7,-0x238,-0x1b6)]=!![];}const _0x23ec3d=new URL(_0x17cd67['weXEH'](_0x5cd494,_0x2f2c28(0x57d,0x607,0x4e4,0x5bb)+_0x2f2c28(0x4d6,0x45c,0x554,0x54a)));window['xiancheng']=![];const _0x1b9e81=await fetch(_0x23ec3d,{'method':_0x17cd67[_0x387892(-0x182,-0x222,-0x1bf,-0x14a)],'body':JSON[_0x2f2c28(0x51c,0x4ab,0x4a7,0x4eb)](_0xb06366),'headers':_0x17cd67[_0x2f2c28(0x466,0x3f9,0x49a,0x49f)](getDirectHeaders,_0x17cd67[_0x2f2c28(0x491,0x4e7,0x4c3,0x476)],_0x17cd67['Ysphk'](getsdAuth))});_0x17cd67[_0x2f2c28(0x460,0x45a,0x507,0x4f0)](setTimeout,()=>{function _0x34b66e(_0x2b90eb,_0x507948,_0x1b9131,_0x23fa12){return _0x2f2c28(_0x2b90eb- -0x507,_0x507948-0x76,_0x507948,_0x23fa12-0x76);}console[_0x34b66e(-0x7f,-0x106,-0xc8,-0xa0)](_0x17cd67[_0x34b66e(-0x3d,0xd,-0x6e,-0xf4)]);function _0x426048(_0x5d902b,_0x4537e0,_0x3224ea,_0x5dbbe4){return _0x387892(_0x5dbbe4-0x266,_0x4537e0-0x132,_0x4537e0,_0x5dbbe4-0x112);}window[_0x34b66e(-0x28,-0x43,0x4f,-0xb0)]=!![];},extension_settings[extensionName]['imageGenIn'+_0x2f2c28(0x504,0x4db,0x501,0x4c0)]);;if(!_0x1b9e81['ok']){const _0xe9d75e=await _0x1b9e81[_0x2f2c28(0x588,0x619,0x613,0x5e0)]();_0x17cd67[_0x387892(-0x28f,-0x350,-0x1d3,-0x28c)](addLog,'SD\x20API\x20返回错'+_0x387892(-0x212,-0x1dd,-0x1b3,-0x284)+_0x1b9e81[_0x2f2c28(0x50b,0x4bb,0x54c,0x500)]+_0x387892(-0x22f,-0x21d,-0x1e1,-0x18d)+_0xe9d75e),console[_0x387892(-0x255,-0x2a3,-0x208,-0x295)](_0x17cd67['FFaiP'],_0xe9d75e);throw new Error('请求失败,状态码:\x20'+_0x1b9e81['status']+_0x387892(-0x281,-0x1c3,-0x23d,-0x1e7)+_0xe9d75e);}const _0x3dd250=await _0x1b9e81[_0x387892(-0x263,-0x2de,-0x316,-0x1d1)]();if(!_0x3dd250[_0x387892(-0x237,-0x23a,-0x2b7,-0x1fe)]||_0x17cd67[_0x2f2c28(0x512,0x4b2,0x4bc,0x499)](_0x3dd250[_0x2f2c28(0x4a6,0x530,0x52e,0x3f5)][_0x2f2c28(0x58d,0x598,0x515,0x4ff)],0x12*0x5e+-0x45f*0x7+0x17fd))throw new Error(_0x17cd67['NwERx']);const _0x1e3b41=_0x3dd250['images'][-0x1*-0x57+0xb7a+0x79*-0x19],_0x1a924b=_0x17cd67['BoVyT']+_0x1e3b41;return _0x17cd67[_0x387892(-0x217,-0x1ad,-0x212,-0x2b8)](addLog,_0x17cd67[_0x2f2c28(0x54e,0x4da,0x5e3,0x559)]),taskQueue[_0x387892(-0x142,-0x1c9,-0x134,-0x95)+'sk'](_0x46332a,!![]),currentTaskId=null,_0x17cd67['cocQn'](_0x17cd67[_0x387892(-0x1f6,-0x1f0,-0x1df,-0x25d)](String,extension_settings[extensionName]['convertToJ'+'pegStorage']),_0x17cd67[_0x2f2c28(0x43f,0x41c,0x40a,0x45b)])&&(_0x1a924b=await convertImageToJpeg(_0x1a924b)),{'image':_0x1a924b,'change':_0x17cd67[_0x387892(-0x25c,-0x1ce,-0x2a9,-0x23c)](_0x42358b,'')};}}}catch(_0x7be56f){window[_0x387892(-0x1fe,-0x1a5,-0x245,-0x1d9)]=!![];if(_0x7be56f[_0x387892(-0x1bc,-0x251,-0x1e6,-0x1e7)]===_0x17cd67['HSSQQ']){}else _0x17cd67['LqyDf'](_0x387892(-0x225,-0x18a,-0x17f,-0x236),_0x17cd67[_0x387892(-0x22c,-0x241,-0x2d4,-0x17f)])?_0x5f2962=_0x17cd67[_0x2f2c28(0x556,0x601,0x5b5,0x4b4)](_0x585f7c,_0x4c85ee):taskQueue[_0x387892(-0x142,-0x1c7,-0x199,-0x1d9)+'sk'](_0x46332a,![]);currentTaskId=null,_0x17cd67[_0x2f2c28(0x526,0x59d,0x505,0x52d)](addLog,_0x2f2c28(0x554,0x4d1,0x4e6,0x5fd)+_0x7be56f['message']),console[_0x387892(-0x1cc,-0x28d,-0x188,-0x1ea)]('Error\x20gene'+_0x387892(-0x171,-0x1dd,-0xf7,-0x10f)+_0x387892(-0x20d,-0x23b,-0x2cf,-0x296),_0x7be56f);throw _0x7be56f;}}async function sdGenerate(_0x1b17f8){const _0x46a1c7={'NmYBa':function(_0xb44a60,_0x2e0b68){return _0xb44a60(_0x2e0b68);},'vhqPa':'{修图}','frVRU':function(_0x5216b6,_0x2eb01c){return _0x5216b6!==_0x2eb01c;},'uWAqT':_0x3871eb(0x158,0x111,0xa6,0xe9),'cPrJQ':'SDOFC','Jijeu':function(_0x1b773d,_0x16f22c){return _0x1b773d(_0x16f22c);},'LOMqj':function(_0x1f5d25,_0x392c41,_0xd4077c,_0x4df445){return _0x1f5d25(_0x392c41,_0xd4077c,_0x4df445);},'aFeIE':function(_0x3c0be4,_0x51360b){return _0x3c0be4(_0x51360b);},'LGGbM':'Error\x20gene'+'rating\x20SD\x20'+_0x4708de(-0x1c3,-0x1f7,-0x103,-0x18d),'obkwm':function(_0xeb7e42,_0x8f5ede){return _0xeb7e42(_0x8f5ede);}},{id:_0x55d3b9,prompt:_0x7578c0,width:_0x1147b0,height:_0x27967a,change:_0x145242}=_0x1b17f8;_0x46a1c7[_0x4708de(-0x2c0,-0x1a3,-0x209,-0x262)](addLog,_0x3871eb(0x18a,0xf2,0x21a,0x1cc)+_0x3871eb(0x11a,0x17a,0x107,0x90)+_0x55d3b9+(_0x4708de(-0x183,-0x180,-0x198,-0x1d1)+':\x20')+_0x7578c0+(_0x145242?_0x4708de(-0x1dd,-0x2bc,-0x2c7,-0x231)+'\x20'+_0x145242:''));function _0x3871eb(_0x3bf307,_0x13f613,_0x175241,_0x57007b){return _0x4a31(_0x3bf307- -0x6c,_0x57007b);}function _0x4708de(_0x4a1606,_0xdb3e3c,_0x1cc692,_0x537ada){return _0x4a31(_0x537ada- -0x3e0,_0x4a1606);}if(_0x145242&&_0x145242[_0x4708de(-0x287,-0x314,-0x300,-0x2e0)](_0x46a1c7[_0x3871eb(0xad,-0x9,0x6,0x141)])){bananaGenerate(_0x1b17f8);return;}try{if(_0x46a1c7[_0x3871eb(0x115,0x18c,0x56,0x17b)](_0x46a1c7[_0x3871eb(0x8e,0x109,0xaa,-0x1)],_0x46a1c7[_0x3871eb(0x19b,0x25d,0x1dc,0xfe)])){const {image:_0x3c8f54,change:_0x5b74d3}=await _0x46a1c7['Jijeu'](generateSDImage,{'prompt':_0x7578c0,'width':_0x1147b0,'height':_0x27967a,'change':_0x145242});if(extension_settings[extensionName][_0x3871eb(0x17f,0xdc,0x124,0x170)]!='0'){const _0x3bec50={};_0x3bec50[_0x3871eb(0x120,0x188,0xcc,0xbc)]=_0x5b74d3,await _0x46a1c7[_0x4708de(-0x29f,-0x228,-0x298,-0x26e)](setItemImg,_0x7578c0,_0x3c8f54,_0x3bec50),addLog(_0x4708de(-0x2d9,-0x24e,-0x2c2,-0x22d)+'or\x20prompt:'+'\x20'+_0x7578c0);}else _0x46a1c7[_0x4708de(-0x20f,-0x14c,-0x18e,-0x1fb)](addLog,_0x3871eb(0x15b,0x1c9,0x9e,0x20b)+'库');const _0x40fade={};_0x40fade['id']=_0x55d3b9,_0x40fade[_0x4708de(-0x200,-0x1a6,-0x1ba,-0x189)]=!![],_0x40fade[_0x3871eb(0xe0,0x179,0x53,0x14d)]=_0x3c8f54,_0x40fade[_0x3871eb(0x182,0xc6,0x15c,0x1d9)]=_0x7578c0,_0x40fade['change']=_0x5b74d3,eventSource[_0x3871eb(0xdd,0xd6,0x61,0x54)](EventType[_0x3871eb(0x1ee,0x157,0x1aa,0x15b)+_0x4708de(-0x294,-0x31f,-0x2f4,-0x293)+_0x3871eb(0x78,0xcd,0xea,0xc3)],_0x40fade),_0x46a1c7[_0x4708de(-0x28f,-0x1e6,-0x1fb,-0x1fb)](addLog,_0x4708de(-0x239,-0x19a,-0x247,-0x234)+_0x4708de(-0x1cd,-0x1f6,-0x1d7,-0x24a)+_0x55d3b9+')');}else _0x2601a1[_0x3871eb(0x1ed,0x13a,0x227,0x24d)+'sk'](_0x12facf,![]);}catch(_0x3ca78d){const _0x1a7352=_0x4708de(-0x1a0,-0x17f,-0x113,-0x194)+_0x4708de(-0x2c7,-0x1af,-0x191,-0x20d)+_0x55d3b9+_0x4708de(-0x1e0,-0x171,-0x1f5,-0x227)+_0x3ca78d[_0x4708de(-0x288,-0x1dc,-0x15c,-0x201)];_0x46a1c7[_0x4708de(-0x221,-0x281,-0x1fd,-0x20b)](addLog,_0x3871eb(0x136,0xff,0x83,0x156)+_0x1a7352),console[_0x3871eb(0x163,0xeb,0xae,0xe0)](_0x46a1c7[_0x4708de(-0x244,-0x26a,-0x31e,-0x299)],_0x3ca78d);const _0x4e757b={};_0x4e757b['id']=_0x55d3b9,_0x4e757b['success']=![],_0x4e757b['error']=_0x3ca78d[_0x4708de(-0x21b,-0x2b7,-0x2ac,-0x201)],_0x4e757b[_0x3871eb(0x182,0x147,0x20b,0x1d6)]=_0x7578c0,eventSource[_0x4708de(-0x227,-0x2c6,-0x1ff,-0x297)](EventType['GENERATE_I'+_0x3871eb(0xe1,0x20,0x66,0x136)+_0x3871eb(0x78,0x116,0x6d,0x55)],_0x4e757b),_0x46a1c7[_0x3871eb(0x15a,0xdf,0x157,0x9b)](addLog,_0x4708de(-0x23f,-0x245,-0x22c,-0x1e5)+'\x20(ID:\x20'+_0x55d3b9+')');}}function initializeSDListener(){function _0x525315(_0x578c9f,_0xb57eec,_0x571086,_0x4d9449){return _0x4a31(_0x4d9449- -0x156,_0xb57eec);}const _0x4a2b8d={'hwhiA':function(_0x5cf71a,_0x3981c3){return _0x5cf71a(_0x3981c3);},'GXOvl':_0x170e62(0x23e,0x227,0x270,0x292)+_0x525315(0x63,-0x81,0x3a,-0x16)};function _0x170e62(_0x368472,_0x283731,_0x103ccd,_0x324c59){return _0x4a31(_0x324c59-0x100,_0x103ccd);}eventSource['on'](EventType[_0x525315(0x48,0x15e,0x185,0x104)+'MAGE_REQUE'+'ST'],sdGenerate),_0x4a2b8d[_0x170e62(0x2e3,0x369,0x2eb,0x2f0)](addLog,_0x4a2b8d[_0x170e62(0x211,0x229,0x2f5,0x2cd)]);}export async function replaceWithSd(){const _0x4dc084={'zKloe':function(_0x34a699,_0x210825){return _0x34a699(_0x210825);},'ZHncZ':function(_0x40e563,_0x5e8272){return _0x40e563!==_0x5e8272;},'VVtqD':_0x5a9cde(-0x279,-0x238,-0x197,-0x2b8),'yMFjo':function(_0x57bb12){return _0x57bb12();},'rCTPj':function(_0x241d92){return _0x241d92();},'eZwtt':'fRTEA'};function _0x158c8a(_0x2e9f40,_0x4fc205,_0x39fdf4,_0x2108e9){return _0x4a31(_0x2e9f40- -0x356,_0x39fdf4);}function _0x5a9cde(_0x40eba5,_0x1ebf9f,_0x74b4a5,_0x54c990){return _0x4a31(_0x1ebf9f- -0x33e,_0x40eba5);}if(extension_settings[extensionName][_0x5a9cde(-0x192,-0x127,-0x154,-0xfd)]=='sd'){if(_0x4dc084[_0x158c8a(-0x11d,-0x109,-0x15e,-0x1d5)](_0x5a9cde(-0x2ab,-0x238,-0x24b,-0x1fa),_0x4dc084[_0x158c8a(-0x27b,-0x1e8,-0x2d6,-0x261)])){_0x4dc084[_0x158c8a(-0x1fd,-0x1c5,-0x1e9,-0x28f)](_0xa5de9f,_0x2fd57f);return;}else!window[_0x158c8a(-0x25b,-0x1e4,-0x209,-0x26a)+_0x158c8a(-0x24d,-0x25b,-0x1d5,-0x2b5)]&&(window[_0x158c8a(-0x25b,-0x206,-0x221,-0x246)+_0x158c8a(-0x24d,-0x270,-0x1c1,-0x255)]=!![],_0x4dc084['yMFjo'](initializeSDListener)),_0x4dc084[_0x5a9cde(-0x19c,-0xf4,-0x78,-0x76)](initializeImageProcessing);}else _0x4dc084[_0x5a9cde(-0x62,-0x105,-0x141,-0x113)](_0x4dc084['eZwtt'],_0x4dc084['eZwtt'])?_0x5a6796=!![]:window['initialize'+_0x5a9cde(-0x1b5,-0x235,-0x1d4,-0x1ea)]&&(eventSource[_0x158c8a(-0x26f,-0x2e6,-0x2a8,-0x320)+_0x158c8a(-0x234,-0x225,-0x225,-0x299)](EventType[_0x5a9cde(-0x4d,-0xe4,-0x9f,-0xed)+'MAGE_REQUE'+'ST'],sdGenerate),window['initialize'+_0x158c8a(-0x24d,-0x293,-0x29b,-0x19b)]=![],addLog('SD\x20生图事件监听器'+_0x5a9cde(-0x1e1,-0x251,-0x311,-0x28e)));}