(function(_0x8ab1a8,_0x1c1d99){function _0x10948d(_0x4adceb,_0x568eeb,_0x10bd19,_0x449d86){return _0x153b(_0x568eeb- -0x2b,_0x10bd19);}const _0x3808a6=_0x8ab1a8();function _0x42f09c(_0x213e90,_0x5f49a2,_0x3991ae,_0x4291c6){return _0x153b(_0x5f49a2-0x20a,_0x213e90);}while(!![]){try{const _0x5dfdcb=-parseInt(_0x42f09c(0x43e,0x435,0x47a,0x41d))/(-0x658+0x1d47+-0x16ee)*(parseInt(_0x42f09c(0x483,0x46e,0x489,0x4a1))/(-0x7ca*0x3+0xf1*0xa+-0xdf6*-0x1))+parseInt(_0x42f09c(0x419,0x44a,0x433,0x41e))/(-0xc7a*-0x2+0x13b6+0xa1*-0x47)*(parseInt(_0x42f09c(0x3fb,0x447,0x439,0x451))/(-0x1c78+-0x5*-0x5+0x1c63))+parseInt(_0x10948d(0x1e7,0x1e8,0x1a3,0x22c))/(0xb*-0x2fb+0x1a3*-0xf+0x395b)*(-parseInt(_0x10948d(0x216,0x20e,0x1d8,0x1dc))/(-0x6a2+-0xa01+0x10a9))+-parseInt(_0x42f09c(0x45a,0x463,0x4a4,0x469))/(0x429+0x7fa*-0x1+0x3d8)+-parseInt(_0x10948d(0x227,0x1f3,0x228,0x1cf))/(0x1*0x11c9+-0x120d*-0x2+0x35db*-0x1)+parseInt(_0x42f09c(0x48a,0x470,0x47c,0x47d))/(-0x24ea+0x1*-0x112b+-0x3*-0x120a)+-parseInt(_0x42f09c(0x42d,0x421,0x454,0x467))/(0x1ba0+-0xbc3*-0x1+-0x2759)*(-parseInt(_0x10948d(0x222,0x25f,0x2af,0x273))/(-0x5*0x622+-0x1*-0xde1+0x10d4));if(_0x5dfdcb===_0x1c1d99)break;else _0x3808a6['push'](_0x3808a6['shift']());}catch(_0x4d858e){_0x3808a6['push'](_0x3808a6['shift']());}}}(_0x67c0,-0x62077+-0x267e5*0x2+-0x3d*-0x3da3));const _0x3248a6=(function(){const _0x4bf665={};_0x4bf665[_0x3a283d(-0x21,0x23,-0x10,0xd)]=function(_0x22545a,_0x5ead8c){return _0x22545a!==_0x5ead8c;},_0x4bf665[_0x3a283d(0x0,-0x78,-0x7f,-0x3e)]=_0x3a283d(0x0,0x7f,0x69,0x36);const _0x2da3da=_0x4bf665;let _0x15d5b1=!![];function _0x3a283d(_0x4a55cb,_0x162cec,_0x9ff841,_0x134ad8){return _0x153b(_0x134ad8- -0x245,_0x162cec);}function _0x1ee8d4(_0x2495e7,_0xa48839,_0xbbf92e,_0x39a07b){return _0x153b(_0xa48839-0x24a,_0x39a07b);}return function(_0x21f343,_0x42a763){function _0x4d8d10(_0x5d940d,_0x40c15d,_0x21d7cb,_0x2b6779){return _0x1ee8d4(_0x5d940d-0xd7,_0x21d7cb- -0xe2,_0x21d7cb-0x52,_0x2b6779);}function _0x44a2d0(_0x1b0834,_0x25cf02,_0xece06e,_0x249f3a){return _0x3a283d(_0x1b0834-0x1dd,_0xece06e,_0xece06e-0x1ba,_0x1b0834-0x466);}if(_0x2da3da['MDJEq'](_0x2da3da[_0x44a2d0(0x428,0x419,0x404,0x412)],_0x2da3da[_0x44a2d0(0x428,0x3e1,0x442,0x43e)])){if(_0x223f4c&&_0xa5d99d[_0x44a2d0(0x4b3,0x497,0x4bf,0x4f8)])return _0x31876a[_0x44a2d0(0x4b3,0x4de,0x48d,0x4ba)]();return _0x44cb81[_0x44a2d0(0x44b,0x405,0x441,0x437)]()['toString'](0xbd0+0x798+-0x1344)+_0x57e396[_0x4d8d10(0x35f,0x365,0x389,0x38a)]()['toString'](-0x93*0x13+-0x265e*-0x1+0x3*-0x91b)[_0x44a2d0(0x46e,0x486,0x43b,0x4a5)](-0x1070+0x62*-0x13+0x17b8);}else{const _0x3eea3c=_0x15d5b1?function(){function _0x42c95d(_0x217e5a,_0x203f08,_0x24a781,_0x1c788a){return _0x44a2d0(_0x24a781- -0x2a7,_0x203f08-0x1ae,_0x217e5a,_0x1c788a-0x5d);}if(_0x42a763){const _0x5598bb=_0x42a763[_0x42c95d(0x1aa,0x16b,0x1a3,0x15a)](_0x21f343,arguments);return _0x42a763=null,_0x5598bb;}}:function(){};return _0x15d5b1=![],_0x3eea3c;}};}()),_0x4a1a0b=_0x3248a6(this,function(){const _0x1358cb={};_0x1358cb['DEqQK']='(((.+)+)+)'+'+$';function _0x4e2685(_0x224b76,_0x4a1e58,_0x2993ae,_0x1f3d24){return _0x153b(_0x1f3d24- -0x3af,_0x224b76);}const _0x29734b=_0x1358cb;function _0x479de1(_0x2b36f3,_0x761076,_0x1f0fe6,_0x20eedb){return _0x153b(_0x2b36f3- -0xf8,_0x20eedb);}return _0x4a1a0b[_0x479de1(0x160,0x168,0x122,0x113)]()[_0x4e2685(-0x13e,-0x143,-0x15c,-0x13c)](_0x29734b[_0x4e2685(-0x112,-0x168,-0x126,-0x12b)])['toString']()['constructo'+'r'](_0x4a1a0b)[_0x479de1(0x17b,0x161,0x1bb,0x1bf)](_0x29734b[_0x4e2685(-0x161,-0x122,-0x121,-0x12b)]);});function _0x67c0(){const _0x2e7a27=['zM9ACxK','CNzJzK0','zKzfA3e','57+76k+r5AsX6lsLoG','DMnwz3m','zw5LCG','rvnu','y2XLyw5Lza','teLksva','qwriBKy','ioIVT+AXGUE/U+IVKsbmte0G','DxrmreK','u3fvBwW','BwvZC2fNzq','s3vACwO','vw9AD0C','sfjVsgq','t2feDu0','DhjPBq','uvDcEKy','wfLtrvy','zMLSDgvY','DwLdDvm','Aw5KzxHpzG','C3qTy2HHDhu4oG','zxjYB3i','AxnbCNjHEq','B2jQzwn0','mtq3mtK4nu9hvxL4tW','r2j0DwC','iefjioIUVUE9RUw3SUE7N+s4GowiSa','qxHzrwi','mJa1nZG5mhvND2jYzW','EK1yyMK','DgvZDa','C2XPy2u','ioE/U+IVKEApKoEKUUIVJEAGH+ETVUwKSEI0Pq','tMrwBMW','q0TtqxK','mJuXotCZnK5IEw9RDq','C2v0','ioAjP+IHJoE7K+AENcaOsuq6','CMfUzg9T','wMzHqwO','sKPlD1O','AM9PBG','q3rfseu','icHjrdOG','Ee1VvLC','B3jPz2LUywXuyq','yxbWBhK','BM93','nuvZDKLczG','AejJDeG','BgvUz3rO','rvvss0i','qvrjt05Fr0vuxW','DLj0D3O','BxPsAfi','vuvtva','BwfW','qKHwyva','Bg9N','qu1hv1O','reHcsxO','57+76k+rieXmtsdMIAFOOyZOTOu','nLDqC1zHvq','EhP3tgW','D2rOzNu','CMvTB3zLtgLZDa','mtzUz1ngEwC','ENn5DwS','57+76k+r5AsX6lsLoIa','mJaXntfKqxLICKS','Eg9Hvxi','DhjHBNnSyxrPBW','D2fYBG','vhbqtNu','shjsDwS','wu9xDuO','B3LhENO','rvnMBxe','rLzesNy','sxndAMq','Bhzdrhq','s2jvsKS','C3vIC3rYAw5N','yKrzBhq','wxfhvue','suviteG','C2TPChbLza','turkrxe','EMnXtNy','C2TPCa','vgHnsLq','CgfYC2u','Bwf0y2G','Dg9tDhjPBMC','mtaWmJi0nNnRyML1vq','qwjVCNrfCNjVCG','t05trq','r3f2ufq','tLLdDeG','keLeoIa','CLHXsui','CMvZDwX0','z0vqsgG','qvrjt05FuKvtua','AK1xDgK','mtm0ntC4wNzlDuDr','sLLzyNG','mJuWotq1mLn6q3LSBq','zMzXB0y','zwfurNG','B3jPz2LUywW','rMzsDxe','DvbMDva','ieXmtsdORR7NVA7POBxPNAi','s0LeveG','zgLZCgXHEvrLEa','ELzstNi','iePtt07OP6pMNPdLPlhOTkxVViW','CMvWBgfJzq','s3fdtem','C2vHCMnO','r0LzCgG','z3nAquW','DMPkq1q','DKDoqw0','ufjptvbux1jfuq','sxjwEuu','EgzksKG','ALjdC3K','zxb5tK8','tg1jANm','Devgs28','Dg9mB3DLCKnHCW','ChvZAa','zw1PDa','s05Mt24','uuv3q2y','revXuuS','iow3SUIoT+wpLUE/U+IVKEApKoEKUUIVJsa','q2zOqve','C3rYAw5N','rwDnv0K','ioIVT+AXGUIoT+wpLUE/U+IVKEApKoEKUUIVJq','ntv2sg1Qv2i','teXnx1rsqu5tta','ufjptvbux1jfuW','rLbzrKG','DffgBg8','r2T5EfC','y0zsAKu','sfPutvG','CMfUzg9Tvvvjra','ue9ou0u','vezeAha','C3bSAxq','qvrjt05FuKvrvq','zKr0se4','tKjcBhe'];_0x67c0=function(){return _0x2e7a27;};return _0x67c0();}_0x4a1a0b();import{extension_settings}from'../../../../extensions.js';import{saveSettingsDebounced,eventSource}from'../../../../../script.js';import{extensionName,eventNames}from'./config.js';import{addLog}from'./utils.js';import{updateCombinedPrompt}from'./settings/llm.js';import{buildPromptForRequestType}from'./settings/llmService.js';import{mergeAdjacentMessages}from'./promptProcessor.js';let settings;const SD_SYMBOL_PATTERN=/^([\(\[\{<]+)?(.*?)([\)\]\}>]+)?(:[\d.]+)?$/,SKIP_PATTERNS=[/^<lora:/i,/^<lyco:/i,/^<hypernet:/i,/^[\d.:]+$/,/^$/,/^\$.*\$$/];function shouldSkipTranslation(_0x1a2778){function _0x3d1836(_0x34bf27,_0x44423b,_0x7bea18,_0x350810){return _0x153b(_0x350810-0x139,_0x34bf27);}function _0x3cd539(_0x5862ce,_0x5633a1,_0x4aafcd,_0x58b54d){return _0x153b(_0x5633a1- -0x185,_0x58b54d);}return SKIP_PATTERNS['some'](_0x7158e3=>_0x7158e3[_0x3cd539(0xd9,0x94,0x45,0x54)](_0x1a2778[_0x3cd539(0xd1,0x84,0x54,0x48)]()));}export function tagsToJsonString(_0x493f44){function _0x3b2af4(_0x8ae028,_0x39c46b,_0x4e3155,_0x225fe5){return _0x153b(_0x8ae028- -0x238,_0x225fe5);}function _0x5143d7(_0xb7fea0,_0x3aaed0,_0x551f98,_0x16890b){return _0x153b(_0x551f98- -0x311,_0x16890b);}if(!Array[_0x3b2af4(-0x27,-0x28,-0x3e,0x1b)](_0x493f44))return'[]';return JSON['stringify'](_0x493f44[_0x5143d7(-0x10c,-0x125,-0x105,-0xe6)](_0x294250=>_0x294250&&typeof _0x294250===_0x3b2af4(0x4f,0x21,0xe,0x4e)));}function _0x153b(_0x59f7a9,_0x1f604e){_0x59f7a9=_0x59f7a9-(0x101*-0x1f+-0x18ef*0x1+0x39ff);const _0x4bf79c=_0x67c0();let _0x566701=_0x4bf79c[_0x59f7a9];if(_0x153b['WGnlAr']===undefined){var _0x294594=function(_0x468411){const _0x87beed='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0xea1ba2='',_0xbe213b='',_0x15ed9c=_0xea1ba2+_0x294594;for(let _0x39aae8=0x1adf+0x1*-0x109d+0x1*-0xa42,_0x530b20,_0x17baf5,_0x5c7b30=-0x2*-0x59e+0xfbb*-0x2+-0x2*-0xa1d;_0x17baf5=_0x468411['charAt'](_0x5c7b30++);~_0x17baf5&&(_0x530b20=_0x39aae8%(0x204*-0x10+0x56*0x32+0xf78)?_0x530b20*(-0x14b2+0x231a*-0x1+0x380c)+_0x17baf5:_0x17baf5,_0x39aae8++%(0x7*0x29d+-0x10a5+0x26*-0xb))?_0xea1ba2+=_0x15ed9c['charCodeAt'](_0x5c7b30+(-0x2*0xfe9+0x1aba+0x522))-(0x26c0+0xc33+-0x1*0x32e9)!==-0x10*0x1e7+0xf6a+0xf06?String['fromCharCode'](-0xc4+0x10b5+-0xef2&_0x530b20>>(-(-0x1d79+-0x24f1+0x426c)*_0x39aae8&0x3a*0x19+0x2ce*0x7+-0x1*0x1946)):_0x39aae8:0xce9*-0x3+-0xc88+0x4a9*0xb){_0x17baf5=_0x87beed['indexOf'](_0x17baf5);}for(let _0x2aa0f2=0x1973+0x1c0c+-0x3*0x11d5,_0x16fd33=_0xea1ba2['length'];_0x2aa0f2<_0x16fd33;_0x2aa0f2++){_0xbe213b+='%'+('00'+_0xea1ba2['charCodeAt'](_0x2aa0f2)['toString'](-0x2435*0x1+0x1c0a+0x83b))['slice'](-(-0x1cb3+0x1c9d+-0x6*-0x4));}return decodeURIComponent(_0xbe213b);};_0x153b['xhPHZu']=_0x294594,_0x153b['kvzEiv']={},_0x153b['WGnlAr']=!![];}const _0x4f87d6=_0x4bf79c[0x1cb8+0x17*0x16f+-0x3db1],_0x4033e6=_0x59f7a9+_0x4f87d6,_0x4bc465=_0x153b['kvzEiv'][_0x4033e6];if(!_0x4bc465){const _0x5a7bff=function(_0x3f59b5){this['mtEdhm']=_0x3f59b5,this['njlggl']=[-0xefc*0x1+0x6a9+0x52*0x1a,-0x111f+-0xa32+0x1b51,0xad*-0x5+0xc30+-0x8cf],this['jTVXcC']=function(){return'newState';},this['csFmXv']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['MzrOil']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x5a7bff['prototype']['FkGLUV']=function(){const _0x44f37d=new RegExp(this['csFmXv']+this['MzrOil']),_0x28576d=_0x44f37d['test'](this['jTVXcC']['toString']())?--this['njlggl'][0x4be*-0x7+-0x24ce+0x4601]:--this['njlggl'][0x6c3+0x2103+0x1*-0x27c6];return this['ezWvjp'](_0x28576d);},_0x5a7bff['prototype']['ezWvjp']=function(_0xa50c77){if(!Boolean(~_0xa50c77))return _0xa50c77;return this['GcvDLF'](this['mtEdhm']);},_0x5a7bff['prototype']['GcvDLF']=function(_0x1009a6){for(let _0x4f9088=0x1da3+0x1a96+-0x3839,_0x33e57f=this['njlggl']['length'];_0x4f9088<_0x33e57f;_0x4f9088++){this['njlggl']['push'](Math['round'](Math['random']())),_0x33e57f=this['njlggl']['length'];}return _0x1009a6(this['njlggl'][0xd4+-0x14b1*-0x1+-0x1585]);},new _0x5a7bff(_0x153b)['FkGLUV'](),_0x566701=_0x153b['xhPHZu'](_0x566701),_0x153b['kvzEiv'][_0x4033e6]=_0x566701;}else _0x566701=_0x4bc465;return _0x566701;}export function preprocessPromptForTranslation(_0x377c5a){const _0x230b05={'tQFlo':function(_0x1b8719,_0x1dee1c){return _0x1b8719>_0x1dee1c;},'lZsGU':function(_0x2bd366,_0x4ae712){return _0x2bd366+_0x4ae712;},'cFRjE':function(_0x59996f,_0x34b5dd){return _0x59996f<_0x34b5dd;},'EgMWI':_0x4f2bc5(0x476,0x425,0x446,0x460),'LIJIP':function(_0xaa6d47,_0x1772b2){return _0xaa6d47===_0x1772b2;},'CtEHE':function(_0x6e542e,_0x37b3f2){return _0x6e542e===_0x37b3f2;},'YSvzr':function(_0x51d49e,_0x460486){return _0x51d49e===_0x460486;},'LnyiJ':function(_0x5cb310,_0xbb5c77){return _0x5cb310!==_0xbb5c77;},'gsZAL':_0x4f2bc5(0x40f,0x3ea,0x40f,0x3fc),'xzwLl':_0x4f2bc5(0x3f0,0x43d,0x44d,0x487),'uPfuP':function(_0xd83bfd,_0x55ad96){return _0xd83bfd(_0x55ad96);},'ThMJT':function(_0x3686a9,_0x338243){return _0x3686a9(_0x338243);},'OaDuM':function(_0x46721f,_0x2cf025){return _0x46721f(_0x2cf025);},'kMEYW':function(_0x1c1f76,_0x57da62){return _0x1c1f76(_0x57da62);}};if(!_0x377c5a||typeof _0x377c5a!==_0x230b05[_0x19e9dc(0x124,0xdd,0xea,0x109)])return{'originalTags':[],'cleanedTags':[],'cleanedText':'','tagMap':new Map()};const _0x5054ed=_0x1e1bed=>{const _0x5789f4=[];function _0x1f6cff(_0xbc720d,_0x34e541,_0x40de02,_0xb56f26){return _0x19e9dc(_0xb56f26- -0x203,_0x34e541,_0x40de02-0xc8,_0xb56f26-0x149);}let _0x47a618='',_0x23eecb=![];for(let _0x11c26d=-0x153*-0x3+0x649+-0x521*0x2;_0x230b05[_0x1f6cff(-0xb2,-0x5f,-0xa9,-0x89)](_0x11c26d,_0x1e1bed[_0x16700e(0x30e,0x36d,0x352,0x319)]);_0x11c26d++){if(_0x230b05[_0x16700e(0x3a1,0x371,0x3ad,0x3b8)]!==_0x230b05[_0x16700e(0x394,0x3db,0x3ad,0x393)]){const _0x334e36=_0x42220c[_0x16700e(0x314,0x34f,0x333,0x352)]('\x5c');if(_0x230b05[_0x1f6cff(-0xc6,-0x5b,-0x45,-0x8b)](_0x334e36,0x2595+-0x15de+-0xfb7)){const _0x2c9d34=_0x75736e[_0x1f6cff(-0x12a,-0x132,-0xf6,-0xff)](-0x1772+-0x246f+0x3be1,_0x334e36)[_0x16700e(0x321,0x377,0x32e,0x2f2)](),_0x33a0f9=_0x3d941f[_0x1f6cff(-0x12d,-0xb1,-0x134,-0xff)](_0x230b05['lZsGU'](_0x334e36,-0x5cc+0x1e13+-0x1846))[_0x16700e(0x35c,0x36b,0x32e,0x376)]();if(_0x2c9d34)_0x1456b4[_0x2c9d34]=_0x33a0f9;}}else{const _0x26f1a6=_0x1e1bed[_0x11c26d];if(_0x230b05[_0x1f6cff(-0xe2,-0x134,-0x127,-0x11a)](_0x26f1a6,'$'))_0x1f6cff(-0x74,-0x8b,-0x85,-0x88)!=='UTjPD'?(_0x23eecb=!_0x23eecb,_0x47a618+=_0x26f1a6):_0x50a43e[_0x5bd494[_0x1f6cff(-0xa3,-0x68,-0xd3,-0x9a)+'e']()]=_0x27db21;else{if((_0x230b05[_0x1f6cff(-0x124,-0xf7,-0xdd,-0xf4)](_0x26f1a6,',')||_0x230b05['YSvzr'](_0x26f1a6,'，'))&&!_0x23eecb){if(_0x230b05['LnyiJ'](_0x230b05[_0x16700e(0x3c5,0x368,0x39a,0x39d)],_0x230b05[_0x16700e(0x3b9,0x35e,0x39a,0x35d)]))return'';else{const _0x8c563e=_0x47a618[_0x16700e(0x329,0x321,0x32e,0x2de)]();if(_0x8c563e)_0x5789f4[_0x1f6cff(-0x8f,-0x87,-0xbc,-0x99)](_0x8c563e);_0x47a618='';}}else _0x47a618+=_0x26f1a6;}}}if(_0x47a618[_0x1f6cff(-0x128,-0xce,-0x154,-0x110)]())_0x5789f4[_0x16700e(0x363,0x379,0x3a5,0x3a0)](_0x47a618[_0x1f6cff(-0x147,-0xdf,-0x151,-0x110)]());function _0x16700e(_0x16c7d7,_0x1a38b9,_0x167473,_0x589ff9){return _0x4f2bc5(_0x16c7d7-0xe1,_0x167473- -0x91,_0x167473-0x77,_0x1a38b9);}return _0x5789f4;},_0x1eed52=_0x230b05[_0x4f2bc5(0x466,0x421,0x419,0x432)](_0x5054ed,_0x377c5a),_0x1cfe84=[];function _0x4f2bc5(_0x16af8d,_0x129675,_0x4508f7,_0x4d78f7){return _0x153b(_0x129675-0x1b6,_0x4d78f7);}const _0x5646a7=[];function _0x19e9dc(_0x2704f9,_0x31abeb,_0x4313e2,_0x43b707){return _0x153b(_0x2704f9- -0x116,_0x31abeb);}const _0x5739ab=new Map();for(const _0x261afe of _0x1eed52){const _0x7ea4b1=_0x261afe[_0x19e9dc(0x141,0x186,0x172,0x139)](SD_SYMBOL_PATTERN);if(_0x7ea4b1){const _0x25fdb3=_0x7ea4b1[-0x1274+-0x1*-0x8eb+0x98a]||'',_0x26a95e=(_0x7ea4b1[0x1cc0+-0x8e*0x2+-0x1ba2]||'')['trim'](),_0x4dafe4=_0x7ea4b1[-0xdaf+-0x1e73+0x2c25]||'',_0x4c263d=_0x7ea4b1[0x63b+0xd9c+-0xcb*0x19]||'',_0x29816c={'original':_0x261afe,'cleaned':_0x26a95e,'prefix':_0x25fdb3,'suffix':_0x4dafe4,'weight':_0x4c263d,'skip':_0x230b05[_0x19e9dc(0x13f,0x178,0x14d,0x15c)](shouldSkipTranslation,_0x261afe)||_0x230b05[_0x19e9dc(0xf2,0x13b,0x118,0xdd)](shouldSkipTranslation,_0x26a95e)};_0x1cfe84[_0x4f2bc5(0x45f,0x436,0x3eb,0x44e)](_0x29816c),!_0x29816c[_0x4f2bc5(0x449,0x40a,0x3c7,0x43f)]&&_0x26a95e&&(_0x5646a7[_0x19e9dc(0x16a,0x158,0x11c,0x171)](_0x26a95e),_0x5739ab[_0x4f2bc5(0x3b0,0x3d5,0x414,0x3a3)](_0x26a95e[_0x4f2bc5(0x434,0x435,0x421,0x421)+'e'](),_0x29816c));}else{const _0x55eec9={'original':_0x261afe,'cleaned':_0x261afe,'prefix':'','suffix':'','weight':'','skip':_0x230b05[_0x19e9dc(0xf2,0xf7,0x11f,0x13b)](shouldSkipTranslation,_0x261afe)};_0x1cfe84[_0x19e9dc(0x16a,0x194,0x17c,0x1b5)](_0x55eec9),!_0x55eec9[_0x4f2bc5(0x3b9,0x40a,0x3dd,0x3d1)]&&_0x261afe&&(_0x5646a7['push'](_0x261afe),_0x5739ab['set'](_0x261afe[_0x19e9dc(0x169,0x16a,0x174,0x151)+'e'](),_0x55eec9));}}return{'originalTags':_0x1cfe84,'cleanedTags':_0x5646a7,'cleanedText':_0x230b05['kMEYW'](tagsToJsonString,_0x5646a7),'tagMap':_0x5739ab};}export function combineTranslationResult(_0x4f14a2,_0x3c1d15){function _0x90f145(_0x4d08ae,_0x56cabb,_0x518939,_0xc7d56d){return _0x153b(_0x518939- -0x1ba,_0x4d08ae);}function _0x43d693(_0x96a574,_0x264741,_0x5eb0b4,_0x75c4ed){return _0x153b(_0x264741-0x3b1,_0x96a574);}const _0x2abc0f={'Gbtug':function(_0x4e1445,_0x7ecc92){return _0x4e1445(_0x7ecc92);},'AxYEb':function(_0x3c95e9,_0x5a2c84){return _0x3c95e9!==_0x5a2c84;},'JJKwZ':function(_0x8d4381,_0x5a49cd){return _0x8d4381===_0x5a49cd;},'cwPGQ':_0x90f145(0x23,0x57,0x58,0xb),'LmIjs':function(_0x44f540,_0x36f24f){return _0x44f540!==_0x36f24f;},'bDYlt':_0x43d693(0x65b,0x62a,0x669,0x677),'HrRuk':_0x43d693(0x66b,0x61e,0x63f,0x63a)};if(!_0x4f14a2||!Array[_0x43d693(0x586,0x5c2,0x598,0x592)](_0x4f14a2)){if(_0x2abc0f[_0x43d693(0x57f,0x5c7,0x594,0x5f0)]('Ukisf',_0x90f145(0xaa,0xa4,0xba,0xdc)))return[];else _0x47f1ff(),_0x2abc0f[_0x90f145(0x40,0x94,0x5a,0x75)](_0x25a4b7,new _0x13b9da(_0x90f145(0x6d,0x2f,0x7e,0xb8)+'时（'+_0x397aea+'ms）'));}const _0x4ab634={};if(_0x3c1d15&&_0x2abc0f[_0x43d693(0x585,0x5d4,0x590,0x602)](typeof _0x3c1d15,_0x2abc0f['cwPGQ']))for(const [_0x227985,_0x1ae40a]of Object['entries'](_0x3c1d15)){_0x2abc0f[_0x90f145(0x7a,0xab,0xc3,0xd6)](_0x2abc0f[_0x43d693(0x63b,0x5ff,0x607,0x5dc)],_0x2abc0f[_0x90f145(0xaf,0xd0,0x8b,0xaa)])?_0x4ab634[_0x227985['toLowerCas'+'e']()]=_0x1ae40a:(_0x4033e6['push'](_0x4bc465),_0x468411[_0x43d693(0x586,0x5d0,0x598,0x5bb)](_0x87beed['toLowerCas'+'e'](),_0xea1ba2));}return _0x4f14a2[_0x43d693(0x5c9,0x5e4,0x594,0x610)](_0x438f41=>{const {original:_0x3e0a78,cleaned:_0x55960f,skip:_0x238cee}=_0x438f41;if(_0x238cee){const _0x18c166={};return _0x18c166[_0x335fb7(0x494,0x418,0x466,0x45e)]=_0x3e0a78,_0x18c166[_0x1fb423(0x2c9,0x2ba,0x2e1,0x2a5)+'n']='',_0x18c166[_0x1fb423(0x29f,0x29b,0x254,0x261)]=_0x55960f,_0x18c166[_0x335fb7(0x468,0x462,0x44e,0x46a)]=!![],_0x18c166;}function _0x1fb423(_0x5c7777,_0x36aaa0,_0xa70b19,_0xf25dda){return _0x90f145(_0x5c7777,_0x36aaa0-0x183,_0xf25dda-0x21d,_0xf25dda-0x1ef);}const _0x5b9a89=_0x4ab634[_0x55960f[_0x335fb7(0x48d,0x49b,0x47c,0x432)+'e']()]||'',_0x22f418={};_0x22f418['original']=_0x3e0a78,_0x22f418[_0x1fb423(0x26a,0x269,0x2a9,0x2a5)+'n']=_0x5b9a89,_0x22f418[_0x1fb423(0x26b,0x214,0x2ab,0x261)]=_0x55960f,_0x22f418['skipped']=![];function _0x335fb7(_0x50fb45,_0x3ee17e,_0x48c346,_0x5aff39){return _0x90f145(_0x5aff39,_0x3ee17e-0x11,_0x48c346-0x3b7,_0x5aff39-0xd5);}return _0x22f418;});}export function formatTranslationDisplay(_0x4b5e5b,_0x422901={}){const _0x374641={};_0x374641[_0x20456b(0x1b,0x4,0x13,0x9)]=function(_0x4e18a5,_0x29c016){return _0x4e18a5===_0x29c016;},_0x374641[_0x869c3b(-0x6e,-0x40,-0x2c,-0x4d)]=_0x20456b(-0x40,-0x68,-0x8c,-0x3f);function _0x869c3b(_0x59b5f6,_0x45e033,_0x157f8f,_0x589df8){return _0x153b(_0x157f8f- -0x28f,_0x59b5f6);}_0x374641[_0x20456b(-0x58,-0x49,-0x14,-0x23)]=function(_0x16f73d,_0x38b26d){return _0x16f73d!==_0x38b26d;},_0x374641[_0x869c3b(-0x71,-0xa8,-0x89,-0xc8)]='Yhzim';const _0x550f6f=_0x374641;function _0x20456b(_0x16f968,_0x1da506,_0x32fa75,_0x43a0b5){return _0x153b(_0x1da506- -0x27a,_0x32fa75);}const {separator:separator=',\x20',showOriginal:showOriginal=!![],showTranslation:showTranslation=!![]}=_0x422901;if(!_0x4b5e5b||!Array[_0x869c3b(-0x4d,-0x79,-0x7e,-0x5b)](_0x4b5e5b))return'';return _0x4b5e5b['map'](_0x5da2b5=>{function _0x4baabb(_0x3782b5,_0xfc92d8,_0xa9d814,_0x220a2c){return _0x869c3b(_0x220a2c,_0xfc92d8-0x135,_0x3782b5-0x637,_0x220a2c-0x50);}function _0x50e0a6(_0x596b37,_0x403920,_0x1af41b,_0x5d8168){return _0x20456b(_0x596b37-0x136,_0x5d8168-0x4cc,_0x596b37,_0x5d8168-0x1b6);}if(_0x5da2b5[_0x50e0a6(0x48d,0x46b,0x45a,0x4a3)])return showOriginal?_0x5da2b5[_0x50e0a6(0x500,0x490,0x4fe,0x4bb)]:'';const _0x2be42c=[];if(showOriginal)_0x2be42c[_0x50e0a6(0x4ce,0x4d5,0x4d2,0x4d2)](_0x5da2b5['original']);if(showTranslation&&_0x5da2b5[_0x4baabb(0x5ea,0x5fb,0x5ee,0x5a4)+'n']){if(_0x550f6f['mzRhR'](_0x550f6f[_0x4baabb(0x5ae,0x5e6,0x5f0,0x5d1)],_0x550f6f[_0x4baabb(0x5ae,0x597,0x562,0x588)])){const _0x38556e=_0x2b536d['match'](/\{[\s\S]*\}/);if(_0x38556e){const _0x37f4d2=_0x3a6aed[_0x50e0a6(0x470,0x4f5,0x4a7,0x4a8)](_0x38556e[0x1639+-0xd65+0xa*-0xe2]);if(_0x550f6f[_0x50e0a6(0x4b6,0x4b9,0x47f,0x4d0)](typeof _0x37f4d2,_0x550f6f[_0x50e0a6(0x4d9,0x4ff,0x465,0x4b5)])&&_0x550f6f[_0x50e0a6(0x444,0x436,0x4c4,0x483)](_0x37f4d2,null))return _0x37f4d2;}}else _0x2be42c[_0x4baabb(0x628,0x5f7,0x5ed,0x649)]('('+_0x5da2b5[_0x4baabb(0x5ea,0x605,0x5dc,0x5c0)+'n']+')');}return _0x2be42c[_0x50e0a6(0x458,0x46a,0x42a,0x476)]('\x20');})[_0x869c3b(-0xba,-0xa6,-0x83,-0x5b)](Boolean)[_0x869c3b(-0x93,-0x97,-0x6b,-0xb6)](separator);}export async function translatePromptTags(_0x1c7c4f){const _0x4b6842={'AMGWZ':function(_0xc8b1e4,_0x3a8a3b){return _0xc8b1e4(_0x3a8a3b);},'pTgxD':function(_0x5389b2,_0x54f771){return _0x5389b2!==_0x54f771;},'epyNO':_0x9bf521(0x44b,0x493,0x485,0x48c),'hgKJj':_0x46f5d1(0x427,0x406,0x3fe,0x44a),'eaTFx':function(_0x41c242,_0x555720){return _0x41c242(_0x555720);},'NBBlq':function(_0x2b8ec2,_0x259f8e,_0x2e94b2){return _0x2b8ec2(_0x259f8e,_0x2e94b2);},'fFEkq':function(_0x40fdf1,_0x5301f2){return _0x40fdf1(_0x5301f2);},'vGNAm':_0x9bf521(0x477,0x461,0x43d,0x452)+_0x9bf521(0x437,0x46d,0x461,0x4b6)+':'},{originalTags:_0x451bb7,cleanedText:_0x57459e}=_0x4b6842[_0x9bf521(0x457,0x488,0x48a,0x4bc)](preprocessPromptForTranslation,_0x1c7c4f);if(!_0x57459e){if(_0x4b6842['pTgxD'](_0x4b6842[_0x46f5d1(0x4c7,0x482,0x476,0x45a)],_0x4b6842['hgKJj'])){const _0x13972d={};return _0x13972d['results']=[],_0x13972d['displayTex'+'t']='',_0x13972d[_0x9bf521(0x4be,0x47a,0x457,0x489)+'gs']=[],_0x13972d;}else _0x440f0d=!_0x6bded8,_0x1d66bf+=_0x37d1be;}function _0x9bf521(_0x3de3ab,_0x1c9c7d,_0x2f009d,_0x1d0cd1){return _0x153b(_0x1c9c7d-0x252,_0x3de3ab);}function _0x46f5d1(_0x339db1,_0x2737f2,_0x5f0aa0,_0x13083c){return _0x153b(_0x2737f2-0x206,_0x13083c);}try{const _0xd2ff29=await _0x4b6842[_0x9bf521(0x488,0x4ba,0x4d0,0x493)](callTranslation,_0x57459e),_0x352629=_0x4b6842[_0x46f5d1(0x46b,0x43c,0x420,0x3ee)](parseTranslationResult,_0xd2ff29),_0x23e872=_0x4b6842[_0x9bf521(0x457,0x448,0x3fa,0x41b)](combineTranslationResult,_0x451bb7,_0x352629),_0x54e517=_0x4b6842[_0x46f5d1(0x3dc,0x3ff,0x42f,0x3b5)](formatTranslationDisplay,_0x23e872),_0x37d49c={};return _0x37d49c['results']=_0x23e872,_0x37d49c[_0x46f5d1(0x468,0x474,0x42d,0x495)+'t']=_0x54e517,_0x37d49c[_0x46f5d1(0x413,0x42e,0x473,0x446)+'gs']=_0x451bb7,_0x37d49c;}catch(_0x519ac3){console[_0x9bf521(0x48b,0x462,0x42f,0x427)](_0x4b6842[_0x9bf521(0x4fb,0x4c9,0x483,0x4cf)],_0x519ac3);throw _0x519ac3;}}export function parseTranslationResult(_0x2fb7b3){function _0x30f86a(_0x346c75,_0x17e262,_0x3eee97,_0x4c6241){return _0x153b(_0x17e262-0x29b,_0x4c6241);}const _0x856b8e={'iBcSw':function(_0x114768,_0x54b8fd){return _0x114768!==_0x54b8fd;},'vcVgs':_0x30f86a(0x53d,0x505,0x53a,0x4b4),'trYFz':_0x30f86a(0x561,0x511,0x510,0x4e8),'CKSAy':function(_0x22e4d8,_0x3e8e75){return _0x22e4d8===_0x3e8e75;},'IEHLH':'object','lcsEz':_0x30f86a(0x496,0x4aa,0x46b,0x468)+_0x30f86a(0x539,0x50b,0x528,0x4ee)+'尝试旧格式:','knAyQ':function(_0x41c686,_0x175b0d){return _0x41c686(_0x175b0d);},'KbUJK':function(_0xfd454,_0x5c5bd6){return _0xfd454>_0x5c5bd6;},'KuZqj':function(_0x57bc0c,_0x5b4e88){return _0x57bc0c+_0x5b4e88;}};if(!_0x2fb7b3)return{};try{if(_0x856b8e['iBcSw'](_0x856b8e[_0x3f5553(0x2d5,0x296,0x29e,0x27b)],_0x856b8e['trYFz'])){const _0x4ba23f=_0x2fb7b3[_0x30f86a(0x500,0x4f2,0x4cd,0x4aa)](/\{[\s\S]*\}/);if(_0x4ba23f){const _0x2ed249=JSON[_0x3f5553(0x2e2,0x2d4,0x2f9,0x2fb)](_0x4ba23f[0x39*0x5e+0x917*-0x1+0x1b1*-0x7]);if(_0x856b8e[_0x3f5553(0x27e,0x2cd,0x2c0,0x2f2)](typeof _0x2ed249,_0x856b8e[_0x3f5553(0x2bb,0x317,0x2f3,0x322)])&&_0x2ed249!==null)return _0x2ed249;}}else return[];}catch(_0x365c08){console[_0x3f5553(0x308,0x307,0x2e6,0x30f)](_0x856b8e['lcsEz'],_0x365c08[_0x30f86a(0x44f,0x49f,0x488,0x4a7)]);}const _0x188249=_0x856b8e['knAyQ'](String,_0x2fb7b3)[_0x3f5553(0x2c3,0x348,0x314,0x2ee)](/[\r\n]+/g,'\x20')['replace'](/^[\s"'`]+|[\s"'`]+$/g,'')['trim'](),_0x3d38ba=_0x188249[_0x30f86a(0x4c1,0x48e,0x477,0x446)](/[,，]/)['map'](_0x84aa82=>_0x84aa82['trim']())[_0x3f5553(0x276,0x2e1,0x2af,0x2d1)](Boolean);function _0x3f5553(_0x1a1880,_0x26fc58,_0x3fc9ed,_0x4820a4){return _0x153b(_0x3fc9ed-0xa3,_0x4820a4);}const _0x2f2c6e={};for(const _0x182d38 of _0x3d38ba){const _0x18a291=_0x182d38[_0x3f5553(0x268,0x2c0,0x2b1,0x2b5)]('\x5c');if(_0x856b8e[_0x3f5553(0x305,0x29e,0x2ef,0x2e5)](_0x18a291,-0x146c+0x1ae2+-0x676)){const _0x21b5b6=_0x182d38['slice'](0xaaf*0x3+-0x144+0x47*-0x6f,_0x18a291)['trim'](),_0x53b9d9=_0x182d38[_0x3f5553(0x2b4,0x27b,0x2bd,0x2e6)](_0x856b8e[_0x3f5553(0x2ae,0x277,0x2a8,0x296)](_0x18a291,0x1923+0x1bca+-0x34ec))['trim']();if(_0x21b5b6)_0x2f2c6e[_0x21b5b6]=_0x53b9d9;}}return _0x2f2c6e;}function generateRequestId(){function _0xa758d6(_0x333e4e,_0x4bf240,_0x50dc10,_0x4ce675){return _0x153b(_0x333e4e- -0x8e,_0x4ce675);}function _0x47f32e(_0x56c0d7,_0x297822,_0x207752,_0x4149f8){return _0x153b(_0x207752-0x34,_0x4149f8);}const _0x13fe0b={};_0x13fe0b[_0xa758d6(0x1d9,0x18b,0x188,0x1b2)]=function(_0x464235,_0x5a8417){return _0x464235+_0x5a8417;};const _0x16a935=_0x13fe0b;if(crypto&&crypto['randomUUID'])return crypto[_0x47f32e(0x2d3,0x2eb,0x2c6,0x30e)]();return _0x16a935[_0x47f32e(0x2c8,0x253,0x29b,0x28d)](Date['now']()['toString'](0xb2d+0xffd+0xd83*-0x2),Math['random']()[_0x47f32e(0x254,0x2cc,0x28c,0x26b)](0x5*0x46a+0x262*0xd+-0x8*0x69d)[_0xa758d6(0x1bf,0x205,0x1f8,0x19b)](0x542+0x71*-0x57+0x2127*0x1));}export function LLM_TRANSLATION_GET_PROMPT(){function _0x11971c(_0x321eea,_0x5a53b4,_0x8550e7,_0x54cb98){return _0x153b(_0x8550e7- -0x218,_0x5a53b4);}const _0x24b080={'XjJIE':function(_0x3a4fc9,_0x34a944,_0x517f35){return _0x3a4fc9(_0x34a944,_0x517f35);},'GGMVy':function(_0x538b52,_0x37a133){return _0x538b52!==_0x37a133;},'zcqNv':function(_0x5389d8,_0x523c2a){return _0x5389d8(_0x523c2a);},'LjHiW':function(_0x5515b9,_0x917660){return _0x5515b9(_0x917660);},'lvCDt':'获取翻译提示词超时','JYYbx':function(_0x1241c1,_0x2b183a){return _0x1241c1===_0x2b183a;},'KqCLC':_0x11971c(-0x4f,-0x1f,-0x16,-0x1a),'CfhAQ':function(_0x234ae5){return _0x234ae5();},'xfJJH':function(_0x1e299c,_0x5ae2de,_0x822065){return _0x1e299c(_0x5ae2de,_0x822065);}};return new Promise((_0x3fdfce,_0x1eaeeb)=>{const _0x2f0e31={'zsyuk':function(_0x20daf4){return _0x20daf4();},'MDrKh':function(_0x2836f1,_0x10a851,_0x386db4){return _0x24b080['XjJIE'](_0x2836f1,_0x10a851,_0x386db4);},'SqUml':function(_0x1dcf52,_0x32da03){return _0x24b080['GGMVy'](_0x1dcf52,_0x32da03);},'NdVnl':function(_0x594165,_0x4e28fa){function _0x4a58a0(_0x1554a1,_0x16f3ec,_0x121128,_0x3ac9b3){return _0x153b(_0x121128- -0x272,_0x16f3ec);}return _0x24b080[_0x4a58a0(-0x5c,-0x27,-0x1f,-0x2f)](_0x594165,_0x4e28fa);},'ZfaAj':function(_0xc0baec,_0xd413eb){return _0x24b080['LjHiW'](_0xc0baec,_0xd413eb);},'rXqIB':_0x24b080[_0x2bf7cd(-0x139,-0x138,-0xe9,-0x158)],'hBctH':function(_0x3c64ea,_0x32dc66){function _0x1bebab(_0x58d734,_0x5e1b9a,_0x4ed6ec,_0x396f48){return _0x2bf7cd(_0x396f48-0x2e6,_0x5e1b9a-0x92,_0x4ed6ec-0xbf,_0x4ed6ec);}return _0x24b080[_0x1bebab(0x1a2,0x1ce,0x1ca,0x1c7)](_0x3c64ea,_0x32dc66);},'ESfmq':_0x2bf7cd(-0x18c,-0x197,-0x191,-0x13c),'TFDhp':_0x24b080[_0x2bf7cd(-0x112,-0x126,-0x114,-0x146)],'wdhfu':function(_0x1e2443,_0x5ef84b){return _0x24b080['LjHiW'](_0x1e2443,_0x5ef84b);}},_0x331995=_0x24b080[_0x2bf7cd(-0xfe,-0xf7,-0x10e,-0xad)](generateRequestId);function _0x2bf7cd(_0x8cdac9,_0x1f1e03,_0x158104,_0x44e2be){return _0x11971c(_0x8cdac9-0x109,_0x44e2be,_0x8cdac9- -0x16c,_0x44e2be-0x63);}console[_0x4e2f4c(0xc0,0xb9,0xcc,0x73)](_0x4e2f4c(0x9a,0xd1,0xae,0xd0)+_0x4e2f4c(0x114,0x111,0x12f,0x137)+_0x4e2f4c(0xb1,0xec,0xf1,0xf6)+_0x331995+')');function _0x4e2f4c(_0x166081,_0x59cea7,_0x5dc3ec,_0x39c290){return _0x11971c(_0x166081-0x1a8,_0x59cea7,_0x166081-0xa3,_0x39c290-0x1c8);}const _0x6d7c28=_0x468948=>{function _0xb4e2a7(_0x475c33,_0x29dfd9,_0x3cda12,_0x42a84c){return _0x2bf7cd(_0x29dfd9-0x741,_0x29dfd9-0x160,_0x3cda12-0x113,_0x42a84c);}const _0xf77267={'TpPNu':function(_0x47a6b1,_0x482581){function _0x13eb6d(_0x31c4ed,_0x391f07,_0x4536ba,_0x545484){return _0x153b(_0x391f07- -0x1c8,_0x4536ba);}return _0x2f0e31[_0x13eb6d(0x6a,0x3b,0x28,0x39)](_0x47a6b1,_0x482581);},'iIafF':function(_0x9f952f,_0x3b3dab){function _0x35e026(_0x45e8b1,_0x58a506,_0x59838c,_0x1c18b3){return _0x153b(_0x59838c- -0xe2,_0x58a506);}return _0x2f0e31[_0x35e026(0x17c,0x166,0x13a,0x14d)](_0x9f952f,_0x3b3dab);},'dYzxw':function(_0x135447,_0x4a3e0f){function _0x1acb5f(_0x2534f6,_0x490e22,_0x44f211,_0x2f2060){return _0x153b(_0x2534f6-0x10c,_0x2f2060);}return _0x2f0e31[_0x1acb5f(0x32e,0x377,0x370,0x300)](_0x135447,_0x4a3e0f);},'vRtwz':_0x2f0e31[_0xb4e2a7(0x60a,0x61c,0x5ed,0x5e5)]};function _0x37db98(_0x4ebee9,_0x14ea59,_0x4d76d2,_0x9a8528){return _0x4e2f4c(_0x9a8528- -0x197,_0x14ea59,_0x4d76d2-0x6d,_0x9a8528-0xc9);}if(_0x2f0e31[_0xb4e2a7(0x5a5,0x5e9,0x5db,0x5f8)](_0x2f0e31[_0x37db98(-0x104,-0xb1,-0xf4,-0xc4)],_0x2f0e31[_0xb4e2a7(0x563,0x5af,0x56d,0x5c0)])){const _0x4b6e7c=_0x2f0e31[_0x37db98(-0x102,-0xbf,-0xca,-0xce)](_0x5c6a94);_0x294720[_0xb4e2a7(0x642,0x5f2,0x5bc,0x5d7)]('st-chatu8:'+_0xb4e2a7(0x619,0x646,0x64c,0x663)+_0xb4e2a7(0x61c,0x5e3,0x609,0x5d7)+_0x4b6e7c+')');const _0x1d700b=_0x233c03=>{function _0x53247f(_0x1648cd,_0x57a842,_0x35aadb,_0x1918d6){return _0x37db98(_0x1648cd-0x172,_0x1648cd,_0x35aadb-0x109,_0x1918d6-0x46a);}if(_0xf77267[_0x41e879(-0x103,-0xda,-0x126,-0xf5)](_0x233c03['id'],_0x4b6e7c))return;function _0x41e879(_0x4e1032,_0x4e73c1,_0x48c4b1,_0x1204ea){return _0x37db98(_0x4e1032-0x19a,_0x48c4b1,_0x48c4b1-0x15c,_0x4e1032- -0x3b);}_0x2c6686[_0x53247f(0x39d,0x34f,0x3eb,0x39a)+'ener'](_0x2e5f91[_0x41e879(-0xbc,-0x7e,-0xf3,-0x101)+_0x53247f(0x3ae,0x35d,0x3bc,0x38d)+'PROMPT_RES'+'PONSE'],_0x1d700b);const {prompt:_0xddbec}=_0x233c03;_0x39da38[_0x53247f(0x3d9,0x391,0x3e1,0x393)]('st-chatu8:'+_0x53247f(0x409,0x428,0x413,0x3e3)+_0x41e879(-0xe9,-0xd0,-0xce,-0xb5)+_0x4b6e7c+'):',_0xddbec),_0xf77267['iIafF'](_0x43dcce,_0xddbec);};_0x142912['on'](_0x13568a['LLM_TRANSL'+'ATION_GET_'+'PROMPT_RES'+_0x37db98(-0xd2,-0xdc,-0x11c,-0x11b)],_0x1d700b);const _0x265288={};_0x265288['id']=_0x4b6e7c,_0x5c04ca['emit'](_0x1a9a34['LLM_TRANSL'+_0xb4e2a7(0x60c,0x5ec,0x5cd,0x5f7)+_0xb4e2a7(0x610,0x635,0x62f,0x641)+_0x37db98(-0xf8,-0xb4,-0xe9,-0xda)],_0x265288),_0x2f0e31['MDrKh'](_0xf610ce,()=>{function _0x872868(_0x1e474e,_0x1cab35,_0x294cb9,_0x2f1268){return _0x37db98(_0x1e474e-0x9c,_0x1e474e,_0x294cb9-0x190,_0x2f1268-0xe1);}function _0x510414(_0x2df367,_0x3b70f0,_0x366a4b,_0x519fb1){return _0x37db98(_0x2df367-0x1a,_0x366a4b,_0x366a4b-0x1b7,_0x3b70f0-0x94);}_0x5c4bdf[_0x872868(-0x28,-0x2d,-0x13,0x11)+_0x510414(-0x6e,-0x7c,-0x61,-0x34)](_0x1fc2c6[_0x872868(0x45,0x1d,0x76,0x60)+_0x872868(-0x1b,0x10,-0x12,0x4)+_0x510414(0xb,0x14,0x1c,0x5b)+_0x872868(0x14,-0x25,-0x17,-0x3a)],_0x1d700b),_0xf77267['dYzxw'](_0x1d2c30,new _0x24d7cb(_0xf77267[_0x510414(-0x7e,-0x48,0x8,-0x16)]));},-0x888+0x3*-0x62d+0x421f);}else{if(_0x2f0e31[_0xb4e2a7(0x573,0x5c0,0x601,0x584)](_0x468948['id'],_0x331995))return;eventSource['removeList'+_0xb4e2a7(0x5c2,0x5b9,0x603,0x5d0)](eventNames[_0xb4e2a7(0x63a,0x648,0x645,0x64b)+_0x37db98(-0x117,-0x9d,-0xb6,-0xdd)+_0x37db98(-0x84,-0x94,-0x81,-0x80)+_0xb4e2a7(0x5ec,0x5ae,0x55d,0x574)],_0x6d7c28);const {prompt:_0x38c957}=_0x468948;console['log'](_0xb4e2a7(0x602,0x5cc,0x600,0x59a)+_0x37db98(-0x3a,-0xcd,-0x4f,-0x87)+_0x37db98(-0xad,-0x76,-0x73,-0xae)+_0x331995+'):',_0x38c957),_0x2f0e31[_0x37db98(-0x109,-0xe4,-0xab,-0xea)](_0x3fdfce,_0x38c957);}};eventSource['on'](eventNames[_0x4e2f4c(0x116,0x108,0xee,0x14d)+_0x4e2f4c(0xba,0xd1,0x10b,0xc6)+_0x2bf7cd(-0xf8,-0xc7,-0x122,-0xe4)+_0x4e2f4c(0x7c,0x54,0x75,0x5c)],_0x6d7c28);const _0x552986={};_0x552986['id']=_0x331995,eventSource[_0x4e2f4c(0x10c,0x15a,0x140,0x119)](eventNames[_0x4e2f4c(0x116,0x10a,0x165,0xdf)+_0x4e2f4c(0xba,0xe7,0xb0,0x76)+'PROMPT_REQ'+_0x4e2f4c(0xbd,0xc0,0xa1,0xe6)],_0x552986),_0x24b080[_0x4e2f4c(0x105,0x138,0x14a,0x128)](setTimeout,()=>{function _0x1dc62c(_0x307a16,_0x1f590a,_0x3e0e02,_0x1a30e4){return _0x2bf7cd(_0x1f590a-0x5db,_0x1f590a-0x195,_0x3e0e02-0x21,_0x307a16);}function _0x4a6f73(_0x20dd36,_0x3d1ed5,_0x3d080b,_0x322afc){return _0x2bf7cd(_0x3d080b-0x65b,_0x3d1ed5-0x87,_0x3d080b-0x9e,_0x20dd36);}eventSource['removeList'+'ener'](eventNames[_0x1dc62c(0x4f4,0x4e2,0x4c0,0x495)+_0x4a6f73(0x504,0x528,0x506,0x54c)+_0x1dc62c(0x4ac,0x4e3,0x4e3,0x4dc)+_0x1dc62c(0x43d,0x448,0x420,0x422)],_0x6d7c28),_0x2f0e31[_0x4a6f73(0x53e,0x53c,0x512,0x4c1)](_0x1eaeeb,new Error(_0x2f0e31['rXqIB']));},0x4*0x2b3+-0x1*0x200f+-0x1*-0x3c53);});}export function LLM_TRANSLATION(_0x5566ae,{timeoutMs:timeoutMs=0xed8f+0x10c53+-0x17*0xbce}={}){function _0x209bec(_0x52048e,_0x4b2e96,_0x48ec7a,_0x3f4494){return _0x153b(_0x48ec7a-0x2ef,_0x3f4494);}const _0x472b2c={'uiCuS':function(_0x366673,_0x383044){return _0x366673(_0x383044);},'GqvPT':_0x209bec(0x4d5,0x507,0x4fe,0x54b)+_0x209bec(0x569,0x533,0x55f,0x580)+'尝试旧格式:','EURKB':function(_0x418b2e,_0x404df3){return _0x418b2e===_0x404df3;},'YOWuJ':_0x209bec(0x540,0x557,0x571,0x5a8),'QEwCf':function(_0x169359,_0x230320){return _0x169359!==_0x230320;},'VVcRr':function(_0x4afec7){return _0x4afec7();},'FPYFH':_0x209bec(0x53d,0x57a,0x549,0x4f8),'gEPHh':_0x31f9fe(-0x1de,-0x1e6,-0x1ec,-0x1a3),'XYSEV':function(_0x330285,_0x3be4b1){return _0x330285(_0x3be4b1);},'NYCtH':_0x31f9fe(-0x1d9,-0x21f,-0x1f1,-0x1aa)+_0x209bec(0x526,0x51c,0x504,0x52f)+_0x209bec(0x579,0x54e,0x55b,0x58d),'foZqy':_0x31f9fe(-0x159,-0x183,-0x1a4,-0x175),'fDtHN':function(_0x538f0b){return _0x538f0b();}};function _0x31f9fe(_0x5bd885,_0x106e8d,_0x55a53a,_0x452f65){return _0x153b(_0x5bd885- -0x3e8,_0x55a53a);}return new Promise((_0x59eb19,_0x15de4e)=>{const _0x2543c3={};function _0x5a05a5(_0x37cd24,_0x4f82d7,_0x72cc4d,_0x4470b7){return _0x31f9fe(_0x4470b7-0x662,_0x4f82d7-0x18f,_0x72cc4d,_0x4470b7-0xfc);}function _0x538f9a(_0x461da4,_0xf9b3fd,_0x1a25c6,_0x39e7b3){return _0x31f9fe(_0xf9b3fd-0x162,_0xf9b3fd-0x82,_0x39e7b3,_0x39e7b3-0x1bc);}_0x2543c3[_0x5a05a5(0x487,0x4e5,0x486,0x4a1)]=_0x472b2c[_0x538f9a(-0x5c,-0x29,0x21,-0xc)];const _0x33a292=_0x2543c3;if(_0x472b2c[_0x5a05a5(0x4c2,0x4bf,0x49c,0x4a8)](_0x472b2c['foZqy'],_0x472b2c[_0x5a05a5(0x446,0x43e,0x4c1,0x471)])){const _0x4b9e0f=_0x472b2c[_0x538f9a(-0xcd,-0x91,-0x90,-0xb3)](generateRequestId);console['log'](_0x5a05a5(0x46d,0x472,0x473,0x489)+_0x5a05a5(0x499,0x4ab,0x4b0,0x47b)+_0x5a05a5(0x4cc,0x523,0x4a1,0x4d8)+_0x4b9e0f+')');let _0x350231=null;const _0x4c1440=()=>{eventSource[_0x49ef5e(0xb5,0xd5,0x99,0xa8)+'ener'](eventNames[_0x2d5711(-0x10,-0x70,-0x25,-0x41)+_0x2d5711(-0x81,-0xa4,-0x21,-0x6a)+_0x2d5711(-0x45,-0x67,-0xb5,-0x71)],_0x3ecea3);function _0x2d5711(_0x3eadf8,_0x1b42a4,_0x467996,_0xa079c8){return _0x538f9a(_0x3eadf8-0x189,_0xa079c8- -0x46,_0x467996-0x105,_0x467996);}function _0x49ef5e(_0x533183,_0x2a6163,_0x4d6678,_0x14d7e1){return _0x538f9a(_0x533183-0x1bc,_0x2a6163-0x11f,_0x4d6678-0x108,_0x14d7e1);}if(_0x350231)_0x472b2c[_0x49ef5e(0xe4,0xa6,0xca,0xb5)](clearTimeout,_0x350231);},_0x3ecea3=_0x390401=>{const _0x467a57={};_0x467a57[_0x47032d(-0x15d,-0x101,-0x169,-0x143)]=_0x472b2c[_0x79ed6f(0x284,0x31d,0x2cf,0x2f5)];const _0xa5a963=_0x467a57;function _0x79ed6f(_0x328647,_0x238632,_0x4cff67,_0x3a5814){return _0x5a05a5(_0x328647-0x1c5,_0x238632-0x88,_0x238632,_0x4cff67- -0x207);}function _0x47032d(_0x4dcd07,_0x11e4f6,_0x550fbf,_0x16e27e){return _0x5a05a5(_0x4dcd07-0x1ad,_0x11e4f6-0x15e,_0x11e4f6,_0x16e27e- -0x5d5);}if(_0x472b2c[_0x47032d(-0xdc,-0xf9,-0x105,-0x12d)](_0x472b2c[_0x47032d(-0x157,-0x104,-0x136,-0x115)],_0x79ed6f(0x2b1,0x2de,0x2f5,0x2c5))){if(_0x472b2c[_0x47032d(-0xf0,-0xdc,-0xcf,-0xd8)](_0x390401['id'],_0x4b9e0f))return;_0x472b2c['VVcRr'](_0x4c1440),console['log'](_0x79ed6f(0x254,0x2be,0x282,0x23e)+'\x20已收到翻译\x20LLM'+_0x47032d(-0xef,-0x13b,-0x121,-0x13b)+'\x20'+_0x4b9e0f+'):',_0x390401);if(_0x390401['success'])_0x472b2c[_0x47032d(-0x190,-0x152,-0x129,-0x14e)](_0x59eb19,_0x390401[_0x47032d(-0xfc,-0xb2,-0xd8,-0xfb)]);else{if(_0x390401['error']&&_0x472b2c[_0x79ed6f(0x2d0,0x2b7,0x2a1,0x28d)](_0x390401['error']['name'],_0x472b2c['FPYFH'])){if(_0x472b2c[_0x79ed6f(0x2c1,0x2ec,0x2a1,0x29f)](_0x472b2c[_0x47032d(-0x139,-0xc7,-0xdd,-0xfa)],_0x79ed6f(0x235,0x275,0x27d,0x233))){const _0xfb8c3a=new Error(_0x390401[_0x47032d(-0x141,-0x136,-0x14f,-0x14b)][_0x47032d(-0x127,-0x13d,-0x179,-0x157)]);_0xfb8c3a['name']=_0x472b2c[_0x79ed6f(0x2d0,0x327,0x300,0x32b)],_0x472b2c[_0x47032d(-0x140,-0x138,-0x140,-0x150)](_0x15de4e,_0xfb8c3a);}else _0x6d4c60[_0x47032d(-0xd4,-0xaa,-0xb7,-0xdb)]('('+_0x52e49f[_0x79ed6f(0x264,0x2e1,0x2b5,0x2ef)+'n']+')');}else _0x472b2c[_0x47032d(-0x197,-0x12a,-0x140,-0x150)](_0x15de4e,new Error(_0x390401[_0x79ed6f(0x28b,0x289,0x2d3,0x2c6)]));}}else _0x2d2863['warn'](_0xa5a963['zMXbi'],_0x2b40ab[_0x79ed6f(0x2a5,0x249,0x277,0x2ba)]);};eventSource['on'](eventNames[_0x5a05a5(0x4b6,0x519,0x504,0x505)+_0x5a05a5(0x51c,0x4c8,0x4b8,0x4dc)+_0x538f9a(-0x44,-0x2b,0x18,-0x27)],_0x3ecea3);const _0x3cd8d3={};_0x3cd8d3['prompt']=_0x5566ae,_0x3cd8d3['id']=_0x4b9e0f,eventSource[_0x538f9a(0x18,-0x5,0xd,0x3f)](eventNames['LLM_TRANSL'+_0x5a05a5(0x44b,0x47a,0x482,0x46e)+_0x538f9a(-0xae,-0x89,-0xa8,-0xa6)],_0x3cd8d3),_0x350231=setTimeout(()=>{_0x4c1440();function _0x13ae5b(_0x464137,_0x1c4d5b,_0x56d464,_0x2d95f5){return _0x5a05a5(_0x464137-0x1d8,_0x1c4d5b-0xce,_0x56d464,_0x1c4d5b- -0x52a);}function _0x5975ab(_0x42f79a,_0x5f0e65,_0x1a004a,_0x176c5e){return _0x538f9a(_0x42f79a-0x1e0,_0x42f79a-0x5e2,_0x1a004a-0xbd,_0x176c5e);}_0x472b2c[_0x5975ab(0x567,0x518,0x584,0x583)](_0x15de4e,new Error(_0x5975ab(0x594,0x569,0x5d6,0x5a3)+'时（'+timeoutMs+'ms）'));},timeoutMs);}else _0x3e9de4[_0x5a05a5(0x4be,0x4a2,0x466,0x4af)](_0x33a292[_0x5a05a5(0x451,0x4af,0x4a3,0x4a1)]),_0xadeb4=!![];});}export async function callTranslation(_0x52396d){function _0x209490(_0x313c36,_0x2e4e43,_0x113b46,_0x5d9d16){return _0x153b(_0x313c36- -0x71,_0x113b46);}const _0x1e4ed5={'DHBIz':function(_0x9d8e72,_0x3d419a,_0x5dfe64){return _0x9d8e72(_0x3d419a,_0x5dfe64);},'YqGUA':_0x209490(0x1d1,0x1de,0x212,0x1ea)+'n','FVDJv':function(_0x489a55,_0x1af0a9){return _0x489a55||_0x1af0a9;},'IsCjd':function(_0x56a587,_0x2b897d){return _0x56a587(_0x2b897d);},'oyGzz':function(_0x38d7a8,_0x47dbf6){return _0x38d7a8||_0x47dbf6;}};function _0xae7c71(_0x57a754,_0x4314fd,_0x2fa1a5,_0x5c413d){return _0x153b(_0x2fa1a5-0x194,_0x5c413d);}try{let _0x4e255d=_0x1e4ed5[_0xae7c71(0x395,0x39d,0x3cb,0x3a1)](buildPromptForRequestType,_0x1e4ed5[_0x209490(0x1de,0x1f1,0x1e6,0x1c3)],_0x1e4ed5[_0x209490(0x1d8,0x1db,0x1aa,0x1d8)](_0x52396d,''));_0x4e255d=_0x1e4ed5['IsCjd'](mergeAdjacentMessages,_0x4e255d);const _0x496e75=[..._0x4e255d,{'role':'user','content':_0x1e4ed5[_0xae7c71(0x422,0x3f5,0x3db,0x418)](_0x52396d,'')}];updateCombinedPrompt(_0x496e75);const _0x4d3032=await _0x1e4ed5[_0xae7c71(0x3cb,0x3e6,0x3de,0x392)](LLM_TRANSLATION,_0x496e75);return _0x4d3032;}catch(_0x368d17){_0x1e4ed5[_0xae7c71(0x3bf,0x394,0x3de,0x3e5)](addLog,_0xae7c71(0x3d5,0x414,0x3d3,0x3eb)+_0x368d17[_0x209490(0x193,0x1b0,0x1c8,0x168)]),console[_0xae7c71(0x3e8,0x3ee,0x3a4,0x3e8)](_0xae7c71(0x384,0x361,0x38e,0x341),_0x368d17);throw _0x368d17;}}let isAiInitialized=![];export function initAiSettings(_0x1f7751){function _0x3289a6(_0x13cad9,_0x22b5de,_0x5ccef4,_0x535158){return _0x153b(_0x5ccef4- -0x1a2,_0x22b5de);}function _0x22fd25(_0x288456,_0x5e5c12,_0x1e933c,_0x2f7616){return _0x153b(_0x1e933c- -0x292,_0x288456);}!isAiInitialized&&(console[_0x3289a6(0xe0,0xc8,0x93,0xd8)](_0x3289a6(0x58,0x6b,0x6d,0x59)+_0x3289a6(0x6a,0x39,0x73,0x5f)+_0x3289a6(0xe0,0xc8,0xca,0xa7)),isAiInitialized=!![]);}