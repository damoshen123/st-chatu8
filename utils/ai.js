(function(_0x1a48ec,_0x26c284){function _0x3c2be5(_0x200e84,_0x51e921,_0x1191d7,_0xda2e46){return _0x52d8(_0x51e921-0x377,_0x200e84);}const _0xe6f1b6=_0x1a48ec();function _0x5092a1(_0x1c90ee,_0xfa3ecb,_0x4ec1e4,_0x405e3c){return _0x52d8(_0x1c90ee-0x38c,_0x4ec1e4);}while(!![]){try{const _0x24e7cb=-parseInt(_0x5092a1(0x53b,0x592,0x4f1,0x4e5))/(0xf70+-0x1ba5+0xc36)*(-parseInt(_0x3c2be5(0x513,0x4e6,0x4b4,0x4ea))/(-0x9*-0x1db+-0x2124+-0x1073*-0x1))+-parseInt(_0x3c2be5(0x4e5,0x530,0x4de,0x519))/(-0x89*0xd+0x3e+0x6ba)*(-parseInt(_0x5092a1(0x4d2,0x4a9,0x4c6,0x47e))/(0x18bb+0x1537+0x2dee*-0x1))+-parseInt(_0x3c2be5(0x492,0x4a7,0x477,0x4e8))/(0x121d+0x205d+-0x3275)*(-parseInt(_0x5092a1(0x499,0x4a5,0x479,0x4df))/(0xece+0x21b3+0x6ed*-0x7))+-parseInt(_0x5092a1(0x511,0x540,0x534,0x51d))/(0x7cd*0x3+-0x2*-0x1178+-0x3a50)*(-parseInt(_0x3c2be5(0x4cd,0x48e,0x447,0x438))/(-0x13*0xea+-0xf8a+0x20f0*0x1))+-parseInt(_0x5092a1(0x51c,0x516,0x4d0,0x541))/(0x13c9+-0x2*-0x7e2+-0x2384)*(parseInt(_0x5092a1(0x502,0x55b,0x4bd,0x4af))/(-0x1e3*-0x5+0x2cf*-0xb+-0x1*-0x1580))+-parseInt(_0x5092a1(0x4ed,0x4ee,0x4a7,0x4c7))/(-0x2*0x116+-0xf85+0x11bc)*(parseInt(_0x5092a1(0x4e1,0x508,0x53a,0x4ac))/(0x2494+-0x1bcb*-0x1+0x21*-0x1f3))+-parseInt(_0x5092a1(0x4ba,0x505,0x4a6,0x486))/(-0x376+0x13fa+-0x1077);if(_0x24e7cb===_0x26c284)break;else _0xe6f1b6['push'](_0xe6f1b6['shift']());}catch(_0x39694e){_0xe6f1b6['push'](_0xe6f1b6['shift']());}}}(_0x354e,0x49*-0x132b+0x1*-0x69a6+0xbf2f6));const _0x23f4f7=(function(){let _0x27a020=!![];return function(_0x68a4c0,_0x4c0718){const _0x1c2d19=_0x27a020?function(){function _0x57dcee(_0x3d2bb2,_0x5effb4,_0x5343f2,_0x407eb6){return _0x52d8(_0x5343f2-0xd2,_0x3d2bb2);}if(_0x4c0718){const _0x4e7fac=_0x4c0718[_0x57dcee(0x24c,0x22f,0x250,0x280)](_0x68a4c0,arguments);return _0x4c0718=null,_0x4e7fac;}}:function(){};return _0x27a020=![],_0x1c2d19;};}()),_0x408dca=_0x23f4f7(this,function(){const _0x256606={};function _0x3e26da(_0x298c27,_0xa67b72,_0xd5bb58,_0x21fa57){return _0x52d8(_0xd5bb58- -0x148,_0x298c27);}function _0xcffb50(_0x539e91,_0x3f3e81,_0x4bf615,_0xf75dab){return _0x52d8(_0x4bf615-0x7b,_0x3f3e81);}_0x256606['CsXlO']='(((.+)+)+)'+'+$';const _0x1b7b87=_0x256606;return _0x408dca['toString']()[_0x3e26da(0xc,0x2,-0x11,-0x21)](_0xcffb50(0x216,0x1b0,0x1ec,0x1fe)+'+$')['toString']()['constructo'+'r'](_0x408dca)[_0xcffb50(0x1d2,0x16d,0x1b2,0x1e7)](_0x1b7b87[_0x3e26da(0xf,0x7,-0x2f,-0x4b)]);});_0x408dca();import{extension_settings}from'../../../../extensions.js';import{saveSettingsDebounced,eventSource}from'../../../../../script.js';import{extensionName,eventNames}from'./config.js';import{addLog}from'./utils.js';import{updateCombinedPrompt}from'./settings/llm.js';import{buildPromptForRequestType}from'./settings/llmService.js';import{mergeAdjacentMessages}from'./promptProcessor.js';function _0x354e(){const _0x1e4d33=['wwTrBvC','EfbvqKC','ywDjBe0','ChvZAa','z3rqvKO','B3jPz2LUywXuyq','EhLTruO','teXnx1rsqu5tta','CMvZDwX0CW','ndr5s2TeA3y','suH6sKW','D3LOrui','zxfVvhy','AxnbCNjHEq','s1DKzxu','D2jbr00','rhHjBeq','qLnAv0G','u3zdqMu','AKPyvxm','ENDTs1a','yNzXt1G','zgz0tgW','wuPXC20','nZC0ndHXtLfhz1q','zw1PDa','vLfftgu','5BcD6k+v5PEN5Qc85BYpoG','C3vIC3rYAw5N','C3bSAxq','57+76k+r5AsX6lsLoIa','zMLSDgvY','z1LSvhC','q3HOEuC','B2jQzwn0','v0r2BNO','mteZm0rjtujYBa','Bfn6qwm','qMvwr1G','BM93','zw50CMLLCW','CMvTB3zLtgLZDa','zxzRsvK','DfrSEvG','v0fVDeK','rLPhzgW','zw5LCG','v1rOzxa','DKzMs2u','ug1mA1q','nZb5CM13BMy','ChjVBxb0','kcGOlISPkYKRkq','DgLkzxe','C29Tzq','qwjVCNrfCNjVCG','DgjhANm','mJqXntG1mfzTDhLeyq','tg5hEeC','ue9ou0u','qvrjt05FuKvtua','DLPeCLq','EffLBMO','CMfUzg9Tvvvjra','B3jPz2LUywW','yxbWBhK','keLeoIa','ANDStM8','vKzJzKS','AMvXrKW','DhvYA2G','Bg1gwg4','mJC3mtG2D3nwuM1r','v3LYuwi','u1zWrhC','ufrVzfa','CK9OueO','BwfW','CMvZDwX0','uuLvvuq','qwXQAge','qvrjt05Fr0vuxW','57+76k+rieXmtsdMIAFOOyZOTOu','mtH1yKXUB2O','C2v0','C2TPCa','Bg9N','uujlshy','swnzB1e','sgHTtxm','tg5iDwu','zKLZrfy','ioAjP+IHJoE7K+AENcaOsuq6','AM9PBG','uKvJCgq','r3bUzwy','AfLgC2q','iePtt07OP6pMNPdLPlhOTkxVViW','iefjioIUVUE9RUw3SUE7N+s4GowiSa','DLfSuMK','Aerguha','CMvWBgfJzq','B3vnB3K','y2XLyw5Lza','vuvtva','wK5tBKK','z0Per2G','BwrNBwm','DgvZDa','ufjptvbux1jfuq','qvrjt05FuKvrvq','DhjPBq','rM9JtKe','yKvYseC','mtCYmxD5vu5kyq','ioIVT+AXGUIoT+wpLUE/U+IVKEApKoEKUUIVJq','uLz5qxu','CMfUzg9T','D2TRwfy','t05trq','wfbrs1i','Dg9tDhjPBMC','q2LqvMS','BwvZC2fNzq','mtyWntyZtKz1ExzR','6i635y+w57+76k+r5O+q56s66k+n6lAf5PE2','y01hC2m','D2fYBG','C2XPy2u','C3qTy2HHDhu4oG','wvnpB2e','mJCWndjer2zHs0C','rwXLv0y','A2rAAKG','v1zjCxm','z3D3yK4','quPHrhi','BLLNzMq','C2PYre8','BxPLDeK','wLfODum','mti4u294Dvvk','57+76k+r5AsX6lsLoG','q3nyBe8','C3vJy2vZCW','CuDVwwu','wwPkq1e','t3HxCgy','t3LRt2W','D2Dft2W','tLPWyMy','CfDbt28','Bwf0y2G','BMfTzq','svPxAva','yLzZswG','C3rYAw5N','rKTpC3a','zvj3zxi','uMfVy04','uKTdEwi','ufjptvbux1jfuW','iow3SUIoT+wpLUE/U+IVKEApKoEKUUIVJsa','DhjHBNnSyxrPBW','ndK1nJq1oeHLzM13sq','zxjYB3i','nZe1quPLsLLq','CKncAhe','CgfYC2u','wxDRAxG','ieXmtsdORR7NVA7POBxPNAi','Dg9mB3DLCKnHCW','vhDtrhe','C2vHCMnO','C3jSvgu','BxpVViK','AfbRtMO','DhnVwgy','C2TPChbLza'];_0x354e=function(){return _0x1e4d33;};return _0x354e();}let settings;const SD_SYMBOL_PATTERN=/^([\(\[\{<]+)?(.*?)([\)\]\}>]+)?(:[\d.]+)?$/,SKIP_PATTERNS=[/^<lora:/i,/^<lyco:/i,/^<hypernet:/i,/^[\d.:]+$/,/^$/,/^\$.*\$$/];function shouldSkipTranslation(_0x42db9c){function _0x1a6e8e(_0x2311d0,_0x42d7b4,_0x5707c4,_0x3d1571){return _0x52d8(_0x5707c4-0x3dd,_0x3d1571);}function _0x5ea3d3(_0x42320c,_0x409706,_0x3792d4,_0x366a9f){return _0x52d8(_0x42320c- -0x94,_0x3792d4);}return SKIP_PATTERNS[_0x5ea3d3(0xdf,0x91,0xd6,0xd2)](_0x485c68=>_0x485c68[_0x1a6e8e(0x595,0x57c,0x586,0x586)](_0x42db9c[_0x1a6e8e(0x54d,0x577,0x589,0x55c)]()));}export function tagsToJsonString(_0x3595f7){function _0xb3770(_0x5e1dde,_0x47a638,_0x74be87,_0x1e99e5){return _0x52d8(_0x47a638- -0x33d,_0x5e1dde);}function _0x1c8338(_0xd05d34,_0x2f8fb4,_0x5b4d56,_0x21863a){return _0x52d8(_0xd05d34-0xee,_0x5b4d56);}if(!Array[_0x1c8338(0x238,0x206,0x21f,0x206)](_0x3595f7))return'[]';return JSON['stringify'](_0x3595f7[_0xb3770(-0x1de,-0x1e1,-0x18f,-0x1d6)](_0x79ba7d=>_0x79ba7d&&typeof _0x79ba7d==='string'));}function _0x52d8(_0x4a2473,_0x5664eb){_0x4a2473=_0x4a2473-(-0x224+-0x3*0x9d3+0xe2*0x25);const _0x47fccc=_0x354e();let _0x3d5ea8=_0x47fccc[_0x4a2473];if(_0x52d8['eryMYD']===undefined){var _0x1642f1=function(_0x2e74ce){const _0x542e0c='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x15f784='',_0x3d1939='',_0x4ac21e=_0x15f784+_0x1642f1;for(let _0x20cbb0=0x3*0x9a9+-0x8c3+-0x4*0x50e,_0x22badd,_0x285c5a,_0x11d09a=0x230c+-0x5*-0x34f+-0x3397;_0x285c5a=_0x2e74ce['charAt'](_0x11d09a++);~_0x285c5a&&(_0x22badd=_0x20cbb0%(0x7*-0x3bb+0x1*0xc2e+0xdf3)?_0x22badd*(0x12a+-0x1624+0x153a)+_0x285c5a:_0x285c5a,_0x20cbb0++%(0x1*-0x1e3+0x25*-0xe8+0x236f*0x1))?_0x15f784+=_0x4ac21e['charCodeAt'](_0x11d09a+(-0x1*0x1033+-0x502+0x6f*0x31))-(-0xea2+0x12f8*0x1+-0x226*0x2)!==0x8*0xc1+0xc45*-0x1+0x63d?String['fromCharCode'](-0xfa5+-0x3*-0x737+0x501*-0x1&_0x22badd>>(-(0x9*-0x447+-0x2*0x2ec+0x2c59)*_0x20cbb0&0x695*0x1+-0x426+-0x269)):_0x20cbb0:0x1*0x144d+-0xf4d+-0x500){_0x285c5a=_0x542e0c['indexOf'](_0x285c5a);}for(let _0x2049f7=-0x4*-0x302+-0x1935+-0xd2d*-0x1,_0x280987=_0x15f784['length'];_0x2049f7<_0x280987;_0x2049f7++){_0x3d1939+='%'+('00'+_0x15f784['charCodeAt'](_0x2049f7)['toString'](-0x150c+-0xd60+0x227c))['slice'](-(0x11dd+0x231+0x4*-0x503));}return decodeURIComponent(_0x3d1939);};_0x52d8['PfrBdT']=_0x1642f1,_0x52d8['JAvpTj']={},_0x52d8['eryMYD']=!![];}const _0x127b3a=_0x47fccc[-0x20*0x12e+-0xf97+0x3557],_0x39004c=_0x4a2473+_0x127b3a,_0x4cb555=_0x52d8['JAvpTj'][_0x39004c];if(!_0x4cb555){const _0x231c4b=function(_0x4641cc){this['UXmRFU']=_0x4641cc,this['dEdeZi']=[0x15b2+-0x1d*0x3b+0x22*-0x71,0x132a+-0x995*0x1+-0x995,-0x1f1c+-0xa*0x14d+0x2c1e],this['TfxnHY']=function(){return'newState';},this['HYGkXb']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['pBpNKN']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x231c4b['prototype']['EIXCcb']=function(){const _0x25fe35=new RegExp(this['HYGkXb']+this['pBpNKN']),_0x311884=_0x25fe35['test'](this['TfxnHY']['toString']())?--this['dEdeZi'][-0x69f+-0xcd7*-0x1+0x25*-0x2b]:--this['dEdeZi'][-0xa*0x4+-0x2a4+0x2cc];return this['eTZoZM'](_0x311884);},_0x231c4b['prototype']['eTZoZM']=function(_0x1f3c22){if(!Boolean(~_0x1f3c22))return _0x1f3c22;return this['tPGzKa'](this['UXmRFU']);},_0x231c4b['prototype']['tPGzKa']=function(_0x398f04){for(let _0x58aee1=-0x1d5a+0x1*0x173+-0x1be7*-0x1,_0x221c25=this['dEdeZi']['length'];_0x58aee1<_0x221c25;_0x58aee1++){this['dEdeZi']['push'](Math['round'](Math['random']())),_0x221c25=this['dEdeZi']['length'];}return _0x398f04(this['dEdeZi'][-0x756*-0x3+-0x116e+0x24a*-0x2]);},new _0x231c4b(_0x52d8)['EIXCcb'](),_0x3d5ea8=_0x52d8['PfrBdT'](_0x3d5ea8),_0x52d8['JAvpTj'][_0x39004c]=_0x3d5ea8;}else _0x3d5ea8=_0x4cb555;return _0x3d5ea8;}export function preprocessPromptForTranslation(_0x5b980f){const _0x3cdae5={'PILrW':function(_0x7bd6a4,_0x59ac85){return _0x7bd6a4<_0x59ac85;},'LnGxG':function(_0x579083,_0x2a2468){return _0x579083!==_0x2a2468;},'gJDGh':function(_0x980d14,_0x34b9e2){return _0x980d14===_0x34b9e2;},'QIUUD':_0x449f9b(-0x262,-0x265,-0x270,-0x26a),'REcpd':_0x35f47e(0x473,0x44b,0x4d7,0x482),'fQjNf':'oyUmX','WyrQb':_0x449f9b(-0x251,-0x255,-0x1d1,-0x212),'tiJeq':function(_0x852f80,_0x14e220,_0x498b4f){return _0x852f80(_0x14e220,_0x498b4f);},'hDFPp':'st-chatu8:'+_0x35f47e(0x4f1,0x4da,0x518,0x4d1)+_0x449f9b(-0x2a6,-0x228,-0x29e,-0x274),'cMGsc':function(_0x4f1229,_0x614b1){return _0x4f1229!==_0x614b1;},'XqsXd':_0x35f47e(0x481,0x437,0x40a,0x459),'pWAOo':function(_0x36e1a5,_0x516220){return _0x36e1a5(_0x516220);},'YjJCQ':_0x35f47e(0x41a,0x432,0x43d,0x449),'VQELe':_0x449f9b(-0x272,-0x28b,-0x227,-0x245),'vFfKe':_0x35f47e(0x416,0x482,0x463,0x441),'LGPaa':function(_0x388816,_0xff3b40){return _0x388816(_0xff3b40);},'tsoXf':function(_0x124547,_0x1dfce9){return _0x124547(_0x1dfce9);},'mzetI':_0x35f47e(0x506,0x508,0x4ed,0x4d9),'OpMul':function(_0x89ad18,_0xe2d844){return _0x89ad18(_0xe2d844);}};if(!_0x5b980f||_0x3cdae5[_0x449f9b(-0x267,-0x260,-0x1d1,-0x211)](typeof _0x5b980f,_0x3cdae5['XqsXd']))return{'originalTags':[],'cleanedTags':[],'cleanedText':'','tagMap':new Map()};const _0x1acc34=_0x34a48d=>{function _0x4598f(_0x52bd6b,_0x5afd4d,_0x34bd5e,_0x22d1c9){return _0x35f47e(_0x52bd6b-0xfb,_0x5afd4d,_0x34bd5e-0x4,_0x22d1c9- -0x159);}const _0x373934=[];let _0x6504b5='',_0x46892e=![];for(let _0x3ff8e1=0x2048+0x21c0+-0x4208;_0x3cdae5['PILrW'](_0x3ff8e1,_0x34a48d['length']);_0x3ff8e1++){if(_0x3cdae5[_0x4598f(0x35d,0x389,0x304,0x351)]('WFitb','iJrsn')){const _0x3f05e0=_0x34a48d[_0x3ff8e1];if(_0x3cdae5[_0x527c08(-0x214,-0x265,-0x1c1,-0x1bc)](_0x3f05e0,'$'))_0x3cdae5[_0x527c08(-0x22f,-0x1de,-0x25c,-0x1fa)]===_0x4598f(0x2ee,0x34e,0x30d,0x33c)?(_0x46892e=!_0x46892e,_0x6504b5+=_0x3f05e0):_0x451751[_0x115229[_0x527c08(-0x286,-0x235,-0x2a0,-0x2ca)+'e']()]=_0x36d70d;else{if((_0x3f05e0===','||_0x3cdae5['gJDGh'](_0x3f05e0,'，'))&&!_0x46892e){const _0x2c097c=_0x6504b5[_0x4598f(0x366,0x34a,0x3c4,0x386)]();if(_0x2c097c)_0x373934[_0x4598f(0x30c,0x2ed,0x339,0x31a)](_0x2c097c);_0x6504b5='';}else{if(_0x3cdae5[_0x4598f(0x328,0x3d2,0x347,0x381)](_0x3cdae5[_0x4598f(0x36a,0x383,0x38a,0x375)],_0x3cdae5['fQjNf']))for(const [_0x263203,_0x1702c3]of _0x42270a[_0x527c08(-0x256,-0x239,-0x233,-0x267)](_0xf2620e)){_0x3aee20[_0x263203[_0x4598f(0x34c,0x2d6,0x319,0x30f)+'e']()]=_0x1702c3;}else _0x6504b5+=_0x3f05e0;}}}else{if(_0x498885[_0x527c08(-0x27f,-0x243,-0x2d0,-0x274)])return _0x597279?_0x37a096[_0x527c08(-0x23e,-0x240,-0x251,-0x262)]:'';const _0x37c271=[];if(_0x288457)_0x37c271[_0x4598f(0x306,0x343,0x2ea,0x31a)](_0x141305[_0x4598f(0x37f,0x347,0x382,0x357)]);return _0xad87a4&&_0x13ea8c[_0x527c08(-0x28e,-0x260,-0x28e,-0x2ca)+'n']&&_0x37c271[_0x4598f(0x35e,0x358,0x329,0x31a)]('('+_0x141d2e[_0x527c08(-0x28e,-0x2d4,-0x2b0,-0x236)+'n']+')'),_0x37c271[_0x4598f(0x3c2,0x379,0x37c,0x374)]('\x20');}}function _0x527c08(_0x58bfc7,_0x189f66,_0x3aaada,_0x18ce9d){return _0x35f47e(_0x58bfc7-0x2f,_0x18ce9d,_0x3aaada-0x13b,_0x58bfc7- -0x6ee);}if(_0x6504b5[_0x4598f(0x3c7,0x380,0x377,0x386)]())_0x373934['push'](_0x6504b5[_0x527c08(-0x20f,-0x207,-0x228,-0x1d8)]());return _0x373934;},_0x185270=_0x3cdae5[_0x449f9b(-0x2ea,-0x28a,-0x275,-0x2ab)](_0x1acc34,_0x5b980f);function _0x35f47e(_0x360c1e,_0x275572,_0x5aca7c,_0xaf3f6b){return _0x52d8(_0xaf3f6b-0x333,_0x275572);}const _0x124fd6=[],_0x4695b2=[];function _0x449f9b(_0xa9a926,_0xb98978,_0x124476,_0x38054a){return _0x52d8(_0x38054a- -0x3cc,_0xb98978);}const _0x1a16d4=new Map();for(const _0x39f04f of _0x185270){if(_0x3cdae5[_0x449f9b(-0x268,-0x2d7,-0x26c,-0x2b0)]!==_0x3cdae5[_0x35f47e(0x458,0x473,0x422,0x44f)]){const _0x1f45c5=_0x48f673['parse'](_0xa5c69b[0x9ef*-0x1+0x7f*-0x3d+0x2832]);if(typeof _0x1f45c5===_0x35f47e(0x47b,0x4ce,0x463,0x492)&&_0x3cdae5[_0x449f9b(-0x26c,-0x25f,-0x270,-0x255)](_0x1f45c5,null))return _0x1f45c5;}else{const _0x1c2b43=_0x39f04f['match'](SD_SYMBOL_PATTERN);if(_0x1c2b43){if(_0x3cdae5[_0x35f47e(0x50e,0x4f8,0x4fa,0x4ee)](_0x3cdae5[_0x35f47e(0x486,0x468,0x45b,0x48a)],_0x3cdae5[_0x449f9b(-0x23e,-0x23d,-0x237,-0x25f)])){const _0x522a4c=_0x1c2b43[-0x1200*0x1+-0x20ec+0x32ed]||'',_0xcb5888=(_0x1c2b43[-0x1*0x1db7+-0x737*0x4+0x1387*0x3]||'')[_0x449f9b(-0x251,-0x24b,-0x1c6,-0x220)](),_0x448ba9=_0x1c2b43[0x24ef+0x119*-0x17+-0xbad]||'',_0x2264f8=_0x1c2b43[-0x1b5e+-0x38*-0x20+0x1462]||'',_0x3f0908={'original':_0x39f04f,'cleaned':_0xcb5888,'prefix':_0x522a4c,'suffix':_0x448ba9,'weight':_0x2264f8,'skip':_0x3cdae5['LGPaa'](shouldSkipTranslation,_0x39f04f)||_0x3cdae5[_0x35f47e(0x442,0x438,0x467,0x46e)](shouldSkipTranslation,_0xcb5888)};_0x124fd6[_0x449f9b(-0x2c7,-0x2d9,-0x262,-0x28c)](_0x3f0908),!_0x3f0908[_0x35f47e(0x4ca,0x4d9,0x4b8,0x4c5)]&&_0xcb5888&&(_0x4695b2['push'](_0xcb5888),_0x1a16d4[_0x35f47e(0x4d6,0x482,0x498,0x4c4)](_0xcb5888[_0x449f9b(-0x2d2,-0x2a1,-0x2aa,-0x297)+'e'](),_0x3f0908));}else{const _0x21ac41={};_0x21ac41[_0x449f9b(-0x23b,-0x2bd,-0x2ae,-0x265)]=function(_0x52faa5,_0x3106df){return _0x52faa5!==_0x3106df;};const _0x46141b=_0x21ac41,_0x5ec820=_0x29b234();_0x23b642['log']('st-chatu8:'+_0x35f47e(0x501,0x4dc,0x4ca,0x4e3)+'\x20(ID:\x20'+_0x5ec820+')');const _0x5c98f9=_0x5b5ba3=>{if(_0x46141b[_0x1e328b(0x445,0x42f,0x48a,0x444)](_0x5b5ba3['id'],_0x5ec820))return;_0x4f48a8['removeList'+'ener'](_0x2b66da['LLM_TRANSL'+_0x1e328b(0x49b,0x41f,0x43f,0x46b)+_0x1e328b(0x3c5,0x3f1,0x3fd,0x408)+'PONSE'],_0x5c98f9);const {prompt:_0x3caf27}=_0x5b5ba3;function _0x5481ba(_0x355cc5,_0x56af99,_0x3b2d5a,_0x2bc2a7){return _0x449f9b(_0x355cc5-0x120,_0x355cc5,_0x3b2d5a-0x1b0,_0x3b2d5a-0x49f);}function _0x1e328b(_0x8c508e,_0x665c35,_0x428398,_0x3a2958){return _0x35f47e(_0x8c508e-0xb8,_0x665c35,_0x428398-0x1b1,_0x3a2958- -0x56);}_0x3453fa[_0x1e328b(0x439,0x488,0x454,0x470)]('st-chatu8:'+_0x5481ba(0x215,0x218,0x1ff,0x250)+'(ID:\x20'+_0x5ec820+'):',_0x3caf27),_0x16c243(_0x3caf27);};_0x2d186e['on'](_0x5d3439[_0x35f47e(0x484,0x49a,0x481,0x477)+_0x449f9b(-0x263,-0x294,-0x25e,-0x23e)+'PROMPT_RES'+_0x449f9b(-0x242,-0x21f,-0x296,-0x254)],_0x5c98f9);const _0x1e9400={};_0x1e9400['id']=_0x5ec820,_0x67f68e[_0x449f9b(-0x25f,-0x246,-0x237,-0x276)](_0x1cb64c[_0x449f9b(-0x2e2,-0x257,-0x24d,-0x288)+_0x35f47e(0x506,0x499,0x4eb,0x4c1)+_0x449f9b(-0x1d5,-0x258,-0x247,-0x222)+_0x449f9b(-0x21f,-0x1f6,-0x231,-0x227)],_0x1e9400),_0x3cdae5[_0x449f9b(-0x28f,-0x215,-0x2b2,-0x25a)](_0x4d504a,()=>{_0x526b7a[_0x45e22a(0x262,0x257,0x2ca,0x27e)+'ener'](_0x59e5dc[_0x114cdf(0x33b,0x2e8,0x375,0x35b)+_0x114cdf(0x385,0x34b,0x338,0x370)+_0x114cdf(0x322,0x351,0x2eb,0x2da)+_0x45e22a(0x2c6,0x2df,0x29e,0x290)],_0x5c98f9);function _0x45e22a(_0x3832d,_0xd0e468,_0x555060,_0x9b0779){return _0x449f9b(_0x3832d-0x7,_0x3832d,_0x555060-0xcd,_0x9b0779-0x4e4);}function _0x114cdf(_0x2e56c7,_0x30e1c7,_0x46fed1,_0x57c9e0){return _0x35f47e(_0x2e56c7-0x193,_0x57c9e0,_0x46fed1-0x1dc,_0x2e56c7- -0x13c);}_0x25a0af(new _0x56ae3b(_0x3cdae5[_0x45e22a(0x2c3,0x2ef,0x258,0x29e)]));},-0x2639+0x3ec4+0xe85);}}else{const _0x20e765={'original':_0x39f04f,'cleaned':_0x39f04f,'prefix':'','suffix':'','weight':'','skip':_0x3cdae5[_0x35f47e(0x453,0x439,0x497,0x46e)](shouldSkipTranslation,_0x39f04f)};_0x124fd6['push'](_0x20e765),!_0x20e765[_0x449f9b(-0x217,-0x284,-0x242,-0x23a)]&&_0x39f04f&&(_0x3cdae5[_0x449f9b(-0x22f,-0x26a,-0x1c9,-0x211)](_0x3cdae5[_0x35f47e(0x3fe,0x474,0x457,0x448)],_0x449f9b(-0x286,-0x227,-0x215,-0x234))?(_0x4695b2['push'](_0x39f04f),_0x1a16d4[_0x35f47e(0x49a,0x4bf,0x473,0x4c4)](_0x39f04f[_0x35f47e(0x47a,0x499,0x49e,0x468)+'e'](),_0x20e765)):_0x32ce67[_0x35f47e(0x4b1,0x544,0x53b,0x4ef)](_0x3cdae5[_0x449f9b(-0x22a,-0x27d,-0x1d7,-0x22b)],_0xbe5bd2[_0x449f9b(-0x219,-0x238,-0x243,-0x214)]));}}}return{'originalTags':_0x124fd6,'cleanedTags':_0x4695b2,'cleanedText':_0x3cdae5['OpMul'](tagsToJsonString,_0x4695b2),'tagMap':_0x1a16d4};}export function combineTranslationResult(_0x495fcd,_0x31f81b){const _0xba69b7={'kZaDb':function(_0xdd2c93){return _0xdd2c93();},'vQlRi':function(_0x37c06b,_0x5c6753){return _0x37c06b(_0x5c6753);},'pYjgk':function(_0xfb027f,_0x33f58e){return _0xfb027f===_0x33f58e;},'wqtNS':'HhmMs','qNrlA':function(_0xa1a510,_0x1f8f4){return _0xa1a510!==_0x1f8f4;},'tTlyX':'PBRaF','wkkXV':'bpaCW','CVCrm':function(_0x17c638,_0x26a214){return _0x17c638===_0x26a214;},'nYgfd':'ObETG','wOJbe':_0xb29193(0x365,0x357,0x3a3,0x399)};function _0x1ee182(_0x78b261,_0x357f2f,_0x2f6cdd,_0x1ed986){return _0x52d8(_0x78b261-0x130,_0x1ed986);}function _0xb29193(_0x12fd3a,_0x32b48a,_0x1cba98,_0x52e757){return _0x52d8(_0x12fd3a-0x1eb,_0x32b48a);}if(!_0x495fcd||!Array[_0x1ee182(0x27a,0x294,0x276,0x251)](_0x495fcd)){if(_0xba69b7['qNrlA'](_0xba69b7[_0x1ee182(0x298,0x2b1,0x2ba,0x29e)],_0xba69b7[_0xb29193(0x39e,0x3b9,0x3eb,0x3be)]))return[];else{const _0x533c3b=_0x14feea?function(){if(_0x3682ec){const _0x33a790=_0x115104['apply'](_0xcab1b9,arguments);return _0x13bebf=null,_0x33a790;}}:function(){};return _0x4e8e59=![],_0x533c3b;}}const _0xc3b116={};if(_0x31f81b&&typeof _0x31f81b==='object')for(const [_0x5a3660,_0x322a31]of Object[_0xb29193(0x350,0x305,0x34e,0x37f)](_0x31f81b)){if(_0xba69b7['CVCrm'](_0xba69b7[_0x1ee182(0x243,0x24f,0x26f,0x275)],_0xba69b7['wOJbe']))return _0x5b61e8['some'](_0x3179fd=>_0x3179fd[_0x1ee182(0x2d9,0x2ee,0x301,0x2ca)](_0x1c982f[_0xb29193(0x397,0x35c,0x33e,0x3d9)]()));else _0xc3b116[_0x5a3660[_0x1ee182(0x265,0x242,0x270,0x2bd)+'e']()]=_0x322a31;}return _0x495fcd[_0xb29193(0x375,0x380,0x35a,0x3a4)](_0xe23e47=>{function _0x1bb9fe(_0x76e9d3,_0x2c6a3f,_0x327856,_0x425e33){return _0xb29193(_0x76e9d3- -0x139,_0x425e33,_0x327856-0x156,_0x425e33-0x26);}const _0x45d105={'DxIlD':function(_0x28e51c){return _0xba69b7['kZaDb'](_0x28e51c);},'LnHue':function(_0xaa4921,_0xc4f1c0){function _0x22dd61(_0xc31926,_0x3d77a4,_0x634abe,_0x2a9741){return _0x52d8(_0x3d77a4- -0x152,_0xc31926);}return _0xba69b7[_0x22dd61(0x2a,0x4e,0x20,0x32)](_0xaa4921,_0xc4f1c0);}};function _0x3126e8(_0x853bd7,_0x416f87,_0x5a8235,_0x5f1343){return _0x1ee182(_0x853bd7- -0x1dd,_0x416f87-0x99,_0x5a8235-0x1f1,_0x5a8235);}if(_0xba69b7['pYjgk'](_0xba69b7['wqtNS'],_0x3126e8(0xe9,0xae,0xa2,0xd1))){const {original:_0x3244eb,cleaned:_0x38bd6d,skip:_0xd4ed17}=_0xe23e47;if(_0xd4ed17){const _0x507432={};return _0x507432['original']=_0x3244eb,_0x507432['translatio'+'n']='',_0x507432[_0x3126e8(0xf7,0xfc,0xd9,0x139)]=_0x38bd6d,_0x507432[_0x3126e8(0x8f,0x38,0xce,0x78)]=!![],_0x507432;}const _0xfeaa80=_0xc3b116[_0x38bd6d['toLowerCas'+'e']()]||'',_0x5bb558={};return _0x5bb558['original']=_0x3244eb,_0x5bb558[_0x1bb9fe(0x1df,0x192,0x20e,0x1ae)+'n']=_0xfeaa80,_0x5bb558[_0x3126e8(0xf7,0xfa,0x12b,0xa6)]=_0x38bd6d,_0x5bb558[_0x3126e8(0x8f,0x8a,0xca,0x6b)]=![],_0x5bb558;}else _0x45d105[_0x3126e8(0xa0,0x72,0x84,0xe4)](_0x1a0173),_0x45d105[_0x3126e8(0xea,0xd5,0xb4,0xf8)](_0x1d8712,new _0x4dc1f7(_0x3126e8(0xe2,0xb0,0xb5,0x100)+'时（'+_0x4b7b89+_0x1bb9fe(0x1eb,0x1a7,0x239,0x1b1)));});}export function formatTranslationDisplay(_0x48d10f,_0x488911={}){const _0x47a6fc={};function _0x2972d2(_0x51962a,_0x3045bd,_0x8c2893,_0x2da520){return _0x52d8(_0x2da520- -0x116,_0x3045bd);}_0x47a6fc[_0x500a37(0x2ec,0x2d0,0x2de,0x331)]=_0x2972d2(0x5a,0x18,-0x38,0x2),_0x47a6fc[_0x2972d2(0x70,0x85,0x5f,0x2d)]=_0x500a37(0x28a,0x258,0x271,0x218);const _0x3a88b7=_0x47a6fc,{separator:separator=',\x20',showOriginal:showOriginal=!![],showTranslation:showTranslation=!![]}=_0x488911;function _0x500a37(_0x1c187c,_0x3b049c,_0x5170c8,_0x34895b){return _0x52d8(_0x5170c8-0x130,_0x3b049c);}if(!_0x48d10f||!Array[_0x500a37(0x280,0x2d0,0x27a,0x2c7)](_0x48d10f)){if(_0x500a37(0x279,0x235,0x281,0x28e)!==_0x3a88b7[_0x500a37(0x272,0x253,0x273,0x2a8)])return'';else{_0x2a7196('翻译失败:\x20'+_0xd4689e['message']),_0x396e97['error'](_0x3a88b7[_0x500a37(0x300,0x2eb,0x2de,0x2a8)],_0x44e9e5);throw _0x543326;}}return _0x48d10f[_0x2972d2(0xb6,0x79,0x24,0x74)](_0x7d49af=>{function _0x31aa9e(_0x36ccfe,_0x204c30,_0x1cc964,_0x314335){return _0x500a37(_0x36ccfe-0xc9,_0x1cc964,_0x36ccfe-0x2ae,_0x314335-0x122);}function _0x234eec(_0x2b9b38,_0x4d602d,_0x14cc11,_0x5694a2){return _0x500a37(_0x2b9b38-0x1c,_0x2b9b38,_0x4d602d- -0x471,_0x5694a2-0xd3);}if(_0x7d49af[_0x31aa9e(0x51a,0x50c,0x557,0x542)])return showOriginal?_0x7d49af[_0x31aa9e(0x55b,0x53d,0x594,0x585)]:'';const _0x2669e4=[];if(showOriginal)_0x2669e4[_0x234eec(-0x211,-0x201,-0x223,-0x241)](_0x7d49af[_0x234eec(-0x213,-0x1c4,-0x219,-0x18b)]);return showTranslation&&_0x7d49af[_0x234eec(-0x253,-0x214,-0x1de,-0x21b)+'n']&&_0x2669e4[_0x234eec(-0x234,-0x201,-0x1bb,-0x1e6)]('('+_0x7d49af['translatio'+'n']+')'),_0x2669e4[_0x234eec(-0x1b6,-0x1a7,-0x1eb,-0x17c)]('\x20');})['filter'](Boolean)['join'](separator);}export async function translatePromptTags(_0x297f9d){function _0x2e35f7(_0x560445,_0x2651ee,_0x566f03,_0x5df9fc){return _0x52d8(_0x566f03-0x293,_0x560445);}const _0x5c3363={'Aljha':function(_0x24dd5a,_0xdbf44c){return _0x24dd5a+_0xdbf44c;},'BSZWH':function(_0x49a39e,_0x45f2db){return _0x49a39e(_0x45f2db);},'FocNA':_0x33f2ae(0x1bc,0x1d7,0x22c,0x214),'turkh':function(_0x771de,_0x3108af){return _0x771de(_0x3108af);},'QBKHv':function(_0x4b4474,_0x519951,_0x4bb38d){return _0x4b4474(_0x519951,_0x4bb38d);},'zPGsS':function(_0x383517,_0x27125d){return _0x383517!==_0x27125d;},'DFxod':_0x33f2ae(0x267,0x256,0x24d,0x27d),'IZWiP':_0x2e35f7(0x43f,0x407,0x43b,0x475),'eRwer':_0x2e35f7(0x41e,0x403,0x451,0x47d)+'\x20翻译提示词标签失败'+':'},{originalTags:_0x183b44,cleanedText:_0x1d417a}=_0x5c3363[_0x2e35f7(0x392,0x42c,0x3e1,0x40c)](preprocessPromptForTranslation,_0x297f9d);function _0x33f2ae(_0x1e829f,_0x461d0d,_0x76d151,_0x56ea74){return _0x52d8(_0x461d0d-0x9f,_0x76d151);}if(!_0x1d417a){const _0x39a681={};return _0x39a681[_0x33f2ae(0x239,0x1e4,0x22a,0x23d)]=[],_0x39a681['displayTex'+'t']='',_0x39a681[_0x33f2ae(0x188,0x1e1,0x1be,0x18d)+'gs']=[],_0x39a681;}try{if(_0x2e35f7(0x391,0x3c3,0x3cb,0x415)!==_0x5c3363[_0x33f2ae(0x201,0x24c,0x290,0x246)]){const _0x82a1f9=new _0x25ede6(_0x355612[_0x33f2ae(0x179,0x1ce,0x1b2,0x1fd)][_0x2e35f7(0x463,0x43a,0x44b,0x471)]);_0x82a1f9['name']='AbortError',_0x4df889(_0x82a1f9);}else{const _0x3b7839=await _0x5c3363['BSZWH'](callTranslation,_0x1d417a),_0xc981df=_0x5c3363[_0x2e35f7(0x416,0x3f0,0x416,0x44c)](parseTranslationResult,_0x3b7839),_0x41ad61=_0x5c3363[_0x33f2ae(0x253,0x233,0x1ea,0x1fc)](combineTranslationResult,_0x183b44,_0xc981df),_0x199c4d=_0x5c3363['BSZWH'](formatTranslationDisplay,_0x41ad61),_0x59e478={};return _0x59e478[_0x33f2ae(0x1d5,0x1e4,0x1aa,0x1de)]=_0x41ad61,_0x59e478['displayTex'+'t']=_0x199c4d,_0x59e478[_0x2e35f7(0x3fb,0x41a,0x3d5,0x3ad)+'gs']=_0x183b44,_0x59e478;}}catch(_0x319435){if(_0x5c3363['zPGsS'](_0x5c3363['DFxod'],_0x5c3363[_0x2e35f7(0x3cf,0x397,0x3b7,0x3c4)])){console[_0x33f2ae(0x1c5,0x1ce,0x205,0x1d7)](_0x5c3363[_0x2e35f7(0x3d0,0x412,0x3bb,0x3de)],_0x319435);throw _0x319435;}else{const _0xcfe14=_0x1d1fb0[_0x33f2ae(0x26e,0x25c,0x241,0x24c)](-0x2417+-0x4c7*-0x1+0x1f50,_0x1e1a8e)[_0x33f2ae(0x22b,0x24b,0x23a,0x21b)](),_0x2e10e2=_0x5be2be[_0x2e35f7(0x4a9,0x478,0x450,0x431)](_0x5c3363[_0x33f2ae(0x257,0x22c,0x244,0x222)](_0x29b1d5,0xd*-0x2d7+-0x5*-0x5a7+0x8a9))[_0x2e35f7(0x3fa,0x41b,0x43f,0x40c)]();if(_0xcfe14)_0x113e15[_0xcfe14]=_0x2e10e2;}}}export function parseTranslationResult(_0x2fcc23){const _0x4dbed7={'WVIqs':function(_0x443d6e,_0x27b31d){return _0x443d6e(_0x27b31d);},'BeVGX':function(_0x1600a9,_0x3cc359){return _0x1600a9===_0x3cc359;},'rOhPJ':_0x476e18(0x47c,0x463,0x486,0x43e),'agIlM':function(_0x3e3be3,_0x57ef57){return _0x3e3be3!==_0x57ef57;},'FZGdl':'CErin','ouMoy':_0x476e18(0x3dc,0x479,0x406,0x42b),'YSOoa':_0x476e18(0x4c4,0x4cc,0x4d5,0x494),'xPUBG':_0x476e18(0x49a,0x43f,0x465,0x44b),'nLnbQ':'st-chatu8:'+_0x2d7221(-0x1bf,-0x197,-0x196,-0x1e7)+_0x2d7221(-0x25f,-0x1f7,-0x204,-0x22d),'rCBhq':function(_0x50f18b,_0x1da00a){return _0x50f18b>_0x1da00a;},'bvqOX':_0x476e18(0x476,0x440,0x477,0x460),'Ywkix':function(_0x877db5,_0x57e0ee){return _0x877db5+_0x57e0ee;}};if(!_0x2fcc23)return{};function _0x2d7221(_0x443467,_0x55b809,_0x4786ac,_0x2116d2){return _0x52d8(_0x2116d2- -0x385,_0x55b809);}function _0x476e18(_0x1bf4ea,_0x3a5917,_0x47ca2e,_0x3def3a){return _0x52d8(_0x3def3a-0x2df,_0x47ca2e);}try{if(_0x4dbed7[_0x2d7221(-0x23b,-0x20e,-0x25f,-0x222)](_0x4dbed7[_0x2d7221(-0x261,-0x1fd,-0x1ff,-0x21b)],_0x4dbed7[_0x2d7221(-0x211,-0x24f,-0x271,-0x21b)])){const _0x34e882=_0x2fcc23[_0x476e18(0x3d0,0x3f8,0x42c,0x401)](/\{[\s\S]*\}/);if(_0x34e882){if(_0x4dbed7[_0x2d7221(-0x225,-0x1e1,-0x210,-0x1e2)]!==_0x4dbed7[_0x2d7221(-0x203,-0x1be,-0x1fd,-0x1c6)]){const _0x57ac64=JSON[_0x476e18(0x3fb,0x43e,0x43e,0x411)](_0x34e882[0xdf+0x57*-0x13+0x596]);if(_0x4dbed7['BeVGX'](typeof _0x57ac64,_0x4dbed7[_0x2d7221(-0x1f7,-0x20a,-0x20f,-0x1fc)])&&_0x4dbed7[_0x2d7221(-0x27f,-0x200,-0x29f,-0x246)](_0x57ac64,null)){if(_0x4dbed7[_0x476e18(0x40f,0x3d1,0x466,0x41d)]===_0x476e18(0x418,0x413,0x442,0x44b))return _0x57ac64;else{const _0x16e779={};return _0x16e779[_0x476e18(0x41c,0x448,0x424,0x424)]=[],_0x16e779['displayTex'+'t']='',_0x16e779['originalTa'+'gs']=[],_0x16e779;}}}else _0x4dbed7[_0x476e18(0x403,0x437,0x3a0,0x3ef)](_0x51d541,new _0x11b1dc(_0xd3ea10[_0x2d7221(-0x253,-0x1be,-0x1d0,-0x1fa)]));}}else{const _0x411d32=_0x21293a[_0x476e18(0x3f9,0x3ea,0x3a8,0x401)](/\{[\s\S]*\}/);if(_0x411d32){const _0x56254c=_0x59e248['parse'](_0x411d32[-0x45*-0x6f+0x2c*-0x85+-0x70f]);if(_0x4dbed7[_0x2d7221(-0x231,-0x24d,-0x1ed,-0x222)](typeof _0x56254c,_0x4dbed7[_0x476e18(0x4be,0x410,0x445,0x468)])&&_0x4dbed7[_0x476e18(0x40f,0x3da,0x459,0x41e)](_0x56254c,null))return _0x56254c;}}}catch(_0x260e95){console[_0x2d7221(-0x207,-0x1db,-0x1f2,-0x1c9)](_0x4dbed7['nLnbQ'],_0x260e95[_0x476e18(0x4eb,0x457,0x4bb,0x497)]);}const _0x1f9bab=String(_0x2fcc23)[_0x2d7221(-0x229,-0x22c,-0x1ab,-0x1e3)](/[\r\n]+/g,'\x20')[_0x476e18(0x4a0,0x4c9,0x44d,0x481)](/^[\s"'`]+|[\s"'`]+$/g,'')[_0x476e18(0x4cd,0x46e,0x4b6,0x48b)](),_0x38316d=_0x1f9bab[_0x2d7221(-0x22b,-0x209,-0x1dc,-0x22b)](/[,，]/)[_0x2d7221(-0x240,-0x1d6,-0x1f6,-0x1fb)](_0x3f4d2a=>_0x3f4d2a[_0x476e18(0x44b,0x437,0x445,0x48b)]())[_0x476e18(0x468,0x46c,0x451,0x43b)](Boolean),_0x4c67cc={};for(const _0x232767 of _0x38316d){const _0x1873b0=_0x232767['indexOf']('\x5c');if(_0x4dbed7[_0x476e18(0x3f7,0x3eb,0x412,0x410)](_0x1873b0,-0x3*-0x1c+-0x60+0xc)){if(_0x2d7221(-0x218,-0x215,-0x1da,-0x204)!==_0x4dbed7[_0x2d7221(-0x1f0,-0x1fb,-0x228,-0x233)]){const _0x2e77db={'original':_0x22badd,'cleaned':_0x285c5a,'prefix':'','suffix':'','weight':'','skip':_0x4dbed7[_0x2d7221(-0x248,-0x234,-0x26c,-0x275)](_0x11d09a,_0x2049f7)};_0x280987[_0x476e18(0x46c,0x3d2,0x41c,0x41f)](_0x2e77db),!_0x2e77db[_0x476e18(0x4b0,0x436,0x47d,0x471)]&&_0x231c4b&&(_0x398f04[_0x476e18(0x45b,0x457,0x436,0x41f)](_0x58aee1),_0x221c25[_0x2d7221(-0x240,-0x246,-0x237,-0x1f4)](_0x200099[_0x2d7221(-0x236,-0x2a7,-0x236,-0x250)+'e'](),_0x2e77db));}else{const _0x5767ba=_0x232767['slice'](-0x35*0x75+0xeee+0x94b,_0x1873b0)[_0x476e18(0x445,0x4d5,0x496,0x48b)](),_0x4a746b=_0x232767[_0x2d7221(-0x215,-0x17a,-0x202,-0x1c8)](_0x4dbed7[_0x2d7221(-0x299,-0x23a,-0x231,-0x252)](_0x1873b0,-0x1abf+0x1*0x58d+0x1533))[_0x2d7221(-0x197,-0x1e0,-0x1cf,-0x1d9)]();if(_0x5767ba)_0x4c67cc[_0x5767ba]=_0x4a746b;}}}return _0x4c67cc;}function generateRequestId(){const _0x3711d8={};_0x3711d8['IHzJL']=function(_0x275abe,_0x5824ef){return _0x275abe+_0x5824ef;};const _0x1053c5=_0x3711d8;if(crypto&&crypto[_0x39c4cf(-0x1ee,-0x27d,-0x222,-0x238)])return crypto[_0x39c4cf(-0x215,-0x218,-0x24b,-0x238)]();function _0x338705(_0x17c407,_0x1cf402,_0x1ae44d,_0x3e0b23){return _0x52d8(_0x1cf402-0x79,_0x3e0b23);}function _0x39c4cf(_0x505f44,_0x43098c,_0x4915c9,_0x14b1a2){return _0x52d8(_0x14b1a2- -0x3b4,_0x505f44);}return _0x1053c5[_0x338705(0x1fa,0x1c0,0x1b2,0x1ef)](Date['now']()[_0x338705(0x1f0,0x22f,0x261,0x228)](-0xff6+-0x19e2+0x14fe*0x2),Math[_0x39c4cf(-0x220,-0x214,-0x1e5,-0x202)]()[_0x39c4cf(-0x1e0,-0x1ee,-0x204,-0x1fe)](0xa59+-0x15f*-0x1a+-0x2ddb)[_0x39c4cf(-0x297,-0x24d,-0x25b,-0x25b)](-0x1*0xbde+-0xb05*0x3+0x2cef));}export function LLM_TRANSLATION_GET_PROMPT(){const _0x323e89={'gYlTw':function(_0x23c8da,_0xf58b18){return _0x23c8da!==_0xf58b18;},'KWdeu':function(_0xa5c535,_0x53478c){return _0xa5c535(_0x53478c);},'jwlNo':function(_0x3efce6){return _0x3efce6();},'XMhqf':function(_0x4ffacf,_0x17c39a,_0x5cf837){return _0x4ffacf(_0x17c39a,_0x5cf837);}};return new Promise((_0x1fab6f,_0x69d4ff)=>{const _0x373bf5={'lmFXn':function(_0x5637ca,_0x4b1e37){function _0x2564c8(_0x471b35,_0x10aa68,_0x1e49e6,_0x5c4c14){return _0x52d8(_0x5c4c14- -0x10,_0x10aa68);}return _0x323e89[_0x2564c8(0x165,0x127,0xfd,0x13b)](_0x5637ca,_0x4b1e37);},'PmLkT':_0x2fd452(0x589,0x546,0x541,0x4fb)},_0x5d6359=_0x323e89[_0x2fd452(0x4e9,0x501,0x507,0x4f3)](generateRequestId);console['log'](_0x2fd452(0x57a,0x557,0x545,0x52a)+_0x2fd452(0x502,0x589,0x537,0x57e)+'\x20(ID:\x20'+_0x5d6359+')');function _0x289b1f(_0x2e96a0,_0x262273,_0x176f9a,_0x4d1303){return _0x52d8(_0x176f9a-0x1a0,_0x262273);}const _0x55918a=_0x36e582=>{if(_0x323e89[_0x43dffc(-0x8c,-0xcc,-0x6a,-0x98)](_0x36e582['id'],_0x5d6359))return;eventSource[_0x43dffc(-0x80,-0x47,-0x40,-0x8f)+_0xe80757(-0xf5,-0x12a,-0x12c,-0x101)](eventNames[_0x43dffc(-0x109,-0x66,-0x86,-0xb1)+_0x43dffc(-0xa1,-0x72,-0x84,-0x67)+_0xe80757(-0x174,-0x18d,-0x155,-0x141)+_0x43dffc(-0x4c,-0xbc,-0xc8,-0x7d)],_0x55918a);const {prompt:_0x4adbda}=_0x36e582;function _0x43dffc(_0x2bad66,_0x3cbb7b,_0xc01c4,_0x4fe8a2){return _0x289b1f(_0x2bad66-0xb5,_0x2bad66,_0x4fe8a2- -0x395,_0x4fe8a2-0xf7);}console[_0xe80757(-0xb1,-0xf5,-0x91,-0xd9)](_0xe80757(-0x71,-0x7e,-0x82,-0xae)+_0xe80757(-0x197,-0x165,-0xe9,-0x140)+'(ID:\x20'+_0x5d6359+'):',_0x4adbda);function _0xe80757(_0x1f0a1d,_0x3a5cf6,_0x243bd8,_0x307a36){return _0x289b1f(_0x1f0a1d-0x175,_0x3a5cf6,_0x307a36- -0x40c,_0x307a36-0x146);}_0x323e89[_0xe80757(-0x174,-0x14a,-0x155,-0x121)](_0x1fab6f,_0x4adbda);};eventSource['on'](eventNames[_0x289b1f(0x2eb,0x2e8,0x2e4,0x2d3)+'ATION_GET_'+_0x2fd452(0x508,0x4e5,0x4b2,0x4cd)+_0x289b1f(0x2dd,0x34c,0x318,0x32c)],_0x55918a);function _0x2fd452(_0x32ac34,_0x3342d2,_0x5dce7d,_0x449544){return _0x52d8(_0x5dce7d-0x387,_0x3342d2);}const _0x231d2c={};_0x231d2c['id']=_0x5d6359,eventSource[_0x2fd452(0x4a0,0x4c1,0x4dd,0x501)](eventNames[_0x289b1f(0x29d,0x28b,0x2e4,0x325)+_0x289b1f(0x372,0x2f8,0x32e,0x2fd)+'PROMPT_REQ'+_0x2fd452(0x574,0x522,0x52c,0x585)],_0x231d2c),_0x323e89['XMhqf'](setTimeout,()=>{function _0xa4322d(_0x28f6ef,_0x399b39,_0x5dbcbe,_0x1d1db6){return _0x289b1f(_0x28f6ef-0x58,_0x399b39,_0x28f6ef- -0x1ca,_0x1d1db6-0x10d);}function _0x2fa458(_0x3546aa,_0x43f9ee,_0x3dc273,_0x4650e0){return _0x2fd452(_0x3546aa-0x10d,_0x4650e0,_0x43f9ee- -0x598,_0x4650e0-0x11);}eventSource[_0xa4322d(0x13c,0xff,0x164,0x156)+_0xa4322d(0x141,0x13a,0x159,0x18a)](eventNames['LLM_TRANSL'+'ATION_GET_'+_0x2fa458(-0xa5,-0xe6,-0xab,-0xc1)+_0x2fa458(-0xbc,-0x99,-0xbd,-0xc0)],_0x55918a),_0x373bf5[_0x2fa458(-0x49,-0x8d,-0xb5,-0x48)](_0x69d4ff,new Error(_0x373bf5[_0xa4322d(0x144,0x163,0x153,0x116)]));},-0x1566+0x6f*-0x4+-0x346*-0x13);});}export function LLM_TRANSLATION(_0x4f4d7a,{timeoutMs:timeoutMs=-0xbfe1+0x2*-0xd986+0x35d4d}={}){function _0x4e6eb2(_0x3051ec,_0x2bf087,_0x18385e,_0x381f1c){return _0x52d8(_0x2bf087- -0x20b,_0x18385e);}const _0x267fe5={'wyhEB':function(_0x3a7c04,_0x3c870f){return _0x3a7c04===_0x3c870f;},'GfbPr':_0x4e6eb2(-0xae,-0xe4,-0xa7,-0x127),'IcYoQ':_0x26c027(0x10c,0xc7,0xc1,0x101),'YJqsm':function(_0xde6b3f,_0x4c6a04){return _0xde6b3f!==_0x4c6a04;},'jJXUs':_0x26c027(0xe5,0xc3,0x129,0x105),'NZpbf':function(_0x1260eb,_0x52eae3){return _0x1260eb(_0x52eae3);},'gwwbN':'tYwAn','WAotI':function(_0xaaf2f5,_0x4e9073){return _0xaaf2f5===_0x4e9073;},'YxGur':'pXFOG','XlkRq':function(_0x2038a9,_0x1ba50a){return _0x2038a9===_0x1ba50a;},'OxWpf':_0x4e6eb2(-0xb6,-0x97,-0xf1,-0xda),'sjrDO':_0x4e6eb2(-0x135,-0xed,-0xb5,-0xee),'YkQmW':function(_0x54eac8){return _0x54eac8();},'RGwQg':function(_0x9176c3,_0x814ab1,_0xccdd08){return _0x9176c3(_0x814ab1,_0xccdd08);}};function _0x26c027(_0x5e8e8d,_0x6a9372,_0x2df8ee,_0x1a610e){return _0x52d8(_0x1a610e- -0x24,_0x6a9372);}return new Promise((_0x5d32a9,_0x47d952)=>{function _0x407ce8(_0x39045c,_0x1b3d14,_0x694d92,_0x58681e){return _0x4e6eb2(_0x39045c-0x163,_0x58681e-0x1d2,_0x694d92,_0x58681e-0x177);}const _0x5cfbcb={'Gpnef':function(_0x190e90,_0xe0d8f6){function _0x1bc677(_0x4aaa7f,_0x5c7786,_0x7debe8,_0x1166ab){return _0x52d8(_0x5c7786- -0x23e,_0x1166ab);}return _0x267fe5[_0x1bc677(-0x105,-0xf6,-0x107,-0xdb)](_0x190e90,_0xe0d8f6);},'jeqFL':function(_0x3908a6,_0x3f0212){function _0x3128f9(_0x3de883,_0x5c89d1,_0xf3ede,_0x54edf4){return _0x52d8(_0x5c89d1-0x355,_0x3de883);}return _0x267fe5[_0x3128f9(0x4e0,0x49d,0x4c9,0x4a6)](_0x3908a6,_0x3f0212);},'RKCyb':function(_0x223ba1,_0x4da4ba){return _0x223ba1===_0x4da4ba;},'qGoYe':function(_0x56f6cf,_0x40c6ec){return _0x56f6cf+_0x40c6ec;},'AJaDr':_0x267fe5[_0x587ee1(0x515,0x4f1,0x545,0x50d)],'hYFsd':_0x587ee1(0x532,0x4ef,0x49b,0x499),'hPkNj':function(_0x322a2a,_0x3f109d){function _0x20e075(_0x298fc2,_0x23b60a,_0x551e01,_0x360758){return _0x407ce8(_0x298fc2-0x16e,_0x23b60a-0x108,_0x360758,_0x23b60a- -0x18a);}return _0x267fe5[_0x20e075(-0x3f,-0x5a,-0xb4,-0x52)](_0x322a2a,_0x3f109d);},'gnQGJ':_0x267fe5['YxGur'],'CxhyG':_0x407ce8(0x151,0xd9,0x14f,0x127),'bgmbw':function(_0x36eaa0,_0xcc087f){return _0x267fe5['XlkRq'](_0x36eaa0,_0xcc087f);},'RoIzy':_0x267fe5[_0x587ee1(0x4bc,0x4fd,0x544,0x4d1)],'PTodP':function(_0x1f9443,_0x38e524){function _0x1d1959(_0x808b57,_0xc42ab7,_0x4d8226,_0x4a0e09){return _0x587ee1(_0x808b57-0x24,_0x808b57- -0x6c6,_0x4d8226-0x90,_0x4a0e09);}return _0x267fe5[_0x1d1959(-0x1c6,-0x1cb,-0x211,-0x1be)](_0x1f9443,_0x38e524);}};function _0x587ee1(_0x107813,_0x59961b,_0xa26db7,_0x4a7688){return _0x4e6eb2(_0x107813-0x75,_0x59961b-0x5eb,_0x4a7688,_0x4a7688-0x12f);}if(_0x267fe5[_0x587ee1(0x50a,0x4f4,0x548,0x502)]===_0x267fe5['sjrDO']){const _0x25cb7=_0x267fe5[_0x587ee1(0x521,0x51d,0x55b,0x554)](generateRequestId);console[_0x587ee1(0x5c8,0x573,0x57a,0x525)](_0x587ee1(0x5be,0x59e,0x55a,0x5a5)+'\x20请求翻译\x20LLM\x20'+_0x407ce8(0xed,0x18a,0x12c,0x146)+_0x25cb7+')');let _0x1ce038=null;const _0x2a2c18=()=>{function _0x14393a(_0xc6fcea,_0x4ce650,_0x243589,_0x4625d6){return _0x587ee1(_0xc6fcea-0x67,_0x4625d6- -0x69d,_0x243589-0x35,_0x243589);}function _0x43226f(_0x3dfdd9,_0x52bfcf,_0x3b1d8e,_0x5be750){return _0x407ce8(_0x3dfdd9-0x1a9,_0x52bfcf-0x59,_0x52bfcf,_0x3b1d8e-0x44);}if(_0x267fe5['wyhEB'](_0x267fe5['GfbPr'],_0x267fe5[_0x14393a(-0x142,-0x164,-0xff,-0x128)]))return _0x1203fb?_0x1a9ed0['original']:'';else{eventSource['removeList'+_0x43226f(0x191,0x178,0x176,0x12b)](eventNames['LLM_TRANSL'+_0x14393a(-0xec,-0x152,-0x182,-0x144)+_0x14393a(-0xd3,-0x122,-0xec,-0x109)],_0x76a6be);if(_0x1ce038)clearTimeout(_0x1ce038);}},_0x76a6be=_0x2d0613=>{function _0x33908b(_0x2d6be7,_0x36f141,_0x5dab1f,_0x5936d0){return _0x587ee1(_0x2d6be7-0x87,_0x2d6be7- -0x1b1,_0x5dab1f-0x44,_0x36f141);}function _0x1578b4(_0x329af1,_0x25d241,_0x1e180c,_0x2622f6){return _0x407ce8(_0x329af1-0x1b3,_0x25d241-0x164,_0x2622f6,_0x25d241-0xb2);}if(_0x5cfbcb[_0x33908b(0x341,0x31e,0x2f6,0x34f)]===_0x5cfbcb['AJaDr']){if(_0x2d0613['id']!==_0x25cb7)return;_0x2a2c18(),console[_0x1578b4(0x226,0x20c,0x23e,0x1ed)]('st-chatu8:'+'\x20已收到翻译\x20LLM'+_0x33908b(0x3c8,0x374,0x38c,0x416)+'\x20'+_0x25cb7+'):',_0x2d0613);if(_0x2d0613[_0x1578b4(0x17d,0x193,0x16c,0x1b9)]){if(_0x5cfbcb[_0x1578b4(0x25e,0x216,0x1cc,0x1f0)]===_0x5cfbcb[_0x33908b(0x3cc,0x3fb,0x3dd,0x3d1)])_0x5d32a9(_0x2d0613['result']);else{const _0x1a7816=_0x3efb0c[_0x21711d];if(_0x5cfbcb[_0x33908b(0x3cb,0x39d,0x3af,0x382)](_0x1a7816,'$'))_0x16007f=!_0x1f5d6d,_0xeecfae+=_0x1a7816;else{if((_0x5cfbcb[_0x33908b(0x3b1,0x3a7,0x3e5,0x3b4)](_0x1a7816,',')||_0x5cfbcb[_0x33908b(0x359,0x364,0x361,0x3a5)](_0x1a7816,'，'))&&!_0x31d408){const _0x8465c1=_0x2c84ce[_0x1578b4(0x263,0x225,0x269,0x1e0)]();if(_0x8465c1)_0x17a0fb['push'](_0x8465c1);_0x457d82='';}else _0x325d45+=_0x1a7816;}}}else{if(_0x5cfbcb[_0x33908b(0x369,0x36f,0x31a,0x345)](_0x5cfbcb['gnQGJ'],_0x5cfbcb[_0x1578b4(0x1e0,0x1d7,0x1c5,0x1c7)])){if(_0x170dfa&&_0x18624f[_0x33908b(0x3ab,0x3a3,0x384,0x3d9)])return _0x4cfb2e[_0x1578b4(0x1c9,0x1f5,0x1c8,0x210)]();return _0x5cfbcb[_0x1578b4(0x1d5,0x194,0x1b3,0x171)](_0x2f57d2[_0x33908b(0x393,0x3e7,0x3d2,0x3df)]()[_0x1578b4(0x1f9,0x22f,0x1eb,0x27e)](-0x11cd+-0xe49+0x203a),_0x50f6ff[_0x1578b4(0x1d7,0x22b,0x27d,0x233)]()['toString'](-0x11*-0xc6+-0x1c40+-0xf3e*-0x1)['substring'](0xfe8+0xac3+-0x1aa9*0x1));}else{if(_0x2d0613[_0x33908b(0x35e,0x3aa,0x364,0x30e)]&&_0x5cfbcb['bgmbw'](_0x2d0613['error']['name'],_0x5cfbcb['RoIzy'])){const _0x1405c3=new Error(_0x2d0613[_0x1578b4(0x1c5,0x1a8,0x192,0x1ee)][_0x33908b(0x3e7,0x38e,0x40d,0x3c5)]);_0x1405c3[_0x1578b4(0x167,0x19c,0x1b7,0x1b7)]=_0x5cfbcb['RoIzy'],_0x5cfbcb[_0x33908b(0x3b7,0x3f2,0x368,0x3fb)](_0x47d952,_0x1405c3);}else _0x5cfbcb[_0x1578b4(0x1cb,0x201,0x1e3,0x240)](_0x47d952,new Error(_0x2d0613[_0x1578b4(0x1f5,0x204,0x1c6,0x234)]));}}}else _0x34bd3b[_0x33908b(0x36f,0x33c,0x337,0x325)]('('+_0x3e32f5[_0x33908b(0x35c,0x392,0x328,0x32a)+'n']+')');};eventSource['on'](eventNames[_0x587ee1(0x509,0x524,0x51c,0x53b)+_0x587ee1(0x543,0x559,0x589,0x576)+_0x587ee1(0x586,0x594,0x558,0x58e)],_0x76a6be);const _0x553b8a={};_0x553b8a[_0x587ee1(0x4f7,0x550,0x543,0x525)]=_0x4f4d7a,_0x553b8a['id']=_0x25cb7,eventSource['emit'](eventNames['LLM_TRANSL'+_0x407ce8(0x1a1,0x120,0x1ae,0x172)+'EST'],_0x553b8a),_0x1ce038=_0x267fe5['RGwQg'](setTimeout,()=>{function _0x3f08df(_0x4bdcd5,_0x17fab9,_0x10aef7,_0x2883df){return _0x407ce8(_0x4bdcd5-0xf2,_0x17fab9-0x1ad,_0x4bdcd5,_0x2883df-0x10e);}function _0x132917(_0x495984,_0x5f378d,_0x59ecc6,_0x472ac1){return _0x587ee1(_0x495984-0x1d2,_0x59ecc6- -0x1bf,_0x59ecc6-0x4b,_0x495984);}if(_0x267fe5[_0x3f08df(0x203,0x220,0x1d0,0x229)](_0x267fe5[_0x3f08df(0x25a,0x209,0x241,0x225)],_0x267fe5[_0x3f08df(0x211,0x22e,0x266,0x225)]))return[];else _0x2a2c18(),_0x267fe5[_0x3f08df(0x1fb,0x233,0x1aa,0x1f5)](_0x47d952,new Error(_0x132917(0x3a5,0x36e,0x3b0,0x3e9)+'时（'+timeoutMs+_0x132917(0x344,0x316,0x35a,0x399)));},timeoutMs);}else _0x10bf1f+=_0x3a3c36;});}export async function callTranslation(_0x4c0c68){const _0x196f0a={'TwSDq':function(_0x258e51,_0x420418,_0x501dbc){return _0x258e51(_0x420418,_0x501dbc);},'dftLl':function(_0x258f12,_0x195e55){return _0x258f12(_0x195e55);},'eqoTv':function(_0x14ce0c,_0x3a97c9){return _0x14ce0c||_0x3a97c9;},'RVyAu':_0xdf8e2e(-0x25b,-0x29f,-0x29c,-0x2cf)};function _0xdf8e2e(_0x1117a4,_0x1e8dcf,_0x3ae01a,_0x2fcdfe){return _0x52d8(_0x3ae01a- -0x3b4,_0x2fcdfe);}function _0x5540c6(_0x59a76d,_0x3fe0c9,_0x2caf0d,_0x13ddf4){return _0x52d8(_0x59a76d-0x3d3,_0x3fe0c9);}try{let _0xceeb7a=_0x196f0a[_0x5540c6(0x509,0x526,0x535,0x4e8)](buildPromptForRequestType,_0xdf8e2e(-0x2ad,-0x266,-0x287,-0x2d5)+'n',_0x4c0c68||'');_0xceeb7a=_0x196f0a[_0x5540c6(0x526,0x500,0x522,0x559)](mergeAdjacentMessages,_0xceeb7a);const _0x3f255f=[..._0xceeb7a,{'role':'user','content':_0x196f0a[_0xdf8e2e(-0x276,-0x24e,-0x26b,-0x21b)](_0x4c0c68,'')}];_0x196f0a[_0xdf8e2e(-0x285,-0x288,-0x261,-0x263)](updateCombinedPrompt,_0x3f255f);const _0x4e4742=await _0x196f0a[_0x5540c6(0x526,0x52c,0x571,0x504)](LLM_TRANSLATION,_0x3f255f);return _0x4e4742;}catch(_0x34c57b){_0x196f0a[_0x5540c6(0x526,0x562,0x4e6,0x55a)](addLog,_0xdf8e2e(-0x28f,-0x26f,-0x259,-0x26d)+_0x34c57b[_0xdf8e2e(-0x208,-0x24b,-0x1fc,-0x1c9)]),console[_0x5540c6(0x502,0x4b1,0x507,0x544)](_0x196f0a[_0xdf8e2e(-0x211,-0x1c2,-0x203,-0x1ee)],_0x34c57b);throw _0x34c57b;}}let isAiInitialized=![];export function initAiSettings(_0x3adf15){const _0x358122={'tbGjs':function(_0x37d673,_0x280f35){return _0x37d673(_0x280f35);},'SIvcw':function(_0x5b409f,_0xceb8c4){return _0x5b409f(_0xceb8c4);},'TUiXt':function(_0x1f81f6,_0x786958){return _0x1f81f6===_0x786958;},'wgEOl':_0x76d0d3(0x2ca,0x2dc,0x308,0x318),'csYDC':'yJRQo'};function _0x76d0d3(_0x4536ef,_0x3cdf92,_0x379682,_0x2517cf){return _0x52d8(_0x3cdf92-0x161,_0x4536ef);}function _0x17ffb4(_0x47e4a8,_0x4c755a,_0x3bcee2,_0x4f7952){return _0x52d8(_0x4c755a-0x104,_0x3bcee2);}if(!isAiInitialized){if(_0x358122['TUiXt'](_0x358122[_0x17ffb4(0x20e,0x223,0x26d,0x262)],_0x358122['csYDC'])){const _0x46f9cf=_0x55abf2[0x332*-0x9+0x391+0x96*0x2b]||'',_0x517e16=(_0x4145ff[0x1b97+-0x1*-0x197b+-0x4*0xd44]||'')[_0x17ffb4(0x2a3,0x2b0,0x264,0x2ce)](),_0x136fc6=_0x36e444[0xdd*-0x1e+0x1845+0x1a4]||'',_0x15a33a=_0x41cb4b[-0x1114+0xeb2+0x266*0x1]||'',_0x501a32={'original':_0x2f7fc4,'cleaned':_0x517e16,'prefix':_0x46f9cf,'suffix':_0x136fc6,'weight':_0x15a33a,'skip':_0x358122[_0x76d0d3(0x2b7,0x2d6,0x286,0x288)](_0x2c773b,_0x37711a)||_0x358122['SIvcw'](_0xe29c9c,_0x517e16)};_0x2d743f['push'](_0x501a32),!_0x501a32['skip']&&_0x517e16&&(_0x317477['push'](_0x517e16),_0x219b35[_0x76d0d3(0x328,0x2f2,0x2b3,0x299)](_0x517e16[_0x76d0d3(0x294,0x296,0x269,0x2a1)+'e'](),_0x501a32));}else console[_0x76d0d3(0x32c,0x2f4,0x33e,0x2fa)](_0x76d0d3(0x2e4,0x31f,0x360,0x2cf)+_0x17ffb4(0x289,0x2a3,0x29f,0x2b7)+_0x17ffb4(0x278,0x238,0x258,0x22a)),isAiInitialized=!![];}}