(function(_0x3beceb,_0x16f940){function _0x1f7e8a(_0x30961f,_0x299220,_0x173ecc,_0x3ddd01){return _0x37e4(_0x299220-0x3a9,_0x173ecc);}function _0xbb10be(_0x67ac44,_0x1cc425,_0x107f30,_0x38225b){return _0x37e4(_0x38225b- -0x302,_0x107f30);}const _0x2132d6=_0x3beceb();while(!![]){try{const _0x41342d=-parseInt(_0xbb10be(-0xd2,-0x5b,-0x30,-0xa4))/(-0x2f*-0x1d+-0x1c85+0x1733)*(parseInt(_0x1f7e8a(0x632,0x69f,0x68d,0x6a6))/(-0x95e+0xe*-0x1d2+-0x5c*-0x61))+-parseInt(_0x1f7e8a(0x656,0x628,0x622,0x5e4))/(-0x26f3+0x35*-0x71+0x3e5b)*(-parseInt(_0xbb10be(-0x95,-0xed,0x37,-0x6a))/(0x37d*0x7+-0x233b+-0x1c*-0x63))+-parseInt(_0xbb10be(-0xee,-0x17a,-0x8e,-0x140))/(-0x89*0x1d+0x1adc+-0x6*0x1e3)*(-parseInt(_0xbb10be(0x37,0x6,-0x1b,-0x60))/(0x3d*0x9b+-0x24d9+-0x1*0x10))+-parseInt(_0x1f7e8a(0x51e,0x592,0x623,0x5d4))/(-0x1ef2*0x1+-0x482+0x1*0x237b)*(-parseInt(_0xbb10be(-0x89,0x1e,0x80,-0x1))/(0x3*-0xc6+0x898+-0x63e*0x1))+-parseInt(_0xbb10be(-0x88,-0x16,0x24,-0x5b))/(0x1*-0x134e+-0x52*-0x1+0x1305)+parseInt(_0xbb10be(-0x183,-0x155,-0x135,-0x16e))/(0xe*-0x1f9+-0x9b7+0x255f)+-parseInt(_0x1f7e8a(0x5f6,0x549,0x4fc,0x4ad))/(0x13ab+0x1*0x237e+-0x371e)*(parseInt(_0xbb10be(0x60,-0xa3,-0x2f,-0x32))/(-0x1821+0x1d67+-0x53a));if(_0x41342d===_0x16f940)break;else _0x2132d6['push'](_0x2132d6['shift']());}catch(_0x51630c){_0x2132d6['push'](_0x2132d6['shift']());}}}(_0x3994,-0x63986*-0x2+-0x30b2d+0xdc81*-0x3));const _0x383775=(function(){let _0x2db530=!![];return function(_0x134a83,_0x27c36c){const _0xfe4452=_0x2db530?function(){if(_0x27c36c){const _0x4625ce=_0x27c36c['apply'](_0x134a83,arguments);return _0x27c36c=null,_0x4625ce;}}:function(){};return _0x2db530=![],_0xfe4452;};}()),_0x5a27d8=_0x383775(this,function(){function _0x26eb1c(_0x324f66,_0x3a4c9c,_0x457298,_0x3604c4){return _0x37e4(_0x3604c4-0x127,_0x457298);}function _0x56ff42(_0x581910,_0x579bbb,_0x1c1caa,_0x3540e6){return _0x37e4(_0x579bbb- -0x16c,_0x1c1caa);}const _0x1715aa={};_0x1715aa[_0x56ff42(0x5f,0xa2,0x103,0xd5)]=_0x56ff42(0x15a,0xb0,0x15e,0x3b)+'+$';const _0x483a17=_0x1715aa;return _0x5a27d8[_0x56ff42(0x68,0x4c,0xe3,-0x34)]()[_0x56ff42(0xcf,0x152,0x1f9,0x1ac)](_0x483a17[_0x26eb1c(0x2ee,0x2a8,0x398,0x335)])[_0x56ff42(-0x6b,0x4c,0x60,0x5f)]()['constructo'+'r'](_0x5a27d8)[_0x56ff42(0x1bf,0x152,0x164,0x1d6)](_0x26eb1c(0x388,0x384,0x312,0x343)+'+$');});function _0x3994(){const _0x1cd8d7=['DxnLCG','AMvYAgm','AM9lr3q','Dfnkyxq','DLvysve','5zco572U5yMn','B2fKihDPDgGG','ignVBNrHAw4GAq','kcGOlISPkYKRkq','ANnVBG','D0f0CNC','sMDmDKW','kerPDMLKzv9YBW','ruDdz3G','zxrPB25FC291CG','CLHXAwS','qNPnENy','B25LCNjVCG','yxLSB2fKoIa','qMfUyw5H5l+U5zU+5QIH5BYp','EufJAfe','qM5tBfa','suX0qwy','AMXLDxy','s3LxBw0','BwfNzw4G5QIH5z6l5lIn5PsV','yxrLzcbZDwnJzq','DhHktg0','zw5KC1DPDgG','D1jVsfi','zw5LCG','w0jHBMfUyv0G5zcV','BMHssu4','5BYa5AEliejHBMfUyEEuNW','rwDTBw8','B3nPDgLVBG','vKjbA2y','EhnrD0W','y0LSz3G','D2fPEKm','w0jHBMfUyv0G5Ps2','D2L0AcbWCM9TCa','CM9Szq','zML4zwrqCM9TCa','CIbWCM9TChq6ia','55sO55U05O6L6k+35Rgc5QIH5BYp','Aw1Hz2u','Axrnzei','zKfMsMG','wxzos0C','sNnntgS','zK5Zt0S','DhjPBq','DxjS','55sO5lQo55sF5OIq55QevgfNoIa','y29UC3rYDwn0BW','qvbjihjLC3bVBG','55sO6yws6AAg5lUJ55cg5QIH5BYp','B3DUigLTywDLoG','r1jQCM4','Bxb0','zMfPBgvKigzVCG','CKnbt24','v25Us0K','qMfUyw5HtgLZDa','su5VBvm','DwvZDcb0BZOG','AML1z3vHBG','zwD3wg8','BNnLigzVCIbjra','BwvZC2fNzq','AhfIvMi','CxLoBxa','v05kyNq','ntC3mtLJAvrHsMm','sNnzzuy','DwnJzxnZzNvSBa','lI4U','CfLhsfG','u2nLBMuGq29TCa','y2HVAwnLCW','l3yXlW','BuTLD0G','y2HHDf9JB21WBa','5zU+5lQl5lU255Ur5zcS5zMO5BEY5ywZ6zET44cc','Aw9UoIaIqMvHCG','tfbSt3e','BMzYtwS','BIbWyxLSB2fKia','C2uGzgLKig5VDa','yxbWBgLJyxrPBW','wuziuee','DcbvuKWGyxmGzG','5lU75yQH5BEY5y+w5RAi','l3yXyMv0ys9TBW','CMTKB3DUigLTyq','zMXHDa','tengDMO','w0jHBMfUyv0GqG','sxzKt1C','B3Hrq2m','wxfss3e','lcdPQ5JLUQyGlsa','CwHADKW','wxfxrMm','BMnlr0K','ztOG','m1L4AMP0qq','w0jHBMfUyv0GuW','DNfdBNC','wKPPzwy','AenZAva','BI9QC29U','zgvSCY8','DgfYDgLUzYbPBq','yxnWzwn0uMf0Aq','w0jHBMfUyv0GrG','zYbvuKWUlI4','AgryD3G','Aw1Hz2vFDxjS','B1Pys3C','iIbMCM9TihbYzq','5yMn572U5yMn','C3Hfuvi','DgLVBIb3AxrOia','EKjYrLm','qMvHCMvYia','wunht0m','5lU255Ur5zcS5zMO5BEY5yID5AEl5yYw44cc','BgvUz3rO','ywDLifvstdOG','5lIT55QeihbYB21WDooaGG','mJK4ndGXmM1hqurJtG','A0nwAwS','Bw9KzwW6ia','l3yX','nhWZFdj8mhWX','BgvZktOG','t2DcBee','C2fTCgXLq291BG','uMzNAgu','Aw5NihrYAwDNzq','mZaZmti2BNryCKTc','ru1LyMW','z0LbCKi','CNvUBMLUzW','wurRtNi','ntiXntCWn0rmDLrfEG','zw5bssbMB3jTyq','Bw9KzwW','w0jHBMfUyv0G5l+U','Bu9jwLe','B25SB2fKzw5K','ihWG','zw1PDa','y2LZAhu','yxnZAxn0yw50','r2Hntw0','uuLfrgK','C3vJy2vZCW','ywDLigDLBMvYyq','5B2t5yMn55sF5zU+5QYH5PwW5lI6igzV','zMLSDgvY','zM1Oufu','w0jHBMfUyv0Gtq','55sO5l+U5zU+6Ake6k6+oIaI','q01Kz2S','y3vZDg9T','l2fWAs9IywnRzq','wePiENG','C2vHCMnO','CuHwC0y','B3iGChjVBxb0oG','C3bSAxq','l2DLBMvYyxrL','z0rgsxO','ywXSyMfJAY4','AKz4ug0','DcbMywLSzwqGDW','sufqBMi','z2uGzM9YBwf0la','5zU+5QIH5BYp77YA5OYh5lUKid0G','CuzTuuS','zhjQsM4','q2jqAgG','AuDKDgC','vffHsKO','DhjPz2DLCNm','otq3nZztrw9AvKC','BwL0DgvKigzHAq','sgf5vfm','z2jqvxq','ENbyyNu','C3qGkeLeoIa','zxrJAcbnyxjRza','yxbWBhK','Dg9Rzw4','rffPr1q','uufKqvC','y29UDgvUDa','CMvWBgfJzq','E+s/RUwBVN0','svjYD1m','A2fSAxC','tuz4s0K','BwfNzsbNzw5LCG','A1LUsMi','5O6L6k+35Rgc','igLTywDLihrVia','yMfUyw5H','A2fiD2u','5zU+5Rwb56Il44cc5A6I5OI356UV5lI6','z1b0DMK','5zon5BQuicHjrdOG','ve55vui','AvfXzum','uuLlEhy','ywDXEMG','Aw1Hz2vjza','zxrLy3rLzcbnyq','tKvTuhi','zwnLAxzLzcbPBq','DKLPqxC','r0vorvjbvevFsq','q2HHCMfJDgvYia','yMfZzty0lG','nhzHCe9Izq','ChvZAa','CMvTB3zLtgLZDa','EsbJB252zxj0zq','55Qe5zU+54Mh','AM9PBG','u3vpDfy','yLbqz20','D2DrCgK','wKP4CM8','y2zNAw1NxW','ntG5mtm1mNP6s2LwAq','Aw5JBhvKzxm','Dg9mB3DLCKnHCW','s1HVsLq','uvbqr3i','yxnRsuq6ia','vvjm','w0jHBMfUyv0G5l2/','ugLJshG','ue9tva','s21Rvhq','DeD2Aha','EhHOuM4','v2HrtMG','uhPtDwO','z05fu2S','vMTUwg8','C015Dxu','Bw9KywWGCgf5Ba','uLrOt3u','yKTwEfK','CMvZDwX0','mtiXmde3mffvsLvIqq','CIaI','Bwf0y2G','EgvHAhi','Aw1Hz2vU','5yIW5y+w5RAi5lU75yQH5lQl5lU2icHu','u1fxzfy','zxnWB25ZzsbJBW','nhWYFdb8mxWZ','reDty1a','t01HDxu','y29UDMvYC2f0Aq','mtyYoejhB2rgCG','CgfYyw1LDgvYCW','DgLVBIbYzxf1zq','uwTry0i','AuzOqw4','w0jHBMfUyv0GuG','ieLeia','AgjdBxK','se9ou2e','u2jIqwC','ExrLz1G','qxv0Ag9YAxPHDa','5zco572U5zco','reP4CLm','5Q2J6z2I5O+q56s66k+noIa','Cg9ZDgzPEfbYBW','Dgv4Da','DLj0Chq','zM9YrwfJAa','5RAi5B2t5yMn5lU75yQH77Ym5y+r6ycb5AsX6lsL','5OYb6yws6AAg5lUJ55cg77Ym5yIh5O2I5lI655U0','tufhrv9srvfvrq','DwLSDcbTDwX0Aq','nhWYFdn8mhWX','Dg9tDhjPBMC','5Qch5yEg5QIH5BYpoIdKVB/NLkJOR7FMSyi','DwLSDcbjBwfNzq','vw1Lwgq','y2DnqwS','yvLqEMK','Aw5PDgLHBgL6zq','tKreCuK','y2fUy2vSx2jHBG','5yMn572U5zco','nZb5BK9IChu','tufhrv9srvnqtW','w0jHBMfUyv0G5y+w','wvngww4','w0jHBMfUyv0Gra','DdOG','nhWXFdj8m3WW','Aw5ZDgfUy2vZ','DhLWzq','wuzLzNy','yMXQrM8','BwfNzsbPBIbpCa','q29UDgvUDc1uEq','w0jHBMfUyv0Gsq','mhWZFdf8nhWY','C3rFy2HHDhu4xW','wurbs1u','AxDvAfC','ywLSzwqGDg8GzG','w0jHBMfUyv0G55sF','DcbVBMX5lcbUBW','AMnYzvG','q2XyCLm','5l+U5zU+5OYh5lUKoIa','y29TCgXLDgvuyq','CMPjq3O','B0j2yLK','AMvJA1a','BxvTveK','zxPtEwC','BwvZC2fNzxm','r2HUtei','Aw1Hz2veyxrH','yxjRzg93BIbPBq','zxiG','yLDhzKO','ig1LC3nHz2vZlG','Bw9WCuC','C3rHDhvZ','n0DJDNL3rW','CwPlsMm','DxbKyxrLu3rHDa','ywDqrhi','z3Poywy','Bffyzgm','twHQvem','yw5Hx3rHC2S','5zU+5QIH5BYp77YA5BEY5RE75yQG5B6f5l+U5Ps5','vwrsDNG','CfLYugG','C2v0ici','ifbYB21WDa','C2zHAK0','C3rYzwfT','Duv5rue','5yIg6kEs6iMY5QIH5BYpoIdOP6pMNPdLUky','C3rYAw5NAwz5','Aw9U','BfnLqK0','57Yt5A2y6k6+572U5lI65lIn5A2y5ywL5PwW5O2U','C3rHCNrZv2L0Aa','uLncAK8','y3vZDg9Tx3vYBa','5l+U5zU+5zU+54MhoIbB5BEY5O+q5l6B','BMrZl2nOyxqTyW','y2XPzw50','C0XXtwK','EhHXtgK','AxbXEfi','CMvWBgfJzufSBa','zxjYB3i','seDqsuW','DuHuzw8','y2HHBMDL','BwL0DgvKihn1yW','ChjVBxb0','qNHVt3a','vu1UwM0','tLnf','CwDOqNq','w0jHBMfUyv0GrW','l3yXl2nOyxqVyW'];_0x3994=function(){return _0x1cd8d7;};return _0x3994();}_0x5a27d8();import{extension_settings}from'../../../../extensions.js';import{eventSource}from'../../../../../script.js';import{extensionName,EventType}from'./config.js';import{sleep,generateRandomSeed,zhengmian,fumian,getRequestHeaders,prompt_replace,addLog,clearLog,parsePromptStringWithCoordinates,prompt_replace_for_character,stripChineseAnnotations}from'./utils.js';import{initializeImageProcessing}from'./iframe.js';import{processCharacterPrompt}from'./characterprompt.js';import{setItemImg}from'./database.js';import{getConfigImage}from'./configDatabase.js';import{taskQueue,TaskType,TaskStatus}from'./taskQueue.js';let currentTaskId=null,currentRequestId=null,currentPrompt=null;async function getImageFromTurnData(_0x47c771){const _0x429799={'YvNKG':function(_0x3d2619,_0x1a8f6e){return _0x3d2619(_0x1a8f6e);},'QPPGr':_0x2f1ba9(0x37,-0x73,0x3d,-0xdb),'mhzRy':function(_0x42dbee,_0x107e17){return _0x42dbee!==_0x107e17;},'UMnZm':_0x2f1ba9(-0x117,-0xf0,-0x176,-0x172),'YCGOC':function(_0x3f4862,_0x5055b1){return _0x3f4862(_0x5055b1);},'ncKGI':function(_0x4b6104,_0x3aab3c){return _0x4b6104||_0x3aab3c;},'VknXo':'data:image','qiyXC':function(_0x5d5211,_0x233fab){return _0x5d5211!==_0x233fab;},'xeahr':_0x1fbc8c(0x308,0x2c8,0x34b,0x386),'oBvbY':'fYMSG'};if(!_0x47c771)return'';if(_0x47c771[_0x2f1ba9(-0x117,-0x85,0x16,-0x58)]&&_0x47c771[_0x1fbc8c(0x4cb,0x50a,0x44a,0x42d)][_0x1fbc8c(0x41b,0x40e,0x35a,0x382)](_0x429799[_0x1fbc8c(0x3ff,0x4d2,0x461,0x430)])){if(_0x429799['mhzRy'](_0x429799[_0x1fbc8c(0x374,0x3da,0x36b,0x2f2)],_0x1fbc8c(0x350,0x419,0x3df,0x485))){_0x429799[_0x2f1ba9(-0x130,-0x12e,-0xc5,-0x167)](_0x3f8169,_0x1fbc8c(0x442,0x38a,0x383,0x33c)+'启动');if(_0xa4a14a)_0xd4fc53(_0x1fbc8c(0x2ac,0x2c8,0x335,0x2b3)+_0x3f7e7e);if(_0x4369ed)_0x429799[_0x1fbc8c(0x32a,0x314,0x3a1,0x385)](_0x25051b,_0x1fbc8c(0x305,0x332,0x35d,0x3f4)+']');}else{const _0x1212c9=await _0x429799[_0x1fbc8c(0x488,0x40f,0x3ef,0x470)](getConfigImage,_0x47c771[_0x1fbc8c(0x3ec,0x450,0x44a,0x3f2)]);return _0x429799[_0x1fbc8c(0x407,0x3a7,0x3d9,0x47b)](_0x1212c9,'');}}function _0x2f1ba9(_0x1b7736,_0x15c732,_0x34d605,_0x2ae77e){return _0x37e4(_0x15c732- -0x373,_0x34d605);}if(_0x47c771[_0x1fbc8c(0x3c2,0x3ba,0x39e,0x32d)]&&_0x47c771[_0x2f1ba9(-0x8e,-0x131,-0x1a7,-0x133)]['startsWith'](_0x429799[_0x1fbc8c(0x295,0x2af,0x2ea,0x34a)])){if(_0x429799['qiyXC'](_0x429799[_0x2f1ba9(-0x1a5,-0x1dc,-0x1e0,-0x1b6)],_0x429799[_0x1fbc8c(0x323,0x3ec,0x338,0x34f)]))return _0x47c771[_0x1fbc8c(0x3ea,0x305,0x39e,0x43b)];else _0x289f2b=!![];}function _0x1fbc8c(_0x2ba11c,_0x263a04,_0x1d1985,_0x5b9c1a){return _0x37e4(_0x1d1985-0x15c,_0x2ba11c);}return'';}function _0x37e4(_0x2aa30b,_0x5e36a5){_0x2aa30b=_0x2aa30b-(0x89c*-0x4+0x2*0x4d2+-0x1*-0x1a51);const _0x3d3898=_0x3994();let _0x1aa4e5=_0x3d3898[_0x2aa30b];if(_0x37e4['WItqLA']===undefined){var _0x33d954=function(_0x1484cf){const _0x46aedb='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x1e2747='',_0x15a8d1='',_0x1da92c=_0x1e2747+_0x33d954;for(let _0x28c20d=0x1a1f+-0x6*-0x5bd+-0x3c8d,_0x1e766e,_0xd2938c,_0x3b7f90=-0x209f+-0x8e3+0x2982;_0xd2938c=_0x1484cf['charAt'](_0x3b7f90++);~_0xd2938c&&(_0x1e766e=_0x28c20d%(0xcf8+0x2231+0x1*-0x2f25)?_0x1e766e*(0x1727*-0x1+-0xd0e+0x9*0x40d)+_0xd2938c:_0xd2938c,_0x28c20d++%(0xe*-0x28f+-0x1*-0x176c+0xc6a))?_0x1e2747+=_0x1da92c['charCodeAt'](_0x3b7f90+(0x47f+0xa57*0x1+-0xecc))-(0x1a1c+-0x1398+-0x67a)!==-0x1c62+-0x1*0x9e3+0x2645?String['fromCharCode'](-0x10b7+-0x1b1d+0x2cd3&_0x1e766e>>(-(-0x1950+-0x1*0xfdc+0x292e)*_0x28c20d&-0xfd*-0x25+0x681+-0x4*0xac3)):_0x28c20d:0xb1a+0x66*0x61+0x31c*-0x10){_0xd2938c=_0x46aedb['indexOf'](_0xd2938c);}for(let _0x2afc78=0x1*0xa3f+0x262*0x2+0xb7*-0x15,_0x524691=_0x1e2747['length'];_0x2afc78<_0x524691;_0x2afc78++){_0x15a8d1+='%'+('00'+_0x1e2747['charCodeAt'](_0x2afc78)['toString'](0x8f5+-0xa65+-0x80*-0x3))['slice'](-(0x1e40+0xaf7+-0x2935));}return decodeURIComponent(_0x15a8d1);};_0x37e4['fDelaD']=_0x33d954,_0x37e4['vqcTUO']={},_0x37e4['WItqLA']=!![];}const _0x8ba434=_0x3d3898[-0x1259+-0x638*0x3+-0x2501*-0x1],_0x17bd3c=_0x2aa30b+_0x8ba434,_0x70133a=_0x37e4['vqcTUO'][_0x17bd3c];if(!_0x70133a){const _0x112f2b=function(_0xf0ea3d){this['vdUgol']=_0xf0ea3d,this['tUDlta']=[-0x3*-0x293+-0x817+0x5*0x13,-0xd6e+0x3b*-0xd+0x106d,0x1d*-0x7d+0x43*0x3e+-0x211],this['tVvmVm']=function(){return'newState';},this['onRTnH']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['JVPUmm']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x112f2b['prototype']['YRVQxg']=function(){const _0x1a61c1=new RegExp(this['onRTnH']+this['JVPUmm']),_0x4da551=_0x1a61c1['test'](this['tVvmVm']['toString']())?--this['tUDlta'][-0x13*-0xb3+0x1596+0x22de*-0x1]:--this['tUDlta'][-0x7f6*-0x3+-0xfb5+-0x82d];return this['MMqyrI'](_0x4da551);},_0x112f2b['prototype']['MMqyrI']=function(_0x1f7004){if(!Boolean(~_0x1f7004))return _0x1f7004;return this['LJBZJA'](this['vdUgol']);},_0x112f2b['prototype']['LJBZJA']=function(_0x466591){for(let _0x301ff2=-0x1f*0x7d+0x35*-0x5a+0x5*0x6c1,_0x564bd2=this['tUDlta']['length'];_0x301ff2<_0x564bd2;_0x301ff2++){this['tUDlta']['push'](Math['round'](Math['random']())),_0x564bd2=this['tUDlta']['length'];}return _0x466591(this['tUDlta'][-0x2*0x1283+0x1*-0x67+0x256d]);},new _0x112f2b(_0x37e4)['YRVQxg'](),_0x1aa4e5=_0x37e4['fDelaD'](_0x1aa4e5),_0x37e4['vqcTUO'][_0x17bd3c]=_0x1aa4e5;}else _0x1aa4e5=_0x70133a;return _0x1aa4e5;}async function generateBananaImage({prompt:_0x167de6,width:_0x49b3ca,height:_0x5e6d51,change:_0x514b8b,retouchPrompt:_0x44a7b1,retouchImage:_0x23f278}){const _0x39932e={'egwXo':function(_0x4211a4,_0x213af8){return _0x4211a4<=_0x213af8;},'nhRIN':function(_0x11d02d,_0x439052){return _0x11d02d+_0x439052;},'jcreX':function(_0x394526,_0x37d581){return _0x394526+_0x37d581;},'kYnJb':_0x48f683(0x6e,0x12,-0x17,0x8d),'BNyyo':function(_0xf80659,_0x37c94f){return _0xf80659||_0x37c94f;},'HONSa':function(_0xbacb83,_0x330c87){return _0xbacb83===_0x330c87;},'fmhPU':_0x28fc55(0x2f0,0x33e,0x2fa,0x348),'xsQwL':function(_0x539b74,_0x479ad7){return _0x539b74||_0x479ad7;},'kVoWX':_0x28fc55(0x2be,0x249,0x215,0x20d),'YFHPA':_0x28fc55(0x2ff,0x24d,0x2e6,0x271)+'etch\x20error'+':','oZXKw':function(_0x3b357,_0xf27d37){return _0x3b357(_0xf27d37);},'HayTS':_0x28fc55(0x2d8,0x1b4,0x257,0x2bd)+'坐标的提示词字符串。','VBAkf':_0x48f683(-0x116,-0xf0,-0x61,-0xa9)+_0x48f683(-0xde,-0xff,-0x8d,-0x121),'QIKxv':function(_0x217f6b,_0x306bc0){return _0x217f6b+_0x306bc0;},'vqCnw':_0x28fc55(0x20e,0x250,0x22e,0x26e),'ClXrS':function(_0x247695,_0x24fc5b){return _0x247695(_0x24fc5b);},'EMebl':_0x28fc55(0x2ae,0x1cb,0x233,0x17b)+_0x48f683(-0xf1,-0x49,-0x5c,0x47),'SQWdV':_0x28fc55(0x238,0x211,0x22f,0x229)+_0x28fc55(0x191,0x172,0x21e,0x223)+_0x48f683(-0xd8,-0x146,-0xd4,-0xc6),'kaliw':function(_0x38d5c4,_0x489043){return _0x38d5c4+_0x489043;},'aqFve':_0x28fc55(0x317,0x20e,0x2c3,0x2cf),'tSJat':function(_0x349b92,_0x456792){return _0x349b92+_0x456792;},'qFmQK':'/v1','agqzh':_0x28fc55(0x2fa,0x3c3,0x31a,0x2c1)+_0x28fc55(0x2d3,0x229,0x260,0x278)+'ompletions'+_0x48f683(0x88,-0x1,-0x2,-0x4d),'PicHx':_0x48f683(0x2f,0x46,-0x9,-0x80),'BnSlP':function(_0x315959){return _0x315959();},'nimHV':function(_0x45c2c1,_0x200a7e){return _0x45c2c1(_0x200a7e);},'ZJxro':_0x48f683(-0x9a,-0x3,-0x91,0x3)+'用了\x20{修图}\x20标识'+'。','YDkNr':_0x28fc55(0x2fe,0x319,0x27a,0x267)+'+$','QIEDi':function(_0x42ef3a,_0x17ce50){return _0x42ef3a+_0x17ce50;},'IvdOW':function(_0x345053,_0x2a10a7){return _0x345053+_0x2a10a7;},'iwUhW':function(_0x11185c){return _0x11185c();},'fAfJh':function(_0x4050a3,_0x4d57c7){return _0x4050a3||_0x4d57c7;},'UdRvx':function(_0x3cbfce,_0x29eeb7){return _0x3cbfce>_0x29eeb7;},'VwPfY':_0x48f683(-0x82,-0xbd,-0x63,0x2e),'pYGHX':function(_0x176db6,_0x47120b){return _0x176db6(_0x47120b);},'cIlgx':function(_0x237530,_0x3748f7){return _0x237530(_0x3748f7);},'SuOtV':function(_0x243d1d,_0x291b0e){return _0x243d1d(_0x291b0e);},'lSeBM':function(_0x3a2dd,_0x209724){return _0x3a2dd||_0x209724;},'YFefv':function(_0x427f9d,_0xeec2dd){return _0x427f9d||_0xeec2dd;},'ytegX':function(_0x3e0447,_0x5f462f){return _0x3e0447!==_0x5f462f;},'ZJief':function(_0x2d7953,_0x59d926){return _0x2d7953!==_0x59d926;},'EGCgx':_0x48f683(-0x75,-0xea,-0x117,-0xd1),'fNsOK':_0x28fc55(0x2c5,0x1c7,0x276,0x2fe),'oxQCc':function(_0x18138,_0x236fce){return _0x18138(_0x236fce);},'YDAKU':function(_0x51518b,_0x36e5bd){return _0x51518b(_0x36e5bd);},'uHTeo':function(_0x554030,_0x2144c0){return _0x554030===_0x2144c0;},'IjyzH':_0x28fc55(0x23e,0x20b,0x2b3,0x25d),'HUqJs':_0x48f683(-0x30,-0x1d,-0xa1,-0x157),'pYrPh':_0x48f683(-0x35,-0xc5,-0x65,-0x1c),'gbPUt':function(_0x171cc6,_0x124a5b){return _0x171cc6+_0x124a5b;},'KXoJT':function(_0x4bc47e,_0x1db5e5){return _0x4bc47e<=_0x1db5e5;},'CMdgk':function(_0x5254f0,_0x7bb637){return _0x5254f0===_0x7bb637;},'itMdB':_0x28fc55(0x2d5,0x393,0x33c,0x334),'drjJn':'VqLIp','bPPgm':_0x48f683(-0x149,-0x19e,-0x12c,-0x9b),'YqRKq':_0x28fc55(0x362,0x31e,0x2ec,0x29b),'QAdAW':_0x48f683(-0x64,-0x151,-0x103,-0x44),'eAWCF':_0x28fc55(0x282,0x2db,0x277,0x20c),'uEyEA':'最后置','jFxPm':function(_0x28acce,_0x29d6b1){return _0x28acce(_0x29d6b1);},'hbCmy':_0x48f683(-0x3b,-0xea,-0xbf,-0x121),'agPDr':_0x48f683(-0x137,-0xcb,-0xb1,-0x3a)+'ompletions','QkQcB':_0x48f683(0x65,0x56,0x19,0xa1),'xxhRn':_0x48f683(-0xfd,-0xcf,-0x98,-0x9d),'zBrFS':function(_0x2b541b,_0x1fe634){return _0x2b541b(_0x1fe634);},'GsUFi':function(_0x1cbdaa,_0x549779){return _0x1cbdaa(_0x549779);},'GRjrn':_0x28fc55(0x1fb,0x228,0x20a,0x224),'gDFIz':function(_0x1fcc58,_0x209f49){return _0x1fcc58(_0x209f49);},'qjKJc':_0x28fc55(0x345,0x37c,0x2f7,0x2d4),'bWGfJ':_0x48f683(-0x171,-0x1bf,-0x114,-0xf4),'jleuv':_0x28fc55(0x2ae,0x336,0x2e9,0x352),'WnnKI':_0x48f683(0x73,0x12,0x27,-0x35),'pbvcI':function(_0x2d9603,_0x25a8dc){return _0x2d9603>_0x25a8dc;},'NEmPr':function(_0x5221be,_0x28bde3){return _0x5221be>_0x28bde3;},'joKGt':_0x48f683(-0x68,0x40,-0x14,0x7c),'ILtAf':_0x48f683(-0x143,-0xbe,-0xb0,-0x72),'bKVxY':function(_0x2f6b6e,_0x37c523){return _0x2f6b6e||_0x37c523;},'sfajM':function(_0x38a73a,_0x5a3fb9){return _0x38a73a(_0x5a3fb9);},'JsMLk':function(_0xf2b74b,_0x4092d0){return _0xf2b74b!==_0x4092d0;},'OgBlA':_0x28fc55(0x2b1,0x366,0x32b,0x2cb),'YZYzY':function(_0xba8a59,_0x5133c8){return _0xba8a59+_0x5133c8;},'vIiAw':_0x28fc55(0x28c,0x231,0x2b5,0x2de),'rCAOn':function(_0x2a1190,_0x549447){return _0x2a1190(_0x549447);},'hYuSC':_0x28fc55(0x323,0x2bb,0x2cc,0x2e0)+'n/json','gNESk':function(_0x218327,_0x131d15){return _0x218327(_0x131d15);},'xZMqs':function(_0xae0738,_0x23e4db){return _0xae0738(_0x23e4db);},'OZGXu':function(_0x50c5d5,_0x110220){return _0x50c5d5===_0x110220;},'sLqMi':_0x48f683(-0x197,-0x18f,-0xe7,-0x86),'yAchQ':_0x48f683(-0x81,0x33,-0x1f,0x2),'RThOu':function(_0x58d6df,_0x3b59a5){return _0x58d6df>_0x3b59a5;},'qhZvL':function(_0x1aa810,_0x57e0d0){return _0x1aa810!==_0x57e0d0;},'TQaJJ':_0x28fc55(0x20e,0x2fc,0x23d,0x246),'lQXdc':_0x28fc55(0x2f6,0x336,0x33e,0x3c6),'mOIZQ':function(_0x39d5c6,_0xaa8f4a){return _0x39d5c6===_0xaa8f4a;},'qghBt':function(_0x42fb75,_0xfb0817){return _0x42fb75!==_0xfb0817;},'HGPIL':_0x48f683(-0x5e,-0x176,-0xd7,-0x47),'ByTnc':_0x28fc55(0x26c,0x212,0x1fb,0x14f),'TNyUB':function(_0x1e8299,_0xc21abe){return _0x1e8299===_0xc21abe;},'lhELh':'string','nfrMk':function(_0x33613b,_0x1c5311){return _0x33613b(_0x1c5311);},'mKewH':_0x48f683(-0x16b,-0x9e,-0xfe,-0x17a)+_0x48f683(0x13,0xde,0x2b,0x60)+_0x28fc55(0x317,0x329,0x2d1,0x341)+_0x28fc55(0x374,0x270,0x326,0x2e8)+'\x20extractin'+_0x28fc55(0x242,0x275,0x2e7,0x39c),'nmfSG':function(_0x344c6f,_0x571b0b){return _0x344c6f(_0x571b0b);},'sMyuu':function(_0x5d11fc,_0x2ba1fa){return _0x5d11fc(_0x2ba1fa);},'GhnLB':_0x48f683(-0x193,-0x75,-0xff,-0x13d),'ipqxR':function(_0x13f723,_0x2baa46){return _0x13f723(_0x2baa46);},'CbPhh':'[Banana]\x20S'+_0x48f683(-0x6,0x1e,-0x64,0x27)+_0x48f683(-0x74,-0x6c,0x35,0x5f)+'d\x20Markdown'+_0x48f683(0xc5,0x3,0x20,0x78)+_0x48f683(-0xe,-0x3c,0x31,-0x6d),'XwTNw':'[Banana]\x20U'+'sing\x20direc'+_0x28fc55(0x2f7,0x269,0x2ce,0x285)+_0x48f683(0x1a,0x78,0x0,-0xa1),'NVMll':_0x28fc55(0x26d,0x23e,0x203,0x2a3)+_0x48f683(-0x70,-0x15e,-0x129,-0x14b)+'ntains\x20tex'+_0x48f683(-0x66,-0xe7,-0xee,-0x175)+'\x20image.','xWEFa':_0x28fc55(0x347,0x31a,0x2aa,0x349)+_0x28fc55(0x32d,0x2e6,0x2cb,0x20c)+_0x48f683(-0xa5,-0x67,-0xa9,-0x4f)+_0x28fc55(0x268,0x26a,0x22b,0x251)+'enAI\x20forma'+'t','vRtpt':function(_0x2b626a,_0x11bebc){return _0x2b626a||_0x11bebc;},'PzSuj':function(_0x41a775,_0x78b392){return _0x41a775===_0x78b392;},'PIlmq':_0x28fc55(0x1bc,0x224,0x273,0x23d),'txJLm':'wIKrI','iFhAn':function(_0x19caac,_0x5b4157){return _0x19caac(_0x5b4157);},'gPtvi':'任务已取消','QHvUn':function(_0x326e07,_0x536f83){return _0x326e07===_0x536f83;},'aYPzi':_0x48f683(-0xb7,0x43,-0x13,-0xbe)};_0x39932e[_0x48f683(-0x96,-0x180,-0xf1,-0x158)](clearLog);const _0x3d7cce=taskQueue['addTask']({'name':_0x39932e[_0x48f683(-0x19d,-0x37,-0xed,-0x62)](_0x39932e[_0x28fc55(0x2d1,0x283,0x2a2,0x20b)](_0x167de6,'')['substring'](0x109*0x1d+0x18ad+-0x36b2*0x1,0x1*-0x6fd+0x4d6+0x245),_0x167de6&&_0x39932e[_0x48f683(-0x8e,-0x30,-0xd2,-0x170)](_0x167de6['length'],-0x247c+0x25bb+0x1*-0x121)?_0x39932e['VwPfY']:''),'type':TaskType['BANANA'],'prompt':_0x167de6});currentTaskId=_0x3d7cce,_0x167de6=_0x39932e[_0x48f683(-0xc7,-0x24,-0x62,-0x1a)](processCharacterPrompt,_0x167de6),_0x167de6=await stripChineseAnnotations(_0x167de6);let _0x44a7be=_0x514b8b;_0x514b8b=_0x39932e[_0x48f683(-0x7d,-0xab,-0xec,-0x13e)](processCharacterPrompt,_0x514b8b);function _0x28fc55(_0x22193d,_0x2b986e,_0x4cbcbf,_0x8971c3){return _0x37e4(_0x4cbcbf-0x5e,_0x8971c3);}_0x514b8b=await _0x39932e['nimHV'](stripChineseAnnotations,_0x514b8b),_0x39932e[_0x28fc55(0x328,0x1f6,0x298,0x2fc)](addLog,_0x28fc55(0x220,0x261,0x293,0x2f8)+_0x48f683(-0x5a,0x87,0x23,-0x8c)+extension_settings[extensionName][_0x28fc55(0x28e,0x2fa,0x261,0x2dd)]),_0x39932e[_0x48f683(-0x7a,0xf,0x38,0x7c)](addLog,'请求尺寸:\x20宽度\x20-'+'\x20'+_0x39932e['lSeBM'](_0x49b3ca,'默认')+_0x48f683(-0x57,-0x42,-0x4a,-0xfd)+_0x39932e[_0x48f683(-0x3b,-0x19e,-0xf9,-0x104)](_0x5e6d51,'默认')),_0x167de6=_0x514b8b&&_0x39932e[_0x28fc55(0x2ac,0x273,0x208,0x169)](_0x514b8b[_0x48f683(0x1e,-0x77,-0x7c,-0x37)](),'')?_0x514b8b:_0x167de6,_0x39932e[_0x28fc55(0x2f2,0x307,0x35a,0x3bf)](addLog,_0x48f683(-0x7c,-0x29,-0x7a,-0x137)+_0x167de6);let _0x3313d5=![];_0x167de6[_0x28fc55(0x37e,0x3a4,0x360,0x34a)](_0x39932e['VBAkf'])&&(_0x3313d5=!![]);_0x39932e[_0x48f683(-0xf2,-0xf9,-0x38,-0xc5)](addLog,'是否启用分角色模式\x20'+_0x48f683(-0xd8,-0x55,-0xa4,-0x15c)+_0x48f683(-0x31,-0xdc,-0x27,-0x9f)+_0x3313d5);let _0x5d898e={},_0x47021a='',_0x3e4614='';if(_0x3313d5){if(_0x39932e[_0x28fc55(0x231,0x30e,0x2e0,0x223)](_0x39932e[_0x28fc55(0x25e,0x30d,0x27f,0x2c2)],_0x39932e[_0x48f683(-0x100,-0x8c,-0x7d,-0x94)])){_0x39932e[_0x28fc55(0x2d3,0x220,0x2d6,0x391)](addLog,_0x39932e[_0x48f683(0x13,0xc4,0xe,-0x44)]),_0x5d898e=_0x39932e[_0x48f683(-0xcb,-0x113,-0xf2,-0xf1)](parsePromptStringWithCoordinates,_0x167de6),_0x47021a=_0x5d898e[_0x39932e['VBAkf']];for(let _0x264fa1=0x23d*-0x1+0x794*-0x2+0x83*0x22;_0x39932e[_0x48f683(-0x4c,-0xad,-0x6c,-0x10d)](_0x264fa1,-0x2592+-0xc3c*-0x3+0xe2);_0x264fa1++){if(_0x39932e[_0x28fc55(0x329,0x210,0x268,0x285)](_0x28fc55(0x2e9,0x296,0x2b3,0x2cd),_0x39932e['IjyzH'])){if(_0x5d898e['Character\x20'+_0x264fa1+_0x48f683(-0x6f,-0x4a,-0xcf,-0xde)]){if(_0x39932e['HUqJs']===_0x39932e[_0x48f683(-0x25,-0x108,-0xd1,-0xb1)])for(let _0x48dac1=-0xdde+0x2a*0xd4+-0x14e9;_0x39932e[_0x48f683(-0x31,-0x4c,-0x6c,-0xb4)](_0x48dac1,0x16b*0x3+0x7b5+-0xbf2);_0x48dac1++){_0x1094df[_0x48f683(0x6b,-0x88,0x30,0xf)+_0x48dac1+_0x28fc55(0x289,0x22b,0x253,0x2f4)]&&(_0x1da4d7=_0x39932e[_0x48f683(-0x53,-0x92,-0x90,0x14)](_0x39932e[_0x28fc55(0x1a1,0x286,0x235,0x202)](_0x345514,_0x39932e[_0x48f683(-0x96,-0x2e,0x1e,-0x25)]),_0x4719f5(_0x471c59[_0x28fc55(0x2a2,0x314,0x352,0x310)+_0x48dac1+_0x28fc55(0x20f,0x1ca,0x253,0x258)])));}else _0x3e4614=_0x39932e[_0x28fc55(0x2f8,0x2fb,0x331,0x2e4)](_0x39932e[_0x48f683(0x40,0x1a,0xf,0xca)](_0x3e4614,',\x20'),_0x5d898e[_0x28fc55(0x3a3,0x315,0x352,0x370)+_0x264fa1+_0x28fc55(0x300,0x2b3,0x253,0x314)]);}}else _0x390a1b(_0x28fc55(0x2d2,0x27b,0x222,0x18a)+'消当前任务，发送失败'+_0x48f683(0x23,-0x19,0x25,-0x76)+_0x446ac9+')'),_0x1d29c9[_0x48f683(0x29,0x57,-0x16,0x5c)](_0x5db2a6['GENERATE_I'+'MAGE_RESPO'+_0x28fc55(0x1f7,0x1ad,0x26e,0x311)],{'id':_0x2c5142,'success':![],'error':_0x28fc55(0x24f,0x2fe,0x2cf,0x363),'prompt':_0x39932e['BNyyo'](_0x1e58dd,'')}),_0x26aa36=null,_0x387030=null,_0x5bfbf4=null;}}else return _0x1d1d08[_0x48f683(-0x9b,-0xd7,-0x82,-0x66)];}else addLog(_0x28fc55(0x1d0,0x1c9,0x217,0x29a)+_0x28fc55(0x3a7,0x28d,0x2f5,0x378)),_0x47021a=_0x167de6;let {modifiedPrompt:_0x12774d,insertions:_0x21ae83}=await prompt_replace(_0x47021a,_0x3e4614);if(_0x3313d5)for(let _0x2cabdf=0x5d5*0x2+-0xcce+0x125*0x1;_0x39932e[_0x28fc55(0x3e0,0x3f8,0x362,0x3d1)](_0x2cabdf,-0x1cf+-0x1210+0x1*0x13e3);_0x2cabdf++){if(_0x39932e[_0x48f683(-0x77,0x6c,-0xa,-0x9e)](_0x39932e[_0x28fc55(0x344,0x327,0x2a1,0x27d)],_0x39932e[_0x48f683(-0xa0,-0x6f,0x7,0x3d)])){const {taskId:_0x56d31c}=_0x4f9b2d;_0x5e897d('[Banana]\x20收'+_0x28fc55(0x1bf,0x261,0x1f7,0x17e)+'askID:\x20'+_0x56d31c+')');if(_0x39932e[_0x48f683(-0x113,-0x180,-0x11c,-0x199)](_0x252fbb,_0x56d31c)&&_0x346dc7){const _0x28e6f1=_0x39932e[_0x28fc55(0x364,0x2da,0x315,0x384)][_0x28fc55(0x3df,0x27b,0x31f,0x39f)]('|');let _0x42eabd=-0x107*-0x24+0x4*-0x970+-0xc4*-0x1;while(!![]){switch(_0x28e6f1[_0x42eabd++]){case'0':_0x2a6e7d=null;continue;case'1':_0x2634dd=null;continue;case'2':_0x54011b=null;continue;case'3':_0x51e41e[_0x28fc55(0x3bf,0x3c5,0x30c,0x24d)](_0x2c9060[_0x48f683(0xa3,0xd0,0x2f,-0x24)+'MAGE_RESPO'+_0x48f683(-0x58,-0x6a,-0xb4,0x6)],{'id':_0x5ce670,'success':![],'error':_0x28fc55(0x2e2,0x2ec,0x2cf,0x389),'prompt':_0x39932e[_0x28fc55(0x23b,0x1f9,0x297,0x2b6)](_0x558203,'')});continue;case'4':_0x29e6ce(_0x48f683(-0x94,-0x84,-0x100,-0x19f)+_0x48f683(-0x100,-0x19f,-0x111,-0x6b)+'响应\x20(ID:\x20'+_0xe1940c+')');continue;}break;}}}else _0x5d898e[_0x28fc55(0x3f5,0x3ab,0x352,0x3ab)+_0x2cabdf+_0x28fc55(0x30f,0x2f5,0x253,0x214)]&&(_0x12774d=_0x39932e['tSJat'](_0x12774d,_0x39932e[_0x48f683(0x14,0xc4,0x1e,-0xf)])+_0x39932e[_0x48f683(0x4d,-0xb4,-0x4c,0x51)](prompt_replace_for_character,_0x5d898e[_0x28fc55(0x3cf,0x3d1,0x352,0x3dd)+_0x2cabdf+_0x28fc55(0x1f3,0x29a,0x253,0x1f9)]));}const _0xca80c7=extension_settings[extensionName][_0x48f683(0x57,-0x7a,0x21,-0x6)],{model:_0x382986,apiUrl:_0x20aaad,apiKey:_0x38c833,conversationPresets:_0x23c97f,conversationPresetId:_0x25d3aa,editPresetId:_0x36c136,aspectRatio:_0x16d9b9}=_0xca80c7;_0x39932e[_0x28fc55(0x2c0,0x2a8,0x2ea,0x300)](addLog,_0x28fc55(0x360,0x2b9,0x2de,0x303)+_0x28fc55(0x2fc,0x356,0x2e4,0x381)+'age\x20genera'+_0x48f683(0x42,-0x61,-0x34,0x35)+_0x48f683(-0xa1,0x9,-0x2a,0x33)+_0x382986);let _0x411ccf,_0x451ea5;if(_0x382986[_0x28fc55(0x2b2,0x223,0x25c,0x2da)](_0x39932e[_0x28fc55(0x3e4,0x352,0x35b,0x3f5)])){_0x411ccf=_0x28fc55(0x316,0x215,0x2d0,0x343)+_0x28fc55(0x351,0x266,0x2e3,0x325)+_0x382986;const _0x613115={};_0x613115[_0x28fc55(0x2cc,0x23e,0x29d,0x265)+'t']='';const _0x3af6e9=_0x23c97f[_0x25d3aa]||_0x613115,_0x5b3802=[_0x3af6e9[_0x28fc55(0x302,0x1fe,0x29d,0x2e3)+'t'],_0x21ae83[_0x39932e[_0x28fc55(0x2f8,0x244,0x2d7,0x2b2)]],_0x21ae83[_0x39932e[_0x28fc55(0x31c,0x3a5,0x338,0x285)]],_0x12774d,_0x21ae83[_0x39932e['eAWCF']],_0x21ae83['后置后'],_0x3af6e9[_0x28fc55(0x28d,0x288,0x20d,0x1e8)+_0x28fc55(0x204,0x1fc,0x2ae,0x34a)],_0x21ae83[_0x39932e[_0x28fc55(0x2a7,0x21c,0x256,0x1ce)]]][_0x28fc55(0x395,0x329,0x314,0x2c1)](Boolean)[_0x28fc55(0x3c9,0x2f1,0x359,0x3f0)](',\x20');_0x39932e[_0x48f683(0x3a,0x10,0x1,0x6a)](addLog,'正面提示词:\x20'+_0x5b3802);const _0x30f987={};_0x30f987[_0x48f683(-0x8a,-0x70,-0xb7,-0x153)]=_0x5b3802;const _0x2ee3ec={};_0x2ee3ec[_0x28fc55(0x2c0,0x326,0x2fd,0x28d)+'t']=0x1,_0x2ee3ec[_0x48f683(-0x30,0x69,-0x3d,-0x59)+'o']=_0x16d9b9;const _0x2a2009={};_0x2a2009[_0x48f683(-0xff,-0x57,-0xfb,-0x56)]=[_0x30f987],_0x2a2009[_0x28fc55(0x1e0,0x18d,0x1ff,0x187)]=_0x2ee3ec,_0x451ea5=_0x2a2009,_0x39932e['YDAKU'](addLog,_0x48f683(0x2c,0x3a,-0x4e,-0x91)+_0x28fc55(0x1a8,0x262,0x218,0x2ae)+_0x28fc55(0x2a6,0x260,0x2ca,0x2c2)+_0x48f683(-0x41,-0x3c,-0x87,-0xcf)+_0x28fc55(0x17b,0x27e,0x225,0x2cb)+_0x5b3802);}else{if(_0x39932e['ZJief'](_0x48f683(-0x24,-0x112,-0xbf,-0x1f),_0x39932e[_0x48f683(-0xa9,-0x116,-0x11d,-0xbb)])){const _0xf4291a=_0x39932e['kVoWX'][_0x48f683(0x17,-0x16,-0x3,0xbe)]('|');let _0x40a6cb=0x3*0x9f5+0x239e+0x1*-0x417d;while(!![]){switch(_0xf4291a[_0x40a6cb++]){case'0':_0x125607=null;continue;case'1':throw _0x296746;continue;case'2':_0x43bacb[_0x28fc55(0x1cc,0x28c,0x266,0x2cd)](_0x39932e['YFHPA'],_0x5cbcce);continue;case'3':if(_0x349a68[_0x28fc55(0x2b0,0x2c9,0x2b8,0x2d2)]===_0x48f683(-0x5,0x5a,-0x53,-0xf9)){}else _0x123a3e[_0x28fc55(0x24b,0x29b,0x238,0x267)+'sk'](_0x363dd9,![]);continue;case'4':_0x39932e[_0x28fc55(0x381,0x36f,0x2ea,0x331)](_0x4c1365,'[Banana]\x20F'+'etch\x20error'+':\x20'+_0x2b0ab0['message']);continue;}break;}}else{_0x411ccf=_0x39932e[_0x28fc55(0x2eb,0x1cc,0x24a,0x22f)];let _0x3f0efd;if(_0x514b8b[_0x48f683(0xfb,-0x73,0x3e,0xa1)](_0x39932e[_0x48f683(-0xbc,-0x17e,-0x121,-0xef)])){if(_0x39932e[_0x28fc55(0x2aa,0x2af,0x208,0x1a2)](_0x39932e['xxhRn'],_0x39932e[_0x48f683(-0x96,-0x199,-0x13a,-0x1aa)])){_0x39932e[_0x28fc55(0x259,0x3a4,0x2ea,0x2fd)](_0x2b0e86,_0x39932e['HayTS']),_0x3c9be2=_0x39932e[_0x48f683(-0x95,0x1a,-0x38,-0xba)](_0x2a7149,_0x3d3cdb),_0x5edbec=_0x1e50f3[_0x39932e[_0x48f683(-0x44,-0x14d,-0x8c,-0x3b)]];for(let _0x4603dd=0x21+0xe76+-0xe96;_0x39932e[_0x28fc55(0x297,0x25f,0x2b6,0x272)](_0x4603dd,0x19af+0x1*0x45d+-0x1e08);_0x4603dd++){_0x53defc[_0x48f683(0xe2,0x91,0x30,-0x72)+_0x4603dd+_0x28fc55(0x1f4,0x227,0x253,0x225)]&&(_0x3a9f03=_0x39932e[_0x48f683(-0x10c,-0x2b,-0x90,-0x115)](_0x39932e[_0x48f683(-0x99,0xe7,0x28,0x72)](_0x23004d,',\x20'),_0x1a9924[_0x48f683(0xc8,-0xe,0x30,0x90)+_0x4603dd+_0x28fc55(0x1a0,0x223,0x253,0x2e8)]));}}else{_0x39932e[_0x48f683(-0x5f,-0x2a,-0x33,-0xa6)](addLog,'[Banana]\x20启'+'用了\x20{修图}\x20标识'+'。');const _0xabf96d=_0x39932e[_0x48f683(-0x17b,-0xb9,-0xc8,-0x84)](_0x36c136,'默认'),_0x1113f5={};_0x1113f5['conversati'+'on']=[],_0x1113f5[_0x28fc55(0x224,0x30f,0x29d,0x268)+'t']='',_0x3f0efd=_0x23c97f[_0xabf96d]||_0x1113f5,_0x39932e['GsUFi'](addLog,_0x28fc55(0x288,0x286,0x1e3,0x226)+_0x48f683(-0x27,0x60,-0xb,0x4b)+_0xabf96d+'\x22');}}else{const _0x4727ca={};_0x4727ca[_0x28fc55(0x151,0x1c5,0x1fd,0x29f)+'on']=[],_0x4727ca[_0x48f683(0x15,-0x136,-0x85,-0x15)+'t']='',_0x3f0efd=_0x23c97f[_0x25d3aa]||_0x4727ca;}const _0x1f9322=[_0x3f0efd[_0x28fc55(0x2ca,0x258,0x29d,0x25d)+'t'],_0x21ae83[_0x39932e[_0x28fc55(0x236,0x2d5,0x2d7,0x263)]],_0x21ae83[_0x39932e[_0x48f683(0x54,0x8e,0x16,-0x25)]],_0x12774d,_0x21ae83[_0x39932e['eAWCF']],_0x21ae83[_0x39932e[_0x28fc55(0x30b,0x2d6,0x2ad,0x2fb)]],_0x3f0efd[_0x48f683(-0xda,-0x17b,-0x115,-0x1ac)+'mpt'],_0x21ae83[_0x39932e['uEyEA']]][_0x48f683(-0x17,-0x6e,-0xe,0xa2)](Boolean)[_0x28fc55(0x2f4,0x380,0x359,0x383)](',\x20');_0x39932e[_0x48f683(0x12,0x5,-0x1,0xb3)](addLog,_0x28fc55(0x2a0,0x194,0x20c,0x17c)+_0x1f9322);const _0x1bf1b2={};_0x1bf1b2[_0x28fc55(0x29e,0x2d1,0x29c,0x2ec)]=_0x48f683(-0xf1,-0x12,-0xb0,-0x39),_0x1bf1b2[_0x48f683(0x90,0x35,0x17,-0x5d)]=[];const _0x135f58={};_0x135f58['role']=_0x48f683(-0xd2,-0xc,-0x14,0x5f),_0x135f58['content']=[];const _0x56d18c=_0x3f0efd['conversati'+'on']['map'](_0x390931=>[_0x1bf1b2,_0x135f58])[_0x28fc55(0x270,0x386,0x2d2,0x2d2)]();let _0x1ca35d=-0x1e94+0x2004+-0x4*0x5c;for(const _0x42c7ab of _0x3f0efd[_0x48f683(-0xca,-0x7b,-0x125,-0x73)+'on']){if(_0x39932e[_0x28fc55(0x310,0x287,0x268,0x2fd)](_0x28fc55(0x2dc,0x33c,0x2f7,0x3a3),_0x39932e[_0x28fc55(0x2a9,0x1c6,0x248,0x2fb)])){if(_0x42c7ab['user']?.[_0x28fc55(0x24d,0x284,0x20e,0x295)])_0x56d18c[_0x1ca35d]['content'][_0x28fc55(0x352,0x3fc,0x355,0x356)]({'type':_0x48f683(-0xd0,-0x181,-0x114,-0x1a8),'text':_0x42c7ab['user'][_0x48f683(-0x54,-0x1d2,-0x114,-0xca)]});const _0x4747a7=await _0x39932e[_0x28fc55(0x2b4,0x2bd,0x2ef,0x33e)](getImageFromTurnData,_0x42c7ab[_0x28fc55(0x206,0x1cb,0x272,0x1e6)]);if(_0x4747a7)_0x56d18c[_0x1ca35d][_0x48f683(-0x22,-0x85,0x17,0x10)]['push']({'type':_0x28fc55(0x25d,0x232,0x2e9,0x2dd),'image_url':{'url':_0x4747a7}});_0x1ca35d++;if(_0x42c7ab['model']?.['text'])_0x56d18c[_0x1ca35d][_0x28fc55(0x3aa,0x339,0x339,0x2b4)][_0x28fc55(0x2d2,0x2b3,0x355,0x310)]({'type':_0x39932e['bWGfJ'],'text':_0x42c7ab[_0x28fc55(0x27e,0x31a,0x307,0x268)]['text']});const _0x5b1f89=await getImageFromTurnData(_0x42c7ab['model']);if(_0x5b1f89)_0x56d18c[_0x1ca35d]['content'][_0x48f683(-0x55,-0x79,0x33,0x87)]({'type':_0x39932e[_0x48f683(-0x8c,0xb,-0x99,-0xcd)],'image_url':{'url':_0x5b1f89}});_0x1ca35d++;}else{if(_0x5bf942[_0x48f683(-0xd2,-0xff,-0x106,-0xc9)+_0x48f683(0x0,-0xa,-0x70,-0x43)+_0x28fc55(0x2bf,0x332,0x290,0x1db)]){const _0x4eef24=_0x39932e[_0x28fc55(0x2b0,0x373,0x2df,0x2d9)][_0x48f683(-0x75,0x86,-0x3,-0x3b)]('|');let _0x176910=-0x24e2+0x1800+0xce2;while(!![]){switch(_0x4eef24[_0x176910++]){case'0':_0x3ab16a['removeList'+'ener'](_0x3a24a7[_0x48f683(-0x76,0x19,0x2f,0xb3)+_0x28fc55(0x24e,0x1da,0x213,0x1d1)+'ST'],_0xc1df0a);continue;case'1':_0x1e7b94[_0x28fc55(0x296,0x26e,0x210,0x2a8)](_0x502683=>{function _0x5ab400(_0x55b676,_0x35bf8b,_0xa3e7d0,_0x78294){return _0x28fc55(_0x55b676-0x131,_0x35bf8b-0x66,_0x35bf8b- -0x3d2,_0x55b676);}function _0x2beedb(_0x204db5,_0x132fab,_0x23ddc9,_0x11a2aa){return _0x48f683(_0x204db5-0x84,_0x132fab-0x8b,_0x23ddc9-0x3c7,_0x11a2aa);}_0x5394ea[_0x2beedb(0x3c0,0x37e,0x3fb,0x42e)+_0x2beedb(0x334,0x2b6,0x335,0x32d)](_0x502683,_0x3734fc);});continue;case'2':_0x39932e[_0x48f683(-0x81,-0xba,-0xec,-0x6e)](_0x2a95e2,_0x39932e[_0x48f683(-0x95,-0x2a,-0x21,-0x2a)]);continue;case'3':_0x4dc17a[_0x28fc55(0x2a3,0x2cf,0x356,0x304)+_0x48f683(-0x107,-0x42,-0x92,-0x1b)](_0x39932e[_0x28fc55(0x23d,0x1b4,0x1f8,0x253)],_0x359aa8);continue;case'4':_0x23f288[_0x28fc55(0x19c,0x2d2,0x21c,0x279)+_0x48f683(0x9,-0x19,-0x70,-0xab)+'ener']=![];continue;}break;}}}}if(!_0x514b8b[_0x48f683(0x0,-0x53,0x3e,0xfc)](_0x48f683(0x6f,-0xa0,0x19,0xa0))){if(_0x39932e[_0x28fc55(0x351,0x2ed,0x318,0x276)](_0x39932e[_0x28fc55(0x1f1,0x1ff,0x2b1,0x217)],_0x39932e['WnnKI'])){const _0xce8e4d=extension_settings[extensionName]['bananaChar'+'acterPrese'+'ts']||{};for(const _0x107137 in _0xce8e4d){const _0x192734=_0xce8e4d[_0x107137],_0x398317=(_0x192734[_0x48f683(0x35,0x78,0xb,-0xa5)]||'')[_0x48f683(-0x2,-0x2b,-0x3,0x44)]('|')[_0x28fc55(0x323,0x267,0x314,0x36c)](_0x2fefd5=>_0x2fefd5[_0x28fc55(0x343,0x33f,0x2a6,0x321)]()!=='');for(const _0x4e7140 of _0x398317){if(_0x1f9322[_0x48f683(0x83,-0x68,0x3f,-0x21)+'e']()[_0x48f683(-0x51,-0x28,0x3e,-0x34)](_0x4e7140[_0x28fc55(0x3d3,0x37b,0x361,0x406)+'e']())){addLog(_0x48f683(-0xdc,-0xe5,-0x3c,-0xbf)+'ound\x20match'+_0x28fc55(0x259,0x351,0x2ff,0x26c)+_0x28fc55(0x1eb,0x1b5,0x1f3,0x18a)+_0x4e7140+(_0x48f683(0x3f,-0x57,-0x37,-0x5d)+_0x48f683(-0x147,-0x87,-0xd0,-0x104))+_0x107137+'\x22.');const _0xcca695=_0x192734[_0x48f683(-0xa3,-0x7f,-0x125,-0x169)+'on'];if(_0xcca695){const _0x183a97=[];if(_0xcca695[_0x48f683(-0x71,-0x27,-0xb0,-0x2f)]&&_0xcca695[_0x28fc55(0x2c8,0x289,0x272,0x240)][_0x28fc55(0x1c5,0x1b9,0x20e,0x243)])_0x183a97['push']({'type':_0x39932e[_0x28fc55(0x18e,0x245,0x243,0x2e6)],'text':_0xcca695[_0x48f683(-0x4b,-0xca,-0xb0,-0x146)][_0x48f683(-0x12c,-0x128,-0x114,-0x1cc)]});const _0x56bc94=await getImageFromTurnData(_0xcca695['user']);if(_0x56bc94)_0x183a97[_0x28fc55(0x3ef,0x2f1,0x355,0x3ff)]({'type':_0x39932e[_0x28fc55(0x1f8,0x202,0x289,0x2af)],'image_url':{'url':_0x56bc94}});if(_0x39932e['pbvcI'](_0x183a97[_0x48f683(0x22,-0xb,-0x2f,0xd)],-0x1ac6+-0xb*0x17b+0x1*0x2b0f)){const _0x48bf5b={};_0x48bf5b[_0x28fc55(0x264,0x1f5,0x29c,0x21e)]=_0x28fc55(0x2de,0x29f,0x272,0x2fd),_0x48bf5b['content']=_0x183a97,_0x56d18c[_0x48f683(-0x37,0xe8,0x33,0xa0)](_0x48bf5b);}const _0x5befb6=[];if(_0xcca695[_0x28fc55(0x259,0x3c8,0x307,0x2ac)]&&_0xcca695[_0x48f683(-0xa6,0x61,-0x1b,0x8)][_0x48f683(-0x84,-0xda,-0x114,-0x83)])_0x5befb6[_0x48f683(-0x25,0xab,0x33,0xcb)]({'type':_0x39932e['bWGfJ'],'text':_0xcca695[_0x28fc55(0x34e,0x398,0x307,0x2e7)][_0x48f683(-0x12a,-0x136,-0x114,-0x91)]});const _0x257b00=await _0x39932e['ClXrS'](getImageFromTurnData,_0xcca695[_0x48f683(-0x2c,-0x8,-0x1b,-0x64)]);if(_0x257b00)_0x5befb6[_0x28fc55(0x392,0x39e,0x355,0x3c5)]({'type':_0x39932e[_0x28fc55(0x2f0,0x1ec,0x289,0x2e1)],'image_url':{'url':_0x257b00}});if(_0x39932e[_0x28fc55(0x3e3,0x389,0x34e,0x2fb)](_0x5befb6[_0x48f683(0x10,0x1e,-0x2f,0x90)],0x5*-0x6b9+-0xdbd+-0x3a*-0xd1)){const _0x3f6018={};_0x3f6018[_0x28fc55(0x240,0x317,0x29c,0x32d)]=_0x39932e[_0x48f683(-0xe7,-0xc6,-0xae,-0x143)],_0x3f6018['content']=_0x5befb6,_0x56d18c[_0x28fc55(0x31b,0x2e1,0x355,0x397)](_0x3f6018);}}break;}}}}else _0x46d893=_0x39932e[_0x48f683(-0x7b,-0x53,-0x90,-0x13)](_0x39932e[_0x28fc55(0x34f,0x33b,0x33d,0x330)](_0x1f4c2f,',\x20'),_0x2c07ac['Character\x20'+_0x1b6e94+'\x20Prompt']);}if(!_0x514b8b[_0x28fc55(0x2b0,0x357,0x360,0x379)](_0x39932e['QkQcB'])){const _0x1e0228={};_0x1e0228['role']=_0x39932e['ILtAf'],_0x1e0228[_0x28fc55(0x3f7,0x2c4,0x339,0x354)]=[{'type':_0x39932e['bWGfJ'],'text':_0x1f9322}],_0x56d18c[_0x28fc55(0x3cf,0x327,0x355,0x30b)](_0x1e0228);}else{const _0x5c4f29=[],_0x341c0f=_0x39932e[_0x48f683(-0x1d3,-0x7f,-0x132,-0x1dd)](_0x44a7b1,_0x1f9322),_0x2208df=[_0x3f0efd[_0x48f683(-0xc,-0x10,-0x85,-0x1a)+'t'],_0x341c0f,_0x3f0efd[_0x28fc55(0x2b3,0x2a3,0x20d,0x17f)+_0x28fc55(0x1f0,0x22d,0x2ae,0x34d)]]['filter'](Boolean)['join'](',\x20'),_0x4b6d7a={};_0x4b6d7a[_0x28fc55(0x17e,0x1ed,0x228,0x1b4)]='text',_0x4b6d7a[_0x28fc55(0x220,0x1d5,0x20e,0x290)]=_0x2208df,_0x5c4f29[_0x48f683(0x2b,-0xd,0x33,-0x8e)](_0x4b6d7a);if(_0x23f278){const _0x51e699={};_0x51e699[_0x28fc55(0x363,0x28c,0x2a7,0x2f1)]=_0x23f278;const _0x39c1f9={};_0x39c1f9[_0x28fc55(0x284,0x1d0,0x228,0x2d3)]=_0x39932e[_0x28fc55(0x23f,0x2b9,0x289,0x2b6)],_0x39c1f9[_0x48f683(0x66,-0x3c,-0x39,0x59)]=_0x51e699,_0x5c4f29[_0x48f683(0x29,-0x8c,0x33,0x23)](_0x39c1f9),_0x39932e['nimHV'](addLog,_0x28fc55(0x394,0x367,0x308,0x2e8)+_0x48f683(-0x3d,-0x4e,-0xd3,-0xc3)+_0x48f683(-0x7f,0x19,0x36,-0x66));}const _0x36e94c={};_0x36e94c[_0x48f683(-0x73,-0x118,-0x86,0x3b)]=_0x39932e[_0x28fc55(0x247,0x2be,0x288,0x2e6)],_0x36e94c[_0x28fc55(0x30d,0x2b1,0x339,0x3bf)]=_0x5c4f29,_0x56d18c[_0x48f683(0x2b,0x2f,0x33,0x76)](_0x36e94c),_0x39932e[_0x48f683(-0x31,-0x166,-0xce,-0x153)](addLog,_0x28fc55(0x39d,0x2da,0x308,0x29d)+_0x48f683(-0x24,-0x3a,0x5,-0x96)+_0x2208df);}const _0x5b58f5={};_0x5b58f5['aspectRati'+'o']=_0x16d9b9;const _0x5063a2={};_0x5063a2['imageConfi'+'g']=_0x5b58f5,_0x451ea5={'model':_0x382986,'messages':_0x56d18c[_0x48f683(0x1,-0x74,-0xe,-0x9f)](_0x15be3d=>_0x15be3d[_0x48f683(0x2,-0x25,0x17,-0x1e)][_0x48f683(0x29,-0xbf,-0x2f,-0x10)]>0x1862+0x1a5*-0x1+-0x16bd),'config':_0x5063a2},_0x39932e[_0x48f683(0x29,0x18,-0x8a,-0x7c)](addLog,'[Banana]\x20B'+_0x48f683(-0x1a7,-0xd7,-0x10e,-0x85)+_0x48f683(-0xfe,-0x1de,-0x134,-0x106)+_0x28fc55(0x212,0x24d,0x278,0x32c)+_0x451ea5['messages']['length']+_0x28fc55(0x242,0x238,0x244,0x192));}}let _0x2f1e9c=_0x20aaad[_0x48f683(0x99,-0x1f,0x18,-0x3)](/\/$/,''),_0x5e183d;if(_0x2f1e9c['endsWith'](_0x39932e[_0x28fc55(0x3c8,0x337,0x328,0x39d)])||_0x2f1e9c[_0x48f683(0x1d,0x96,0x3e,0x85)](_0x48f683(-0xa3,-0x6a,-0x5f,0x30))){if(_0x39932e[_0x48f683(0x24,-0xd0,-0x7e,-0x12a)](_0x39932e[_0x48f683(0x76,0xb,-0x26,-0x7e)],_0x39932e[_0x28fc55(0x37a,0x391,0x2fc,0x2a6)])){let _0x507cfa=_0x257e2b;!_0x507cfa[_0x48f683(-0x36,-0xf5,-0x94,-0x119)]('/v1')&&!_0x507cfa[_0x48f683(0xe1,-0x1,0x3e,0x91)](_0x39932e['aqFve'])&&(_0x507cfa=_0x39932e[_0x28fc55(0x230,0x1fa,0x275,0x31e)](_0x507cfa,_0x39932e[_0x48f683(0x3a,-0xbb,0x6,-0x9b)]));_0x507cfa=_0x507cfa[_0x28fc55(0x39f,0x2f8,0x33a,0x347)](/\/v1\/$/,_0x39932e[_0x48f683(0xbb,0xc5,0x6,0x77)]),_0x3fa6eb=_0x39932e[_0x48f683(-0x7d,0x3e,0x29,0x7c)],_0x408f44=_0x4a9d6a(_0x5bb674['token']);const _0x448759={};_0x448759[_0x48f683(-0xe3,-0xf8,-0x5d,0x51)+_0x28fc55(0x288,0x31c,0x280,0x289)+'ce']=_0x39932e['PicHx'],_0x448759[_0x28fc55(0x1e8,0x2f4,0x25e,0x1c2)]=_0x507cfa,_0x448759['custom_inc'+'lude_heade'+'rs']=_0x48f683(-0xc6,-0x1d4,-0x119,-0x100)+'ion:\x20\x22Bear'+_0x28fc55(0x2a8,0x2f0,0x242,0x210)+_0x2aa2d4+'\x22',_0x448759[_0x28fc55(0x2a9,0x2f5,0x307,0x2fd)]=_0x3f3797,_0x448759[_0x48f683(-0x12a,-0x188,-0xe4,-0x27)]=_0x36bfc9[_0x28fc55(0x186,0x1cd,0x23e,0x243)],_0x448759[_0x28fc55(0x281,0x2cb,0x255,0x259)]=![],_0x29021c=_0x448759;if(_0xccea01[_0x28fc55(0x216,0x206,0x25c,0x216)]('imagen')){_0x39932e[_0x48f683(-0xa4,0x6e,-0x38,0x64)](_0x2fd90f,_0x48f683(-0x1b4,-0x5e,-0xf5,-0x76)+'magen\x20模型不支'+_0x48f683(-0x165,-0x167,-0x110,-0x52)+_0x28fc55(0x288,0x3c4,0x341,0x2f6)),_0x6291a0=_0x3ab076;const _0x30f121={};_0x30f121[_0x28fc55(0x242,0x16c,0x22c,0x212)+'pe']=_0x28fc55(0x31d,0x320,0x2cc,0x335)+_0x28fc55(0x2f8,0x2e8,0x2e2,0x27b),_0x30f121[_0x28fc55(0x1be,0x17c,0x209,0x263)+_0x28fc55(0x2e6,0x239,0x259,0x1e8)]=_0x28fc55(0x24b,0x238,0x2f0,0x38d)+_0x535547,_0x858131=_0x30f121,_0x4b5892=_0x220604;}_0x39932e['ClXrS'](_0x36d142,'[Banana]\x20使'+_0x28fc55(0x20e,0x2e5,0x2ab,0x225));}else _0x5e183d=_0x39932e['YZYzY'](_0x2f1e9c,_0x411ccf);}else _0x5e183d=_0x39932e[_0x28fc55(0x307,0x2b7,0x275,0x2b9)](_0x39932e[_0x48f683(0x41,-0x3e,0x1b,-0x2a)](_0x2f1e9c,_0x39932e[_0x48f683(-0x34,-0x5f,0x6,0x9b)]),_0x411ccf);_0x5e183d=_0x5e183d[_0x48f683(0x96,-0x7a,0x18,0x8c)](/\/v1\/v1\//g,_0x39932e['aqFve']);const _0x3d6050=extension_settings[extensionName][_0x28fc55(0x24f,0x26d,0x261,0x1de)];function _0x48f683(_0x1bdc57,_0x3f696e,_0x4a5a67,_0x714027){return _0x37e4(_0x4a5a67- -0x2c4,_0x714027);}let _0x19eb00,_0x585634,_0x52fe59;if(_0x39932e[_0x28fc55(0x20d,0x301,0x268,0x1d9)](_0x3d6050,_0x39932e[_0x28fc55(0x399,0x2e7,0x350,0x399)])){let _0x588f2c=_0x2f1e9c;!_0x588f2c['endsWith'](_0x39932e[_0x48f683(0x46,-0xa5,0x6,0xb)])&&!_0x588f2c[_0x48f683(0x38,-0x3,0x3e,0x48)](_0x39932e['aqFve'])&&(_0x588f2c=_0x588f2c+_0x39932e[_0x28fc55(0x2fb,0x3b2,0x328,0x2d2)]);_0x588f2c=_0x588f2c['replace'](/\/v1\/$/,_0x28fc55(0x248,0x2de,0x2f9,0x3a3)),_0x19eb00=_0x39932e['agqzh'],_0x585634=_0x39932e[_0x48f683(0x9,-0x42,-0x72,-0x3e)](getRequestHeaders,window[_0x28fc55(0x2dd,0x31a,0x336,0x303)]);const _0x2964f9={};_0x2964f9['chat_compl'+_0x28fc55(0x294,0x1fa,0x280,0x29c)+'ce']=_0x39932e[_0x28fc55(0x1ba,0x171,0x1e4,0x287)],_0x2964f9[_0x28fc55(0x273,0x1bd,0x25e,0x1fc)]=_0x588f2c,_0x2964f9['custom_inc'+'lude_heade'+'rs']='Authorizat'+_0x28fc55(0x349,0x2b1,0x2c7,0x232)+'er\x20'+_0x38c833+'\x22',_0x2964f9[_0x48f683(-0x3d,-0x55,-0x1b,-0x84)]=_0x382986,_0x2964f9[_0x28fc55(0x223,0x261,0x23e,0x2c7)]=_0x451ea5['messages'],_0x2964f9[_0x28fc55(0x2a5,0x26d,0x255,0x221)]=![],_0x52fe59=_0x2964f9;if(_0x382986[_0x28fc55(0x275,0x2d9,0x25c,0x287)](_0x39932e[_0x28fc55(0x303,0x29e,0x35b,0x2dc)])){addLog(_0x48f683(-0xa5,-0x13c,-0xf5,-0x1a1)+_0x48f683(-0xaa,-0x106,-0x97,-0x116)+_0x48f683(-0xd4,-0x1b1,-0x110,-0xc7)+_0x28fc55(0x298,0x3ea,0x341,0x3df)),_0x19eb00=_0x5e183d;const _0x4d84f2={};_0x4d84f2[_0x28fc55(0x218,0x2d8,0x22c,0x239)+'pe']='applicatio'+_0x28fc55(0x360,0x34f,0x2e2,0x36c),_0x4d84f2[_0x48f683(-0x8c,-0xc8,-0x119,-0x1d8)+_0x28fc55(0x25c,0x229,0x259,0x2a1)]=_0x28fc55(0x2e0,0x333,0x2f0,0x2fb)+_0x38c833,_0x585634=_0x4d84f2,_0x52fe59=_0x451ea5;}addLog(_0x48f683(-0x13d,-0x185,-0x13f,-0xc8)+'用酒馆代理模式');}else{_0x19eb00=_0x5e183d;const _0xc7bd46={};_0xc7bd46[_0x48f683(-0xc2,-0x3d,-0xf6,-0x89)+'pe']=_0x39932e['hYuSC'],_0xc7bd46[_0x48f683(-0xf9,-0xdc,-0x119,-0x151)+_0x48f683(-0x15a,-0xac,-0xc9,-0x103)]=_0x28fc55(0x338,0x2b6,0x2f0,0x2a4)+_0x38c833,_0x585634=_0xc7bd46,_0x52fe59=_0x451ea5,_0x39932e[_0x28fc55(0x2e3,0x292,0x2d6,0x378)](addLog,_0x48f683(-0x11f,-0x1b9,-0x13f,-0x1ae)+_0x28fc55(0x277,0x300,0x29f,0x21b));}_0x39932e[_0x48f683(-0x7a,-0x16b,-0x137,-0x15e)](addLog,'[Banana]\x20S'+'ending\x20req'+_0x28fc55(0x2c0,0x276,0x2b4,0x2d4)+_0x19eb00),_0x39932e['xZMqs'](addLog,'[Banana]\x20P'+_0x48f683(0x2,-0xf0,-0x9e,-0x106)+JSON[_0x48f683(-0x63,-0x14,-0xca,-0x4c)](_0x52fe59,null,0xe47*0x1+-0x2*-0x1f3+-0x122b));try{if(_0x39932e['OZGXu'](_0x39932e[_0x48f683(-0x56,-0x119,-0xc0,-0xa5)],_0x28fc55(0x18f,0x2b6,0x23b,0x228))){taskQueue[_0x28fc55(0x1b0,0x2fd,0x249,0x265)+'us'](_0x3d7cce,_0x39932e[_0x48f683(-0xd6,0x1c,-0x9c,-0x119)]);const _0x2b0623=await fetch(_0x19eb00,{'method':_0x28fc55(0x1d2,0x218,0x1e5,0x19a),'headers':_0x585634,'body':JSON['stringify'](_0x52fe59)});if(!_0x2b0623['ok']){const _0xaec5a4=await _0x2b0623[_0x48f683(-0x15c,-0x89,-0x114,-0x19e)]();throw new Error('API\x20reques'+_0x48f683(0x39,-0x8b,0x2,-0x7a)+'ith\x20status'+'\x20'+_0x2b0623['status']+':\x20'+_0xaec5a4);}const _0x7c3f41=await _0x2b0623[_0x28fc55(0x20b,0x306,0x27b,0x300)]();let _0x1d2b31='';const _0x43aeea=_0x7c3f41[_0x28fc55(0x248,0x249,0x2c2,0x2bb)];if(_0x43aeea&&_0x39932e[_0x28fc55(0x24c,0x1fc,0x1ef,0x292)](_0x43aeea[_0x48f683(-0x33,-0xbe,-0x2f,-0x7e)],-0x6c5*-0x5+-0x13ee+0xdeb*-0x1)){const _0x35ca3c=_0x43aeea[0x245a*-0x1+-0x555+0x29af][_0x48f683(0x35,-0x82,-0x6a,-0x115)]?.[_0x48f683(-0x60,0x55,0x17,-0xa6)];if(Array['isArray'](_0x35ca3c)){if(_0x39932e[_0x48f683(-0xe0,-0x88,-0x49,0x56)](_0x39932e['TQaJJ'],_0x39932e[_0x28fc55(0x282,0x332,0x32c,0x361)]))_0x27ce7f[_0x48f683(-0xdd,-0x1a8,-0x106,-0x10a)+'BananaList'+_0x48f683(-0x104,-0x48,-0x92,-0x83)]=!![],_0x39932e[_0x28fc55(0x261,0x274,0x287,0x326)](_0x566ab1);else for(const _0x3e8d39 of _0x35ca3c){if(_0x39932e[_0x48f683(-0x56,-0x25,-0xd6,-0x119)]!==_0x28fc55(0x3f6,0x389,0x33e,0x3e1)){const _0x47f64f=new _0x18d8b9();_0x47f64f['onloadend']=()=>_0x89f767(_0x47f64f[_0x28fc55(0x215,0x22a,0x1f1,0x218)]),_0x47f64f[_0x48f683(-0x155,-0x95,-0x9f,0xe)]=_0x6a6847,_0x47f64f['readAsData'+_0x28fc55(0x3fe,0x34d,0x365,0x373)](_0x5b5b9d);}else{if(_0x39932e[_0x28fc55(0x249,0x3c1,0x309,0x27c)](_0x3e8d39[_0x48f683(-0x8a,-0x7a,-0xfa,-0x4b)],_0x28fc55(0x36b,0x39c,0x2e9,0x265))&&_0x3e8d39[_0x28fc55(0x240,0x3a0,0x2e9,0x306)]?.[_0x28fc55(0x271,0x32b,0x2a7,0x29b)]){if(_0x39932e[_0x48f683(-0x13,-0x11,-0xb3,-0x99)](_0x39932e[_0x28fc55(0x21e,0x1eb,0x267,0x2ea)],_0x39932e['ByTnc'])){_0x1d2b31=_0x3e8d39[_0x48f683(-0xe7,0x33,-0x39,-0x40)][_0x48f683(-0xd6,-0x2e,-0x7b,-0xd8)];break;}else{_0x39932e['nimHV'](_0x25d52c,_0x39932e[_0x48f683(-0x51,0xd2,0x3b,-0x79)]);const _0x2a2fcf=_0x39932e['BNyyo'](_0x5ff5b,'默认'),_0x4ba873={};_0x4ba873[_0x48f683(-0x170,-0x168,-0x125,-0x1cc)+'on']=[],_0x4ba873[_0x48f683(-0xfa,-0xab,-0x85,-0x16)+'t']='',_0x2fef18=_0x16a203[_0x2a2fcf]||_0x4ba873,_0x155ab7(_0x48f683(-0x10d,-0x184,-0x13f,-0x10f)+'用修图预设:\x20\x22'+_0x2a2fcf+'\x22');}}}}}else{if(_0x39932e[_0x48f683(0x43,0x34,0x26,-0x17)](typeof _0x35ca3c,_0x39932e['lhELh'])){const _0x5d0323=/!\[.*?\]\((https?:\/\/[^\s\)]+)\)/,_0x45034b=_0x35ca3c[_0x48f683(-0x1b4,-0xd7,-0x12e,-0x75)](_0x5d0323);if(_0x45034b&&_0x45034b[-0x8b3+0x623*-0x1+0xed7]){_0x39932e[_0x28fc55(0x32f,0x337,0x2c9,0x315)](addLog,_0x39932e[_0x28fc55(0x24a,0x291,0x2c4,0x236)]);const _0x463ca0=_0x45034b[-0x152*-0x13+0xc*-0x3a+-0x165d];_0x39932e['nmfSG'](addLog,_0x48f683(0x7a,-0x69,-0xc,0x4)+_0x28fc55(0x277,0x235,0x241,0x187)+_0x28fc55(0x3b1,0x325,0x2f4,0x322)+_0x463ca0);try{const _0x44269b=await _0x39932e[_0x28fc55(0x289,0x138,0x1ed,0x169)](fetch,_0x463ca0);if(!_0x44269b['ok']){if(_0x39932e['GhnLB']===_0x39932e[_0x48f683(-0x127,-0x137,-0xe3,-0x39)])throw new Error('Failed\x20to\x20'+'fetch\x20imag'+_0x48f683(0x43,-0x2e,-0x46,0x18)+_0x44269b[_0x48f683(-0x79,-0x25,-0xdc,-0x84)]);else return _0x8a9cd4[_0x28fc55(0x16c,0x26a,0x216,0x1e6)]()['search'](JpYuYs[_0x28fc55(0x2e1,0x295,0x304,0x2d3)])[_0x28fc55(0x176,0x23a,0x216,0x1f4)]()[_0x48f683(-0x1a,-0x12f,-0x79,-0xfa)+'r'](_0x1b4925)[_0x48f683(0x85,0x50,-0x6,0x96)](JpYuYs['YDkNr']);}const _0x390b52=await _0x44269b['blob'](),_0x51f721=await new Promise((_0x5ab114,_0x2154c4)=>{const _0x260667=new FileReader();_0x260667[_0x3879e7(0x444,0x2eb,0x2fb,0x3ab)]=()=>_0x5ab114(_0x260667['result']);function _0x3879e7(_0x37b44a,_0x1f14d8,_0x7d1894,_0x335f56){return _0x48f683(_0x37b44a-0xb1,_0x1f14d8-0x140,_0x335f56-0x3c3,_0x37b44a);}_0x260667['onerror']=_0x2154c4;function _0x3cfcd4(_0x2bb4fa,_0xae14d5,_0x49e7b5,_0x4bc798){return _0x48f683(_0x2bb4fa-0x96,_0xae14d5-0xc,_0x49e7b5-0x4bf,_0x4bc798);}_0x260667['readAsData'+_0x3cfcd4(0x54d,0x549,0x502,0x50e)](_0x390b52);});_0x1d2b31=_0x51f721,_0x39932e[_0x48f683(-0xce,-0x43,-0xbe,-0x8f)](addLog,_0x39932e[_0x48f683(0x91,-0x67,0x8,-0x3b)]);}catch(_0x51198f){_0x39932e[_0x48f683(-0xeb,0x1d,-0x33,-0x41)](addLog,_0x48f683(-0xb1,-0x48,-0x3c,0x3a)+_0x48f683(-0x5b,-0x2e,-0xf0,-0x4f)+_0x48f683(-0x2d,0x78,0x12,-0x32)+_0x28fc55(0x2d1,0x260,0x2ac,0x354)+'\x20'+_0x51198f[_0x48f683(-0xef,-0x10f,-0x6a,-0xa2)]),_0x1d2b31=_0x463ca0,_0x39932e[_0x48f683(-0x81,-0xf4,-0xbe,-0xb1)](addLog,_0x39932e['XwTNw']);}}else addLog(_0x39932e['NVMll']);}}}if(!_0x1d2b31)throw new Error(_0x39932e['xWEFa']);return _0x39932e[_0x48f683(-0xaf,-0xbb,-0x62,-0x68)](addLog,_0x48f683(-0x131,-0x103,-0xf5,-0x183)+_0x48f683(-0x15,0x68,0x1d,-0x92)+_0x48f683(-0x136,-0xb8,-0x96,-0x102)+'ssfully.'),taskQueue[_0x28fc55(0x225,0x1c7,0x238,0x2ae)+'sk'](_0x3d7cce,!![]),currentTaskId=null,{'image':_0x1d2b31,'change':_0x39932e[_0x48f683(-0x18b,-0x7b,-0x113,-0xe7)](_0x44a7be,'')};}else{const _0x33b9aa={};_0x33b9aa[_0x48f683(-0xeb,-0x9d,-0x86,-0xff)]=_0x28fc55(0x320,0x1fd,0x272,0x212),_0x33b9aa[_0x28fc55(0x372,0x397,0x339,0x385)]=_0x148dc6,_0x43c398[_0x48f683(0xe,-0x3c,0x33,0x90)](_0x33b9aa);}}catch(_0x2e8ed1){if(_0x39932e[_0x28fc55(0x24f,0x1f0,0x1ea,0x1fc)](_0x39932e['PIlmq'],_0x39932e[_0x28fc55(0x261,0x2d3,0x28d,0x28a)])){if(_0x119a49){const _0x1020a0=_0x437003[_0x28fc55(0x394,0x2fd,0x335,0x391)](_0x58e662,arguments);return _0x15bdb1=null,_0x1020a0;}}else{_0x39932e[_0x28fc55(0x1e9,0x195,0x202,0x169)](addLog,_0x48f683(-0xee,-0x8d,-0x3c,0xf)+'etch\x20error'+':\x20'+_0x2e8ed1['message']),console[_0x28fc55(0x300,0x206,0x266,0x304)](_0x39932e[_0x48f683(-0x7c,-0xaf,-0x55,-0xb6)],_0x2e8ed1);if(_0x39932e[_0x28fc55(0x2de,0x264,0x309,0x258)](_0x2e8ed1[_0x28fc55(0x354,0x266,0x2b8,0x2f1)],_0x39932e[_0x28fc55(0x37f,0x3e5,0x346,0x384)])){}else _0x39932e['QHvUn'](_0x39932e[_0x48f683(-0x121,-0xd3,-0x107,-0xe5)],_0x39932e['aYPzi'])?taskQueue[_0x48f683(-0x4a,-0x123,-0xea,-0x197)+'sk'](_0x3d7cce,![]):_0x46e81b=_0x39932e[_0x28fc55(0x2e6,0x393,0x310,0x321)](_0x39932e[_0x28fc55(0x232,0x2c6,0x2d5,0x37d)](_0x17bdab,_0x39932e[_0x48f683(-0x3a,0x5,0x6,-0x72)]),_0x1af6c0);currentTaskId=null;throw _0x2e8ed1;}}}export async function bananaGenerate(_0x5d4973){const _0x5d9536={'YqWFc':_0x2e90ab(-0x149,-0x1f7,-0x179,-0x140)+'se\x20did\x20not'+_0x2e90ab(-0x218,-0x1a7,-0x1aa,-0x1d6)+_0x2e90ab(-0x2af,-0x258,-0x1f8,-0x1a8)+_0x2e90ab(-0x18f,-0x1de,-0x11d,-0xe2)+'t','OMauu':function(_0x17c180,_0x5ef34f){return _0x17c180+_0x5ef34f;},'WhQNh':function(_0x35481b,_0x207be8){return _0x35481b+_0x207be8;},'IAPnb':function(_0x2b2815,_0x5d443e){return _0x2b2815(_0x5d443e);},'qyNmp':_0x50646e(0x4bf,0x4e8,0x471,0x4b3),'LPlOq':function(_0x35d81b){return _0x35d81b();},'KmkTt':function(_0x6a1d41,_0x1552fe){return _0x6a1d41(_0x1552fe);},'Utxln':_0x50646e(0x469,0x55f,0x4c3,0x515),'XJHzx':function(_0x4bae3e,_0x2a8c46){return _0x4bae3e(_0x2a8c46);},'hdXwx':'GYTqv','mopqG':_0x50646e(0x450,0x408,0x475,0x49b),'wgQpi':function(_0x46a8a5,_0x5e23ef){return _0x46a8a5(_0x5e23ef);},'NDDqI':function(_0x3a80db,_0x1db72c){return _0x3a80db!=_0x1db72c;},'bljFo':function(_0x5ce464,_0x162e84){return _0x5ce464===_0x162e84;},'UmeXd':_0x2e90ab(-0x111,-0xa3,-0xec,-0x101),'zpXbu':_0x50646e(0x2e6,0x414,0x3a2,0x458),'qHVsF':function(_0x4efe9e,_0xf23441,_0x2e8089,_0x4fc2ff){return _0x4efe9e(_0xf23441,_0x2e8089,_0x4fc2ff);},'mumTI':function(_0x122efd,_0x5a8f8c){return _0x122efd(_0x5a8f8c);},'Rfghe':function(_0x284f67,_0x31cdd2){return _0x284f67(_0x31cdd2);}};_0x5d9536[_0x50646e(0x45c,0x398,0x450,0x393)](clearLog);let {id:_0x14091c,prompt:_0x71eee0,width:_0x385dfe,height:_0x25fc5a,change:_0x43eda3,retouchPrompt:_0x359393,retouchImage:_0x23f5b7}=_0x5d4973;currentRequestId=_0x14091c,currentPrompt=_0x71eee0,_0x5d9536[_0x50646e(0x2e4,0x3c3,0x36e,0x3e5)](addLog,_0x50646e(0x36e,0x376,0x38b,0x2d2)+_0x50646e(0x459,0x58a,0x4d7,0x568)+_0x50646e(0x545,0x49b,0x49a,0x54a)+_0x2e90ab(-0x270,-0x18d,-0x223,-0x1ca)+_0x50646e(0x533,0x46c,0x4bb,0x4f1)+_0x14091c+')');let _0x44663b='';_0x43eda3?_0x44663b=_0x43eda3[_0x50646e(0x429,0x49e,0x3ed,0x35e)](_0x2e90ab(-0x13e,-0x109,-0xe8,-0x80),''):_0x44663b=_0x71eee0;if(_0x43eda3&&_0x43eda3[_0x50646e(0x516,0x4cd,0x4e8,0x4a7)](_0x5d9536['Utxln'])){_0x5d9536['IAPnb'](addLog,_0x50646e(0x406,0x431,0x40d,0x36f)+'启动');if(_0x359393)_0x5d9536[_0x50646e(0x4f9,0x41c,0x4a3,0x422)](addLog,'修图指令:\x20'+_0x359393);if(_0x23f5b7)addLog(_0x2e90ab(-0x191,-0x149,-0x1c4,-0x262)+']');}function _0x50646e(_0xd7da68,_0x52a88f,_0x4e9ae5,_0x3c808c){return _0x37e4(_0x4e9ae5-0x1e6,_0xd7da68);}function _0x2e90ab(_0x5cb06f,_0x45bfad,_0x59d856,_0x1abdf7){return _0x37e4(_0x59d856- -0x3c5,_0x45bfad);}try{if(_0x5d9536[_0x50646e(0x4f5,0x531,0x470,0x475)]===_0x5d9536[_0x50646e(0x449,0x3b8,0x3cd,0x452)])throw new _0x13c272(_0x5d9536[_0x2e90ab(-0xe3,-0x1dd,-0x149,-0x189)]);else{const {image:_0x470390,change:_0x67b97f}=await _0x5d9536[_0x2e90ab(-0x55,-0xe7,-0xc7,-0x47)](generateBananaImage,{'prompt':_0x71eee0,'width':_0x385dfe,'height':_0x25fc5a,'change':_0x43eda3,'retouchPrompt':_0x359393,'retouchImage':_0x23f5b7});if(_0x5d9536[_0x2e90ab(-0x240,-0x24b,-0x206,-0x2a1)](extension_settings[extensionName]['cache'],'0')){if(_0x5d9536[_0x50646e(0x381,0x44a,0x3b2,0x355)](_0x5d9536[_0x2e90ab(-0x21a,-0x2c1,-0x20a,-0x25c)],_0x5d9536[_0x2e90ab(-0xbe,-0x113,-0xf1,-0xd3)]))_0x2aa30b[_0x50646e(0x55c,0x4a4,0x4da,0x4cc)+_0x5e36a5+_0x2e90ab(-0x25d,-0x248,-0x1d0,-0x20b)]&&(_0x70133a=_0x5d9536[_0x50646e(0x30e,0x3fb,0x384,0x423)](_0x5d9536['WhQNh'](_0x1484cf,_0x50646e(0x3e7,0x473,0x493,0x4a1)),_0x5d9536[_0x2e90ab(-0xbb,-0x55,-0xfe,-0xa1)](_0x46aedb,_0x1e2747[_0x2e90ab(-0x13e,-0x129,-0xd1,-0xcc)+_0x15a8d1+_0x50646e(0x373,0x440,0x3db,0x38a)])));else{const _0x1388c0={};_0x1388c0[_0x50646e(0x34b,0x399,0x3f1,0x362)]=_0x44663b,await _0x5d9536[_0x2e90ab(-0xa4,-0xb5,-0x106,-0xbd)](setItemImg,_0x71eee0,_0x470390,_0x1388c0),addLog('图像已存入数据库\x20f'+_0x50646e(0x532,0x442,0x4a6,0x4f2)+'\x20'+_0x71eee0);if(extension_settings[extensionName][_0x2e90ab(-0x49,-0xe1,-0xe0,-0x9e)][_0x50646e(0x4af,0x3fd,0x495,0x550)])extension_settings[extensionName][_0x50646e(0x4eb,0x502,0x4cb,0x43f)][_0x2e90ab(-0xa7,-0xa2,-0x116,-0x178)]=_0x5d9536[_0x2e90ab(-0x187,-0x276,-0x23a,-0x24f)](extension_settings[extensionName]['banana']['cishu'],0x252f+-0x170*-0x19+-0x491e),addLog('当前生图次数为\x20fo'+'r\x20prompt:\x20'+extension_settings[extensionName][_0x2e90ab(-0x177,-0x154,-0xe0,-0x144)][_0x50646e(0x3fb,0x4b1,0x495,0x43f)]);else{if(_0x5d9536[_0x2e90ab(-0x1df,-0x22f,-0x1f9,-0x1da)](_0x50646e(0x46f,0x380,0x40a,0x4ab),_0x50646e(0x3d5,0x3b2,0x40a,0x354)))extension_settings[extensionName]['banana'][_0x50646e(0x4f4,0x4be,0x495,0x472)]=0x101+0x1f98+-0x2098,_0x5d9536[_0x2e90ab(-0x11b,-0xed,-0xfe,-0x181)](addLog,_0x50646e(0x42a,0x42f,0x49b,0x540)+_0x2e90ab(-0x141,-0xe2,-0x185,-0x1ab)+extension_settings[extensionName]['banana'][_0x50646e(0x497,0x4da,0x495,0x47e)]);else{_0x20a3fe=_0x1e2031;const _0xd97f2a={};_0xd97f2a[_0x50646e(0x3a1,0x389,0x3b4,0x438)+'pe']=_0x50646e(0x407,0x3b1,0x454,0x429)+_0x50646e(0x44d,0x3cf,0x46a,0x4a9),_0xd97f2a[_0x2e90ab(-0x214,-0x221,-0x21a,-0x21a)+_0x2e90ab(-0x15a,-0x22d,-0x1ca,-0x174)]=_0x2e90ab(-0x1af,-0x17e,-0x133,-0x17f)+_0x3d2c4d,_0x43737f=_0xd97f2a,_0xfec19f=_0x289ed6,_0x19869d(_0x50646e(0x313,0x3c3,0x36b,0x3c0)+_0x50646e(0x449,0x40a,0x427,0x43e));}}}}else addLog(_0x2e90ab(-0x169,-0x275,-0x1c8,-0x274)+'库');const _0x28c099={};_0x28c099['id']=_0x14091c,_0x28c099[_0x50646e(0x53a,0x3f1,0x499,0x504)]=!![],_0x28c099[_0x2e90ab(-0x1f9,-0x287,-0x1e3,-0x127)]=_0x470390,_0x28c099[_0x2e90ab(-0x19c,-0x1de,-0x1b8,-0x243)]=_0x71eee0,_0x28c099[_0x2e90ab(-0x187,-0x1bc,-0x1ba,-0x1f8)]=_0x44663b,eventSource[_0x2e90ab(-0xca,-0x76,-0x117,-0x1af)](EventType[_0x50646e(0x568,0x505,0x4d9,0x55d)+'MAGE_RESPO'+'NSE'],_0x28c099),_0x5d9536[_0x50646e(0x47b,0x3db,0x3c4,0x3c3)](addLog,'[Banana]\x20E'+_0x2e90ab(-0x11d,-0x130,-0x1b9,-0x1c1)+'cess\x20respo'+_0x50646e(0x39c,0x46d,0x43f,0x3c5)+':\x20'+_0x14091c);}}catch(_0x3d2d35){if(_0x2e90ab(-0x124,-0x124,-0x16a,-0xda)==='odYCv'){const _0x3047c5={};_0x3047c5[_0x2e90ab(-0x1a4,-0x218,-0x17c,-0x102)]=_0x298e90;const _0x169039={};_0x169039[_0x50646e(0x34d,0x3bf,0x3b0,0x42a)]=_0x5d9536[_0x2e90ab(-0xeb,-0x203,-0x169,-0xf5)],_0x169039['image_url']=_0x3047c5,_0x1389d6['push'](_0x169039),_0x5d9536['IAPnb'](_0x2119f4,_0x2e90ab(-0x104,-0xff,-0x11b,-0x176)+'图模式：已添加待修改'+'的图片');}else{const _0x4b6529=_0x50646e(0x38c,0x41e,0x3f8,0x3b9)+'eneration\x20'+_0x50646e(0x3bb,0x3e8,0x437,0x481)+_0x50646e(0x422,0x42f,0x38c,0x402)+_0x14091c+':\x20'+_0x3d2d35[_0x2e90ab(-0x172,-0x225,-0x16b,-0x207)];_0x5d9536[_0x50646e(0x48a,0x483,0x4ad,0x539)](addLog,_0x4b6529),console['error'](_0x4b6529);const _0x176307={};_0x176307['id']=_0x14091c,_0x176307[_0x2e90ab(-0xe0,-0x12d,-0x112,-0x165)]=![],_0x176307[_0x2e90ab(-0x18e,-0x1cd,-0x1bd,-0x20e)]=_0x3d2d35[_0x2e90ab(-0x211,-0x21a,-0x16b,-0x1f0)],_0x176307[_0x50646e(0x3dd,0x447,0x3f3,0x43d)]=_0x71eee0,eventSource[_0x2e90ab(-0xdd,-0x145,-0x117,-0xa8)](EventType['GENERATE_I'+_0x50646e(0x39a,0x415,0x3a9,0x2f7)+'NSE'],_0x176307),_0x5d9536[_0x50646e(0x3d9,0x40c,0x486,0x43b)](addLog,'[Banana]\x20E'+_0x50646e(0x45d,0x4ef,0x4b7,0x561)+'lure\x20respo'+'nse\x20for\x20ID'+':\x20'+_0x14091c);}}}function handleCancelBananaTask(_0x4c2c57){const _0xe9d623={'JgLvL':'后置前','SbbAg':_0x3a457f(0x81,-0x4,0xd4,0x126),'LCFvj':function(_0x24f4ee,_0x5a177e){return _0x24f4ee(_0x5a177e);},'tGvhp':_0x26dbf0(0xaa,0x134,0x125,0x1c2),'wRoHR':_0x26dbf0(0x43,0xbd,0xc7,0x127),'gIArB':_0x26dbf0(0x7a,0x134,0x90,0x89),'waizC':_0x3a457f(0x146,0x1a6,0x16e,0x168)};function _0x26dbf0(_0x9d5e15,_0x1509d9,_0x9b2ef9,_0x59ff81){return _0x37e4(_0x9b2ef9- -0x138,_0x9d5e15);}const {taskId:_0x492cb6}=_0x4c2c57;_0xe9d623[_0x26dbf0(0x127,0x1c9,0x13d,0xc7)](addLog,_0x3a457f(0x111,0x167,0x152,0x11c)+_0x26dbf0(0x72,-0x41,0x61,0xbb)+_0x3a457f(0x1db,0x18c,0x120,0x163)+_0x492cb6+')');function _0x3a457f(_0x367eb3,_0x11903f,_0x3cda93,_0x5b71cc){return _0x37e4(_0x367eb3- -0x12b,_0x5b71cc);}if(currentTaskId===_0x492cb6&&currentRequestId){if(_0xe9d623[_0x26dbf0(0xf2,-0x6e,0x51,-0x3a)]!==_0xe9d623[_0x26dbf0(0x75,0xb8,0xf9,0x175)]){const _0x53e0e3=_0xe9d623[_0x26dbf0(0xbd,0xf6,0x16c,0xe9)][_0x3a457f(0x196,0x243,0x189,0x235)]('|');let _0x226b8b=-0x547+0x3dd*-0x7+-0xac6*-0x3;while(!![]){switch(_0x53e0e3[_0x226b8b++]){case'0':currentPrompt=null;continue;case'1':const _0x591f60={};_0x591f60['id']=currentRequestId,_0x591f60[_0x26dbf0(0xfe,0x121,0x17b,0x15d)]=![],_0x591f60[_0x3a457f(0xdd,0x98,0x185,0xf7)]=_0xe9d623[_0x3a457f(0x110,0xcb,0x1a2,0x84)],_0x591f60[_0x3a457f(0xe2,0x15d,0x144,0x159)]=currentPrompt||'',eventSource['emit'](EventType[_0x26dbf0(0x186,0x275,0x1bb,0x155)+_0x26dbf0(0xfb,-0x33,0x8b,0x22)+_0x3a457f(0xe5,0x138,0x121,0xa9)],_0x591f60);continue;case'2':currentTaskId=null;continue;case'3':currentRequestId=null;continue;case'4':_0xe9d623[_0x26dbf0(0x7c,0x11c,0x13d,0x1b9)](addLog,_0x3a457f(0x99,-0x13,0xd,0x158)+'消当前任务，发送失败'+_0x26dbf0(0x100,0x223,0x1b1,0x1eb)+currentRequestId+')');continue;}break;}}else{_0x2adb19=_0x3a457f(0x147,0x1ae,0x17a,0x1b8)+_0x26dbf0(0xf9,0x1b3,0x14d,0x16d)+_0x49ae37;const _0x4a69b8={};_0x4a69b8[_0x3a457f(0x114,0xe9,0x1bd,0xe3)+'t']='';const _0x445dd8=_0x296cc9[_0x474882]||_0x4a69b8,_0x374f2f=[_0x445dd8[_0x26dbf0(0x181,0xd8,0x107,0x109)+'t'],_0x3549dc[_0x26dbf0(0x211,0x121,0x156,0x177)],_0x5f3ea5[_0x3a457f(0x96,0x10b,-0x16,0x59)],_0x5f17e1,_0x5170dd[_0xe9d623[_0x26dbf0(0xfc,0xb0,0xe7,0x8d)]],_0x408914[_0xe9d623[_0x3a457f(0x7e,0xe2,0x78,0xd7)]],_0x445dd8[_0x3a457f(0x84,0xc4,0x117,0xce)+_0x3a457f(0x125,0x1c5,0xd6,0x1ad)],_0x1895d5['最后置']][_0x26dbf0(0x1e0,0x16a,0x17e,0x149)](_0x304e2a)['join'](',\x20');_0xe9d623[_0x3a457f(0x14a,0xa5,0x1f8,0xf2)](_0x5c80cc,_0x26dbf0(0x6a,0x5a,0x76,0x2)+_0x374f2f);const _0x4c02f9={};_0x4c02f9[_0x3a457f(0xe2,0x171,0xf2,0x12a)]=_0x374f2f;const _0x4acfbe={};_0x4acfbe['sampleCoun'+'t']=0x1,_0x4acfbe[_0x3a457f(0x15c,0x9b,0x210,0x184)+'o']=_0x48d035;const _0x206c21={};_0x206c21['instances']=[_0x4c02f9],_0x206c21[_0x3a457f(0x76,0x4a,0x3b,0x10d)]=_0x4acfbe,_0x18f195=_0x206c21,_0xe9d623[_0x3a457f(0x14a,0x167,0x168,0xc7)](_0x2c7091,_0x26dbf0(0xc3,0x16b,0x13e,0x1ca)+_0x3a457f(0x8f,0xf,0x126,0x92)+_0x3a457f(0x141,0xb0,0x124,0x16b)+_0x26dbf0(0x129,0x175,0x105,0xb2)+_0x26dbf0(0xf,0xaa,0x8f,0xc9)+_0x374f2f);}}}function initializeBananaListener(){function _0x2bf99e(_0x18fe3d,_0x45f504,_0x526b30,_0x1136e3){return _0x37e4(_0x45f504- -0x372,_0x18fe3d);}const _0x474a37={'XpQEU':_0x420d18(0x4a3,0x556,0x55e,0x4aa)+_0x420d18(0x5c3,0x5b0,0x54d,0x4b7)+_0x420d18(0x602,0x564,0x57d,0x4cc),'wAtrw':function(_0x4de120,_0x459e75){return _0x4de120(_0x459e75);},'zhjtG':'banana\x20生图事'+_0x2bf99e(-0xe0,-0xde,-0xf2,-0x70)};eventSource['on'](EventType[_0x2bf99e(-0xeb,-0x7f,-0x52,-0xd8)+'MAGE_REQUE'+'ST'],bananaGenerate);function _0x420d18(_0x59e3f6,_0x56e4e6,_0x12c30b,_0x3dcc6b){return _0x37e4(_0x12c30b-0x38d,_0x56e4e6);}eventSource['on'](_0x474a37['XpQEU'],handleCancelBananaTask),_0x474a37[_0x420d18(0x52f,0x55b,0x5ab,0x4ed)](addLog,_0x474a37['zhjtG']);}export async function replaceWithBanana(){function _0x2183c8(_0xe0544c,_0x3c0762,_0x4e6548,_0x1d1b40){return _0x37e4(_0x4e6548-0x1e0,_0xe0544c);}const _0x12fd78={'Egmmo':function(_0x193808,_0x2a919a){return _0x193808==_0x2a919a;},'evCrM':_0x2183c8(0x496,0x558,0x4c5,0x4b3),'YrmaI':function(_0x2c627b){return _0x2c627b();},'ciwAo':_0x91fc8f(0x61,-0x87,0x11,-0x19),'kaHwe':_0x2183c8(0x37c,0x39d,0x3b1,0x44b)+_0x2183c8(0x449,0x41f,0x3a0,0x34c)+_0x91fc8f(-0x6,0xf8,0x65,0x116),'rjICz':_0x2183c8(0x35e,0x343,0x3b5,0x416)+'图事件监听器已关闭。'};function _0x91fc8f(_0x5323f2,_0x320870,_0x5ad19d,_0x2c6de8){return _0x37e4(_0x5ad19d- -0x18b,_0x5323f2);}if(_0x12fd78[_0x91fc8f(0x169,0x5a,0xab,0xbd)](extension_settings[extensionName]['mode'],_0x12fd78['evCrM']))!window[_0x2183c8(0x33d,0x41c,0x39e,0x421)+_0x2183c8(0x37c,0x3ab,0x434,0x3df)+_0x91fc8f(0x10e,0x53,0xa7,0x3a)]&&(window[_0x91fc8f(0x2b,0xd9,0x33,-0x54)+_0x2183c8(0x391,0x4e5,0x434,0x440)+_0x91fc8f(0x140,0xd,0xa7,0x7f)]=!![],_0x12fd78['YrmaI'](initializeBananaListener)),initializeImageProcessing();else{if(window['initialize'+'BananaList'+_0x2183c8(0x385,0x4c9,0x412,0x438)]){const _0x3a6e27=_0x12fd78['ciwAo'][_0x2183c8(0x49e,0x480,0x4a1,0x437)]('|');let _0x1bfea8=-0x1b19+0x980*0x2+0x819;while(!![]){switch(_0x3a6e27[_0x1bfea8++]){case'0':LEGACY_EVENT_NAMES[_0x2183c8(0x381,0x3ff,0x392,0x372)](_0x18fa79=>{function _0x3d1d64(_0x52ffbe,_0x2de70a,_0x41cff7,_0x420209){return _0x2183c8(_0x2de70a,_0x2de70a-0xb5,_0x41cff7- -0x5bc,_0x420209-0x9a);}function _0x15d8e3(_0x336a95,_0x3e11d1,_0x58d3e9,_0x2385c8){return _0x2183c8(_0x3e11d1,_0x3e11d1-0x143,_0x336a95- -0x4c9,_0x2385c8-0x13a);}eventSource[_0x3d1d64(-0x108,-0x97,-0xe4,-0xac)+_0x3d1d64(-0x24f,-0x23d,-0x1aa,-0x250)](_0x18fa79,bananaGenerate);});continue;case'1':window[_0x2183c8(0x3ec,0x303,0x39e,0x367)+_0x91fc8f(0x107,0x74,0xc9,0x75)+_0x2183c8(0x3d3,0x3dc,0x412,0x3da)]=![];continue;case'2':eventSource[_0x91fc8f(0x16a,0xac,0x16d,0x17f)+_0x2183c8(0x3c8,0x486,0x412,0x3bb)](_0x12fd78[_0x91fc8f(0xc8,0xf0,0x15b,0xfb)],handleCancelBananaTask);continue;case'3':addLog(_0x12fd78[_0x2183c8(0x3a3,0x419,0x3bb,0x403)]);continue;case'4':eventSource['removeList'+_0x91fc8f(0x5e,0x106,0xa7,0xca)](EventType[_0x91fc8f(0x11c,0xb2,0x168,0x1e6)+_0x91fc8f(-0x36,0xb8,0x2a,-0x26)+'ST'],bananaGenerate);continue;}break;}}}}