(function(_0x59e780,_0x14e15e){function _0x4ca701(_0x9fcf47,_0xcfd3e4,_0x183eae,_0x3027a0){return _0x37c4(_0x9fcf47-0x121,_0x3027a0);}const _0x75b3ad=_0x59e780();function _0x480c6f(_0x3b7b0d,_0x102e68,_0x25e4b0,_0x1a4d33){return _0x37c4(_0x102e68-0x385,_0x3b7b0d);}while(!![]){try{const _0x33b22c=parseInt(_0x4ca701(0x32d,0x301,0x39e,0x275))/(0x4de+0x1e9c+-0x2379)*(-parseInt(_0x480c6f(0x787,0x6d6,0x730,0x681))/(-0x4a*0x27+-0xd25*-0x1+0x9*-0x35))+parseInt(_0x480c6f(0x664,0x6ea,0x759,0x63e))/(0x20f7+-0xa*0xb6+-0x19d8)+-parseInt(_0x480c6f(0x6c2,0x6f1,0x668,0x64c))/(-0x5d*0x13+0x61*0xf+0x1*0x13c)+parseInt(_0x4ca701(0x36d,0x319,0x375,0x2f0))/(0x1fb5*-0x1+-0x9*0x18b+0x2d9d)*(-parseInt(_0x4ca701(0x394,0x436,0x342,0x359))/(0x3e8+0x2f*0x1e+0x4b2*-0x2))+-parseInt(_0x4ca701(0x3cb,0x413,0x38a,0x35b))/(-0x1dd6+0x518+0x18c5)+-parseInt(_0x480c6f(0x4d1,0x582,0x50d,0x572))/(0x1*-0x220f+0x6*0x63f+-0x121*0x3)+-parseInt(_0x4ca701(0x3f6,0x3cb,0x3c7,0x473))/(0xc0d+-0x97*-0x1f+-0x1e4d)*(-parseInt(_0x480c6f(0x587,0x5cb,0x512,0x68d))/(-0x15c3+0xdc8+-0x1*-0x805));if(_0x33b22c===_0x14e15e)break;else _0x75b3ad['push'](_0x75b3ad['shift']());}catch(_0x421c19){_0x75b3ad['push'](_0x75b3ad['shift']());}}}(_0xd7d4,0x2*0x6c5fb+-0x1b*-0x42bd+-0xce461));const _0x2b5840=(function(){const _0x5db8e1={'Omgcm':function(_0x58e33d,_0x1f580e){return _0x58e33d(_0x1f580e);},'zrTht':function(_0x166d7b,_0x242b8d){return _0x166d7b===_0x242b8d;},'BCQEo':_0x27766b(0x478,0x4de,0x447,0x46e),'NYrpW':function(_0x4b98fd,_0x1aa014){return _0x4b98fd||_0x1aa014;},'usnav':_0x5d2def(-0x1ce,-0x10b,-0x177,-0x159)};function _0x5d2def(_0x4248f9,_0x4e2a7f,_0x29ee87,_0x4dfe4a){return _0x37c4(_0x4248f9- -0x3d0,_0x4e2a7f);}let _0x5ae8a5=!![];function _0x27766b(_0x27d941,_0x5a1b11,_0x397aac,_0x446ca2){return _0x37c4(_0x27d941-0x192,_0x446ca2);}return function(_0x376ddf,_0x3f6599){function _0x551b53(_0x18e17d,_0x10225e,_0x4d4f46,_0x334c77){return _0x27766b(_0x10225e- -0x250,_0x10225e-0xd6,_0x4d4f46-0x14e,_0x4d4f46);}function _0x324382(_0xb1aaab,_0x11f8cb,_0x30b44f,_0x37024d){return _0x27766b(_0xb1aaab-0xbe,_0x11f8cb-0x1ba,_0x30b44f-0xca,_0x30b44f);}if(_0x5db8e1[_0x551b53(0x27e,0x29d,0x2f5,0x1dc)](_0x5db8e1['usnav'],_0x5db8e1['usnav'])){const _0x111e40=_0x5ae8a5?function(){function _0x51df0d(_0x471d8d,_0x3a1ecf,_0x3c2c04,_0x3d3988){return _0x551b53(_0x471d8d-0x1a4,_0x471d8d- -0xd5,_0x3a1ecf,_0x3d3988-0x1d7);}if(_0x3f6599){const _0x145f0e=_0x3f6599[_0x51df0d(0xb2,0x56,0x120,-0x5)](_0x376ddf,arguments);return _0x3f6599=null,_0x145f0e;}}:function(){};return _0x5ae8a5=![],_0x111e40;}else{const {taskId:_0xa0757b}=_0x55afa1;_0x5db8e1[_0x551b53(0x126,0x1d4,0x23a,0x15d)](_0x2b93b0,_0x551b53(0xaa,0x11f,0x13a,0x1ab)+_0x324382(0x514,0x4b7,0x445,0x46d)+_0x551b53(0x1ca,0x15e,0x224,0x1c5)+_0xa0757b+')');if(_0x5db8e1[_0x551b53(0x1d6,0x29d,0x36b,0x293)](_0x3a89e7,_0xa0757b)&&_0x20783e){const _0x37f6a6=_0x5db8e1[_0x324382(0x4e5,0x471,0x4ad,0x50c)][_0x551b53(0x2b4,0x23b,0x1b4,0x228)]('|');let _0x3b7b59=0x1d56+-0x1*-0x1d54+-0x3aaa;while(!![]){switch(_0x37f6a6[_0x3b7b59++]){case'0':_0x161f5f=null;continue;case'1':_0x1a0fb9['emit'](_0x464acb[_0x551b53(0xfa,0x146,0x217,0x20e)+_0x551b53(0x1f9,0x1d8,0x1ca,0x15e)+_0x551b53(0x1ad,0x149,0x149,0x1f5)],{'id':_0x4ea0bf,'success':![],'error':_0x551b53(0x1e4,0x22c,0x273,0x26c),'prompt':_0x5db8e1[_0x551b53(0x2b7,0x20c,0x172,0x154)](_0xace1fe,'')});continue;case'2':_0x46b30f=null;continue;case'3':_0x403bcc=null;continue;case'4':_0x5db8e1['Omgcm'](_0x423d29,_0x324382(0x481,0x4f1,0x4d7,0x54b)+'消当前任务，发送失败'+'响应\x20(ID:\x20'+_0x22eb78+')');continue;}break;}}}};}()),_0x375dc8=_0x2b5840(this,function(){const _0x5873fa={};_0x5873fa['IkEgR']=_0x2ed412(0x1df,0x299,0x200,0x303)+'+$';const _0x3c0511=_0x5873fa;function _0x2a7496(_0x458ea5,_0x260a09,_0x237c0e,_0xac5127){return _0x37c4(_0xac5127- -0x26,_0x260a09);}function _0x2ed412(_0x5f00fa,_0x3a0f16,_0x2738e7,_0x2ad7d2){return _0x37c4(_0x3a0f16-0x72,_0x2738e7);}return _0x375dc8[_0x2ed412(0x2a1,0x280,0x21c,0x2c7)]()[_0x2a7496(0x300,0x294,0x361,0x2b5)](_0x3c0511['IkEgR'])[_0x2a7496(0x19b,0x2bb,0x21a,0x1e8)]()['constructo'+'r'](_0x375dc8)['search'](_0x3c0511[_0x2ed412(0x385,0x2ca,0x26c,0x333)]);});_0x375dc8();import{extension_settings}from'../../../../extensions.js';import{eventSource}from'../../../../../script.js';import{extensionName,EventType}from'./config.js';import{sleep,generateRandomSeed,zhengmian,fumian,getRequestHeaders,prompt_replace,addLog,clearLog,parsePromptStringWithCoordinates,prompt_replace_for_character,stripChineseAnnotations,convertImageToJpeg}from'./utils.js';import{initializeImageProcessing}from'./iframe.js';import{processCharacterPrompt}from'./characterprompt.js';import{setItemImg}from'./database.js';function _0xd7d4(){const _0x30b79f=['twvNsuy','l3yXl2nOyxqVyW','zNLYzwW','ntiXnJrry05LDNy','y2XPzw50','Aw9UoIaIqMvHCG','qwzPuK0','BwL0DgvKihn1yW','twfYA2rVD24U','CNf3vxG','rNDpBeG','w0jHBMfUyv0Gra','sLjfCwi','DgLVBIb3AxrOia','wvLWtei','EwzZwgS','zML4zwrqCM9TCa','AurTuxq','wufHDve','rLvQzfy','DcbMywLSzwqGDW','rhLVteW','Dg9mB3DLCKnHCW','DhjSA3e','wunJC0q','Ahj3zxO','rfnczwu','w0jHBMfUyv0G5Ps2','C2nJu0G','y2vZCYbYzxnWBW','DhD1sue','w0jHBMfUyv0GuG','ztOG','AM9PBG','55sO5lQo55sF5OIq55QevgfNoIa','Defcu1G','w0jHBMfUyv0Gua','v3vtrhu','zxrPB25FC291CG','Aw5ZDgfUy2vZ','w0jHBMfUyv0Gsq','wNnWCKm','zgvSCY8','l3yX','ywLSzwqGDg8GzG','55sO5lQgihVKV67LM759ioAGH+IVHG','y2HHDf9JB21WBa','rfHKuw0','ywXMrvq','rwfkBgS','5zon5BQuicHjrdOG','5RAi5B2t5yMn5lU75yQH77Ym5y+r6ycb5AsX6lsL','rhfrrg8','5zU+5QIH5BYp77YA5OYh5lUKid0G','tfjAD04','CeTou2G','ywXSyMfJAY4','Ee9RAuO','q2HHCMfJDgvYia','nZG4mtqWoffMAeXerG','uKXYB1C','B3vUzcbTyxrJAa','C3rYAw5N','w0jHBMfUyv0GrG','A2HUDwi','yujNDMm','r0vorvjbvevFsq','mc4WlJaUmcbtyq','BwfNzw4G5QIH5z6l5lIn5PsV','tLnf','DhjPBq','yxLSB2fKoIa','ugrUzuW','ieLeia','mtb2r3nbEgy','y3vZDg9Tx3vYBa','Dg9tDhjPBMC','ruXHuuq','v2LUnJq7ihG2na','wgLdr0G','wMrHyM8','y3vZDg9Tx2LUyW','B21WBgv0Aw9UCW','Aw1Hz2u','w0jHBMfUyv0G5l2/','uKzNrMy','sNnuB1q','s0DJwKe','EungB0m','BwvZC2fNzq','yxnRsuq6ia','sxLgz2S','DwLSDcbTDwX0Aq','EuvQsNy','zwrKzwqGyMfZzq','5l+U5zU+5zU+54MhoIbB5BEY5O+q5l6B','shj6vue','BhvYzsbYzxnWBW','rhPzqu0','DgLVBIbYzxf1zq','svrXzuS','kcGOlISPkYKRkq','Aw5NihrYAwDNzq','nJqGAw1Hz2uU','Cg9ZDgzPEfbYBW','DhLWzq','zxiG','qw1pENO','5OYb6yws6AAg5lUJ55cg77Ym5yIh5O2I5lI655U0','v1ryA3C','BwHesve','w0jHBMfUyv0G5y+w','v1jfB1a','Bw9KzwW6ia','Eu9WyxK','BwfNzsbNzw5LCG','B3DUigLTywDLoG','qMfUyw5H5l+U5zU+5QIH5BYp','Dwn4vhG','CKn0rMi','ywn0zxjqCMvZzq','wg1cBKK','rg1pywe','w0jHBMfUyv0GrW','EvfUA1G','kI8Q','wvzUAuW','w0jHBMfUyv0G5zcV','wxnLrvu','C3nMDwXSEs4','ueHUExm','yxbWBhK','mZbKrfL3Ce0','yxjRzg93BIbPBq','CMvWBgfJzufSBa','zgTZCvK','s2L0lZuZnY4ZnG','Aw5JBhvKzxm','ndCWtxLQvfvY','CMvTB3zLtgLZDa','ALfju2e','BI9QC29U','DfzpqNy','B2fKihDPDgGG','vunJthy','y29UDMvYC2f0Aq','yw5Hx3rHC2S','DvzbBNa','DfzQAxy','zxrJAcbLCNjVCG','swTfz1i','z0fmrhC','Evntwwq','BfnAv20','DMrxEhi','ExD2ywK','ihWG','ie5uideWlJa7ia','Dgv4Da','CevcD0i','r1PXrhm','qvbjihjLCxvLCW','yMfZzty0lG','zMv0y2GGAw1HzW','zxrLy3rLzcbnyq','y3vZDg9T','u3vyvw8','BvPWrwK','zNPRDwG','CKD1z04','5zU+5QIH5BYp77YA5BEY5RE75yQG5B6f5l+U5Ps5','qMfUyw5HtgLZDa','zcbIyxnLnJqGAq','zxjYB3i','tfLOvgy','BMrZl2nOyxqTyW','zM9YrwfJAa','nteZotzwEuHqC08','Bu1LBuS','Aw1Hz2vFDxjS','ywDLigDLBMvYyq','DwLSDcbjBwfNzq','u2nLBMuGq29TCa','Bw9Kzq','w0jHBMfUyv0G5l+U','sgzqzxi','C3vJy2vZCW','qxv0Ag9YAxPHDa','D1rMvMO','CNv1vKy','s1jvBMm','A0L1A3K','DxnLCG','yxnWzwn0uMf0Aq','CKLnAMW','EsbLEhrYywn0zq','Dhj1zq','ue9tva','yxbWBgLJyxrPBW','B1jSyum','tfD0rhy','Dvr0CgW','55sO55U05O6L6k+35Rgc5QIH5BYp','Aw9U','B25LCNjVCG','C2LUzYbKAxjLyW','BIbWyxLSB2fKia','AurrAe4','t21Ny20','zgf0ytPPBwfNzq','BhvKzv9OzwfKzq','qKnrrw8','tufhrv9srvnqtW','5O6L6k+35Rgc','tufhrv9srvfvrq','yMfUyw5HioEuN+wBVUs6IW','ig1LC3nHz2vZlG','vxnLCI1bz2vUDa','ifbYB21WDa','yxrLzcbZDwnJzq','z3DOqMS','AxnbCNjHEq','zw5LCG','AefRAee','zevxAeC','y0fyAxq','wuvwz0y','wunJD2K','uePos2K','5l+U5zU+5OYh5lUKoIa','y1f4tLu','CMvWBgfJzq','mtu2mdm2m2TorMLssW','wxvVDgq','z0jArfe','vvjm','C2fTCgXLq291BG','BwfNzsbPBIbpCa','rvHMthm','5yMn572U5yMn','D2L0AcbWCM9TCa','C3rHCNrZv2L0Aa','zxrJAcbnyxjRza','CIbWCM9TChq6ia','BLnJt1u','CMjWsuW','y2v4ru4','ywrKvgfZAW','ienOCM9Tzs8XmG','CIaI','venPqvG','Ag9Yqxi','uvnKy2C','Bw9KzwW','qKDXAuu','y29UDgvUDa','q1f6yvi','qKfoqu5b','5yIW5y+w5RAi5lU75yQH5lQl5lU2icHu','BwL0DgvKigzHAq','z2uGvvjmlcbLEa','BgvUz3rO','wfnrDuq','AwTLieDLy2TVkq','tLLYCfC','BNnLigzVCIbjra','DxbKyxrLu3rHDa','BeP4wvq','tNbHyw4','qu1Jyvq','y2fUy2vSx2jHBG','l2fWAs9IywnRzq','Avblzfi','l2DLBMvYyxrL','DgXmCKO','nJG3mde1mhLqEvjiBa','icHlsfrntcWGBa','AMD2CLe','wNvXthq','55Qe5zU+54Mh','Avj5BLG','C2vHCMnO','EKTIz3i','ywDLifvstdOG','z3LHB2C','C2v0ici','5B2t5yMn55sF5zU+5QYH5PwW5lI6igzV','uKrpuLC','CMTKB3DUigLTyq','CMTKB3DUigvTyG','u211B1a','Aw1Hz2vdB25MAq','nhWXFdn8mhWY','EePmqxK','q1b1zeS','C2fuC3y','5lU75yQH5BEY5y+w5RAi','AeHcAuK','zwnLAxzLzcbPBq','tM15sLO','CM9Szq','CLfnv1e','sxnxEw0','ksbbChbSzvDLyG','swfOq20','s2PHAwS','BwvZC2fNzxm','rev3wfu','DwvZDcb0BZOG','l3yXlW','C2uGzgLKig5VDa','C3bSAxq','t1PVz3a','qNrxA1i','igLTywDLihrVia','zMLSDgvY','ChrXs0S','DLHuB0u','D0rkBKS','CfPfEKK','zw5KAw5NihjLCq','w0jHBMfUyv0Grq','zMXHDa','sxrNCem','kerPDMLKzv9YBW','wefMEhu','zw1PDa','C3rYAw5NAwz5','BNrHAw5ZihrLEa','uhzZteu','vhbqAfO','z1LtwNe','q1PHB04','57Yt5A2y6k6+572U5lI65lIn5A2y5ywL5PwW5O2U','yMfUyw5H','y2HVAwnLCW','igLTywDLlG','Bw9KywWGCgf5Ba','BwfNzsbMCM9Tia','Aw5PDgLHBgL6zq','5BYa5AEliejHBMfUyEEuNW','y29UDMvYDfrVsG','ChjVBxb0','C3rFy2HHDhu4xW','l3yXyMv0ys9TBW','5Q2J6z2I5O+q56s66k+noIa','y2HHBMDL','5zU+5lQl5lU255Ur5zcS5zMO5BEY5ywZ6zET44cc','zg1HuuO','zgrHChq','y2LZAhu','rwrPA2i','DhjHy3rPBMCUlG','6k+35Rgc5Bc65A+4oIdLRR3LUQyGlq','ChvZAa','CgvNu3rVCMfNzq','CgfYyw1LDgvYCW','ENjWuwG','t3zrvge','y29TCgXLDgvuyq','z093BMe','ignVBNrHAw4GAq','C3rHDhvZ','BfrYDfm','C2XjEvG','vMf5Avi','55sO6yws6AAg5lUJ55cg5QIH5BYp','5lU255Ur5zcS5zMO5BEY5yID5AEl5yYw44cc','y2fJAgu','C3rYzwfT','Dg9Rzw4','AxrOihn0yxr1CW','B3nPDgLVBG','v3PnCvy','zMfYAs81mZCUmW','E+s/RUwBVN0','wuLhEvi','v290zMu','Bwf0y2G','q29UDgvUDc1uEq','sMLeDgC','mxW0Fdn8mNWW','Bxb0','ENflzuy','5Qch5yEg5QIH5BYpoIdKVB/NLkJOR7FMSyi','mNWXFdr8mhWZ','vMD1t0y','DfDcEMW','55sO5l+U5zU+6Ake6k6+oIaI','yMDPr1i','DvjMA0S','qMvHCMvYia','zw5KC1DPDgG','uKnRAvy','zfnMC1u','B09zv0q','lcdPQ5JLUQyGlsa','tLziB0C','DcbvuKWGyxmGzG','mZiXmZHUANbRv3G','w0jHBMfUyv0Gvq','yujPAve','zxnWB25ZzsbJBW','rKvYAM8','5zco572U5zco','w0jHBMfUyv0GqG','DgfYDgLUzYbPBq','DxjS','AML1z3vHBG','ENjuAhq','vM15t0W','vfPOAum','Eg5eu2m','ALPkwxm','CfbxyMi','yxnZAxn0yw50','5PIV5zcM5zcV55sO5yIg6kEs6iMY5QIH5BYpia','DwnJzxnZzNvSBa','q3PywM0','mtiWmZq5ogXnCgnesa','w0jHBMfUyv0GuW','CuvUyM4','Aw1Hz2vjza'];_0xd7d4=function(){return _0x30b79f;};return _0xd7d4();}import{getConfigImage}from'./configDatabase.js';import{taskQueue,TaskType,TaskStatus}from'./taskQueue.js';function getDirectHeaders(_0x39585e=null,_0x3dcda5=null){const _0x17bee2={};_0x17bee2[_0x587da6(0x56d,0x517,0x581,0x4c2)]=_0x4aa0a5(0x538,0x4d0,0x587,0x442),_0x17bee2[_0x4aa0a5(0x606,0x5ed,0x5c9,0x576)]=_0x587da6(0x68d,0x646,0x715,0x69d)+'pe';const _0x25b877=_0x17bee2,_0x5c37a8={};_0x5c37a8[_0x587da6(0x5eb,0x5f4,0x593,0x55c)]='Mozilla/5.'+'0\x20(Windows'+_0x587da6(0x5af,0x52b,0x58a,0x5af)+_0x4aa0a5(0x4d2,0x4a1,0x51f,0x431)+_0x587da6(0x641,0x63f,0x624,0x6e5)+_0x4aa0a5(0x441,0x4db,0x44b,0x56b)+_0x4aa0a5(0x60f,0x567,0x507,0x593)+_0x587da6(0x619,0x620,0x656,0x690)+_0x4aa0a5(0x562,0x54b,0x5f3,0x4ba)+_0x4aa0a5(0x42f,0x496,0x54d,0x464)+_0x587da6(0x688,0x72d,0x687,0x61c)+'6';function _0x587da6(_0x34c8e2,_0x3f6d2c,_0x2b9fac,_0x1e2a4e){return _0x37c4(_0x34c8e2-0x350,_0x1e2a4e);}_0x5c37a8['Accept']=_0x25b877[_0x4aa0a5(0x48a,0x4ae,0x50d,0x563)];const _0x5ecea3=_0x5c37a8;_0x39585e&&(_0x5ecea3[_0x25b877[_0x4aa0a5(0x554,0x5ed,0x5bc,0x65e)]]=_0x39585e);function _0x4aa0a5(_0x5315c7,_0x209e45,_0x1adb4d,_0x48cfed){return _0x37c4(_0x209e45-0x291,_0x5315c7);}return _0x3dcda5&&(_0x5ecea3[_0x4aa0a5(0x584,0x50e,0x541,0x464)+_0x4aa0a5(0x590,0x51e,0x575,0x52c)]=_0x3dcda5),_0x5ecea3;}let currentTaskId=null,currentRequestId=null,currentPrompt=null;async function getImageFromTurnData(_0x3350d2){function _0x2d05b3(_0x3bc668,_0x2ae8cd,_0x3bd4ce,_0x17c5fb){return _0x37c4(_0x2ae8cd- -0x38,_0x17c5fb);}const _0x1f52ee={};_0x1f52ee[_0x1224c4(-0xe,0x8a,0x70,0x63)]=function(_0x8d1156,_0x4f45a7){return _0x8d1156!==_0x4f45a7;},_0x1f52ee[_0x1224c4(0xef,0x23,0xc7,0x1d)]=_0x2d05b3(0x1b9,0x223,0x29e,0x270),_0x1f52ee[_0x1224c4(0x26c,0x155,0x194,0x198)]=function(_0x25ab9d,_0x1e4eca){return _0x25ab9d||_0x1e4eca;},_0x1f52ee[_0x1224c4(0x22b,0x132,0x1fd,0x182)]=_0x1224c4(0x14,0x2,0x167,0xb8);const _0x40ca39=_0x1f52ee;if(!_0x3350d2)return'';function _0x1224c4(_0x56b210,_0x109f77,_0x387731,_0x5dac00){return _0x37c4(_0x5dac00- -0x1db,_0x56b210);}if(_0x3350d2[_0x1224c4(0x17e,0x1fd,0x160,0x18d)]&&_0x3350d2[_0x2d05b3(0x34c,0x330,0x2d4,0x344)][_0x2d05b3(0x280,0x27b,0x20b,0x258)]('cfgimg_')){if(_0x40ca39[_0x2d05b3(0x1b9,0x206,0x25b,0x241)](_0x40ca39[_0x1224c4(-0x31,-0xb4,0xa4,0x1d)],_0x40ca39[_0x1224c4(0x44,0x6d,0xd6,0x1d)])){const _0x1e1b77={};_0x1e1b77[_0x2d05b3(0x2a2,0x21b,0x16b,0x157)+'on']=[],_0x1e1b77[_0x1224c4(0x148,0x106,0xfb,0x19e)+'t']='',_0x20121a=_0x390ab8[_0xec7af3]||_0x1e1b77;}else{const _0x2966bb=await getConfigImage(_0x3350d2[_0x1224c4(0xc9,0xc9,0x17b,0x18d)]);return _0x40ca39[_0x1224c4(0x19a,0x1a7,0x1d2,0x198)](_0x2966bb,'');}}if(_0x3350d2[_0x1224c4(-0x53,-0x18,0x7,0x3a)]&&_0x3350d2['image']['startsWith'](_0x40ca39[_0x2d05b3(0x381,0x325,0x3aa,0x29f)]))return _0x3350d2[_0x1224c4(0x104,0x17,0x1b,0x3a)];return'';}async function generateBananaImage({prompt:_0x43f933,width:_0x277cb8,height:_0x41b831,change:_0x555e51,retouchPrompt:_0x5cdcf5,retouchImage:_0x475414}){function _0x592b73(_0x5ff68a,_0xc6fb04,_0x58e99c,_0x15820c){return _0x37c4(_0x58e99c- -0x187,_0x15820c);}const _0x13dd0b={'pZEzI':function(_0x2e79c1,_0x1cdde3){return _0x2e79c1(_0x1cdde3);},'ELaQD':_0xe7e266(0x5f1,0x608,0x6b1,0x5fc)+'中的\x20prompt。','uTtpl':function(_0x51ac06,_0x7524ed){return _0x51ac06(_0x7524ed);},'EAZbG':_0xe7e266(0x4ae,0x4a7,0x3db,0x50c)+_0xe7e266(0x6a0,0x61a,0x6b3,0x57f)+_0xe7e266(0x646,0x5d0,0x5ea,0x5a6)+'t\x20only,\x20no'+_0x592b73(0x154,0x250,0x18b,0x1d2),'PdneL':function(_0x2f9104,_0x4046fb){return _0x2f9104+_0x4046fb;},'JEcRw':function(_0x42ad50,_0x1535d0){return _0x42ad50+_0x1535d0;},'gyaog':'\x20|\x20','jZJYs':_0xe7e266(0x496,0x53b,0x57d,0x565),'JsToT':_0xe7e266(0x41e,0x4b3,0x3ef,0x52d),'rbpIL':function(_0x186876,_0x4f7f3b){return _0x186876(_0x4f7f3b);},'zqKeF':_0xe7e266(0x49c,0x52d,0x5ca,0x5c3),'YAauQ':'imagen','RCkiV':function(_0x3c6021,_0x19033c){return _0x3c6021(_0x19033c);},'Npaan':_0xe7e266(0x4ec,0x54e,0x517,0x48a)+'n/json','wTfVj':function(_0x45070d,_0x3b22bf){return _0x45070d(_0x3b22bf);},'bgiGR':_0x592b73(0x208,0x11a,0x192,0x1f1)+_0xe7e266(0x634,0x596,0x521,0x613)+_0xe7e266(0x4df,0x51a,0x51e,0x541),'rqwUx':function(_0x56f0c1,_0x7a99fd){return _0x56f0c1(_0x7a99fd);},'DXdQm':_0xe7e266(0x460,0x526,0x487,0x457),'qEnbn':function(_0x9c2e39,_0x433ea3){return _0x9c2e39+_0x433ea3;},'lrUlQ':function(_0x30b8ea,_0x48de8c){return _0x30b8ea+_0x48de8c;},'ZuqLt':function(_0x309879,_0x34ab9f,_0x510385){return _0x309879(_0x34ab9f,_0x510385);},'XiCGH':_0xe7e266(0x553,0x618,0x572,0x68e)+_0x592b73(0xc3,0x158,0x108,0xdd)+_0x592b73(0x174,0x278,0x1c9,0x256)+_0x592b73(0xd6,0xc5,0x73,-0x52),'NaOzU':function(_0x31ce98){return _0x31ce98();},'IsWym':function(_0x362f61,_0x5e1f61){return _0x362f61>_0x5e1f61;},'pspZt':'...','DqQDo':function(_0x19e244,_0x25ce9e){return _0x19e244(_0x25ce9e);},'HfPer':function(_0x291b08,_0x3a28a7){return _0x291b08(_0x3a28a7);},'dEWhG':function(_0xe7076a,_0x218272){return _0xe7076a(_0x218272);},'RLroW':function(_0x569ee4,_0x2b93e4){return _0x569ee4||_0x2b93e4;},'XSQuD':function(_0x1e09cd,_0x276b89){return _0x1e09cd!==_0x276b89;},'oatbZ':function(_0x1b280b,_0x33e4cb){return _0x1b280b(_0x33e4cb);},'iPKdR':_0x592b73(0x52,0x12b,0xf1,0xc0)+_0xe7e266(0x698,0x5fc,0x58f,0x611),'kIuky':function(_0x211b72,_0x28afbd){return _0x211b72(_0x28afbd);},'slIyX':_0x592b73(0x186,0x114,0xe3,0xfe),'YwAJi':'分角色模式:\x20解析带'+'坐标的提示词字符串。','gALDw':function(_0x22c443,_0x465608){return _0x22c443<=_0x465608;},'tABSX':_0x592b73(0x152,0x63,0xcf,0x41),'LgRUY':_0x592b73(0x6,0x8f,0x9d,0xb6),'yOpay':function(_0x25fae8,_0x48cedd){return _0x25fae8+_0x48cedd;},'Yuotd':_0x592b73(0x158,0xd4,0x1a1,0x14a),'IahCm':_0x592b73(0x222,0x16f,0x1a8,0x128),'tlLrJ':'zxSOd','zKbgr':_0x592b73(0xed,0xb1,0x11d,0x14a),'JREqb':function(_0x44930c,_0x4de7e3){return _0x44930c!==_0x4de7e3;},'yEjJv':_0xe7e266(0x434,0x4a4,0x446,0x566),'gYSZq':function(_0x4c68d1,_0x35b549){return _0x4c68d1+_0x35b549;},'BGqiE':function(_0x3b38d4,_0x2df943){return _0x3b38d4(_0x2df943);},'Kjaik':_0xe7e266(0x62a,0x577,0x5f9,0x553),'aBgvc':'前置后','WuSDu':'后置前','OZogp':_0x592b73(0x1ac,0x1fc,0x1cf,0x262),'gOwna':'最后置','Vrrod':_0x592b73(0x1c6,0x143,0x1e3,0x19c)+_0x592b73(0xbe,0x3f,0x8d,-0x21),'vdWxr':_0x592b73(0xa,0xeb,0xba,0x112)+_0xe7e266(0x474,0x4b5,0x4d9,0x47c)+'。','uRfkK':'FUjdV','yCFoC':function(_0x2ec500,_0x1dd350){return _0x2ec500(_0x1dd350);},'MegIF':function(_0x3ae6a2,_0x1cfefa){return _0x3ae6a2(_0x1cfefa);},'CQzaR':function(_0x12333c,_0x54324e){return _0x12333c(_0x54324e);},'gwhBk':_0xe7e266(0x57c,0x5ff,0x5bf,0x54a),'YCcsD':function(_0x50a56,_0x3da4c9){return _0x50a56===_0x3da4c9;},'MtSfA':'TCiAX','yfsXk':_0xe7e266(0x4c0,0x4ec,0x553,0x5aa),'uVAnp':function(_0x446d80,_0x441a3e){return _0x446d80(_0x441a3e);},'mhDIQ':function(_0x47eaa8,_0x1607f0){return _0x47eaa8===_0x1607f0;},'SmuoP':_0xe7e266(0x65f,0x5d1,0x593,0x657),'Edikb':_0xe7e266(0x4be,0x572,0x59a,0x633),'PHnys':function(_0x1925c4,_0x124c2c){return _0x1925c4>_0x124c2c;},'iDQhN':'user','rQMWQ':function(_0x578446,_0x1e4aa7){return _0x578446(_0x1e4aa7);},'fyrel':'/v1/','trlkq':_0xe7e266(0x6d7,0x60b,0x551,0x58f),'pKNSh':function(_0x7093cb,_0x24115b){return _0x7093cb+_0x24115b;},'alfET':function(_0x5bc685,_0x1599fe){return _0x5bc685===_0x1599fe;},'XWgRz':_0xe7e266(0x5c0,0x620,0x5e2,0x62d),'DSBee':function(_0x5eb2f2,_0x1e3f6c){return _0x5eb2f2(_0x1e3f6c);},'saTsv':_0x592b73(0x170,0x26,0xdb,0x52),'pPWbb':function(_0x217681,_0x221312){return _0x217681(_0x221312);},'ucxTx':_0x592b73(0x1d,0x6,0x9b,0x51),'WTXkw':function(_0x334aec,_0x1ec676){return _0x334aec(_0x1ec676);},'xnDSc':function(_0x1d3772,_0x3cafac){return _0x1d3772(_0x3cafac);},'bxSmV':'running','ZsprC':function(_0x2783b9,_0x3f8d3e,_0x2dcf36){return _0x2783b9(_0x3f8d3e,_0x2dcf36);},'dksqY':_0xe7e266(0x504,0x54d,0x4d1,0x5cb),'YYpLB':function(_0xb50a66,_0x1ddcff){return _0xb50a66===_0x1ddcff;},'VvUds':_0xe7e266(0x4d0,0x4c6,0x41f,0x592),'IIDtw':_0xe7e266(0x5cb,0x559,0x567,0x564)+'/','lTrtS':_0xe7e266(0x57c,0x5b3,0x535,0x618),'NVHoG':_0xe7e266(0x61d,0x62c,0x57d,0x6aa)+_0xe7e266(0x63b,0x629,0x679,0x5e5)+_0xe7e266(0x542,0x54b,0x595,0x58d)+_0xe7e266(0x542,0x534,0x5c9,0x52c)+_0x592b73(0xc3,0xf3,0x18d,0x205)+_0xe7e266(0x633,0x637,0x6f8,0x589),'oOYWD':'Zdabo','twuIA':_0xe7e266(0x5a6,0x63a,0x5ab,0x67e)+_0xe7e266(0x534,0x52c,0x5d0,0x5d6)+_0x592b73(0x10f,0xcb,0x15b,0xac)+_0x592b73(0x115,0x118,0x13f,0x1ce)+_0xe7e266(0x6b5,0x5e8,0x6a4,0x5ec)+'.','hrwez':_0xe7e266(0x542,0x506,0x492,0x46c),'WzMqV':function(_0x29a116){return _0x29a116();},'ruuVF':function(_0x26e0a3,_0x238a7b){return _0x26e0a3===_0x238a7b;},'xJLAy':_0xe7e266(0x4e9,0x54c,0x5b4,0x590),'PFyDN':function(_0x540a65,_0x1958c2){return _0x540a65===_0x1958c2;},'horAr':'QPSqh','nScOU':'API\x20respon'+_0xe7e266(0x65e,0x5be,0x5ff,0x509)+_0x592b73(0x19e,0x222,0x1a4,0x1d1)+_0x592b73(0x107,0x1cb,0x128,0xf2)+'enAI\x20forma'+'t','XmBnI':function(_0x14ad44,_0x3b06ff){return _0x14ad44(_0x3b06ff);},'jQISa':'[Banana]\x20I'+_0x592b73(0x9e,0x1f,0xae,0x139)+_0x592b73(0x114,0x178,0x116,0x177)+_0x592b73(0x19,0xc7,0xbc,0x17e),'EaJlk':_0xe7e266(0x509,0x595,0x5e8,0x5fa),'ywvai':_0xe7e266(0x588,0x502,0x596,0x57a),'WREoP':_0xe7e266(0x546,0x609,0x5bc,0x64f)};_0x13dd0b['NaOzU'](clearLog);const _0x2962fa=taskQueue[_0xe7e266(0x562,0x57f,0x5a9,0x591)]({'name':_0x13dd0b[_0x592b73(0x119,0x7,0x83,0x153)]((_0x43f933||'')['substring'](-0x1377+-0x5*0x2a5+-0x10*-0x20b,0x1588+-0x257b+0x55b*0x3),_0x43f933&&_0x13dd0b[_0x592b73(0xca,0x10e,0x169,0x1ea)](_0x43f933['length'],-0x1*-0x136a+-0x1358+0xc)?_0x13dd0b['pspZt']:''),'type':TaskType[_0xe7e266(0x58e,0x589,0x566,0x5fd)],'prompt':_0x43f933});currentTaskId=_0x2962fa,_0x43f933=_0x13dd0b['DqQDo'](processCharacterPrompt,_0x43f933),_0x43f933=await _0x13dd0b[_0x592b73(0x210,0x163,0x17a,0xc4)](stripChineseAnnotations,_0x43f933);let _0x1422a3=_0x555e51;_0x555e51=_0x13dd0b['HfPer'](processCharacterPrompt,_0x555e51),_0x555e51=await _0x13dd0b[_0xe7e266(0x684,0x638,0x64f,0x57a)](stripChineseAnnotations,_0x555e51),_0x13dd0b[_0xe7e266(0x615,0x568,0x4db,0x57d)](addLog,_0xe7e266(0x685,0x5dc,0x696,0x684)+'图流程。客户端为'+extension_settings[extensionName][_0xe7e266(0x577,0x633,0x668,0x5d2)]),_0x13dd0b['rqwUx'](addLog,_0xe7e266(0x6ac,0x5e9,0x676,0x648)+'\x20'+_0x13dd0b[_0xe7e266(0x426,0x4c4,0x58b,0x4ef)](_0x277cb8,'默认')+_0x592b73(0x1bf,0x25e,0x1c7,0x1d6)+_0x13dd0b[_0xe7e266(0x42d,0x4c4,0x4b6,0x590)](_0x41b831,'默认')),_0x43f933=_0x555e51&&_0x13dd0b[_0x592b73(0x153,0x1d6,0x141,0x143)](_0x555e51[_0xe7e266(0x4bb,0x4ce,0x4fc,0x4fd)](),'')?_0x555e51:_0x43f933,_0x13dd0b['oatbZ'](addLog,_0xe7e266(0x483,0x4aa,0x54c,0x54c)+_0x43f933);let _0x4c81c=![];_0x43f933['includes'](_0x13dd0b[_0xe7e266(0x530,0x598,0x4c5,0x658)])&&(_0x4c81c=!![]);_0x13dd0b[_0x592b73(0x1cd,0x16e,0xfa,0xdc)](addLog,_0x592b73(0x1e1,0x223,0x1db,0x224)+_0xe7e266(0x65c,0x5cc,0x645,0x667)+'les):\x20'+_0x4c81c);let _0x2d5ea9={},_0x42acb5='',_0x15b546='';if(_0x4c81c){if(_0x13dd0b[_0xe7e266(0x4cf,0x58e,0x4ec,0x614)](_0x13dd0b[_0x592b73(0x1a4,0x177,0x1a7,0xf5)],_0x592b73(0xe5,0x24b,0x177,0xf5))){addLog(_0x13dd0b['YwAJi']),_0x2d5ea9=_0x13dd0b[_0xe7e266(0x4c3,0x541,0x563,0x4ea)](parsePromptStringWithCoordinates,_0x43f933),_0x42acb5=_0x2d5ea9[_0xe7e266(0x504,0x53e,0x604,0x492)+_0xe7e266(0x5e9,0x5fc,0x5fd,0x61e)];for(let _0x31e8d9=-0x26*0xbf+-0x1a65+-0x36c0*-0x1;_0x13dd0b[_0xe7e266(0x4af,0x51f,0x48f,0x458)](_0x31e8d9,0x1*-0x24e6+-0x4*0x256+0x2e42);_0x31e8d9++){_0x13dd0b[_0x592b73(0xc,0x22,0x5e,0xba)]!==_0x13dd0b['LgRUY']?_0x2d5ea9[_0xe7e266(0x41d,0x4c2,0x4cc,0x3fc)+_0x31e8d9+_0x592b73(0x6d,0x1a6,0x115,0x1d6)]&&(_0x15b546=_0x13dd0b[_0xe7e266(0x5ca,0x4fa,0x464,0x5a8)](_0x13dd0b[_0xe7e266(0x5d8,0x62d,0x569,0x6f0)](_0x15b546,',\x20'),_0x2d5ea9['Character\x20'+_0x31e8d9+_0x592b73(0xc6,0x1b4,0x115,0x102)])):_0x2383a7[_0x592b73(0x225,0x271,0x1a2,0x253)+'sk'](_0x45fe37,![]);}}else _0x13dd0b['pZEzI'](_0x53250f,_0x13dd0b[_0x592b73(0xfb,0x132,0x88,-0x47)]),_0x32c7eb=_0x529615;}else{if(_0x13dd0b[_0xe7e266(0x534,0x571,0x63f,0x4fc)]!==_0x13dd0b[_0xe7e266(0x56b,0x5b8,0x65a,0x510)])addLog(_0x13dd0b[_0xe7e266(0x42a,0x4d5,0x4ce,0x45f)]),_0x42acb5=_0x43f933;else{_0x2d29b2(_0x592b73(-0x51,0x7d,0x63,0x3d)+_0xe7e266(0x4ca,0x4cc,0x582,0x516)+_0xe7e266(0x524,0x4f4,0x587,0x486)+_0xe7e266(0x4ee,0x55d,0x4ef,0x501)),_0x1229af=_0x53cbec;const _0x4f2332={};_0x4f2332['Content-Ty'+'pe']='applicatio'+_0x592b73(0x8b,0x11f,0xc8,0x14f),_0x4f2332['Authorizat'+_0x592b73(0x19f,0x181,0x106,0x55)]=_0x592b73(0x1f4,0x1dd,0x1c2,0x221)+_0x3007a3,_0x4b3b1f=_0x4f2332,_0x4b5cd6=_0x5f0916;}}let {modifiedPrompt:_0x3be375,insertions:_0x530db9}=await _0x13dd0b[_0x592b73(0x17c,0x132,0x151,0x103)](prompt_replace,_0x42acb5,_0x15b546);if(_0x4c81c)for(let _0x1101a4=-0x2*0x525+0xe32*0x1+-0x9*0x6f;_0x13dd0b['gALDw'](_0x1101a4,0x69a+-0x265b+0x1*0x1fc5);_0x1101a4++){_0x13dd0b[_0x592b73(0x202,0x148,0x14d,0x101)]===_0x13dd0b[_0x592b73(0x1d4,0xb4,0x155,0x194)]?_0x25e8fb=_0x530c5a:_0x2d5ea9[_0xe7e266(0x510,0x4c2,0x43b,0x522)+_0x1101a4+_0x592b73(0x1ae,0x136,0x115,0x44)]&&(_0x13dd0b[_0x592b73(0x1b0,0x258,0x1ee,0x162)](_0x592b73(0xe,0x43,0x57,0xb8),_0x13dd0b[_0x592b73(0x45,0x103,0x98,0xf6)])?_0x13dd0b['uTtpl'](_0x219e28,_0x13dd0b['EAZbG']):_0x3be375=_0x13dd0b[_0x592b73(0xb7,0x243,0x186,0x1e6)](_0x3be375+_0x13dd0b[_0xe7e266(0x531,0x5a4,0x616,0x60d)],_0x13dd0b[_0xe7e266(0x562,0x586,0x60e,0x523)](prompt_replace_for_character,_0x2d5ea9[_0xe7e266(0x547,0x4c2,0x479,0x55d)+_0x1101a4+_0x592b73(0x1c4,0x185,0x115,0x94)])));}const _0x329a38=extension_settings[extensionName][_0x592b73(0x146,0xef,0x189,0xbf)],{model:_0x121d36,apiUrl:_0x16a8b0,apiKey:_0x4e2d5a,conversationPresets:_0x13e22f,conversationPresetId:_0x46a4c1,editPresetId:_0x1f7e2b,aspectRatio:_0x4bdd2c}=_0x329a38;_0x13dd0b[_0x592b73(0x1c5,0x1c7,0x104,0xe6)](addLog,_0x592b73(0x248,0x12d,0x1df,0x112)+_0xe7e266(0x564,0x61e,0x588,0x689)+_0xe7e266(0x515,0x53c,0x51c,0x5ca)+_0xe7e266(0x5e3,0x63c,0x638,0x58c)+_0x592b73(0x14e,0xf8,0xac,0x10)+_0x121d36);let _0x346c7f,_0x2a90ea;if(_0x121d36[_0xe7e266(0x5d4,0x579,0x55c,0x519)](_0x13dd0b[_0xe7e266(0x667,0x641,0x6ee,0x63b)])){_0x346c7f=_0x592b73(0x1f7,0x206,0x193,0x1fe)+_0x592b73(-0x3d,0xfe,0x65,-0x4)+_0x121d36;const _0x3bd13e={};_0x3bd13e['fixedPromp'+'t']='';const _0x28a102=_0x13e22f[_0x46a4c1]||_0x3bd13e,_0x37978a=[_0x28a102[_0x592b73(0x17f,0x135,0x1f2,0x1b2)+'t'],_0x530db9[_0x13dd0b[_0xe7e266(0x648,0x5b9,0x5d8,0x5da)]],_0x530db9[_0x13dd0b[_0x592b73(-0x28,0x42,0x7c,0x94)]],_0x3be375,_0x530db9[_0x13dd0b[_0xe7e266(0x56f,0x4ad,0x424,0x438)]],_0x530db9[_0x13dd0b[_0xe7e266(0x623,0x5c0,0x5b6,0x650)]],_0x28a102[_0x592b73(-0x27,0x8,0xa3,0x12b)+'mpt'],_0x530db9[_0x13dd0b[_0xe7e266(0x5b0,0x5f0,0x699,0x597)]]][_0x592b73(0x234,0x11d,0x176,0x20b)](Boolean)[_0xe7e266(0x571,0x4a9,0x469,0x3d7)](',\x20');_0x13dd0b[_0xe7e266(0x544,0x551,0x588,0x4a3)](addLog,'正面提示词:\x20'+_0x37978a);const _0x576861={};_0x576861[_0xe7e266(0x5ce,0x5de,0x529,0x5b5)]=_0x37978a;const _0x12dfc4={};_0x12dfc4[_0xe7e266(0x52f,0x574,0x4bd,0x4d2)+'t']=0x1,_0x12dfc4['aspectRati'+'o']=_0x4bdd2c;const _0x8ec73b={};_0x8ec73b[_0xe7e266(0x552,0x4af,0x4f0,0x461)]=[_0x576861],_0x8ec73b[_0xe7e266(0x61e,0x5ec,0x5e2,0x680)]=_0x12dfc4,_0x2a90ea=_0x8ec73b,addLog(_0xe7e266(0x5f5,0x61d,0x693,0x5e6)+_0xe7e266(0x5ea,0x53d,0x570,0x563)+_0x592b73(0x180,0x1cf,0x109,0x52)+_0x592b73(0x74,0x8c,0x12b,0x15c)+'t:\x20'+_0x37978a);}else{_0x346c7f=_0x13dd0b['Vrrod'];let _0x18bfb9;if(_0x555e51[_0x592b73(0x151,0x18c,0xc4,0x5e)](_0xe7e266(0x68e,0x5ff,0x675,0x6aa))){_0x13dd0b['wTfVj'](addLog,_0x13dd0b[_0x592b73(0x8f,0x18d,0xd5,0x5e)]);const _0x53f7cb=_0x1f7e2b||'默认',_0x2b221={};_0x2b221['conversati'+'on']=[],_0x2b221[_0xe7e266(0x57b,0x63f,0x6cf,0x704)+'t']='',_0x18bfb9=_0x13e22f[_0x53f7cb]||_0x2b221,addLog(_0xe7e266(0x4a3,0x4dc,0x4d1,0x533)+_0x592b73(0x216,0xf3,0x1bf,0x26a)+_0x53f7cb+'\x22');}else{if(_0x13dd0b[_0xe7e266(0x567,0x60e,0x624,0x5ea)]===_0xe7e266(0x6a0,0x642,0x617,0x667)){const _0x5d0d36={};_0x5d0d36['conversati'+'on']=[],_0x5d0d36[_0xe7e266(0x69d,0x63f,0x64b,0x694)+'t']='',_0x18bfb9=_0x13e22f[_0x46a4c1]||_0x5d0d36;}else _0x3fcfc7=_0x13dd0b['PdneL'](_0x13dd0b['JEcRw'](_0x4d060e,_0x13dd0b[_0xe7e266(0x4e6,0x5a4,0x56e,0x5e3)]),_0x16d92a(_0x3f02f3['Character\x20'+_0x23a44f+'\x20Prompt']));}const _0x196df6=[_0x18bfb9[_0x592b73(0x207,0x154,0x1f2,0x146)+'t'],_0x530db9[_0x13dd0b['Kjaik']],_0x530db9[_0x13dd0b[_0xe7e266(0x529,0x4c9,0x4a8,0x4a2)]],_0x3be375,_0x530db9[_0x13dd0b[_0x592b73(-0x5a,0xab,0x60,0x98)]],_0x530db9['后置后'],_0x18bfb9[_0x592b73(0x30,0xff,0xa3,0x4d)+'mpt'],_0x530db9[_0x13dd0b[_0xe7e266(0x69f,0x5f0,0x5e0,0x598)]]][_0x592b73(0x1c9,0x10b,0x176,0x175)](Boolean)[_0x592b73(0xc5,-0x1d,0x5c,0x3)](',\x20');_0x13dd0b[_0xe7e266(0x4c6,0x4e0,0x52a,0x4e2)](addLog,_0x592b73(0x1a0,0x14c,0x194,0x232)+_0x196df6);const _0x53fcf7={};_0x53fcf7['role']='user',_0x53fcf7['content']=[];const _0x369ce7={};_0x369ce7[_0x592b73(0x186,0x1ac,0x167,0x22c)]=_0x592b73(0x24b,0x1cb,0x1da,0x1c7),_0x369ce7[_0x592b73(0xa0,0xff,0x13a,0x1a5)]=[];const _0xf3edcd=_0x18bfb9['conversati'+'on']['map'](_0x8c11d=>[_0x53fcf7,_0x369ce7])[_0x592b73(0xaf,0x16e,0x17d,0x10f)]();let _0x22f19c=0xc28+-0x1*0xd09+0x4b*0x3;for(const _0x309e84 of _0x18bfb9[_0x592b73(0x39,0xdb,0xcc,0x19c)+'on']){if(_0x309e84[_0xe7e266(0x5ef,0x548,0x4e9,0x53f)]?.[_0x592b73(0x121,0x92,0xd9,0xf8)])_0xf3edcd[_0x22f19c][_0xe7e266(0x4ef,0x587,0x589,0x5b0)]['push']({'type':_0x13dd0b[_0xe7e266(0x403,0x4b7,0x41d,0x3f7)],'text':_0x309e84[_0x592b73(0x17a,0xb3,0xfb,0x51)][_0x592b73(0x97,0x30,0xd9,0xc9)]});const _0x51c034=await _0x13dd0b[_0xe7e266(0x5cc,0x62f,0x626,0x5d5)](getImageFromTurnData,_0x309e84[_0xe7e266(0x576,0x548,0x53a,0x4e0)]);if(_0x51c034)_0xf3edcd[_0x22f19c][_0x592b73(0x153,0x1b0,0x13a,0x1a1)][_0xe7e266(0x629,0x5ea,0x543,0x528)]({'type':_0x13dd0b['jZJYs'],'image_url':{'url':_0x51c034}});_0x22f19c++;if(_0x309e84[_0x592b73(0x1fc,0xbe,0x138,0xb4)]?.[_0x592b73(0x60,0x184,0xd9,0x63)])_0xf3edcd[_0x22f19c][_0x592b73(0x1a7,0x11e,0x13a,0xc5)][_0x592b73(0x234,0xf3,0x19d,0x166)]({'type':_0x13dd0b[_0xe7e266(0x4b3,0x4b7,0x574,0x443)],'text':_0x309e84[_0x592b73(0x1d7,0xb8,0x138,0xe7)]['text']});const _0x8c161a=await _0x13dd0b[_0xe7e266(0x503,0x588,0x549,0x50b)](getImageFromTurnData,_0x309e84[_0xe7e266(0x575,0x585,0x5d8,0x645)]);if(_0x8c161a)_0xf3edcd[_0x22f19c][_0x592b73(0xbb,0x137,0x13a,0xa4)]['push']({'type':_0x13dd0b[_0x592b73(0x20d,0x1cf,0x1d8,0x167)],'image_url':{'url':_0x8c161a}});_0x22f19c++;}if(!_0x555e51['includes'](_0x13dd0b[_0x592b73(0xca,0x10c,0x117,0x119)])){if(_0x13dd0b['YCcsD'](_0x13dd0b['MtSfA'],_0xe7e266(0x613,0x582,0x59a,0x600))){const _0x4ec2ce=extension_settings[extensionName]['bananaChar'+_0xe7e266(0x475,0x500,0x553,0x5cc)+'ts']||{};for(const _0x5fd659 in _0x4ec2ce){const _0x3d6d03=_0x4ec2ce[_0x5fd659],_0x527feb=(_0x3d6d03['triggers']||'')[_0xe7e266(0x520,0x5bf,0x552,0x55e)]('|')[_0xe7e266(0x51f,0x5c3,0x5d4,0x5eb)](_0x4a48dc=>_0x4a48dc[_0xe7e266(0x426,0x4ce,0x4d3,0x48f)]()!=='');for(const _0x5b128a of _0x527feb){if(_0x13dd0b[_0xe7e266(0x42d,0x4a0,0x440,0x460)](_0xe7e266(0x4b0,0x4ec,0x59c,0x43f),_0x13dd0b[_0x592b73(0x211,0x205,0x1f1,0x1fd)])){if(_0x196df6[_0x592b73(0xc6,0xc1,0x51,0x8c)+'e']()[_0x592b73(0x14f,0x37,0xc4,0x18c)](_0x5b128a['toLowerCas'+'e']())){_0x13dd0b[_0xe7e266(0x49f,0x51b,0x5ed,0x52b)](addLog,_0x592b73(0x33,0x121,0x7a,0x2d)+_0xe7e266(0x4cd,0x4c5,0x4da,0x583)+_0x592b73(0x7f,0x49,0xa1,0xe4)+_0xe7e266(0x5e3,0x581,0x626,0x4ef)+_0x5b128a+('\x22\x20from\x20pre'+_0xe7e266(0x548,0x5a5,0x673,0x672))+_0x5fd659+'\x22.');const _0xdbff3a=_0x3d6d03[_0xe7e266(0x45c,0x519,0x44d,0x467)+'on'];if(_0xdbff3a){if(_0x13dd0b[_0x592b73(0x13d,-0xe,0xa9,0x86)](_0x13dd0b[_0xe7e266(0x571,0x5aa,0x565,0x5c9)],_0x13dd0b[_0xe7e266(0x657,0x5e7,0x6a9,0x535)])){const _0x3bd9db={};_0x3bd9db[_0xe7e266(0x5f1,0x61f,0x681,0x55f)]=_0x1cb8dd;const _0x203343={};_0x203343[_0x592b73(0x89,0x73,0xa4,0x11a)]=_0x13dd0b['jZJYs'],_0x203343['image_url']=_0x3bd9db,_0x40394b[_0xe7e266(0x575,0x5ea,0x647,0x605)](_0x203343),_0x3577fb('[Banana]\x20修'+_0x592b73(0xb4,0x143,0xe5,0xb5)+_0xe7e266(0x50d,0x59f,0x5eb,0x533));}else{const _0x48249c=[];if(_0xdbff3a[_0x592b73(0x84,0x1b7,0xfb,0x1b3)]&&_0xdbff3a[_0xe7e266(0x54c,0x548,0x5f4,0x508)][_0x592b73(0x170,0xc8,0xd9,0x16b)])_0x48249c['push']({'type':_0x13dd0b['DXdQm'],'text':_0xdbff3a[_0xe7e266(0x51b,0x548,0x490,0x600)][_0xe7e266(0x538,0x526,0x4b6,0x5af)]});const _0x554585=await getImageFromTurnData(_0xdbff3a[_0x592b73(0xbf,0x1c8,0xfb,0x103)]);if(_0x554585)_0x48249c[_0xe7e266(0x5dd,0x5ea,0x686,0x692)]({'type':'image_url','image_url':{'url':_0x554585}});if(_0x13dd0b[_0x592b73(0x115,0xf1,0xbd,0x95)](_0x48249c['length'],-0x1*0x20ab+0x6*-0x3e9+0x3821*0x1)){const _0x4fbdc5={};_0x4fbdc5[_0xe7e266(0x51b,0x5b4,0x593,0x5f6)]=_0x592b73(0x1a1,0x9b,0xfb,0xc4),_0x4fbdc5[_0xe7e266(0x53a,0x587,0x59f,0x551)]=_0x48249c,_0xf3edcd['push'](_0x4fbdc5);}const _0x1d055a=[];if(_0xdbff3a[_0xe7e266(0x4ec,0x585,0x5cd,0x515)]&&_0xdbff3a['model'][_0x592b73(0x1a4,0x13e,0xd9,0x7c)])_0x1d055a[_0x592b73(0x1a4,0xca,0x19d,0xff)]({'type':_0x13dd0b[_0xe7e266(0x4c7,0x4b7,0x48b,0x4c2)],'text':_0xdbff3a['model'][_0x592b73(0x48,0xa2,0xd9,0x198)]});const _0xfb147e=await _0x13dd0b['DqQDo'](getImageFromTurnData,_0xdbff3a[_0x592b73(0x84,0xb8,0x138,0x118)]);if(_0xfb147e)_0x1d055a[_0xe7e266(0x655,0x5ea,0x6b8,0x5df)]({'type':_0x592b73(0xbb,0x98,0xee,0x24),'image_url':{'url':_0xfb147e}});if(_0x1d055a[_0xe7e266(0x628,0x58d,0x518,0x513)]>0x2004+-0xcaa+0x9ad*-0x2){const _0x5b4ff5={};_0x5b4ff5[_0x592b73(0xe9,0xbc,0x167,0x1cd)]='assistant',_0x5b4ff5[_0xe7e266(0x5d3,0x587,0x4c2,0x506)]=_0x1d055a,_0xf3edcd[_0xe7e266(0x5cd,0x5ea,0x5d5,0x553)](_0x5b4ff5);}}}break;}}else{let _0x1de146=_0x313c3b;!_0x1de146[_0x592b73(0x17a,0x128,0x1c3,0x1b2)](_0x13dd0b['JsToT'])&&!_0x1de146[_0x592b73(0x5b,0x118,0xc4,0x149)](_0x592b73(0xb9,0x20f,0x170,0x1f0))&&(_0x1de146=_0x1de146+_0x592b73(-0x3c,0x25,0x66,0xde));_0x1de146=_0x1de146[_0x592b73(0x17b,0xdd,0x122,0x1d4)](/\/v1\/$/,_0x13dd0b[_0x592b73(0x42,0xeb,0x91,0x18)]),_0x477671=_0xe7e266(0x520,0x597,0x5de,0x657)+'nds/chat-c'+_0x592b73(0x24,-0xc,0x8d,-0x39)+'/generate',_0x3a9980=_0x13dd0b[_0x592b73(0x8c,0x180,0x130,0x1d6)](_0x3d5d8e,_0x1b1cef[_0xe7e266(0x55d,0x5fa,0x543,0x630)]);const _0x4bb276={};_0x4bb276[_0x592b73(0x3e,0x6b,0x69,0xea)+_0xe7e266(0x46a,0x4ae,0x571,0x473)+'ce']=_0x13dd0b[_0x592b73(0x20e,0x1d5,0x1ba,0x1b7)],_0x4bb276[_0xe7e266(0x4b0,0x4d3,0x417,0x57a)]=_0x1de146,_0x4bb276[_0x592b73(0xa5,0x65,0x8c,0x120)+'lude_heade'+'rs']='Authorizat'+'ion:\x20\x22Bear'+_0xe7e266(0x502,0x4f2,0x44f,0x58b)+_0x4c9152+'\x22',_0x4bb276[_0x592b73(0x181,0x14c,0x138,0x1ab)]=_0x14126c,_0x4bb276[_0x592b73(0xa7,0x1f8,0x16d,0x18b)]=_0x3dfd42[_0x592b73(0xad,0x213,0x16d,0x234)],_0x4bb276[_0xe7e266(0x688,0x5f9,0x63e,0x5c9)]=![],_0x41dfbe=_0x4bb276;if(_0x43722f['startsWith'](_0x13dd0b[_0x592b73(0x1c3,0x150,0x1f4,0x180)])){_0x13dd0b[_0x592b73(0x200,0x263,0x1c4,0x1d6)](_0x54e6b8,'[Banana]\x20I'+_0xe7e266(0x54a,0x4cc,0x47d,0x4a3)+_0xe7e266(0x4cf,0x4f4,0x46a,0x4a2)+_0x592b73(0xf1,0xe7,0x110,0x1dd)),_0x530cd6=_0x28b0cf;const _0x174611={};_0x174611[_0x592b73(0x161,0x1c1,0x1b6,0x141)+'pe']=_0x13dd0b['Npaan'],_0x174611['Authorizat'+_0xe7e266(0x55f,0x553,0x610,0x5ba)]=_0xe7e266(0x5aa,0x60f,0x58f,0x6c2)+_0x5e3052,_0x4d6114=_0x174611,_0xf87e0a=_0x59c0b9;}_0x13dd0b[_0x592b73(0x1a2,0x157,0xf7,0x110)](_0x1e8a7c,'[Banana]\x20使'+_0xe7e266(0x6ab,0x5f6,0x552,0x56c));}}}}else _0x3c9c9f['on'](_0x44c430['GENERATE_I'+_0xe7e266(0x5b8,0x55e,0x549,0x5f1)+'ST'],_0x21fa74),_0x5bd0f2['on'](_0x13dd0b[_0x592b73(0x1f2,0x148,0x1c0,0x286)],_0x3df97d),_0x426aa0(_0x592b73(0x16b,0xce,0x112,0x7c)+_0xe7e266(0x647,0x5f7,0x637,0x63d));}if(!_0x555e51[_0x592b73(0xda,0xd0,0xc4,0x18f)](_0x592b73(0xfc,0x1e6,0x1b2,0x1cd))){const _0x53e294={};_0x53e294[_0x592b73(0x19a,0x222,0x167,0x131)]=_0x13dd0b[_0x592b73(0x75,0x129,0x10a,0x19f)],_0x53e294['content']=[{'type':_0x13dd0b[_0xe7e266(0x544,0x4b7,0x4aa,0x498)],'text':_0x196df6}],_0xf3edcd[_0xe7e266(0x580,0x5ea,0x55a,0x651)](_0x53e294);}else{const _0x3d6092=[],_0x185db4=_0x5cdcf5||_0x196df6,_0x567329=[_0x18bfb9['fixedPromp'+'t'],_0x185db4,_0x18bfb9[_0x592b73(0x151,-0x2f,0xa3,0xb9)+_0xe7e266(0x541,0x606,0x53b,0x5d3)]][_0x592b73(0x12c,0x10c,0x176,0xe8)](Boolean)['join'](',\x20'),_0x227e88={};_0x227e88[_0x592b73(0x59,0x4f,0xa4,0x48)]=_0x13dd0b[_0x592b73(-0x25,-0x29,0x6a,0x12f)],_0x227e88[_0xe7e266(0x4b9,0x526,0x54d,0x457)]=_0x567329,_0x3d6092[_0xe7e266(0x571,0x5ea,0x5b9,0x676)](_0x227e88);if(_0x475414){const _0x3361bb={};_0x3361bb[_0x592b73(0x174,0x1ee,0x1d2,0x144)]=_0x475414;const _0x1e3507={};_0x1e3507[_0xe7e266(0x436,0x4f1,0x56a,0x54d)]=_0x13dd0b['jZJYs'],_0x1e3507['image_url']=_0x3361bb,_0x3d6092['push'](_0x1e3507),_0x13dd0b[_0xe7e266(0x64a,0x638,0x607,0x6e6)](addLog,_0xe7e266(0x4cc,0x540,0x55e,0x4b4)+'图模式：已添加待修改'+'的图片');}const _0x61cf01={};_0x61cf01[_0x592b73(0x1e5,0x210,0x167,0x148)]=_0x592b73(0x1b4,0x83,0xfb,0x54),_0x61cf01[_0x592b73(0xc8,0xdd,0x13a,0x1a0)]=_0x3d6092,_0xf3edcd[_0xe7e266(0x537,0x5ea,0x6a7,0x53b)](_0x61cf01),addLog(_0x592b73(0x29,0xf5,0xf3,0xa2)+_0xe7e266(0x568,0x4bd,0x52b,0x48f)+_0x567329);}const _0x50619d={};_0x50619d[_0xe7e266(0x5ea,0x549,0x565,0x566)+'o']=_0x4bdd2c;const _0x9f0224={};_0x9f0224[_0xe7e266(0x576,0x5ab,0x5a8,0x5f6)+'g']=_0x50619d,_0x2a90ea={'model':_0x121d36,'messages':_0xf3edcd[_0xe7e266(0x573,0x5c3,0x5a2,0x502)](_0x3d75a3=>_0x3d75a3[_0x592b73(0x8d,0x73,0x13a,0x1e2)][_0xe7e266(0x64f,0x58d,0x5a7,0x4f3)]>0x3*-0x2e5+-0x313*0x2+0xed5),'config':_0x9f0224},_0x13dd0b[_0x592b73(0x111,0x109,0x168,0xc5)](addLog,'[Banana]\x20B'+_0x592b73(0xab,0x5e,0x97,0xc1)+_0xe7e266(0x656,0x5d9,0x5d7,0x607)+_0x592b73(-0x4,0x16e,0xca,0xea)+_0x2a90ea[_0x592b73(0x168,0x106,0x16d,0x129)][_0xe7e266(0x4fe,0x58d,0x595,0x4cc)]+_0xe7e266(0x58e,0x560,0x60b,0x5c4));}let _0x317ce6=_0x16a8b0[_0x592b73(0x1bb,0x1a7,0x122,0x7e)](/\/$/,''),_0x23fbdb;_0x317ce6[_0x592b73(0x182,0x1ef,0x1c3,0x207)](_0x13dd0b[_0x592b73(0x14f,-0x3c,0x91,0xc0)])||_0x317ce6[_0xe7e266(0x460,0x511,0x522,0x554)](_0x13dd0b[_0xe7e266(0x69c,0x631,0x57c,0x61d)])?_0x13dd0b[_0x592b73(0x146,0x107,0xa9,0x5b)](_0x592b73(0x56,0x95,0x11e,0x1c4),_0x13dd0b[_0x592b73(0x33,-0x6b,0x52,0xf1)])?_0x12b2cc[_0x592b73(0xdb,0x7a,0xf6,0xa0)+'ion']=_0x3c0f7a:_0x23fbdb=_0x13dd0b[_0x592b73(0x103,0x9a,0x72,0x6)](_0x317ce6,_0x346c7f):_0x23fbdb=_0x317ce6+_0x13dd0b[_0xe7e266(0x4cc,0x4de,0x5a1,0x419)]+_0x346c7f;_0x23fbdb=_0x23fbdb['replace'](/\/v1\/v1\//g,_0xe7e266(0x5ce,0x5bd,0x65a,0x5b1));const _0xca4375=extension_settings[extensionName][_0xe7e266(0x572,0x633,0x628,0x645)];let _0xe6b6d,_0x32b646,_0x57fd85;if(_0x13dd0b[_0x592b73(-0x33,0x3c,0x6b,0xe2)](_0xca4375,_0x13dd0b['XWgRz'])){let _0x8efb98=_0x317ce6;!_0x8efb98[_0x592b73(0x1ab,0x20f,0x1c3,0x133)](_0x13dd0b['JsToT'])&&!_0x8efb98[_0x592b73(0x69,0x196,0xc4,0x18d)](_0x13dd0b['fyrel'])&&(_0x8efb98=_0x8efb98+_0x13dd0b[_0xe7e266(0x581,0x4de,0x4be,0x467)]);_0x8efb98=_0x8efb98[_0xe7e266(0x63c,0x56f,0x4f0,0x4bc)](/\/v1\/$/,_0x13dd0b['JsToT']),_0xe6b6d=_0x592b73(0x98,0xa8,0x14a,0x19d)+_0x592b73(0x122,0xcc,0xea,0x126)+_0x592b73(0x45,0xb0,0x8d,0xda)+_0x592b73(0x7d,0xe3,0x14c,0x143),_0x32b646=_0x13dd0b[_0xe7e266(0x553,0x4a2,0x4ce,0x4c6)](getRequestHeaders,window['token']);const _0x7b2d0={};_0x7b2d0[_0xe7e266(0x49f,0x4b6,0x4e9,0x524)+_0xe7e266(0x473,0x4ae,0x4b8,0x549)+'ce']=_0x13dd0b['zqKeF'],_0x7b2d0[_0x592b73(0x5d,0x11d,0x86,0x33)]=_0x8efb98,_0x7b2d0[_0xe7e266(0x495,0x4d9,0x535,0x58d)+_0xe7e266(0x566,0x55a,0x560,0x4bd)+'rs']=_0x592b73(0x91,0x15b,0xf6,0xfa)+_0x592b73(0x188,0x13a,0x1e7,0x1c3)+_0xe7e266(0x5a3,0x4f2,0x564,0x480)+_0x4e2d5a+'\x22',_0x7b2d0['model']=_0x121d36,_0x7b2d0[_0x592b73(0x1c4,0x1a0,0x16d,0x14c)]=_0x2a90ea['messages'],_0x7b2d0[_0xe7e266(0x62b,0x5f9,0x5ce,0x5a5)]=![],_0x57fd85=_0x7b2d0;if(_0x121d36[_0xe7e266(0x4f4,0x579,0x4f2,0x5b4)](_0x13dd0b[_0x592b73(0x26c,0x224,0x1f4,0x21b)])){if(_0x13dd0b[_0x592b73(-0x26,-0x27,0x6b,0xf9)](_0x13dd0b[_0xe7e266(0x58b,0x5af,0x619,0x559)],_0x13dd0b[_0xe7e266(0x503,0x5af,0x5c6,0x67e)])){_0x13dd0b[_0x592b73(0x13f,0x182,0x1d9,0x1a8)](addLog,_0xe7e266(0x438,0x4b0,0x541,0x42a)+_0x592b73(0x12,0xf8,0x7f,0xb2)+_0x592b73(0xc4,-0x8,0xa7,0x16c)+_0xe7e266(0x5d0,0x55d,0x4b9,0x5a4)),_0xe6b6d=_0x23fbdb;const _0x27752b={};_0x27752b[_0xe7e266(0x588,0x603,0x66b,0x63e)+'pe']=_0x13dd0b[_0x592b73(0xae,0x1fb,0x147,0x149)],_0x27752b[_0xe7e266(0x476,0x543,0x55b,0x539)+_0xe7e266(0x4d0,0x553,0x4e4,0x4ae)]=_0x592b73(0x174,0xf5,0x1c2,0x114)+_0x4e2d5a,_0x32b646=_0x27752b,_0x57fd85=_0x2a90ea;}else _0x12e0aa[_0x52c25e][_0xe7e266(0x615,0x5d6,0x594,0x685)][_0xe7e266(0x5b0,0x5e6,0x63b,0x58d)]=_0x3a3dab[_0x2ff0d7][_0x592b73(0xbe,0x17c,0x189,0x115)][_0x592b73(0x135,0x1dc,0x199,0x25d)]+(0x72b*-0x1+-0x2411+0x1*0x2b3d),_0x13dd0b['rqwUx'](_0x55808b,_0xe7e266(0x5b0,0x5a6,0x591,0x4f8)+_0x592b73(0x160,0xa0,0x12e,0xa2)+_0x38eb7a[_0x18f435]['banana'][_0xe7e266(0x5b3,0x5e6,0x5e7,0x66f)]);}addLog(_0x592b73(-0x20,0xf7,0x8f,0xed)+_0xe7e266(0x5b9,0x5f6,0x69a,0x5de));}else{if(_0x13dd0b[_0x592b73(0x1e3,0x164,0x1ee,0x2a7)](_0x13dd0b[_0xe7e266(0x5a8,0x4fe,0x4e1,0x46c)],_0x13dd0b[_0xe7e266(0x598,0x4fe,0x5a6,0x455)])){if(_0x5b5582){const _0x2e44c3=_0x586872[_0xe7e266(0x501,0x50b,0x55e,0x576)](_0x339c6d,arguments);return _0x38cb21=null,_0x2e44c3;}}else _0xe6b6d=_0x23fbdb,_0x32b646=_0x13dd0b['ZuqLt'](getDirectHeaders,_0x592b73(0x1be,0xc6,0x101,0x12e)+_0xe7e266(0x53b,0x515,0x5ba,0x52a),'Bearer\x20'+_0x4e2d5a),_0x57fd85=_0x2a90ea,_0x13dd0b['pZEzI'](addLog,_0x592b73(-0x3e,0xb9,0x8f,0x12)+'用直接请求模式');}function _0xe7e266(_0x31ec71,_0x5333c7,_0x4a4b36,_0x4d9dbc){return _0x37c4(_0x5333c7-0x2c6,_0x4d9dbc);}_0x13dd0b[_0xe7e266(0x55c,0x4f5,0x453,0x5bf)](addLog,'[Banana]\x20S'+_0x592b73(0x1b3,0x23c,0x17b,0x107)+_0xe7e266(0x523,0x5bc,0x675,0x519)+_0xe6b6d),_0x13dd0b[_0x592b73(0x248,0x1e7,0x1d7,0x14c)](addLog,_0x592b73(0x125,0xbd,0x5f,0xd2)+_0xe7e266(0x45b,0x4cf,0x401,0x535)+JSON[_0x592b73(0xf6,0xb0,0x182,0x21f)](_0x57fd85,null,-0x2615+-0x4d9*0x7+-0x2a*-0x1b7));try{taskQueue[_0xe7e266(0x590,0x592,0x577,0x5ed)+'us'](_0x2962fa,_0x13dd0b['bxSmV']);const _0x28f5c2=await _0x13dd0b[_0xe7e266(0x4e0,0x4b1,0x448,0x432)](fetch,_0xe6b6d,{'method':_0x13dd0b[_0xe7e266(0x451,0x50f,0x45f,0x52e)],'headers':_0x32b646,'body':JSON['stringify'](_0x57fd85)});if(!_0x28f5c2['ok']){const _0x1b826d=await _0x28f5c2['text']();throw new Error(_0x592b73(0x89,0xa4,0xdc,0x74)+_0x592b73(0x1f6,0x146,0x1f6,0x17d)+_0xe7e266(0x557,0x5fb,0x64f,0x645)+'\x20'+_0x28f5c2['status']+':\x20'+_0x1b826d);}const _0x59806a=await _0x28f5c2['json']();let _0x5a307d='';const _0x2c77b2=_0x59806a[_0x592b73(0x20e,0x148,0x18a,0x22f)];if(_0x2c77b2&&_0x13dd0b[_0x592b73(0x5e,0xd7,0xbd,-0x4)](_0x2c77b2[_0xe7e266(0x610,0x58d,0x614,0x584)],0x568+0x449+-0x9b1)){const _0x15ef91=_0x2c77b2[-0x87d+-0x1d6b+0x25e8][_0xe7e266(0x547,0x4e1,0x48c,0x4a5)]?.['content'];if(Array[_0x592b73(0x163,0x56,0x118,0xb5)](_0x15ef91))for(const _0xe9ad1d of _0x15ef91){if(_0x13dd0b[_0xe7e266(0x61f,0x63d,0x6ae,0x626)](_0xe9ad1d[_0x592b73(0xc3,0xf9,0xa4,0xc2)],_0x592b73(0xaf,0x197,0xee,0x1a6))&&_0xe9ad1d[_0xe7e266(0x4b9,0x53b,0x5fd,0x501)]){_0x5a307d=typeof _0xe9ad1d[_0x592b73(0x112,0x5d,0xee,0x194)]===_0xe7e266(0x588,0x4c6,0x478,0x41b)?_0xe9ad1d['image_url']:_0xe9ad1d[_0xe7e266(0x534,0x53b,0x4b1,0x604)][_0xe7e266(0x5bc,0x61f,0x6d4,0x5fb)];break;}}else{if(typeof _0x15ef91===_0x13dd0b['VvUds']){const _0x2b8e82=/!\[.*?\]\(((?:https?:\/\/|data:image\/[^;]+;base64,)[^\s\)]+)\)/,_0x318866=_0x15ef91[_0xe7e266(0x536,0x602,0x67c,0x67e)](_0x2b8e82);if(_0x318866&&_0x318866[0x19f0+-0x206*-0x9+0xeb7*-0x3]){const _0x355e10=_0x318866[-0x1e94*-0x1+0x1*-0xe02+-0x1091*0x1];if(_0x355e10['startsWith'](_0x13dd0b['IIDtw'])){if(_0x13dd0b[_0xe7e266(0x661,0x58e,0x620,0x56f)](_0x13dd0b[_0xe7e266(0x6be,0x5f3,0x59e,0x66d)],_0x13dd0b[_0x592b73(0x26f,0x160,0x1a6,0x247)])){const _0x4c7987={};_0x4c7987[_0xe7e266(0x5bf,0x4f1,0x4d5,0x534)]=_0x13dd0b[_0x592b73(0x76,0x6d,0x6a,-0x4b)],_0x4c7987[_0xe7e266(0x495,0x526,0x56d,0x58f)]=_0x12b44a;const _0x3b3db7={};_0x3b3db7[_0xe7e266(0x5af,0x5b4,0x669,0x578)]='user',_0x3b3db7[_0x592b73(0x115,0xee,0x13a,0x90)]=[_0x4c7987],_0x469623[_0xe7e266(0x549,0x5ea,0x643,0x620)](_0x3b3db7);}else addLog('[Banana]\x20D'+_0xe7e266(0x4db,0x52c,0x491,0x5bc)+_0xe7e266(0x4e9,0x5a9,0x507,0x522)+_0x592b73(0xaf,0x9c,0x99,0x6)+'64\x20image.'),_0x5a307d=_0x355e10,_0x13dd0b[_0xe7e266(0x62f,0x611,0x5f1,0x5a8)](addLog,_0x13dd0b[_0xe7e266(0x5e7,0x615,0x5f2,0x6cb)]);}else{if(_0x13dd0b[_0xe7e266(0x5ab,0x58e,0x527,0x60d)](_0x13dd0b[_0xe7e266(0x625,0x613,0x6b6,0x62d)],_0xe7e266(0x4ac,0x4d8,0x437,0x59d)))_0x3087c2[_0x4750bd][_0x592b73(0x239,0x117,0x189,0xce)][_0x592b73(0x125,0x265,0x199,0x192)]=-0x10da+-0x22*-0xef+0xee3*-0x1,_0x13dd0b['RCkiV'](_0x432b13,'当前生图次数为\x20fo'+_0xe7e266(0x4ab,0x57b,0x5cd,0x4d7)+_0x5d886[_0x3e7242][_0xe7e266(0x640,0x5d6,0x5e4,0x687)]['cishu']);else{_0x13dd0b['xnDSc'](addLog,_0x13dd0b[_0xe7e266(0x43a,0x4a6,0x44b,0x4a7)]),addLog('[Banana]\x20M'+_0x592b73(0x18b,0xd4,0xc0,0x15)+_0x592b73(0xfe,0xe2,0x156,0x127)+_0x355e10);try{if(_0x13dd0b[_0x592b73(0xcd,0x7c,0x141,0x132)](_0xe7e266(0x5a9,0x62a,0x657,0x642),_0x13dd0b[_0xe7e266(0x507,0x4a1,0x548,0x459)])){const _0x44d990=await fetch(_0x355e10,{'headers':_0x13dd0b[_0xe7e266(0x612,0x5fd,0x5c8,0x5f9)](getDirectHeaders)});if(!_0x44d990['ok'])throw new Error('Failed\x20to\x20'+_0x592b73(0x2e,0x9c,0xde,0x193)+_0xe7e266(0x4ac,0x4a8,0x445,0x54f)+_0x44d990[_0xe7e266(0x5a1,0x5f2,0x53b,0x654)]);const _0x1fca17=await _0x44d990['blob'](),_0x1b0b5c=await new Promise((_0x2fcfad,_0x469a04)=>{const _0x4cd769=new FileReader();_0x4cd769['onloadend']=()=>_0x2fcfad(_0x4cd769['result']),_0x4cd769[_0xe8a0ec(0x60,0x6c,0xe8,0x23)]=_0x469a04;function _0xe8a0ec(_0x4031e7,_0x4c8173,_0x156742,_0x567695){return _0x592b73(_0x4031e7-0x3a,_0x4c8173-0x37,_0x156742- -0x1f,_0x4031e7);}function _0xb00db(_0x239ab3,_0x5c4031,_0x47debb,_0x4eab6c){return _0x592b73(_0x239ab3-0x11e,_0x5c4031-0x154,_0x47debb-0x4be,_0x239ab3);}_0x4cd769['readAsData'+_0xe8a0ec(0x8b,0x92,0x107,0x106)](_0x1fca17);});_0x5a307d=_0x1b0b5c,_0x13dd0b[_0xe7e266(0x5e0,0x545,0x521,0x5e2)](String(extension_settings[extensionName][_0xe7e266(0x512,0x5dd,0x5c0,0x531)+_0xe7e266(0x6b3,0x5eb,0x61c,0x631)]),_0x13dd0b[_0x592b73(0xb2,0xf2,0x160,0x1f7)])&&(_0x13dd0b['XSQuD'](_0xe7e266(0x50f,0x56e,0x549,0x642),_0x592b73(0xc7,0x139,0x90,0xf9))?_0x5a307d=await convertImageToJpeg(_0x5a307d):_0x28cd7b(_0x592b73(0x183,0x127,0x188,0x217)+'库')),addLog('[Banana]\x20S'+_0xe7e266(0x5b3,0x629,0x665,0x57a)+'y\x20converte'+'d\x20Markdown'+_0x592b73(0x1ba,0x133,0x175,0xb5)+_0xe7e266(0x5de,0x52a,0x4a0,0x5a0));}else _0x2990b8[_0xe7e266(0x415,0x4c2,0x587,0x449)+_0x13078f+'\x20Prompt']&&(_0x429eb3=_0x13dd0b[_0x592b73(0x14f,0x11b,0x1e0,0x28d)](_0x13dd0b['lrUlQ'](_0x3a3032,_0xe7e266(0x47b,0x524,0x472,0x50c)),_0x13dd0b[_0xe7e266(0x5d2,0x57d,0x52c,0x626)](_0x55515a,_0x143a56[_0xe7e266(0x50f,0x4c2,0x540,0x4fd)+_0x257ac3+_0x592b73(0xe8,0x11c,0x115,0x1a1)])));}catch(_0x47910e){addLog('[Banana]\x20F'+'ailed\x20to\x20f'+_0xe7e266(0x582,0x57a,0x568,0x573)+_0x592b73(0x120,0x33,0xaf,0x15b)+'\x20'+_0x47910e[_0xe7e266(0x503,0x4e1,0x46b,0x533)]),_0x5a307d=_0x355e10,_0x13dd0b[_0x592b73(0x88,0xa6,0x6f,0x111)](addLog,_0x13dd0b['XiCGH']);}}}}else _0x13dd0b[_0x592b73(0xbd,0xaa,0x168,0x227)](addLog,_0x13dd0b['EAZbG']);}}}if(!_0x5a307d){if(_0x13dd0b['PFyDN'](_0x13dd0b[_0xe7e266(0x518,0x583,0x630,0x5b2)],_0x13dd0b[_0x592b73(0x133,0x1a2,0x136,0xd2)]))throw new Error(_0x13dd0b[_0x592b73(0x17c,0x17f,0x12f,0xf8)]);else _0x3b2ba5=_0x58cc91,_0x80f5b4=_0x13dd0b[_0xe7e266(0x646,0x59e,0x631,0x657)](_0x3e1ad8,_0x13dd0b[_0xe7e266(0x5ca,0x594,0x64d,0x5ce)],'Bearer\x20'+_0x24ec3a),_0x11421b=_0x10b09d,_0x13dd0b[_0xe7e266(0x6ec,0x638,0x676,0x68b)](_0x5311f6,_0xe7e266(0x55f,0x4dc,0x465,0x592)+_0x592b73(0xb5,0xfd,0x105,0x152));}return _0x13dd0b[_0xe7e266(0x4d5,0x501,0x500,0x49c)](addLog,_0x13dd0b[_0x592b73(0xe7,0x157,0xc7,0x4b)]),taskQueue['completeTa'+'sk'](_0x2962fa,!![]),currentTaskId=null,{'image':_0x5a307d,'change':_0x13dd0b['RLroW'](_0x1422a3,'')};}catch(_0x43de8a){if(_0x13dd0b[_0xe7e266(0x404,0x4b9,0x407,0x4cc)]===_0x13dd0b[_0xe7e266(0x51a,0x523,0x585,0x5be)])_0x13dd0b['uTtpl'](_0x372349,_0xe7e266(0x4a5,0x4c7,0x509,0x46a)+_0xe7e266(0x3ed,0x4b4,0x3e5,0x53d)+_0xe7e266(0x632,0x57a,0x612,0x62e)+'own\x20image:'+'\x20'+_0x90e03b['message']),_0x2158c1=_0x4c7f8a,_0x13dd0b[_0x592b73(0xf0,0x198,0xf7,0x19b)](_0x266d12,_0x13dd0b[_0xe7e266(0x462,0x4d7,0x4da,0x4e2)]);else{const _0x498771=_0x13dd0b[_0x592b73(0x124,0xf0,0xab,-0x24)][_0x592b73(0x11d,0x102,0x172,0xc5)]('|');let _0x3e4818=-0x43c+0x37*0x65+0x1*-0x1177;while(!![]){switch(_0x498771[_0x3e4818++]){case'0':currentTaskId=null;continue;case'1':console['error']('[Banana]\x20F'+_0xe7e266(0x4c7,0x51d,0x55e,0x53a)+':',_0x43de8a);continue;case'2':addLog(_0xe7e266(0x469,0x4c7,0x472,0x452)+'etch\x20error'+':\x20'+_0x43de8a['message']);continue;case'3':throw _0x43de8a;continue;case'4':if(_0x43de8a[_0x592b73(-0xf,0xf9,0x94,0x81)]===_0xe7e266(0x573,0x5b0,0x649,0x603)){}else taskQueue[_0xe7e266(0x5fa,0x5ef,0x55a,0x520)+'sk'](_0x2962fa,![]);continue;}break;}}}}function _0x37c4(_0x4b771a,_0x3ff04a){_0x4b771a=_0x4b771a-(-0xb8e+-0x1*-0x231a+-0x15b5);const _0x1b9f87=_0xd7d4();let _0x306647=_0x1b9f87[_0x4b771a];if(_0x37c4['gDOkOz']===undefined){var _0x580b0d=function(_0x390b46){const _0x1c8bc4='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x3b8a0b='',_0x58fc2f='',_0x6fadbc=_0x3b8a0b+_0x580b0d;for(let _0x536a5f=0x69f+0x52f*-0x4+-0xe1d*-0x1,_0x5a91c5,_0x175b9f,_0x1fdaa9=0x216c+-0x1a17+-0x755;_0x175b9f=_0x390b46['charAt'](_0x1fdaa9++);~_0x175b9f&&(_0x5a91c5=_0x536a5f%(-0xc*0x196+-0x21e7+-0xa97*-0x5)?_0x5a91c5*(-0x3a2+0x12c5+-0xee3)+_0x175b9f:_0x175b9f,_0x536a5f++%(-0x1eb6*-0x1+-0x1ada+-0x1*0x3d8))?_0x3b8a0b+=_0x6fadbc['charCodeAt'](_0x1fdaa9+(-0x1c68+0x1*0x23c3+0x1*-0x751))-(-0x776*-0x1+0xd*0x11c+-0x8*0x2bb)!==0x22+0x3*-0x49d+-0xdb5*-0x1?String['fromCharCode'](-0x18c3+-0x2517+-0x207*-0x1f&_0x5a91c5>>(-(0x83d+0x13ad+0x2f*-0x98)*_0x536a5f&-0x15d*0x13+0x105*0x23+-0x9c2)):_0x536a5f:-0xd8e+-0x1*-0x2159+-0x13cb){_0x175b9f=_0x1c8bc4['indexOf'](_0x175b9f);}for(let _0x42b142=0x3d*0xf+-0x1575+0x11e2,_0x1c077c=_0x3b8a0b['length'];_0x42b142<_0x1c077c;_0x42b142++){_0x58fc2f+='%'+('00'+_0x3b8a0b['charCodeAt'](_0x42b142)['toString'](0x1f98+-0x7*-0x551+-0x44bf))['slice'](-(-0x59b*-0x5+0x1*0x142d+-0x3032));}return decodeURIComponent(_0x58fc2f);};_0x37c4['bRlHrY']=_0x580b0d,_0x37c4['tCnzbW']={},_0x37c4['gDOkOz']=!![];}const _0x243c01=_0x1b9f87[-0x1*0x699+-0x201c+0x26b5],_0x3a1471=_0x4b771a+_0x243c01,_0x4275b6=_0x37c4['tCnzbW'][_0x3a1471];if(!_0x4275b6){const _0x7a9871=function(_0x2990b8){this['aDNFkN']=_0x2990b8,this['jnaggn']=[-0xe8a+0x8ee+-0x3*-0x1df,-0x1683+-0x6*-0x54e+-0x1*0x951,0x102d*-0x1+0x9c0+-0x66d*-0x1],this['VJmAWJ']=function(){return'newState';},this['MLMdwA']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['vlZKgn']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x7a9871['prototype']['YZNtAr']=function(){const _0x13078f=new RegExp(this['MLMdwA']+this['vlZKgn']),_0x50a559=_0x13078f['test'](this['VJmAWJ']['toString']())?--this['jnaggn'][-0x17f9+-0x1b04+0x32fe]:--this['jnaggn'][-0x1767+0x1073+0x6f4];return this['dMFfjI'](_0x50a559);},_0x7a9871['prototype']['dMFfjI']=function(_0x503a8b){if(!Boolean(~_0x503a8b))return _0x503a8b;return this['plCsTc'](this['aDNFkN']);},_0x7a9871['prototype']['plCsTc']=function(_0xefbfe2){for(let _0xd60f77=0x1d0d*0x1+0x2479*-0x1+0x76c,_0x25e5b1=this['jnaggn']['length'];_0xd60f77<_0x25e5b1;_0xd60f77++){this['jnaggn']['push'](Math['round'](Math['random']())),_0x25e5b1=this['jnaggn']['length'];}return _0xefbfe2(this['jnaggn'][0x96*-0x2b+0x38*0x37+0xa*0x151]);},new _0x7a9871(_0x37c4)['YZNtAr'](),_0x306647=_0x37c4['bRlHrY'](_0x306647),_0x37c4['tCnzbW'][_0x3a1471]=_0x306647;}else _0x306647=_0x4275b6;return _0x306647;}export async function bananaGenerate(_0x5f1a53){const _0x299c8b={'dmaQJ':function(_0x31ba42,_0x8470eb){return _0x31ba42||_0x8470eb;},'pKYND':_0x202b1d(0x20a,0x28c,0x26b,0x34d),'rIMjl':function(_0x3e22dc,_0x272c31){return _0x3e22dc(_0x272c31);},'DyoLL':_0x539e50(0x465,0x41b,0x544,0x4c9),'pEBwB':function(_0x127e26,_0x5f0eec){return _0x127e26(_0x5f0eec);},'CPudK':_0x539e50(0x3fb,0x40d,0x3b7,0x448)+_0x202b1d(0x286,0x26e,0x2bb,0x1df)+':','LWtDv':function(_0x2d3373,_0x375de9){return _0x2d3373===_0x375de9;},'JiDtg':function(_0x5df0e,_0x31eb2a){return _0x5df0e(_0x31eb2a);},'QSdcg':_0x202b1d(0x352,0x38b,0x3ef,0x44c)+_0x539e50(0x406,0x446,0x51a,0x4ad)+_0x202b1d(0x36c,0x2fa,0x31e,0x39c)+_0x539e50(0x51b,0x4bc,0x3fb,0x467)+_0x202b1d(0x17a,0x240,0x1e1,0x21a),'VVVUR':_0x202b1d(0x3ad,0x37d,0x42c,0x396)+'uccessfull'+'y\x20extracte'+_0x202b1d(0x308,0x285,0x325,0x357)+_0x539e50(0x607,0x5ac,0x4d1,0x55b)+_0x202b1d(0x2dc,0x388,0x378,0x43e),'hHBiI':_0x202b1d(0x3a9,0x378,0x374,0x2c6),'rGugN':_0x539e50(0x490,0x526,0x495,0x488)+_0x539e50(0x442,0x443,0x38b,0x436)+'。','ySSYd':function(_0x4505dc,_0x137d2d){return _0x4505dc(_0x137d2d);},'iRynX':_0x202b1d(0x2aa,0x363,0x3b7,0x2ba),'iDmQt':_0x202b1d(0x3d6,0x352,0x410,0x324),'aBPEi':'{修图}','AmOzz':function(_0x212cc6,_0x4be44f){return _0x212cc6===_0x4be44f;},'aBiiQ':_0x539e50(0x40b,0x4aa,0x42e,0x4b0),'vXToE':function(_0x44bf71,_0x372bba){return _0x44bf71(_0x372bba);},'cAXit':function(_0x3e58a6,_0x3ef9a1){return _0x3e58a6!=_0x3ef9a1;},'RVwpv':'zMVdn','puDcg':function(_0x588c2f,_0x411e11){return _0x588c2f(_0x411e11);},'hDgZw':function(_0x33e296,_0x7bd29e){return _0x33e296+_0x7bd29e;},'PJNKi':function(_0x32f87e,_0x47b0ad){return _0x32f87e(_0x47b0ad);},'ddapt':_0x202b1d(0x2c0,0x267,0x2c1,0x1bb),'KGcZA':function(_0x271022,_0xac45f4){return _0x271022(_0xac45f4);},'TpPhZ':function(_0x5c314d,_0x53c4eb){return _0x5c314d!==_0x53c4eb;},'zrpQh':_0x202b1d(0x27f,0x212,0x1e0,0x2c0),'lJxYT':_0x202b1d(0x267,0x30c,0x373,0x2c1),'mMemK':function(_0x2e4654,_0x56f275){return _0x2e4654(_0x56f275);},'SuXUo':function(_0x203c67,_0x2f7444){return _0x203c67(_0x2f7444);}};function _0x539e50(_0x100f28,_0x586f03,_0x233e0b,_0x2ba4e6){return _0x37c4(_0x2ba4e6-0x247,_0x233e0b);}clearLog();let {id:_0x5d6087,prompt:_0x489b61,width:_0x3a93a2,height:_0xcfa4d0,change:_0x48a758,retouchPrompt:_0xecf0b1,retouchImage:_0x4fa5e9}=_0x5f1a53;currentRequestId=_0x5d6087,currentPrompt=_0x489b61,_0x299c8b['ySSYd'](addLog,'[Banana]\x20R'+_0x539e50(0x5cd,0x558,0x57c,0x533)+'age\x20genera'+_0x539e50(0x4e1,0x523,0x41c,0x46c)+'st\x20(ID:\x20'+_0x5d6087+')');let _0x377aba='';if(_0x48a758){if(_0x299c8b[_0x539e50(0x529,0x461,0x48d,0x521)]!==_0x299c8b[_0x202b1d(0x357,0x391,0x2dd,0x37b)])_0x377aba=_0x48a758['replaceAll'](_0x299c8b['aBPEi'],'');else{const _0x6efb40=[],_0x1fba9c=_0x299c8b[_0x202b1d(0x341,0x335,0x31a,0x35c)](_0x15f549,_0x51f687),_0x3bc497=[_0x4842b2[_0x202b1d(0x454,0x390,0x3ce,0x3a3)+'t'],_0x1fba9c,_0x1c3291[_0x539e50(0x3bb,0x477,0x520,0x471)+_0x539e50(0x4d7,0x5d3,0x540,0x587)]][_0x202b1d(0x3d8,0x314,0x2f2,0x352)](_0x177f31)[_0x202b1d(0x151,0x1fa,0x1dd,0x204)](',\x20'),_0x227c22={};_0x227c22[_0x202b1d(0x29c,0x242,0x17f,0x226)]=_0x539e50(0x43e,0x4b1,0x486,0x4a7),_0x227c22[_0x202b1d(0x1d6,0x277,0x203,0x2f2)]=_0x3bc497,_0x6efb40['push'](_0x227c22);if(_0x198e74){const _0x4e9c77={};_0x4e9c77[_0x539e50(0x5ad,0x567,0x565,0x5a0)]=_0x551536;const _0x3f2ca9={};_0x3f2ca9[_0x202b1d(0x2f1,0x242,0x1f6,0x30b)]=_0x299c8b['pKYND'],_0x3f2ca9['image_url']=_0x4e9c77,_0x6efb40[_0x202b1d(0x380,0x33b,0x2cb,0x278)](_0x3f2ca9),_0x299c8b[_0x202b1d(0x241,0x29b,0x20e,0x1f3)](_0x35ad43,'[Banana]\x20修'+_0x202b1d(0x2a8,0x283,0x331,0x334)+'的图片');}const _0xcd88ae={};_0xcd88ae[_0x202b1d(0x325,0x305,0x395,0x29f)]=_0x299c8b[_0x539e50(0x40e,0x416,0x46e,0x41e)],_0xcd88ae['content']=_0x6efb40,_0xc83470['push'](_0xcd88ae),_0x299c8b['rIMjl'](_0x5ea5a5,_0x539e50(0x530,0x3fd,0x54a,0x4c1)+_0x202b1d(0x13d,0x20e,0x1c1,0x194)+_0x3bc497);}}else{if(_0x299c8b['AmOzz'](_0x299c8b[_0x539e50(0x55b,0x63a,0x5ce,0x59a)],'gOHWD')){_0x299c8b[_0x539e50(0x44e,0x540,0x42c,0x4a8)](_0x1977ab,_0x202b1d(0x196,0x218,0x268,0x152)+'etch\x20error'+':\x20'+_0x45b08b[_0x202b1d(0x255,0x232,0x1c2,0x297)]),_0x52bd42[_0x202b1d(0x2f9,0x286,0x246,0x33e)](_0x299c8b[_0x539e50(0x4ac,0x523,0x542,0x52f)],_0x1f83e1);if(_0x299c8b[_0x202b1d(0x284,0x2a1,0x233,0x313)](_0x130696[_0x202b1d(0x25b,0x232,0x2ea,0x1f6)],_0x539e50(0x4f9,0x4ad,0x4f1,0x531))){}else _0x44c8c8['completeTa'+'sk'](_0x257806,![]);_0x83f67a=null;throw _0x34b927;}else _0x377aba=_0x489b61;}if(_0x48a758&&_0x48a758[_0x202b1d(0x2ee,0x262,0x1cb,0x298)]('{修图}')){addLog(_0x539e50(0x497,0x4c4,0x3f1,0x47e)+'启动');if(_0xecf0b1)_0x299c8b[_0x539e50(0x534,0x5eb,0x4f9,0x546)](addLog,_0x202b1d(0x292,0x2be,0x34e,0x281)+_0xecf0b1);if(_0x4fa5e9)_0x299c8b[_0x202b1d(0x2b0,0x271,0x28b,0x1be)](addLog,_0x202b1d(0x309,0x238,0x1bb,0x18b)+']');}function _0x202b1d(_0x49d579,_0x251a5e,_0x2dac5a,_0x4998e0){return _0x37c4(_0x251a5e-0x17,_0x4998e0);}try{const {image:_0x416922,change:_0x18cf54}=await _0x299c8b['rIMjl'](generateBananaImage,{'prompt':_0x489b61,'width':_0x3a93a2,'height':_0xcfa4d0,'change':_0x48a758,'retouchPrompt':_0xecf0b1,'retouchImage':_0x4fa5e9});if(_0x299c8b[_0x202b1d(0x304,0x2ba,0x291,0x2ba)](extension_settings[extensionName][_0x539e50(0x56c,0x639,0x5e5,0x579)],'0')){if(_0x299c8b['LWtDv'](_0x299c8b['RVwpv'],'qHlgb'))_0x299c8b[_0x202b1d(0x3fe,0x355,0x341,0x373)](_0x3e30b1,_0x299c8b[_0x539e50(0x490,0x467,0x5d4,0x505)]),_0x154a67=_0x30ce4c,_0x222877(_0x299c8b['VVVUR']);else{const _0x6de6c1={};_0x6de6c1[_0x539e50(0x62b,0x54c,0x597,0x563)]=_0x377aba,await setItemImg(_0x489b61,_0x416922,_0x6de6c1),_0x299c8b['puDcg'](addLog,'图像已存入数据库\x20f'+'or\x20prompt:'+'\x20'+_0x489b61),extension_settings[extensionName]['banana'][_0x202b1d(0x2e2,0x337,0x2f8,0x28c)]?(extension_settings[extensionName]['banana'][_0x539e50(0x58d,0x535,0x50c,0x567)]=_0x299c8b['hDgZw'](extension_settings[extensionName][_0x539e50(0x569,0x4c0,0x4df,0x557)][_0x202b1d(0x373,0x337,0x36e,0x37c)],-0x1e9a+0x2f5+0x2*0xdd3),addLog(_0x539e50(0x4cc,0x5ee,0x570,0x527)+_0x202b1d(0x218,0x2cc,0x336,0x2d8)+extension_settings[extensionName][_0x539e50(0x608,0x502,0x5aa,0x557)]['cishu'])):(extension_settings[extensionName][_0x202b1d(0x399,0x327,0x34b,0x2e0)][_0x539e50(0x4eb,0x5f0,0x4fb,0x567)]=-0x67f*0x4+0x15c5+0x438,_0x299c8b[_0x202b1d(0x328,0x2bd,0x270,0x36a)](addLog,_0x539e50(0x5de,0x4c3,0x595,0x527)+_0x202b1d(0x2ca,0x2cc,0x2a4,0x218)+extension_settings[extensionName][_0x539e50(0x515,0x487,0x4eb,0x557)]['cishu']));}}else{if(_0x299c8b[_0x202b1d(0x26d,0x244,0x185,0x227)](_0x299c8b[_0x539e50(0x5af,0x61b,0x549,0x566)],_0x299c8b[_0x202b1d(0x38f,0x336,0x30c,0x287)]))_0x299c8b[_0x539e50(0x3de,0x44b,0x4b7,0x460)](addLog,_0x202b1d(0x375,0x326,0x2af,0x2d0)+'库');else{const _0x560c6e={};_0x560c6e['role']=_0x299c8b[_0x539e50(0x50d,0x581,0x462,0x532)],_0x560c6e['content']=_0x38bb45,_0x474ce9['push'](_0x560c6e);}}const _0x4c3076={};_0x4c3076['id']=_0x5d6087,_0x4c3076['success']=!![],_0x4c3076['imageData']=_0x416922,_0x4c3076['prompt']=_0x489b61,_0x4c3076[_0x539e50(0x4e6,0x58e,0x4c3,0x563)]=_0x377aba,eventSource[_0x539e50(0x54f,0x498,0x577,0x54f)](EventType[_0x539e50(0x4fd,0x4f8,0x3c1,0x44b)+_0x539e50(0x4e6,0x482,0x541,0x4dd)+_0x202b1d(0x266,0x21e,0x1e7,0x19d)],_0x4c3076),_0x299c8b['rIMjl'](addLog,_0x539e50(0x48c,0x4f9,0x4cf,0x54a)+_0x202b1d(0x3b2,0x387,0x2b6,0x3b0)+_0x539e50(0x4c7,0x362,0x470,0x426)+_0x539e50(0x5e5,0x4b7,0x48b,0x512)+':\x20'+_0x5d6087);}catch(_0x85c02){if(_0x299c8b[_0x202b1d(0x3f0,0x323,0x38c,0x2da)](_0x299c8b[_0x202b1d(0x3cb,0x33e,0x3a2,0x291)],_0x299c8b[_0x539e50(0x55a,0x4ac,0x4f1,0x514)])){const _0x5f4cc7=_0x202b1d(0x286,0x254,0x1ad,0x2b1)+'eneration\x20'+'failed\x20for'+_0x539e50(0x468,0x3e2,0x513,0x452)+_0x5d6087+':\x20'+_0x85c02[_0x539e50(0x4d4,0x489,0x4ec,0x462)];_0x299c8b[_0x539e50(0x569,0x58b,0x4db,0x4bb)](addLog,_0x5f4cc7),console[_0x539e50(0x4b0,0x472,0x4c0,0x4b6)](_0x5f4cc7);const _0x46e26c={};_0x46e26c['id']=_0x5d6087,_0x46e26c[_0x202b1d(0x1c4,0x293,0x21d,0x31b)]=![],_0x46e26c[_0x539e50(0x491,0x52d,0x521,0x4b6)]=_0x85c02[_0x202b1d(0x1b5,0x232,0x1ef,0x2d7)],_0x46e26c[_0x202b1d(0x355,0x32f,0x3e9,0x35c)]=_0x489b61,eventSource['emit'](EventType[_0x539e50(0x38f,0x4b2,0x444,0x44b)+_0x202b1d(0x289,0x2ad,0x230,0x2cb)+_0x539e50(0x3a8,0x507,0x453,0x44e)],_0x46e26c),_0x299c8b[_0x202b1d(0x1ff,0x27f,0x34a,0x260)](addLog,'[Banana]\x20E'+_0x539e50(0x484,0x506,0x444,0x50c)+_0x202b1d(0x1fe,0x23a,0x1a0,0x298)+_0x539e50(0x5b9,0x53d,0x4ef,0x512)+':\x20'+_0x5d6087);}else{_0x365b9d(_0x299c8b[_0x539e50(0x4e7,0x4c5,0x4b6,0x4b2)]);const _0x1078f9=_0x299c8b['dmaQJ'](_0x238f0b,'默认'),_0x5cdfcf={};_0x5cdfcf[_0x202b1d(0x2a4,0x26a,0x2af,0x25e)+'on']=[],_0x5cdfcf['fixedPromp'+'t']='',_0x3de981=_0x5a588d[_0x1078f9]||_0x5cdfcf,_0x299c8b[_0x202b1d(0x2eb,0x278,0x1eb,0x271)](_0x2dfd93,'[Banana]\x20使'+_0x202b1d(0x2de,0x35d,0x40e,0x377)+_0x1078f9+'\x22');}}}function handleCancelBananaTask(_0x23c9b3){function _0x5b33de(_0x2c7f74,_0xaf1156,_0x518602,_0x53b4d4){return _0x37c4(_0x2c7f74-0x65,_0xaf1156);}const _0x57378a={'KRUnc':function(_0x6116cc,_0x1b3d23){return _0x6116cc(_0x1b3d23);},'sxxTe':_0xbb878c(0x4c,0xb4,0xfb,0x186),'oRlaC':function(_0x19fd23,_0x5514a9){return _0x19fd23(_0x5514a9);},'SUAsm':'任务已取消'},{taskId:_0x56939a}=_0x23c9b3;function _0xbb878c(_0x3b8419,_0x4bfa6b,_0x4db334,_0x726447){return _0x37c4(_0x4bfa6b- -0x28b,_0x4db334);}_0x57378a[_0x5b33de(0x2e5,0x320,0x33d,0x2d7)](addLog,'[Banana]\x20收'+_0xbb878c(0x37,0x39,0x97,-0xa)+'askID:\x20'+_0x56939a+')');if(currentTaskId===_0x56939a&&currentRequestId){const _0x16a871=_0x57378a['sxxTe']['split']('|');let _0x2f1acc=0x1aa2+-0x1*0xd17+-0xd8b;while(!![]){switch(_0x16a871[_0x2f1acc++]){case'0':currentPrompt=null;continue;case'1':_0x57378a[_0xbb878c(0x46,-0x2,0xb6,0x17)](addLog,_0x5b33de(0x296,0x2c0,0x2ed,0x2a2)+_0xbb878c(-0x103,-0x96,-0xf1,-0x121)+_0xbb878c(-0x28,-0x97,-0xa3,-0x8)+currentRequestId+')');continue;case'2':currentRequestId=null;continue;case'3':currentTaskId=null;continue;case'4':const _0x1774ae={};_0x1774ae['id']=currentRequestId,_0x1774ae['success']=![],_0x1774ae['error']=_0x57378a['SUAsm'],_0x1774ae['prompt']=currentPrompt||'',eventSource[_0x5b33de(0x36d,0x35f,0x2d3,0x384)](EventType['GENERATE_I'+'MAGE_RESPO'+_0xbb878c(0x4d,-0x84,0x2,-0x9b)],_0x1774ae);continue;}break;}}}function initializeBananaListener(){const _0x36346b={'LYhTf':_0x532816(0xe3,0x25,0x76,-0x45)+_0x532816(-0x26,-0x24,0x8d,-0x66)+_0x48eea6(-0x17a,-0x129,-0xeb,-0x17c),'YbhTB':function(_0x24fa20,_0x29fa8e){return _0x24fa20(_0x29fa8e);},'jgvrQ':_0x48eea6(-0x62,-0x12f,-0xa6,0x23)+'件监听器已初始化。'};eventSource['on'](EventType[_0x532816(-0x2b,-0xf0,-0x139,-0x84)+'MAGE_REQUE'+'ST'],bananaGenerate);function _0x532816(_0x17a37a,_0x4c8622,_0x5ebc46,_0x591640){return _0x37c4(_0x4c8622- -0x2f4,_0x5ebc46);}eventSource['on'](_0x36346b[_0x48eea6(-0x153,-0x19e,-0xcf,-0x149)],handleCancelBananaTask);function _0x48eea6(_0x50795e,_0x5a95e5,_0x28d4b4,_0x3e6c49){return _0x37c4(_0x28d4b4- -0x33f,_0x5a95e5);}_0x36346b['YbhTB'](addLog,_0x36346b[_0x48eea6(-0x5b,-0xa4,-0x68,0x1b)]);}export async function replaceWithBanana(){const _0xae5f13={'UCcLv':'[Banana]\x20生'+_0x5c6996(0x31e,0x40a,0x399,0x31d),'rCtFb':function(_0x4da130,_0x54278f){return _0x4da130!==_0x54278f;},'YseEU':_0x1499a8(-0x81,-0x44,-0x4c,0x45),'AfiRM':_0x5c6996(0x389,0x399,0x3c0,0x455),'CZaoN':function(_0x5ecad1,_0x426905){return _0x5ecad1==_0x426905;},'BtWkR':_0x1499a8(-0x29,-0x50,0x6c,-0xb7),'FErjo':function(_0x5c0de1){return _0x5c0de1();},'RDORW':function(_0x434534,_0x221992){return _0x434534===_0x221992;},'XAfxu':'PVuQs','wDJnK':function(_0x2dd3d5,_0xcbbafb){return _0x2dd3d5!==_0xcbbafb;},'lolzg':'xZRXI','YIGyR':_0x1499a8(-0x34,-0xc9,-0x2b,-0xa7),'EXfLs':'st_chatu8_'+_0x1499a8(-0x69,0x2,-0x38,0x36)+'ana_task','iquNR':function(_0x28cf7f,_0x195750){return _0x28cf7f(_0x195750);}};function _0x1499a8(_0x48910d,_0x23d55e,_0x40bb5a,_0x48257c){return _0x37c4(_0x48910d- -0x339,_0x48257c);}function _0x5c6996(_0x137b22,_0x9a73fd,_0x4d2f32,_0x1186df){return _0x37c4(_0x4d2f32-0x7c,_0x9a73fd);}if(_0xae5f13[_0x5c6996(0x3f7,0x3b8,0x38a,0x2c8)](extension_settings[extensionName][_0x5c6996(0x37a,0x345,0x2f5,0x336)],_0xae5f13[_0x1499a8(-0x3e,0xd,-0x94,0x60)]))!window['initialize'+_0x5c6996(0x2dd,0x2f1,0x2e9,0x2a9)+_0x5c6996(0x380,0x2d4,0x31c,0x36f)]&&(window[_0x5c6996(0x3eb,0x3eb,0x391,0x38f)+_0x1499a8(-0xcc,-0x165,-0x193,-0x16e)+_0x5c6996(0x35a,0x3a0,0x31c,0x379)]=!![],_0xae5f13['FErjo'](initializeBananaListener)),_0xae5f13[_0x1499a8(0x1c,0x5a,-0xb6,0x19)](initializeImageProcessing);else{if(_0xae5f13[_0x5c6996(0x38a,0x2c4,0x35d,0x312)](_0xae5f13[_0x1499a8(-0x32,0x94,-0x57,-0x6b)],_0x5c6996(0x335,0x351,0x31d,0x3aa))){const _0x2a67c9='0|3|4|1|2'[_0x5c6996(0x447,0x2eb,0x375,0x33d)]('|');let _0x1e5fa7=0x252e*0x1+-0x833+-0x3*0x9a9;while(!![]){switch(_0x2a67c9[_0x1e5fa7++]){case'0':_0x50d1d2[_0x1499a8(-0xec,-0x1d,-0x69,-0x52)+_0x1499a8(-0x99,-0xdf,-0xd8,-0xa1)](_0x4967c2[_0x1499a8(-0x135,-0xf9,-0x19a,-0x206)+_0x5c6996(0x347,0x368,0x314,0x28b)+'ST'],_0x2fa7c8);continue;case'1':_0x1aef28[_0x5c6996(0x32d,0x423,0x391,0x423)+_0x1499a8(-0xcc,-0xfb,-0xae,-0x187)+_0x5c6996(0x349,0x29c,0x31c,0x2ef)]=![];continue;case'2':_0x10568d(_0xae5f13[_0x5c6996(0x25a,0x1fd,0x2ce,0x2fa)]);continue;case'3':_0x429b53[_0x5c6996(0x30b,0x275,0x2c9,0x28b)+'ener']('st_chatu8_'+'cancel_ban'+_0x5c6996(0x37e,0x243,0x2d0,0x286),_0x2199d0);continue;case'4':_0x392c93[_0x1499a8(-0xc7,-0xb5,-0x33,-0x160)](_0x1cff3e=>{function _0x221f5c(_0x4877c4,_0x277426,_0x119d38,_0x27aaf4){return _0x5c6996(_0x4877c4-0xa1,_0x27aaf4,_0x4877c4- -0x39f,_0x27aaf4-0x168);}function _0x5d44ea(_0x42c357,_0x498cf4,_0x26b6cb,_0x58aff1){return _0x1499a8(_0x42c357-0x4cd,_0x498cf4-0x83,_0x26b6cb-0x131,_0x58aff1);}_0x3004f4[_0x5d44ea(0x3e1,0x33e,0x32c,0x43d)+_0x221f5c(-0x83,-0xd5,-0x97,-0xda)](_0x1cff3e,_0x4ae57c);});continue;}break;}}else window[_0x5c6996(0x3c0,0x40b,0x391,0x3f1)+_0x1499a8(-0xcc,-0x11b,-0x20,-0x126)+'ener']&&(_0xae5f13[_0x1499a8(-0x39,0x2c,-0xa2,-0x1)](_0xae5f13['lolzg'],_0xae5f13[_0x5c6996(0x363,0x3e7,0x3b6,0x442)])?(eventSource[_0x5c6996(0x289,0x2aa,0x2c9,0x34b)+_0x1499a8(-0x99,-0x6c,-0x25,-0x85)](EventType['GENERATE_I'+_0x1499a8(-0xa1,-0x6c,-0x2a,-0x57)+'ST'],bananaGenerate),eventSource['removeList'+'ener'](_0xae5f13[_0x5c6996(0x264,0x362,0x32c,0x270)],handleCancelBananaTask),LEGACY_EVENT_NAMES[_0x1499a8(-0xc7,-0x137,-0xbb,-0xda)](_0x2a084a=>{function _0x12e87d(_0x12690a,_0x59f428,_0x459675,_0x320a01){return _0x1499a8(_0x59f428-0x1b6,_0x59f428-0x11c,_0x459675-0x19,_0x459675);}function _0xe56e15(_0x587709,_0x8d7a58,_0x5e17fe,_0xade6d0){return _0x5c6996(_0x587709-0x1a4,_0x8d7a58,_0x5e17fe- -0x2d0,_0xade6d0-0x155);}if(_0xae5f13[_0xe56e15(-0x15,-0xdf,-0x1b,-0x2a)](_0xae5f13[_0xe56e15(0x12,-0x75,-0x12,-0x16)],_0xae5f13[_0x12e87d(0x242,0x1ec,0x1a0,0x13d)]))eventSource[_0x12e87d(0x116,0xca,0xba,0x173)+_0x12e87d(0x144,0x11d,0x18e,0x10f)](_0x2a084a,bananaGenerate);else return _0x2cb9e7[_0x12e87d(-0x17,0x92,0xba,0x10d)];}),window[_0x1499a8(-0x24,0x5,0x8f,0x6d)+'BananaList'+_0x5c6996(0x2a3,0x269,0x31c,0x28a)]=![],_0xae5f13['iquNR'](addLog,_0xae5f13[_0x5c6996(0x2ec,0x28a,0x2ce,0x2da)])):_0x5dec7f=_0x2cc34f[_0x1499a8(-0xf1,-0x133,-0x29,-0x154)](_0x1499a8(0x0,0x18,-0x7d,0x75),''));}}